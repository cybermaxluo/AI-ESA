# 6.1 应用安全战略与业务对齐

应用安全战略是企业安全架构的核心支柱之一。它不仅定义"保护什么、如何保护、保护到什么程度",更关键的是建立安全与业务、开发、运营的协同机制,将安全从"事后补救"转变为"内生能力"。本节聚焦业务驱动的应用安全体系建设,通过安全 BP(Business Partner)机制、业务流程分析、威胁建模、目标指标与 Policy as Code,实现安全需求与业务目标的深度对齐。

![API 安全架构](../../../assets/images/chapter_06/06_API_Security_Architecture_v6.png)

---

## 6.1.1 应用安全架构框架基础

企业应用安全建设常面临三个核心困境:第一,安全团队、开发团队、业务团队对"什么是好的应用安全"理解不一致,导致需求对齐困难;第二,工具、流程、人员各自为政,无法形成体系化能力,投资分散且效率低下;第三,缺乏客观的成熟度基准,不知道当前处于什么水平,也不清楚下一步该优化什么。

标准化框架提供三个关键价值:提供统一的能力模型,让跨部门对"应用安全包含哪些能力"达成共识,消除沟通障碍;提供成熟度基准,明确当前水平与目标差距,将抽象的"安全能力提升"转化为可量化的分级目标,指导投资优先级决策;提供最佳实践参考,复用已验证的安全模式,避免重复造轮子和试错成本。

### 主流框架对比

| 框架 | 发布方 | 核心特点 | 适用场景 | 成熟度层级 |
|------|--------|----------|----------|------------|
| **OWASP SAMM** | OWASP | 开源、社区驱动、轻量级 | 中小企业、快速起步 | 3 级(初始/管理/量化) |
| **BSIMM** | Synopsys | 基于真实数据、描述性 | 大型企业、对标行业 | 3 级 × 4 能力域 × 12 实践域 |
| **NIST SSDF** | NIST | 政府背书、供应链视角 | 政府、金融、关基 | 4 类 × 12 实践 |
| **ISO/IEC 27034** | ISO | 国际标准、全面但复杂 | 合规导向企业 | 框架性指导 |

#### OWASP SAMM(Software Assurance Maturity Model)

OWASP SAMM 将应用安全能力划分为 5 大业务功能:Governance(治理)、Design(设计)、Implementation(实施)、Verification(验证)、Operations(运营),每个功能下包含 3 个实践,共 15 个安全实践。每个实践分为初始级、管理级、量化级三个成熟度等级。

其核心优势在于:开源免费,社区活跃,更新及时;提供在线评估工具和详细指导文档;轻量级,适合快速起步和迭代优化。

典型应用场景包括:初创公司可使用 SAMM 快速评估当前状态,选择 3-5 个优先级最高的实践进行建设,6 个月后复评,逐步提升成熟度;传统企业数字化转型可对标 SAMM 成熟度模型,识别差距,制定 3 年路线图,每年提升 1 级成熟度,使用 SAMM 工具箱快速落地最佳实践。

#### BSIMM(Building Security In Maturity Model)

BSIMM 将应用安全能力划分为 4 大能力域:Governance(治理)、Intelligence(情报)、SSDL Touchpoints(安全开发生命周期)、Deployment(部署),每个能力域下包含 3 个实践域,共 12 个实践域,包含 119 个活动。

其核心特点在于:BSIMM 是描述性而非规范性,它告诉你"别人在做什么",而非"你应该做什么";基于真实企业数据,每年发布基于 100+ 企业的调研报告,提供行业基准数据;支持社区对标,可与同行业、同规模企业对比,了解自己的相对位置。

典型应用场景包括:大型企业可使用 BSIMM 评估工具进行自评,对比 BSIMM 年度报告,了解行业平均水平,识别自身优势和短板,制定针对性改进计划;在安全预算论证时,可展示 BSIMM 数据说服管理层增加安全投资,制定 3-5 年成熟度提升路线图。

#### NIST SSDF(Secure Software Development Framework)

NIST SSDF 将安全开发实践划分为 4 类:Prepare the Organization(准备组织)、Protect the Software(保护软件)、Produce Well-Secured Software(生产安全软件)、Respond to Vulnerabilities(响应漏洞),每类包含 2-4 个实践组,共 12 个实践组。SSDF 特别强调供应链安全,关注第三方组件、开源软件、供应商管理。

其核心优势在于:政府背书,权威性强,适合合规要求高的行业;供应链视角完整,覆盖软件全生命周期;与其他 NIST 标准(如 NIST 800-53、NIST CSF)无缝衔接。

典型应用场景包括:政府/金融行业可按照 NIST SSDF 建立安全开发框架,满足监管要求(如 FISMA、PSD2 等),通过第三方审计认证;在供应链安全治理中,使用 SSDF 的供应链实践指导 SBOM 管理,建立第三方组件风险评估机制,实施供应商安全评估流程。

### 框架选择与实施策略

框架选择应基于企业规模、行业特点、合规要求进行。推荐组合如下:初创/中小企业采用 OWASP SAMM + NIST SSDF(供应链部分),SAMM 轻量快速,SSDF 补充供应链能力;大型企业采用 BSIMM(对标) + OWASP SAMM(实践),BSIMM 提供行业基准,SAMM 提供具体落地指导;政府/金融采用 NIST SSDF + ISO 27034,满足合规要求,权威性强;全球化企业采用 BSIMM + OWASP SAMM + ISO 27034,覆盖行业对标、实践落地、国际标准。

框架落地应遵循"聚焦-评估-迭代-工具化"的渐进路径。首先避免框架堆砌,选择 1-2 个框架作为主框架,其他框架仅作补充参考;其次在任何改进之前使用框架工具进行成熟度评估,建立基线了解现状;根据业务风险和资源约束定优先级,聚焦 3-5 个优先级最高的实践域,而非全面铺开导致资源分散;采用小步快跑策略,每半年复评一次,逐步提升成熟度,避免一次性投入过大但收效甚微;最后充分利用工具降低评估成本,如 SAMM Toolbox 提供自动化评估报告,BSIMM 在线评估工具可与同行对比。

---

## 6.1.2 建立协作机制:安全 BP 与治理流程

### 为什么需要安全 BP 机制?

传统安全团队常处于"被动响应"状态:业务发布在即,安全评审压缩至 1-2 天;安全需求未在设计阶段前置,导致临门一脚的返工;多个安全团队(架构、应用安全、运营)各自对接业务,业务方不知道该找谁。安全 BP(Business Partner)机制通过以下方式解决这些问题:统一安全服务入口,业务方只需对接一个安全 BP,由 BP 协调后端资源;前置安全介入,在需求阶段、架构设计阶段嵌入安全评审,而非发布前临门一脚;建立常态化协同通道,通过季度/月度/周度例会机制,将安全融入业务节奏。

### 安全 BP 组织与职责

安全 BP 机制包含以下核心角色:

**安全 BP(安全业务合作伙伴)**: 对应业务线的第一安全接口,负责需求受理、评审协调、风险沟通与决策推动。BP 应具备业务理解能力(熟悉业务流程、数据流、核心指标)与安全专业能力(STRIDE 威胁建模、SDL 流程、常见攻击面)。

**架构安全负责人**: 把关架构级控制与跨域依赖,评审系统架构图、数据流图、信任边界、外部依赖,提出架构层面的安全建议。

**安全工程与平台负责人**: 负责工具链与 Policy as Code 的门禁实施,维护 SAST/DAST/SCA 工具,配置 CI/CD 质量门禁,管理策略规则库。

**业务负责人/产品经理/研发经理**: 需求方,负责提供业务上下文(业务流程、数据分级、外部依赖、里程碑),承诺整改资源与时限。

### 协作与例会节奏

安全 BP 机制应建立多层次例会节奏:

**季度例会(安全治理委员会)**: 由 GRC 团队主导,参与方包括安全负责人、业务负责人、技术负责人。会议议题包括:确认策略/制度更新,复盘年度目标与资源投入,审批重大安全例外(如豁免某项安全检查)。

**月度例会(业务部门安全例会)**: 由安全 BP 主导,参与方包括业务线安全 BP、业务负责人、研发经理、运营负责人。会议议题包括:复盘月度安全指标(漏测率、门禁阻断率、MTTR),通报重大风险与事件,评审下月发布计划与资源协调。

**周度例会(项目看板/需求评审会)**: 由安全 BP 主导,参与方包括项目经理、开发负责人、测试负责人。会议议题包括:评审新增需求与安全影响,跟踪整改进度与例外项,同步工具链变更与策略更新。

**日常工单(统一需求入口)**: 通过工单系统(如 Jira Service Desk)收口所有安全请求,BP 首审并分级。

### 需求受理与 SLA

安全 BP 应建立统一的需求受理入口与 SLA 承诺。典型的服务目录包括:应用安全需求评审、发布评审、代码审计、渗透测试、移动安全评估、逆向分析服务、第三方/供应商评估、紧急响应、安全例外申请等。

需求应按优先级分级,并绑定 SLA:

- **P1(紧急)**: 适用于生产环境高危漏洞、重大安全事件、监管要求紧急整改等,承诺当日答复/48 小时结论。
- **P2(高)**: 适用于发布前评审、重要业务需求评估、中危漏洞修复等,承诺 2 个工作日结论。
- **P3(中)**: 适用于常规需求评审、低危漏洞修复、安全咨询等,承诺 5 个工作日结论。

### 流程与产出

安全 BP 机制的核心流程包括:

**输入**: 业务方提供 PRD/BRD、系统架构图、数据分级清单、外部依赖清单、项目里程碑等。

**活动**: 安全 BP 进行需求澄清,梳理数据/接口清单,进行初步风险评估,编排所需安全服务(如需要威胁建模、代码审计、渗透测试等)。

**产出**: 输出受理单,给出评审结论(通过/限条件通过/补充材料/拒绝并建议替代方案),制定整改计划(责任人/时间/验收标准)。

**闭环**: 发布后验证控制措施是否生效,收集经验回收到知识库/规则库/门禁策略中。

### CI/CD 安全流水线与质量门禁

CI/CD 安全流水线通过多层质量门禁确保代码从开发到部署的全链路安全。典型的质量门禁包括:

| 阶段 | 关键安全活动 | 典型工具(开源) | 质量门禁 |
| --------- | -------------------------------------- | --------------------------------------------------- | ------------------------------------------- |
| 开发/编码 | IDE 安全插件、Secrets 预扫描、预提交钩子 | Gitleaks、Pre-commit | 违反高危规则阻断提交,异常入知识库 |
| 提交/合并 | 代码评审、分支保护、合规检查 | Gitea、GitLab CE、代码评审模板 | 需两人复核,高危缺陷不得合并 |
| 构建 | SAST、SCA、SBOM 生成、制品签名 | Semgrep、OWASP Dependency-Check、Syft/Grype、Cosign | 高危漏洞阻断构建,SBOM 与签名缺失禁止入库 |
| 测试 | DAST、IAST、API 测试、移动安全测试 | OWASP ZAP、Schemathesis、MobSF | 扫描通过方可进入制品仓库,例外需补充缓解措施 |
| 制品入库 | 镜像扫描、配置基线、合规校验 | Trivy、OPA/Kyverno | 未通过镜像扫描或基线检查不得发布 |
| 部署前 | IaC 分析、金丝雀策略、发布审批 | Atlantis、Argo CD、Flux | 双人审批,重大变更需回滚预案审核 |
| 部署/运行 | RASP、WAF、日志监控 | OpenRASP、ModSecurity/Coraza、Wazuh | 关键告警触发自动化响应,输出运营工单 |
| 反馈 | 度量回收、规则调优、经验固化 | 度量看板、规则仓库、知识库 | 形成整改闭环并定期复盘 |

阻断策略应绑定责任团队与 SLA,例外需设置缓解措施与自动到期提醒,并将证据同步进入安全审计平台以便审计。

### 成功标准

安全 BP 机制的成功标准包括:受理即时确认率≥95%;按 SLA 出结论≥90%;上线后返工率季度下降;业务方满意度≥90%(季度调查)。

---

## 6.1.3 分析业务流程:端到端场景、数据与边界

### 为什么需要业务流程分析?

威胁建模的前提是"理解系统在做什么、处理什么数据、与谁交互"。没有清晰的业务流程分析,威胁建模就会流于形式,成为无法指导开发和测试的文档。业务流程分析通过以下方式建立威胁建模的基础:识别关键资产(用户账户、订单、支付信息、个人数据等),明确"保护什么";绘制数据流图,明确数据如何流动、在哪里存储、谁可以访问,识别"攻击面在哪里";识别信任边界,明确系统边界、网络边界、身份边界、合规边界,划定"需要重点防护的区域"。

### 方法与产出

业务流程分析应采用以下方法:

**过程建模**: 使用 BPMN/SIPOC/事件风暴,划清"发起→处理→完成"的主干与关键分支。BPMN(业务流程建模符号)可清晰表达流程步骤、决策点、异常分支;SIPOC(供应商-输入-过程-输出-客户)适合梳理端到端流程;事件风暴适合跨团队协作,快速识别领域事件与边界。

**数据流图(DFD)**: 绘制 Level 0/1 数据流图,标注实体(用户、外部系统)、存储(数据库、对象存储)、处理(微服务、函数)、流向(API 调用、消息队列)与信任边界(跨区域/跨 VPC/跨账号)。DFD 应明确标注哪些数据流跨越信任边界,这些边界是威胁建模的重点关注区域。

**资产盘点**: 盘点应用/微服务、数据库、消息队列、对象存储、API(内部/外部)、密钥/证书、第三方 SaaS 等资产。资产盘点应包含资产属性:数据敏感度、暴露面(内网/公网)、访问控制方式、数据保留期限等。

**外部依赖清单**: 盘点支付/物流/风控/营销等第三方依赖,明确集成方式(SDK/API/回调/离线导入)、数据交换范围、鉴权方式、SLA 要求等。外部依赖是供应链安全的重点关注区域,需评估第三方的安全能力与合规资质。

### 电商典型主链路与敏感点

以电商场景为例,典型主链路与安全敏感点包括:

**上架**: 需关注图片与富文本过滤(防止 XSS、恶意内容)、供应商接口安全(鉴权、限流)、价格与库存一致性(防止恶意篡改)。

**下单**: 需关注购物车安全(防止负数库存、价格篡改)、优惠体系安全(高欺诈/薅羊毛敏感,需风控联动)、限流与限速(防止恶意下单)。

**支付**: 需关注跳转/托管支付安全(防止钓鱼、中间人攻击)、对账机制(检测异常交易)、幂等性(防止重复支付)、回调验签(防止伪造回调)、支付票据保护(敏感数据脱敏)。

**履约**: 需关注 WMS/TMS 对接安全(供应商鉴权、数据完整性)、地址与联系方式隐私(脱敏、最小化)、跨境合规(GDPR/PIPL 数据出境要求)。

**售后**: 需关注退款退货流程安全(身份核验、防止欺诈)、敏感凭证上传(图片与 PDF 防恶意文件)。

### 数据识别与标记

数据识别应覆盖以下数据类型:

**PII(个人可识别信息)**: 姓名、身份证号、手机号、邮箱、地址、人脸照片等,需加密存储、脱敏展示、访问审计。

**支付敏感数据**: 银行卡号、CVV、支付密码、交易流水等,需高等级加密、PCI-DSS 合规、严格访问控制。

**账号凭据**: 用户密码、API Key、Token、会话 ID 等,需散列存储(密码)、短期有效(Token)、传输加密。

**业务机密**: 定价策略、供应商合同、经营数据等,需访问控制、加密存储、泄露监测。

**日志与遥测**: 操作日志、审计日志、性能指标等,需保留期限管理、敏感信息脱敏、集中存储。

数据识别应建立元数据标记机制:数据拥有者(责任团队)、系统归属(所属应用)、保留期限(合规要求)、敏感级别标签(公开/内部/机密/高度机密)、跨境限制(是否可出境、需要哪些合规手续)。

信任边界应显式标记:任何身份/网络/合规边界均应在数据流图中显式标记,并明确审计要求。典型的信任边界包括:用户侧与应用侧(需鉴权)、应用侧与数据侧(需授权)、内网与公网(需网络隔离)、不同云账号(需跨账号鉴权)、不同地域(需跨境合规)。

### 产出清单

业务流程分析应输出以下交付物:业务流程图(BPMN/SIPOC)、数据流图(DFD Level 0/1)、资产清单(应用/数据/外部依赖)、数据目录(含分类分级)、外部依赖清单(含集成方式与鉴权)、信任边界图(标注身份/网络/合规边界)。

---

## 6.1.4 识别安全需求:威胁→控制→验证

### 威胁建模方法

威胁建模是 SDL 流程的关键起点,通过系统化识别资产威胁与控制措施,指导后续的安全设计、代码评审、测试与运营。典型的威胁建模框架包括:

**STRIDE**: STRIDE 是微软提出的经典威胁建模框架,将威胁分为六类:Spoofing(伪造,如伪造身份、会话劫持)、Tampering(篡改,如修改数据、注入攻击)、Repudiation(抵赖,如否认操作、缺乏审计)、Information Disclosure(信息泄露,如敏感数据暴露、权限绕过)、Denial of Service(拒绝服务,如资源耗尽、限流不当)、Elevation of Privilege(提权,如越权访问、权限升级)。STRIDE 可与数据流图(DFD)结合,对每个数据流、存储、处理逐一枚举威胁。

**OWASP Top 10/API Top 10**: OWASP Top 10:2025 覆盖常见应用层威胁,包括:失效的访问控制(A01)、安全配置错误(A02)、软件供应链失效(A03,2025 新增)、加密失效(A04)、注入(A05,含 SQL/XSS/命令注入)、不安全设计(A06)、身份认证失效(A07)、软件和数据完整性失效(A08)、日志与告警失效(A09)、异常条件处理不当(A10,2025 新增)。OWASP API Top 10:2023 覆盖 API 特有威胁,包括:对象级授权失效(API1)、身份认证失效(API2)、对象属性级授权失效(API3)、不受限资源消耗(API4)、功能级授权失效(API5)、敏感业务流程的不受限访问(API6)、服务端请求伪造(API7)、安全配置错误(API8)、资产管理不当(API9)、不安全的 API 消费(API10)。

**MITRE ATT&CK**: MITRE ATT&CK 提供攻击者 TTP(战术、技术、过程)知识库,可用于威胁建模中的攻击路径分析,识别攻击者可能使用的技术与检测措施。

### 资产-威胁-控制映射

威胁建模应对每个关键资产(账户、支付、订单、API、后台系统、构建链)枚举威胁场景与候选控制。以账户接管/暴力破解为例:

**威胁**: 攻击者通过暴力破解、凭据填充、钓鱼攻击等方式获取用户账户控制权。

**控制**: 实施 MFA(多因素认证),登录限速/验证码,IP/设备/行为风控(检测异常登录行为),密码强度要求与散列升级(使用 bcrypt/Argon2 等慢哈希算法)。

**验证**: 测试 MFA 绕过、验证码绕过、限速绕过,确认控制措施有效;监控异常登录告警,确认检测能力生效。

其他常见威胁与控制包括:

**越权/访问控制**: 实施统一鉴权与细粒度授权(RBAC/ABAC),使用不可猜测 ID(UUID 而非自增 ID),实施对象级鉴权(每次操作检查用户是否有权访问该对象)。

**注入与反序列化**: 使用参数化查询(而非拼接 SQL),实施严格输入校验(白名单优于黑名单),禁止危险反序列化(或使用安全配置),部署 WAF 基线规则。

**数据泄露**: 实施最小权限原则,数据加密(静态加密/传输加密),使用密钥管理服务托管密钥,实施脱敏与代币化,记录敏感数据访问审计日志。

**供应链投毒**: 使用受控包源(内部镜像源),实施 SCA(软件成分分析),生成 SBOM(软件物料清单),签名制品与验签,部署恶意包检测。

**API 滥用**: 在 API 网关实施限速/配额/突发控制,鉴权豁免需例外审批流程,实施 Schema 校验(OpenAPI/GraphQL Schema),使用请求签名防篡改。

### 误用/滥用案例

除了技术层面的威胁建模,还需关注业务层面的误用/滥用案例。运营/营销活动常见的滥用场景包括:薅羊毛(利用优惠券规则漏洞批量套利)、刷单(虚假交易刷好评或销量)、优惠券套利(批量注册账号领取优惠券并转卖)。这些场景需建立业务风控联动,结合设备指纹、行为分析、图关系分析等手段进行识别与阻断。

### 风险评估与处置

威胁识别后应进行风险评估,确定优先级。风险评分公式为:R = L × I(可能性 × 影响)。可能性评估应结合 CVSS/EPSS 与业务暴露面,影响评估应结合数据敏感度、业务重要性、合规要求等。

风险处置策略包括:修复(实施控制措施消除风险)、缓解(降低风险可能性或影响)、转移(通过保险或第三方转移风险)、接受(低风险或修复成本过高,接受残余风险)。风险接受需走例外审批流程,并设定复评时间。

| 阶段 | 目标 | 工具/方法 | 主要输出 |
| ---------- | ---------------------- | ---------------------------------------------- | ------------------------------ |
| 资产识别 | 明确保护对象及敏感度 | CMDB、流程图、数据分类清单 | 资产-数据-依赖列表 |
| 威胁建模 | 覆盖攻击路径与业务滥用 | STRIDE、OWASP Top 10、MITRE ATT&CK、误用案例库 | 威胁场景矩阵、攻击树 |
| 控制映射 | 为威胁匹配防御措施 | ASVS/MASVS、零信任策略库、业务风控规则 | 候选控制清单、策略草案 |
| 风险评估 | 确定优先级与资源投入 | CVSS/EPSS、风险评分引擎、专家研判 | 风险等级、缓解计划、例外建议 |
| 验证与回溯 | 评估控制有效性 | SAST/DAST/IAST、CI/CD 门禁、运行时检测 | 复测结论、监控告警、知识库条目 |

风险接受必须经过例外流程并设定复评时间,处理结果需进入指标看板与审计平台。

---

## 6.1.5 确定业务目标:SMART/OKR 化

### 为什么需要 SMART/OKR 化目标?

安全目标如果停留在"提升安全能力"这样的抽象表述,就无法指导资源投入与优先级决策,也无法衡量工作成效。SMART 原则(Specific/Measurable/Achievable/Relevant/Time-bound)与 OKR(Objectives and Key Results)方法可将抽象目标转化为可衡量、可达成、有时限的关键结果。

### 目标设定原则

目标设定应遵循以下原则:与业务战略一致(安全目标服务于业务目标,而非自说自话);可衡量(基于工具化数据,而非主观判断);可达成(分阶段设定,避免一步到位导致挫败感);对交付有效(不拖慢研发速度,平衡安全与效率)。

### 典型目标与关键结果示例

以下是三个典型的应用安全 OKR 示例:

**O1:实现安全左移,减少生产高危问题**

- KR1:漏测率降至≤5%(外部发现漏洞数 ÷ 总漏洞数)
- KR2:高危漏洞 MTTR≤3 天(从发现到修复上线的平均时长)
- KR3:门禁阻断率控制在 3%-10% 健康区间(阻断率过低说明门禁不严,过高说明误报过多)

**O2:提升供应链可信度与可追溯性**

- KR1:SBOM 覆盖率≥90%(生成 SBOM 的服务数 ÷ 服务总数)
- KR2:签名制品占比≥95%(已签名制品数 ÷ 生产发布制品总数)
- KR3:SLSA 达成 L2→L3(按 SLSA 框架逐级提升供应链安全成熟度)

**O3:提升团队安全能力与协作效率**

- KR1:培训覆盖率≥90%(参加安全培训的研发人员数 ÷ 研发人员总数)
- KR2:安全评审覆盖率≥90%(经过安全评审的项目数 ÷ 项目总数)
- KR3:自动化处置率≥80%(自动闭环事件数 ÷ 总事件数)

---

## 6.1.6 设定关键指标:业务/过程/结果/成熟度

### 指标分层

应用安全指标体系应分为四层:业务类指标(保障业务目标)、过程类指标(左移与效率)、结果类指标(质量与效果)、成熟度类指标(体系能力)。

**业务类指标(保障业务目标)**:

- 关键路径安全事件数(交易/支付/账户等核心链路的安全事件)
- 对 GMV/MAU 影响的安全问题为零(确保安全问题不影响业务核心指标)

**过程类指标(左移与效率)**:

- 评审覆盖率≥90%(经过安全评审的项目数 ÷ 项目总数)
- 门禁阻断率 3%-10%(过低说明门禁不严,过高说明误报过多)
- SLA 达成率≥90%(按 SLA 出结论的工单数 ÷ 总工单数)
- 自动化率≥80%(自动化处置的事件数 ÷ 总事件数)

**结果类指标(质量与效果)**:

- 漏测率≤5%(外部发现漏洞数 ÷ 总漏洞数)
- 误报率持续下降(误报漏洞数 ÷ 总报告漏洞数)
- MTTR/MTTD(平均修复时长/平均检测时长)
- 在逃漏洞趋势(已知未修复的漏洞数量与趋势)

**成熟度类指标(体系能力)**:

- SDL(BSIMM)≥6 分(BSIMM 评分达到行业中等水平)
- DSOMM 分级逐季提升(DevSecOps 成熟度模型)
- MASVS L1 覆盖度提升(移动应用安全验证标准)
- SLSA 达成 L2→L3(供应链安全成熟度)

### 核心指标计算公式

以下是核心指标的计算公式与口径说明:

```
漏测率(季度) = (外部发现漏洞数 ÷ 总漏洞数) × 100%
外部发现漏洞数范围:外部白帽/SRC/赏金平台/第三方渗透测试/监管检查发现的漏洞数
总漏洞数:内部发现漏洞数 + 外部发现漏洞数

平均修复时长(MTTR) = Σ 漏洞修复用时 ÷ 关闭漏洞数
修复用时:从漏洞发现到修复上线的时长(工作日)

门禁阻断率 = 被门禁阻断的构建/发布次数 ÷ 总构建/发布次数
健康区间:3%-10%(过低说明门禁不严,过高说明误报过多)

SBOM 覆盖率 = 生成 SBOM 的服务数 ÷ 服务总数

签名制品占比 = 已签名制品数 ÷ 生产发布制品总数

自动化处置率 = 自动闭环事件数 ÷ 总事件数
自动闭环:无需人工介入即完成检测→响应→修复的事件
```

### 指标属性与治理

每个指标需明确以下属性:定义(口径与范围,避免歧义)、数据源(工具/平台/工单系统,确保可追溯)、采集周期(周/月/季,匹配决策节奏)、阈值(红黄绿,触发行动项)、责任人(指标 Owner,负责改进)、行动项触发条件(如漏测率连续两季度>5% 触发专项改进)。

指标治理应避免以下误区:过度关注形式合规(如扫描覆盖率 100%),而忽视实质效果(真实修复率低);缺乏过程质量验证,导致"走过场"式的 SDL 执行;博弈行为普遍存在(如标记误报、风险接受代替真实修复)。

指标治理应建立质量验证机制:定期抽查扫描结果与修复证据,确认是否真实修复;对比内部发现与外部发现的漏洞类型,识别扫描盲区;对风险接受与例外项进行复审,避免滥用。

---

## 6.1.7 业务与数据分级:标准化与管控映射

### 为什么需要分级管控?

"一刀切"的安全管控会导致两个问题:对低风险业务过度管控,增加不必要的成本与摩擦;对高风险业务管控不足,导致重大安全事件。分级管控通过业务重要性与数据敏感度分级,实现差异化安全投入与管控强度,在安全与效率之间取得平衡。

### 数据分级(四级体系)

数据分级应建立统一的分类标准,典型的四级体系包括:

**公开(Public)**:可公开信息,无需保密。示例:市场宣传资料、公开的产品介绍。控制:无特殊要求。

**内部(Internal)**:仅内部员工可见,不得外传。示例:一般运营数据、内部流程文档。控制:员工访问控制,禁止公网暴露。

**机密(Confidential)**:对业务有实质性影响,泄露会造成经济损失或竞争劣势。示例:非公开经营指标、供应商合同、未发布的产品计划。控制:加密存储、访问审计、最小权限、禁止下载或需审批。

**高度机密(Restricted)**:对公司/客户风险极高,泄露会造成重大法律/合规/声誉风险。示例:PII(个人可识别信息)、支付敏感数据、密钥材料、敏感业务数据。控制:加密(静态加密/传输加密)、MFA(多因素认证)、审计留存、脱敏/代币化、备份加密与恢复演练。

### 业务分级(五类)

业务分级应基于业务重要性与风险影响,典型的五类包括:

**核心交易**: 订单、支付、账户等核心交易链路,中断或故障直接影响 GMV/收入。

**支付**: 支付链路,涉及资金流转,需满足 PCI-DSS 等合规要求。

**账户**: 用户账户、身份认证,是所有业务的基础,需最高等级保护。

**营销**: 促销、优惠券、积分等营销活动,高欺诈/薅羊毛风险,需风控联动。

**分析/BI**: 数据分析、报表、BI,不直接面向用户,但涉及敏感数据聚合。

### 控制映射

分级管控应建立分级与控制措施的映射关系:

**发布窗口**: 核心交易/支付/账户需遵守变更冻结期(如大促前一周禁止变更),需变更审批委员会批准。

**额外测试**: 核心交易/支付/账户需额外渗透测试、压力测试、金丝雀发布。

**额外监测**: 核心交易/支付需额外的交易异常监测、欺诈检测、对账核查。

**审批人**: 核心交易/支付/账户需双人审批或高层审批,其他业务可单人审批。

### 标签与治理

数据与系统需打标签,标签包括:敏感度(公开/内部/机密/高度机密)、归属(责任团队)、跨境限制(是否可出境、需哪些合规手续)、留存期(数据保留期限,满足合规要求)。

例外审批应绑定标签级别:标签级别越高,例外审批越严格(如高度机密数据的访问例外需 CISO 批准),周期性复核(季度/半年复审,避免长期例外)。

---

## 6.1.8 安全需求即代码:Policy as Code

### 为什么需要 Policy as Code?

传统的"安全规范文档"存在以下问题:规范是自然语言,存在理解歧义,难以自动化验证;规范变更缓慢,无法跟上业务与技术演进;规范执行依赖人工审查,效率低且容易遗漏。Policy as Code 通过将抽象的安全要求转化为可机读、可验证、可审计的策略与测试,嵌入 CI/CD 与平台控制面,实现安全规范的自动化执行与持续验证。

### 策略域与工具

Policy as Code 应覆盖以下策略域:

**代码与依赖**:

- SAST 规则:定义代码安全规则(如禁止 SQL 拼接、禁止硬编码密钥、禁止危险函数)。
- SCA 政策:定义 CVE 阈值(如高危 CVE 阻断构建)、许可证白名单(如禁止 GPL 许可证)。
- 敏感信息规则:定义敏感信息检测规则(如 API Key、私钥、密码等)。

**基础设施与集群**:

- IaC 策略:使用 Checkov/Terrascan 等工具检测 Terraform/CloudFormation 配置,禁止不安全配置(如 S3 公开访问、IAM 过度权限)。
- K8s 策略:使用 OPA Gatekeeper/Kyverno 等工具检测 K8s 资源配置,禁止特权容器、强制资源限额、镜像签名与验签、只读根文件系统。

**CI/CD**:

- Runner 最小权限:CI/CD Runner 仅授予必要权限,禁止 Runner 访问生产环境。
- 短期令牌:CI/CD 使用短期令牌(如 OIDC Token),避免长期凭据泄露。
- 双人审批:生产发布需双人审批,关键变更需高层审批。
- 强制质量门禁顺序:代码必须先通过 SAST/SCA/DAST 扫描,才能进入制品仓库。

**API**:

- OpenAPI 契约校验:API 必须符合 OpenAPI Spec,Schema 校验不通过的请求被拒绝。
- 鉴权豁免白名单与审批:默认所有 API 需鉴权,豁免需例外审批流程。
- 速率限制与配额策略:定义 API 限速规则(如 100 req/min),配额规则(如每用户每天 1000 次调用)。

**平台/网关**:

- WAF/限流/认证策略版本化:策略规则存储在代码仓库,变更走代码评审流程。
- 按环境分层:Dev/Test/Prod 环境使用不同的策略配置,生产环境最严格。

### 流水线集成点

Policy as Code 应嵌入 CI/CD 流水线的关键检查点:

**预提交/PR**: 规范检查、Secrets 扫描、轻量 SAST、契约校验。在开发者提交代码前,IDE 插件或 Pre-commit Hook 即进行检查,快速反馈。

**构建**: SAST 全量扫描、SCA 扫描、SBOM 生成与签名。构建时进行完整扫描,高危问题阻断构建。

**制品入库**: CVE/许可证门禁、签名校验。只有通过扫描且已签名的制品才能进入制品仓库。

**部署**: K8s/IaC 策略门禁、Admission 验签、环境基线校验。部署前检查配置是否符合策略,未签名镜像禁止部署。

**运行**: 策略漂移检测、异常行为报警、策略回滚保护。运行时监测配置是否发生漂移,异常行为触发告警。

### 策略治理

Policy as Code 需建立策略治理机制:

**策略仓库与版本管理**: 策略规则存储在 Git 仓库,变更走代码评审流程,保留历史版本。

**策略变更评审**: 策略变更需安全团队评审,重大变更需业务负责人确认影响。

**灰度与回滚机制**: 新策略先在测试环境验证,再灰度到生产环境,发现问题快速回滚。

**策略测试(正/反用例)**: 每个策略规则需配套正向用例(符合策略的配置)与反向用例(违反策略的配置),确保规则有效。

**例外管理**: 策略命中可触发自动化例外申请流程,例外需明确:时间受控(如临时豁免 7 天)、范围受限(仅豁免特定项目/服务)、审计留痕(记录豁免原因与审批人)。

---

## 本节小结

本节建立了业务驱动的应用安全战略体系,通过安全 BP 机制、业务流程分析、威胁建模、目标指标与 Policy as Code,实现安全需求与业务目标的深度对齐。核心要点包括:

**安全 BP 机制**: 统一服务入口 + 分级响应 + 闭环流程,避免安全服务碎片化。通过季度/月度/周度例会机制,将安全融入业务节奏。

**业务流程分析**: 通过 BPMN/DFD/资产盘点,识别关键资产、数据流与信任边界,为威胁建模建立基础。

**威胁建模方法论**: 应用 STRIDE 框架 + OWASP Top 10 + MITRE ATT&CK,前置风险识别。威胁建模需配套质量验证与闭环机制,避免流于形式。

**目标指标体系**: 采用 SMART 原则与 OKR 方法,建立业务/过程/结果/成熟度四层指标,将抽象目标转化为可衡量的关键结果。

**分级管控**: 四级数据分类(公开/内部/机密/高度机密)× 五类业务分级(核心交易/支付/账户/营销/分析),实现差异化安全投入。

**Policy as Code**: 策略代码化 + CI/CD 集成 + 例外管理自动化,将安全规范转化为可机读、可验证、可审计的策略规则。

### 关键成功因素

**威胁建模必须"有牙齿"**: 威胁建模不能停留在文档层面,需配套质量验证(检查威胁覆盖度)、执行闭环(控制措施落地并验证)、结果导向(漏测率等指标驱动)、案例库更新(将实际攻击场景回收到威胁库)。

**Policy as Code 渐进式推广**: 新策略需分阶段推广(先测试环境验证,再灰度到生产),确保误报率<10%(过高会导致团队绕过),建立标准化豁免流程(避免滥用风险接受)。

**数据与业务分级**: 明确安全投入优先级,避免"一刀切"导致的过度管控或管控不足。

### 常见误区与应对

**误区 1:威胁建模流于形式**: 威胁建模文档仅为应付流程,未真正识别业务关键风险,文档与开发/测试脱节。应对:建立威胁建模质量评审机制,检查威胁覆盖度与控制措施有效性;将威胁建模结果转化为测试用例,验证控制措施是否生效。

**误区 2:Policy as Code 误报过高**: 策略规则定义过于理想化,不考虑历史遗留和现实约束,导致误报率高,开发团队绕过或禁用安全检查。应对:策略规则需分阶段推广,先在新项目试点,再逐步覆盖存量项目;建立例外管理机制,允许合理豁免但需审计留痕。

**误区 3:安全指标与真实风险脱节**: 指标关注形式合规(如扫描覆盖率 100%),忽视实质效果(真实修复率低),导致"走过场"式的 SDL 执行。应对:建立过程质量验证机制,定期抽查扫描结果与修复证据;对比内部发现与外部发现的漏洞类型,识别扫描盲区。

---

**下一节预告**: [6.2 应用安全架构设计](./6.2_appsec_architecture_design.md) 将深入应用安全架构的设计方法,包括安全架构框架(TOGAF、SABSA、零信任)、威胁建模方法论(STRIDE、PASTA、LINDDUN)、安全设计原则(纵深防御、最小权限、隐私设计)与参考架构,构建可持续、可扩展的安全架构体系。

---

## 📍 导航 | Navigation

**[← 返回章节目录](./README.md)** | **[→ 下一节: 6.2 应用安全架构设计](./6.2_appsec_architecture_design.md)**

---

© 2025 AI-ESA Project. Licensed under CC BY-NC-SA 4.0

