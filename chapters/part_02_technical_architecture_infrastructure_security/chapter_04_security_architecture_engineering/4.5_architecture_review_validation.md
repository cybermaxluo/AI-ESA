# 4.5 架构评审与验证

本节阐述安全架构评审流程、评审方法（包括安全设计评审 SDR、威胁分析、控制验证）、文档规范与评审委员会（ARB）运作机制，目标是确保架构设计质量与合规性可验证、可追溯。

---

## 4.5.1 安全架构评审流程

### 评审机制定义

安全架构评审（security architecture review，SAR）是一种结构化的审查机制，用于验证系统设计是否符合安全原则、满足合规要求、并将风险控制在可接受范围内。SAR 的核心价值在于将安全控制前置到设计阶段，避免开发后期或上线后发现架构性缺陷导致的高昂修复成本。

SAR 的适用边界需要明确：新系统设计、涉及敏感数据处理、暴露互联网接口、满足监管要求的场景属于强制触发范围；技术栈重大变更、第三方集成、跨境数据传输属于推荐触发范围；小规模功能迭代、配置优化、内部工具则可采用轻量评审或豁免机制。SAR 不适用于纯运维配置调整（如防火墙规则微调），此类场景应通过变更管理流程处理。

### 评审触发条件

下表列出了不同触发类型的分级标准。选择这些维度是因为它们直接影响评审的资源投入与深度要求：紧急程度决定评审排期优先级，评审深度决定投入的架构师人力与时间。

| 触发类型 | 触发条件 | 紧急程度 | 评审深度 |
|---------|---------|---------|---------|
| 强制触发 | 新系统或重大架构变更、处理敏感数据、暴露互联网接口、监管要求 | 高 | 深度评审 |
| 推荐触发 | 技术栈重大变更、第三方集成、跨境数据传输 | 中 | 标准评审 |
| 可选触发 | 小规模功能迭代、配置优化、内部工具 | 低 | 轻量评审 |
| 周期触发 | 生产系统年度复审、关键系统季度复审 | 中 | 合规评审 |

触发条件的权衡在于：过于宽泛的强制触发会导致评审成为业务瓶颈，过于狭窄则会漏过高风险项目。建议根据组织风险偏好和安全架构师资源设定阈值，并定期根据评审积压情况调整。

![架构评审流程](../../../assets/images/chapter_04/10_Architecture_Review_v6.png)

### 五阶段评审流程

SAR 采用五阶段流程，每个阶段有明确的输入、活动、输出与时限要求。

**阶段一：申请与分级（Intake & Triage）**。项目经理或架构师提交评审申请表与项目文档，安全架构办公室（SAO）进行初步评估，按风险分级（Critical/High/Medium/Low）分配评审团队。此阶段的关键约束是快速分流——延迟分级会导致评审积压。输出为评审计划与评审团队分配。

**阶段二：文档审查（Document Review）**。安全架构师异步审查架构文档、数据流图（DFD）、威胁模型（如有），检查文档完整性（架构图、数据流、控制清单），识别初步问题并准备评审问题清单。此阶段的常见误区是文档不完整——缺少 DFD 或信任边界标注会导致威胁分析无法有效执行。输出为初步审查报告与问题清单。

**阶段三：正式评审会议（Review Meeting）**。召开评审会议，参与者包括架构师、开发负责人、产品、安全、GRC、隐私等角色。会议内容包括问题讨论与澄清、风险评估与决策。此阶段的关键约束是会议效率——若问题清单未提前分发，会议将变成文档宣读而非决策讨论。输出为评审决策（通过/整改/例外）与行动项清单。

**阶段四：整改跟踪（Remediation Tracking）**。项目团队实施整改措施，SAO 跟踪整改进度，对关键问题进行复审，处理例外批准流程（如需要）。整改时限根据风险级别设定：Critical 级别需在较短周期内完成，High 级别次之，Medium 级别可有更长整改窗口。此阶段的常见误区是例外失控——批准后不跟踪，导致例外长期存在形成系统性风险。输出为整改证据与例外批准记录。

**阶段五：关闭与归档（Closure & Archiving）**。验证整改完成（测试、审计），评审正式关闭，文档归档（Confluence/Git/GRC 平台），更新经验积累（模式库、常见问题库）。此阶段的验证方法是检查整改证据是否与行动项一一对应，并通过自动化测试或人工审计确认控制已实施。输出为评审关闭报告与合规证据包。

### 风险分级标准

风险分级采用概率与影响二维矩阵，风险评分 = 概率 × 影响。分级标准决定审批权限：Critical 级别需 CEO/CISO 批准，High 级别需安全委员会批准，Medium 级别由安全架构师批准，Low 级别可由项目经理自主决策。

分级的关键约束在于：过于保守的分级会导致高层审批过载，过于激进则可能让高风险项目绕过应有的审批。验证方法是定期回顾已关闭评审的后续安全事件，评估分级准确性。

---

## 4.5.2 安全设计评审

### SDR 概述

安全设计评审（security design review，SDR）是在系统设计阶段进行的深度安全审查，关注架构设计、数据流、安全控制与威胁缓解。SDR 与 SAR 的区别在于：SAR 是流程框架，SDR 是技术评审方法。SDR 适用于需要深度技术分析的 Critical 和 High 级别项目，对于 Medium 和 Low 级别项目可采用简化版检查清单。

SDR 的适用边界包括：新产品或功能设计阶段（需求确定后、开发前）、架构重大变更（如云迁移、零信任改造）、集成第三方服务。SDR 不适用于已完成开发的系统（此时应采用渗透测试或代码审计），也不适用于纯配置变更。

### SDR 检查清单

SDR 检查清单覆盖五大维度：架构与设计、身份与访问控制、数据保护、网络安全、应用安全。检查清单的价值在于提供结构化的审查框架，避免遗漏关键控制点。但检查清单不能替代威胁建模——清单验证"是否实施了控制"，威胁建模识别"应该实施哪些控制"。

架构与设计检查要点包括：架构图完整性（系统上下文图、容器图、组件图、部署图）、数据流图（外部实体识别、进程/服务识别、数据存储识别、数据流与信任边界标注）、架构原则符合性（最小权限、纵深防御、职责分离、安全默认）、技术栈评估（使用批准的技术栈、开源组件风险评估、依赖项安全评估）。

身份与访问控制检查要点包括：认证机制（密码策略、MFA 强制启用范围、会话管理、防暴力破解）、授权机制（RBAC/ABAC 模型选择、细粒度权限设计、默认拒绝策略）、API 安全（OAuth 2.0/JWT 认证、Scope/Claims 授权、限流与配额）、特权访问（特权账户分离、JIT 访问、会话录制、审计日志）。

数据保护检查要点包括：数据分类（分类体系、敏感数据识别、数据流向映射、数据驻留要求）、加密（传输加密 TLS 1.2+、静态加密 AES-256、密钥管理 KMS/HSM）、数据最小化（保留策略、自动清理机制、脱敏/匿名化）、DLP 与监控。

网络安全检查要点包括：网络分段（信任边界定义、网络分区、防火墙规则、微隔离策略）、入侵防护（IDS/IPS 部署、WAF 规则配置、DDoS 防护）、安全通信（VPN/ZTNA 配置、Service Mesh mTLS、证书管理）。

应用安全检查要点包括：输入验证（白名单验证、参数化查询、输出编码）、会话管理（安全 Cookie 属性、CSRF Token、会话固定防护）、错误处理（统一错误处理、移除堆栈跟踪、通用错误消息）、安全 Headers（HSTS、CSP、X-Frame-Options）、依赖管理（SBOM、依赖漏洞扫描、许可证合规）。

### SDR 评审报告

SDR 评审报告应包含以下结构：项目信息（项目名称、评审日期、评审编号、风险级别）、评审团队（主评审员、评审员、项目团队）、系统概述、架构概览、发现问题（按严重程度分类：Critical/High/Medium/Observations）、合规性检查、评审决策（通过/有条件通过/不通过）、下一步行动、附件（威胁模型文档、数据流图、控制矩阵）。

SDR 报告的常见误区包括：问题描述过于笼统（如"缺少加密"而非"数据库连接未使用 TLS"）、未明确责任人与截止日期、建议措施不可执行（如"加强安全"而非"配置 Kong Rate Limiting 插件"）。验证方法是回顾已关闭评审，检查整改措施是否与问题一一对应且可验证。

---

## 4.5.3 架构威胁分析

### 威胁分析与评审的集成

架构评审中集成威胁建模可将威胁识别从被动发现转变为主动预防。威胁分析在评审中的定位是：在 SDR 之前或同步进行威胁建模，识别系统面临的威胁；SDR 检查清单验证针对已识别威胁的控制是否到位；评审决策综合威胁缓解状态与残余风险。

威胁分析流程包括五个步骤：识别资产（数据资产、系统资产、人员资产）、识别威胁（使用 STRIDE 对 DFD 元素进行威胁识别，参考 MITRE ATT&CK 攻击技术，结合历史安全事件）、评估风险（使用 DREAD 或其他评分方法，考虑业务影响，进行优先级排序）、设计缓解措施（选择安全控制，评估控制有效性，记录残余风险）、验证（威胁模型评审，渗透测试验证，持续监控）。

威胁分析的适用边界是：处理敏感数据、暴露互联网接口、集成第三方服务的系统应强制进行威胁建模；内部工具、低风险功能迭代可采用简化版威胁清单检查。威胁分析的关键约束包括：威胁建模需要架构师具备安全知识，培训不足会导致建模流于形式；建模时间与项目排期的平衡需要提前规划。

### 威胁分析实践要点

威胁分析的常见误区包括：将威胁建模视为文档练习而非技术审查——有效的威胁建模需要深入分析数据流与信任边界，而非机械套用 STRIDE 模板；仅关注已知威胁类别而忽略业务特定风险——如电商平台的支付金额篡改风险、金融系统的交易抵赖风险；威胁模型不更新——系统架构变更后威胁模型未同步更新，导致新引入的攻击面未被识别。

威胁分析的验证方法包括：将威胁模型中识别的高风险威胁纳入渗透测试范围，验证缓解措施有效性；上线后监控安全日志，检查威胁模型预测的攻击路径是否被实际利用；定期复审威胁模型（建议每年或每次重大版本发布）。

威胁分析的运行指标包括：威胁建模覆盖率（已建模项目数 ÷ 重大项目总数）、高风险威胁缓解率（已缓解高风险威胁 ÷ 高风险威胁总数）、建模周期（从需求确定到建模完成的天数）。

---

## 4.5.4 安全控制验证

### 控制验证方法

控制验证的目的是确认架构设计中规划的安全控制已正确实施且有效运行。控制验证方法应根据控制类型与生命周期阶段选择。

下表列出了不同验证方法的适用场景。选择这些维度是因为不同控制类型需要不同的验证技术，而验证时机决定了问题发现的成本——设计阶段发现问题的修复成本远低于生产环境。

| 验证方法 | 适用控制类型 | 时机 | 典型工具 |
|---------|------------|------|---------|
| 代码审查 | 输入验证、加密实现、认证逻辑 | 设计与开发阶段 | GitHub PR、GitLab MR |
| 静态分析（SAST） | 代码漏洞、硬编码凭证、不安全配置 | CI/CD Pipeline | SonarQube、Checkmarx、Semgrep |
| 动态测试（DAST） | 运行时漏洞、配置错误 | 测试阶段 | OWASP ZAP、Burp Suite |
| 配置审查 | 安全基线、强化配置 | 部署前 | Chef InSpec、OpenSCAP |
| 渗透测试 | 综合安全验证 | 上线前、定期 | 人工渗透测试、自动化工具 |
| 红队演练 | 攻击链验证 | 生产环境（需授权隔离） | 红队工具包 |

控制验证的权衡在于：全面验证需要大量资源投入，选择性验证可能遗漏关键控制。建议根据风险级别确定验证深度：Critical 级别项目应进行全面验证（包括渗透测试），Medium 级别可采用 SAST/DAST + 配置审查，Low 级别可仅进行自动化扫描。

### 控制验证矩阵

控制验证矩阵将控制点与预期行为、验证方法、验证结果、证据关联，形成可追溯的验证记录。矩阵结构如下：

**认证与授权类控制**：JWT 签名验证（预期：拒绝未签名或签名无效的 Token，验证方法：单元测试）、MFA 强制启用（预期：管理员账户强制 MFA，验证方法：集成测试）、API Rate Limiting（预期：超过阈值返回 429，验证方法：负载测试）、权限提升防护（预期：普通用户无法访问管理 API，验证方法：渗透测试）。

**数据保护类控制**：传输加密（预期：所有连接使用 TLS 1.2+，验证方法：DAST）、静态加密（预期：数据库数据加密存储，验证方法：配置审查）、PII 脱敏（预期：日志中不包含明文 PII，验证方法：日志审查）、备份加密（预期：备份文件加密，验证方法：合规检查）。

控制验证的常见误区包括：验证覆盖不完整——仅验证新增控制而忽略已有控制的回归测试；验证证据不可追溯——测试报告未关联到具体控制点，无法在审计时证明合规；自动化不足——依赖人工验证导致验证周期过长或遗漏。

控制验证的运行指标包括：控制验证覆盖率（已验证控制数 ÷ 总控制数）、验证发现率（验证发现的问题数 ÷ 验证次数）、验证周期（从提交验证请求到完成验证的天数）。

---

## 4.5.5 架构文档规范

### 文档类型与用途

架构文档是评审的输入依据，也是后续运维与审计的基础。文档规范的目的是确保文档完整性、一致性与可追溯性。主要文档类型包括：

**安全架构文档（SAD - Security Architecture Document）**：完整描述系统的安全设计，包括业务背景、安全目标、合规要求、威胁模型、安全架构设计（分层视图、身份与访问、数据保护）、安全控制矩阵、风险评估、运营安全（监控告警、事件响应、持续改进）。SAD 适用于 Critical 和 High 级别项目，是评审的核心输入文档。

**架构决策记录（ADR - Architecture Decision Record）**：记录重大架构决策的背景、决策内容、理由、备选方案、影响与风险。ADR 的价值在于：为后续维护人员提供决策上下文，避免"为什么这样设计"的知识流失；为技术债务评估提供依据，明确哪些决策可能需要重新审视。

**安全控制文档（SCD - Security Control Document）**：针对特定系统或组件的控制实施细节，包括控制类型、实施状态、责任人、技术配置位置、测试方法、审计周期。SCD 适用于需要精细化控制管理的场景，如合规审计准备。

### 文档规范要点

文档规范的关键约束包括：文档与实现的同步——架构变更后文档未更新是最常见的问题，建议采用 architecture-as-code 方法减少文档维护负担；文档粒度的平衡——过于详细的文档维护成本高且容易过时，过于简略的文档无法支撑评审与审计。

文档规范的验证方法包括：在评审阶段检查文档完整性（使用检查清单确认必需章节是否存在）；在系统变更时触发文档更新流程；定期审计文档与实现的一致性。

文档规范的常见误区包括：文档模板过于复杂导致团队抵触——应根据项目规模提供分级模板；文档存储分散导致查找困难——应统一存储在 Confluence/Git/GRC 平台并建立索引。

---

## 4.5.6 评审委员会运作

### ARB 组织架构

架构评审委员会（architecture review board，ARB）是架构决策的最高治理机构，负责重大项目评审决策、例外批准、架构原则更新与流程改进。

ARB 采用三层结构：

**决策层（ARB 委员会）**：由 CISO（主席）、首席架构师、安全架构负责人、GRC 负责人、隐私官、关键业务代表组成，负责 Critical 和 High 级别项目的评审决策、例外批准、架构原则与政策更新。会议频率建议每两周一次。

**运营层（安全架构办公室 SAO）**：由评审协调员、文档管理员、跟踪专员组成，负责评审流程管理、文档归档、进度跟踪、例外管理。SAO 是 ARB 的日常运营支撑。

**执行层（评审专家组）**：由领域安全架构师（身份/网络/云/数据/应用）、威胁建模专家、安全工程师组成，负责技术评审执行、威胁分析、控制验证。

ARB 运作的关键约束包括：委员会成员的时间投入——高管时间有限，需确保会议高效；跨部门协作——评审需要安全、GRC、隐私、业务多方参与，协调成本较高；评审资源与业务需求的平衡——安全架构师人手不足时，评审可能成为业务瓶颈。

### ARB 会议流程

ARB 会议议程应结构化，避免会议时间浪费。典型议程包括：开场与议程确认、评审案例（按风险级别排序）、例外批准请求、整改进度回顾、政策与流程讨论、总结与行动项。

会议效率的关键在于：会前分发评审报告与问题清单，会上聚焦决策而非信息传递；每个评审案例限定时间，复杂问题可安排专题会议；会后及时发送会议纪要与行动项，明确责任人与截止日期。

ARB 运作的常见误区包括：评审会议变成技术讨论会——详细技术问题应在会前由评审专家组解决，ARB 会议聚焦决策；例外审批过于宽松——缺少补偿控制要求和复审机制；决策不透明——项目团队不清楚评审标准和决策依据，产生抵触情绪。

### 例外管理流程

例外是指无法满足安全控制要求但仍需上线的情况。例外管理的目的是：明确例外的风险、确保补偿控制到位、设定例外有效期、定期复审。

例外管理流程包括五个步骤：

**步骤一：例外申请**。项目团队提交例外申请表，说明无法满足的控制、业务理由、请求的例外时限。

**步骤二：风险评估**。安全架构师评估例外风险（可使用 DREAD 或类似方法），识别可行的补偿控制，量化残余风险。

**步骤三：批准流程**。根据风险级别确定审批权限：低风险例外由安全架构师批准，中风险例外由安全委员会批准，高风险或 Critical 例外由 CISO/CEO 批准。

**步骤四：补偿控制实施**。部署补偿控制（如加强监控、增加审计日志、缩短 token 有效期），配置相应的告警规则，设定定期复审周期。

**步骤五：例外关闭**。在例外有效期内实施永久控制，移除补偿控制，正式关闭例外。

例外管理的运行指标包括：例外总数、例外平均存续时间、逾期未关闭例外数、例外按期关闭率。

---

## 4.5.7 本节小结

### 核心实践要点

评审流程标准化是架构安全治理的基础。五阶段评审流程（申请分级、文档审查、正式评审、整改跟踪、关闭归档）确保评审的一致性与可追溯性。流程设计的关键在于平衡严谨性与效率——过于繁琐的流程会被绕过，过于简单的流程无法发现问题。

SDR 检查清单覆盖架构、身份、数据、网络、应用五大维度，但检查清单不能替代威胁建模。检查清单验证"是否实施了控制"，威胁建模识别"应该实施哪些控制"。两者结合才能有效降低架构风险。

控制验证需要多种方法组合。代码审查、SAST/DAST、配置审查、渗透测试各有适用场景，应根据项目风险级别选择验证深度。验证结果需要可追溯——控制验证矩阵将控制点、预期行为、验证方法、验证结果、证据关联起来。

文档规范确保评审可执行、审计可支撑。SAD、ADR、SCD 三类文档覆盖架构设计、决策记录、控制细节。文档规范的挑战在于与实现的同步——建议采用 architecture-as-code 减少维护负担。

ARB 运作需要明确的分层结构与决策权限。决策层聚焦重大决策与例外批准，运营层负责流程管理，执行层执行技术评审。例外管理是 ARB 的关键职能，需要严格的风险评估、补偿控制与复审机制。

### 常见陷阱与规避

评审流于形式是最常见的陷阱。规避方法包括：使用结构化检查表、要求输出威胁模型与 ADR、定期审计评审质量。

文档不及时更新导致文档与实际脱节。规避方法包括：在系统变更时触发文档更新流程、采用 architecture-as-code、定期审计文档一致性。

例外失控导致系统性风险积累。规避方法包括：严格的例外审批流程、强制补偿控制、设定例外有效期、定期复审未关闭例外。

评审资源不足导致评审成为业务瓶颈。规避方法包括：根据风险级别分层评审（Critical 深度评审、Low 自动化检查）、培养更多安全架构师、引入自动化工具辅助评审。

验证不充分导致控制未真正有效。规避方法包括：将威胁模型中的高风险威胁纳入渗透测试范围、建立控制验证矩阵、上线后监控控制有效性。

### 验证方法与运行指标

验证方法：评审流程有效性可通过以下方式验证——回顾已关闭评审的后续安全事件，评估评审是否遗漏关键风险；审计例外管理记录，检查例外是否按期关闭且补偿控制到位；定期抽查评审文档质量，确认检查清单完整性。

运行指标：架构评审覆盖率（已评审项目数 ÷ 重大项目总数）、评审问题发现率（评审发现问题数 ÷ 项目总数）、评审周期达成率（按时完成评审 ÷ 总评审数）、例外按期关闭率（按时关闭例外 ÷ 总例外数）、高风险威胁缓解率（已缓解高风险威胁 ÷ 高风险威胁总数）。

---

## 4.5.8 延伸阅读

### 行业标准

NIST SP 800-160 Vol. 1 Systems Security Engineering 第 3 章提供了安全评审的系统工程视角。ISO/IEC 27034 Application Security 包含架构评审指南。TOGAF 提供了 architecture review process 的通用方法。SABSA 提供了 security architecture review framework。

### 工具参考

评审管理工具包括 Jira、ServiceNow、Confluence。威胁建模工具包括 Microsoft Threat Modeling Tool、IriusRisk、Threagile。文档协作工具包括 Confluence、Notion、GitBook。合规管理工具包括 OneTrust、Vanta、Drata。

### 相关章节

前置知识：4.2 架构设计原则（提供评审基准）、4.3 威胁建模（提供评审中的威胁分析方法）。后续内容：4.6 技术选型与决策（评审中的技术评估）、第 11 章安全运营（评审后的持续监控）。

---

## 导航

**[← 上一节：4.4 安全架构模式](./4.4_security_architecture_patterns.md)** | **[返回章节目录](./README.md)** | **[下一节：4.6 技术选型与决策 →](./4.6_technology_selection_decision.md)**

---

**© 2025 AI-ESA Project. Licensed under CC BY-NC-SA 4.0**

