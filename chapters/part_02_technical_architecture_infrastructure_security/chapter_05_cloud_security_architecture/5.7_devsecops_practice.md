# 5.7 DevSecOpså®è·µ

æœ¬èŠ‚å»ºç«‹ä»CI/CDæµæ°´çº¿å®‰å…¨é›†æˆåˆ°æ¼æ´å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„å®Œæ•´DevSecOpså·¥ç¨‹ä½“ç³»,è¦†ç›–åŸºç¡€è®¾æ–½å³ä»£ç æ‰«æã€å®¹å™¨é•œåƒä¾›åº”é“¾å®‰å…¨ã€å®‰å…¨å·¦ç§»å·¥ç¨‹å®è·µä¸è‡ªåŠ¨åŒ–è´¨é‡é—¨ç¦è®¾è®¡,å°†å®‰å…¨æ§åˆ¶å‰ç½®åˆ°è®¾è®¡ä¸å¼€å‘é˜¶æ®µ,é™ä½ä¿®å¤æˆæœ¬å¹¶æé«˜äº¤ä»˜æ•ˆç‡ã€‚

---

## 5.7.1 CI/CDå®‰å…¨é›†æˆ

### CI/CDå¹³å°å®‰å…¨å¯¹æ¯”

é€‰æ‹©CI/CDå¹³å°æ—¶éœ€è¦ç»¼åˆè€ƒè™‘éƒ¨ç½²æ¨¡å¼ã€å‡­è¯ç®¡ç†æœºåˆ¶ã€å®‰å…¨æ‰«æç”Ÿæ€ä¸å®¡è®¡èƒ½åŠ›ã€‚ä¸‹è¡¨å¯¹æ¯”ä¸»æµå¹³å°çš„æ ¸å¿ƒå®‰å…¨ç‰¹æ€§,ä¸ºæŠ€æœ¯é€‰å‹æä¾›å‚è€ƒä¾æ®:

| å¹³å° | Jenkins | GitLab CI | GitHub Actions | CircleCI |
|------|---------|-----------|----------------|----------|
| éƒ¨ç½²æ¨¡å¼ | Self-hosted/Cloud | Self-hosted/SaaS | Cloud | Cloud |
| å‡­è¯ç®¡ç† | Credentials Plugin | CI/CD Variables | Secrets | Contexts |
| Pipelineå®šä¹‰ | Jenkinsfile | .gitlab-ci.yml | Workflow YAML | config.yml |
| RBAC | æ’ä»¶æ”¯æŒ | å†…ç½® | å†…ç½® | å†…ç½® |
| å®¡è®¡æ—¥å¿— | æ’ä»¶æ”¯æŒ | å†…ç½® | å†…ç½® | æœ‰é™ |
| ç­¾åéªŒè¯ | æ’ä»¶ | å†…ç½® | æœ‰é™ | æœ‰é™ |
| å®‰å…¨æ‰«æé›†æˆ | ä¸°å¯Œæ’ä»¶ | å†…ç½®+æ’ä»¶ | Marketplace | Orbs |
| éš”ç¦»æ€§ | é…ç½®ä¾èµ– | å®¹å™¨éš”ç¦» | å®¹å™¨éš”ç¦» | å®¹å™¨éš”ç¦» |
| æœ€ä½³åœºæ™¯ | ä¼ä¸šè‡ªå»º | GitLabç”Ÿæ€ | GitHubç”Ÿæ€ | å¿«é€Ÿé…ç½® |

é€‰å‹å…³é”®å†³ç­–ç‚¹åŒ…æ‹¬:ä¼ä¸šè‡ªå»ºç¯å¢ƒä¼˜å…ˆJenkins(å¯æ§æ€§é«˜ã€å®šåˆ¶èƒ½åŠ›å¼º),GitLab/GitHubç”Ÿæ€ä¼˜å…ˆå¯¹åº”åŸç”ŸCI(å‡å°‘å·¥å…·åˆ‡æ¢æˆæœ¬),å¯¹å®¹å™¨éš”ç¦»æœ‰å¼ºéœ€æ±‚æ—¶é¿å…å•çº¯ä¾èµ–Jenkinsé…ç½®éš”ç¦»(éœ€é¢å¤–åŠ å›º)ã€‚

### å®‰å…¨é—¨ç¦çš„ä¸ƒå±‚é˜²æŠ¤ç­–ç•¥

å®‰å…¨é—¨ç¦çš„è®¾è®¡éœ€è¦å¹³è¡¡é£é™©æ§åˆ¶ä¸å¼€å‘æ•ˆç‡ã€‚ä¸ƒå±‚é˜²æŠ¤ç­–ç•¥æŒ‰è½¯ä»¶ç”Ÿå‘½å‘¨æœŸé¡ºåºè®¾ç½®æ£€æŸ¥ç‚¹:

**ç¬¬ä¸€å±‚:ä»£ç æäº¤éªŒè¯**ã€‚é€šè¿‡Gitç­¾åéªŒè¯(GPGç­¾å)ç¡®ä¿ä»£ç æ¥æºå¯ä¿¡,é˜²æ­¢ä¾›åº”é“¾æŠ•æ¯’ã€‚æ£€æŸ¥ç‚¹åœ¨ä»£ç è¿›å…¥ä»£ç åº“å‰è§¦å‘,é˜»æ–­æœªç­¾åæäº¤ã€‚

**ç¬¬äºŒå±‚:ç§˜å¯†æ‰«æ**ã€‚ä½¿ç”¨TruffleHogæˆ–GitGuardianæ‰«æå…¨å†å²æäº¤ä¸å½“å‰ä»£ç ,æ£€æµ‹ç¡¬ç¼–ç APIå¯†é’¥ã€æ•°æ®åº“å‡­è¯ã€ç§é’¥ã€‚å‘ç°æ³„éœ²ç«‹å³é˜»æ–­æ„å»ºã€‚é€‚ç”¨è¾¹ç•Œ:ä»…æ‰«æä»£ç ä»“åº“,ä¸è¦†ç›–è¿è¡Œæ—¶é…ç½®æ–‡ä»¶(éœ€é€šè¿‡å…¶ä»–å·¥å…·ç›‘æ§)ã€‚

**ç¬¬ä¸‰å±‚:é™æ€ä»£ç å®‰å…¨åˆ†æ(SAST)**ã€‚ä½¿ç”¨SonarQubeæˆ–Checkmarxæ£€æµ‹SQLæ³¨å…¥ã€XSSã€ä¸å®‰å…¨ååºåˆ—åŒ–ç­‰ä»£ç æ¼æ´ã€‚è®¾ç½®Quality Gateé˜ˆå€¼(å¦‚Criticalæ¼æ´=0,ä»£ç è¦†ç›–ç‡>è®¾å®šåŸºçº¿)ã€‚å…³é”®çº¦æŸ:SASTè¯¯æŠ¥ç‡å¯èƒ½è¾¾åˆ°åˆæ¬¡æ‰«æç»“æœçš„80%,éœ€å»ºç«‹åŸºçº¿ä¸ç™½åå•æœºåˆ¶(è§é—¨ç¦å†³ç­–æµç¨‹)ã€‚

**ç¬¬å››å±‚:è½¯ä»¶æˆåˆ†åˆ†æ(SCA)**ã€‚ä½¿ç”¨Snykæˆ–Dependabotæ£€æµ‹ä¾èµ–åº“CVEæ¼æ´ã€‚ä»…Criticalçº§åˆ«è‡ªåŠ¨é˜»æ–­,Highçº§åˆ«ç”Ÿæˆä¿®å¤å·¥å•ä½†å…è®¸é€šè¿‡,é¿å…é˜»å¡ä¸šåŠ¡äº¤ä»˜ã€‚éªŒè¯æ–¹æ³•:æ¯æœˆæŠ½æŸ¥ä¿®å¤å·¥å•å®Œæˆç‡,ç¡®è®¤SLAåˆè§„ã€‚

**ç¬¬äº”å±‚:å®¹å™¨é•œåƒæ‰«æ**ã€‚ä½¿ç”¨Trivyæˆ–Grypeæ£€æµ‹åŸºç¡€é•œåƒä¸åº”ç”¨å±‚æ¼æ´,é€šè¿‡CosignéªŒè¯é•œåƒç­¾åã€‚æ‰«æè¦†ç›–æ“ä½œç³»ç»ŸåŒ…ä¸åº”ç”¨ä¾èµ–,é˜»æ–­åŒ…å«é«˜å±æ¼æ´çš„é•œåƒæ¨é€åˆ°ç”Ÿäº§Registryã€‚

**ç¬¬å…­å±‚:åŸºç¡€è®¾æ–½å³ä»£ç æ‰«æ(IaC)**ã€‚ä½¿ç”¨Checkovæˆ–Terrascanæ£€æµ‹Terraform/CloudFormationé…ç½®é£é™©(å¦‚S3å…¬å¼€è¯»å†™ã€å®‰å…¨ç»„è¿‡åº¦å¼€æ”¾)ã€‚é€‚ç”¨è¾¹ç•Œ:ä»…æ£€æµ‹åŸºç¡€è®¾æ–½é…ç½®,ä¸è¦†ç›–åº”ç”¨å±‚é…ç½®æ–‡ä»¶(å¦‚Nginxé…ç½®éœ€é€šè¿‡SASTæˆ–è‡ªå®šä¹‰è„šæœ¬æ£€æŸ¥)ã€‚

**ç¬¬ä¸ƒå±‚:åŠ¨æ€åº”ç”¨å®‰å…¨æµ‹è¯•(DAST)**ã€‚åœ¨Stagingç¯å¢ƒä½¿ç”¨OWASP ZAPæˆ–Burp Suiteæ‰§è¡Œè¢«åŠ¨æ‰«æä¸ä¸»åŠ¨æ”»å‡»æµ‹è¯•ã€‚è¿è¡Œæ—¶æœº:éƒ¨ç½²åˆ°Stagingåæ‰§è¡Œ,ç”ŸæˆHTMLæŠ¥å‘Šä¾›å®‰å…¨å›¢é˜Ÿå®¡æŸ¥ã€‚å…³é”®çº¦æŸ:DASTæ‰«ææ—¶é—´è¾ƒé•¿(30åˆ†é’Ÿè‡³æ•°å°æ—¶),ä¸é€‚åˆæ¯æ¬¡PRè§¦å‘,å»ºè®®ä»…åœ¨ä¸»åˆ†æ”¯åˆå¹¶åæ‰§è¡Œã€‚

### é—¨ç¦é˜»æ–­ç­–ç•¥è®¾è®¡

é—¨ç¦é˜»æ–­ç­–ç•¥éœ€è¦æƒè¡¡å®‰å…¨é£é™©ä¸äº¤ä»˜æ•ˆç‡:

- **å¼ºåˆ¶é˜»æ–­åœºæ™¯**:ç§˜å¯†æ³„éœ²ã€Criticalçº§åˆ«SASTæ¼æ´ã€Criticalçº§åˆ«å®¹å™¨æ¼æ´ã€IaCé…ç½®è¿ååˆè§„è¦æ±‚(å¦‚æ•°æ®åº“å…¬ç½‘æš´éœ²)ã€‚è¿™äº›é—®é¢˜ä¿®å¤æˆæœ¬ä½ã€é£é™©é«˜,å¿…é¡»é›¶å®¹å¿ã€‚
- **è­¦å‘Šä½†å…è®¸é€šè¿‡åœºæ™¯**:Highçº§åˆ«SASTæ¼æ´(æ•°é‡â‰¤è®¾å®šé˜ˆå€¼,å¦‚5ä¸ª)ã€Mediumçº§åˆ«ä¾èµ–æ¼æ´ã€ä»£ç è¦†ç›–ç‡ä½äºç›®æ ‡ä½†é«˜äºæœ€ä½è¦æ±‚ã€‚è¿™äº›é—®é¢˜ç”Ÿæˆå·¥å•è·Ÿè¸ª,ä½†ä¸ç«‹å³é˜»æ–­,é¿å…å½±å“ç´§æ€¥å‘å¸ƒã€‚
- **ä»…è®°å½•ä¸é˜»æ–­åœºæ™¯**:Lowçº§åˆ«ä»£ç è´¨é‡é—®é¢˜ã€Mediumçº§åˆ«ä¾èµ–æ¼æ´ã€ä¿¡æ¯æ³„éœ²(å¦‚æ³¨é‡Šä¸­çš„å†…éƒ¨URL)ã€‚è®°å½•åˆ°æŠ€æœ¯å€ºå°è´¦,å®šæœŸæ¸…ç†ã€‚

å¸¸è§è¯¯åŒºåŒ…æ‹¬:ä¸€åˆ€åˆ‡é˜»æ–­æ‰€æœ‰Highæ¼æ´å¯¼è‡´å¼€å‘å›¢é˜Ÿé¢‘ç¹ç”³è¯·ä¾‹å¤–,é™ä½é—¨ç¦æƒå¨æ€§;æœªå»ºç«‹åŸºçº¿å¯¼è‡´é¦–æ¬¡å¯ç”¨SASTæ—¶æŠ¥å‘Šæ•°åƒä¸ªå†å²é—®é¢˜,æ·¹æ²¡æ–°å¢é—®é¢˜;è¯¯æŠ¥ç™½åå•ç¼ºä¹å®¡æŸ¥æœºåˆ¶,æˆä¸ºè§„é¿æ£€æŸ¥çš„åé—¨ã€‚

### é—¨ç¦æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

é›†æˆå¤šå±‚æ‰«æå,æ„å»ºæ—¶é—´å¯èƒ½ä»5åˆ†é’Ÿå»¶é•¿è‡³25åˆ†é’Ÿ,å½±å“å¼€å‘ä½“éªŒã€‚ä¼˜åŒ–ç­–ç•¥åŒ…æ‹¬:

**å¹¶è¡ŒåŒ–æ‰«æ**ã€‚SASTã€SCAã€Secretæ‰«æäº’ä¸ä¾èµ–,å¯å¹¶è¡Œæ‰§è¡Œã€‚ç¤ºä¾‹é…ç½®è§ä¸‹æ–¹Jenkinsæµæ°´çº¿ç‰‡æ®µçš„å¹¶è¡Œstageå®šä¹‰ã€‚

**å¢é‡æ‰«æ**ã€‚ä»…æ‰«æå˜æ›´ä»£ç è€Œéå…¨é‡ä»£ç ã€‚SonarQubeçš„Pull Requeståˆ†ææ¨¡å¼ä»…æŠ¥å‘ŠPRæ–°å¢é—®é¢˜,å¤§å¹…ç¼©çŸ­æ‰«ææ—¶é—´(ä»15åˆ†é’Ÿé™è‡³3åˆ†é’Ÿ)ã€‚

**ç¼“å­˜æœºåˆ¶**ã€‚ä¾èµ–åº“æ‰«æç»“æœç¼“å­˜24å°æ—¶,é¿å…é‡å¤æ‰«æç›¸åŒçš„package.jsonæˆ–pom.xmlã€‚å®ç°æ–¹æ³•:æ ¹æ®ä¾èµ–æ–‡ä»¶å“ˆå¸Œå€¼æŸ¥è¯¢ç¼“å­˜,å‘½ä¸­åˆ™è·³è¿‡æ‰«æã€‚

**åˆ†å±‚é—¨ç¦**ã€‚PRé˜¶æ®µä»…æ‰§è¡Œå¿«é€Ÿæ‰«æ(Secret+SASTå¢é‡),åˆå¹¶åæ‰§è¡Œå®Œæ•´æ‰«æ(åŒ…æ‹¬DASTä¸å®¹å™¨æ‰«æ)ã€‚é€‚ç”¨è¾¹ç•Œ:ä»…é€‚ç”¨äºä¸»åˆ†æ”¯ä¿æŠ¤ä¸¥æ ¼çš„å›¢é˜Ÿ,å¦åˆ™å¯èƒ½é—æ¼é—®é¢˜ã€‚

æ€§èƒ½ä¼˜åŒ–çš„éªŒè¯æ–¹æ³•:ç»Ÿè®¡P95æ„å»ºæ—¶é•¿,ç¡®ä¿â‰¤åŸåŸºçº¿çš„150%(å¦‚åŸ5åˆ†é’Ÿ,ä¼˜åŒ–åâ‰¤7.5åˆ†é’Ÿ);å¼€å‘è€…æ»¡æ„åº¦è°ƒç ”,ç¡®è®¤é—¨ç¦ä¸å½±å“æ­£å¸¸è¿­ä»£èŠ‚å¥ã€‚

### Jenkinså®‰å…¨é—¨ç¦å®ç°ç¤ºä¾‹

ä»¥ä¸‹Groovyä»£ç ç‰‡æ®µå±•ç¤ºæ ¸å¿ƒé—¨ç¦é€»è¾‘,å®Œæ•´Jenkinsfileéœ€æ ¹æ®å®é™…æŠ€æœ¯æ ˆè°ƒæ•´:

```groovy
// CI/CDå®‰å…¨é—¨ç¦ - æ ¸å¿ƒé˜¶æ®µé…ç½®
pipeline {
 agent any

 stages {
  // å†³ç­–ç‚¹1: Secretæ‰«æå‰ç½®,æœ€æ—©å‘ç°å‡­è¯æ³„éœ²
  stage('Secret Scanning') {
   steps {
    sh 'trufflehog filesystem . --json > secrets.json'
    script {
     def secrets = readJSON file: 'secrets.json'
     if (secrets.size() > 0) {
      error "ğŸ”´ Secrets detected! Build aborted." // å¼ºåˆ¶é˜»æ–­
     }
    }
   }
  }

  // å†³ç­–ç‚¹2: SAST Quality Gateé˜»æ–­Criticalæ¼æ´
  stage('SAST') {
   steps {
    withSonarQubeEnv('SonarQube') {
     sh 'mvn sonar:sonar -Dsonar.qualitygate.wait=true'
    }
    timeout(time: 10, unit: 'MINUTES') {
     waitForQualityGate abortPipeline: true // Quality Gateå¤±è´¥åˆ™é˜»æ–­
    }
   }
  }

  // å†³ç­–ç‚¹3: SCAæ‰«æå…è®¸Highæ¼æ´ä½†è®°å½•
  stage('SCA') {
   steps {
    sh 'snyk test --severity-threshold=critical --json > snyk-report.json'
    script {
     // è§£ææŠ¥å‘Š,Highæ¼æ´ç”ŸæˆJiraå·¥å•ä½†ä¸é˜»æ–­
     sh 'python3 scripts/create-vuln-tickets.py snyk-report.json'
    }
   }
  }

  // å†³ç­–ç‚¹4: å®¹å™¨ç­¾åéªŒè¯ä¾›åº”é“¾å®‰å…¨
  stage('Container Build & Sign') {
   steps {
    sh 'docker build -t ${IMAGE_TAG} .'
    sh 'trivy image --exit-code 1 --severity CRITICAL ${IMAGE_TAG}' // é«˜å±æ¼æ´é˜»æ–­
    sh 'cosign sign --key cosign.key ${IMAGE_TAG}' // Sigstore Cosignç­¾å
   }
  }
 }

 post {
  always {
   // å½’æ¡£æ‰«ææŠ¥å‘Š,ä¿ç•™30å¤©ç”¨äºå®¡è®¡
   archiveArtifacts artifacts: '**/*-report.json', allowEmptyArchive: true
  }
 }
}
```

å…³é”®é…ç½®å†³ç­–:

- **å‡­è¯ç®¡ç†**:æ‰€æœ‰æ•æ„Ÿä¿¡æ¯(Docker Registryå¯†ç ã€SonarQube Tokenã€Cosignç§é’¥)å¿…é¡»ä»Vaultæˆ–AWS Secrets ManageråŠ¨æ€è·å–,ç¦æ­¢ç¡¬ç¼–ç åœ¨Jenkinsfileä¸­ã€‚éªŒè¯æ–¹æ³•:ä»£ç å®¡æŸ¥æ£€æŸ¥æ— æ˜æ–‡å‡­è¯,å®šæœŸæ‰«æJenkinsé…ç½®æ–‡ä»¶ã€‚
- **æ„å»ºè¶…æ—¶**:è®¾ç½®å…¨å±€è¶…æ—¶(å¦‚1å°æ—¶),é˜²æ­¢å¼‚å¸¸æ„å»ºå ç”¨èµ„æºã€‚è¶…æ—¶åè‡ªåŠ¨ç»ˆæ­¢å¹¶å‘Šè­¦åˆ°Slackã€‚
- **ç»“æœå­˜æ¡£**:æ‰€æœ‰æ‰«ææŠ¥å‘Š(JSONæ ¼å¼)å­˜æ¡£30å¤©,ç”¨äºåˆè§„å®¡è®¡ä¸è¶‹åŠ¿åˆ†æã€‚å­˜æ¡£è·¯å¾„éœ€é…ç½®å®šæœŸæ¸…ç†,é¿å…ç£ç›˜å æ»¡ã€‚

### GitHub Actionså®‰å…¨å®è·µ

GitHub Actionsçš„å®‰å…¨é…ç½®éœ€è¦ç‰¹åˆ«æ³¨æ„æƒé™æœ€å°åŒ–ä¸Secretç®¡ç†ã€‚ä»¥ä¸‹YAMLå±•ç¤ºå®Œæ•´å®‰å…¨æµæ°´çº¿:

```yaml
# .github/workflows/security-pipeline.yml
name: Security CI/CD Pipeline

on:
 push:
  branches: [main, develop]
 pull_request:
  branches: [main]

# å…³é”®:æƒé™æœ€å°åŒ–,ä»…æˆäºˆå¿…éœ€æƒé™
permissions:
 contents: read          # è¯»å–ä»£ç 
 security-events: write  # ä¸Šä¼ SARIFæŠ¥å‘Šåˆ°Securityæ ‡ç­¾
 pull-requests: write    # PRè¯„è®º

env:
 REGISTRY: ghcr.io
 IMAGE_NAME: ${{ github.repository }}

jobs:
 secret-scan:
  name: Secret Scanning
  runs-on: ubuntu-latest
  steps:
   - uses: actions/checkout@v4
    with:
     fetch-depth: 0 # å…¨å†å²æ‰«æ,æ£€æµ‹å†å²æäº¤ä¸­çš„æ³„éœ²

   - name: TruffleHog Secret Scan
    uses: trufflesecurity/trufflehog@main
    with:
     path: ./
     base: ${{ github.event.repository.default_branch }}
     head: HEAD

 sast-scan:
  name: SAST Scanning
  runs-on: ubuntu-latest
  steps:
   - uses: actions/checkout@v4

   # CodeQLåˆ†æ(GitHubåŸç”Ÿ)
   - name: Initialize CodeQL
    uses: github/codeql-action/init@v3
    with:
     languages: java, javascript

   - name: Build
    run: mvn clean package -DskipTests

   - name: Perform CodeQL Analysis
    uses: github/codeql-action/analyze@v3

   # SonarCloudåˆ†æ(ç¬¬ä¸‰æ–¹)
   - name: SonarCloud Scan
    uses: SonarSource/sonarcloud-github-action@master
    env:
     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
     SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}

 sca-scan:
  name: SCA Dependency Scanning
  runs-on: ubuntu-latest
  steps:
   - uses: actions/checkout@v4

   - name: Run Snyk
    uses: snyk/actions/maven@master
    env:
     SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
    with:
     args: --severity-threshold=high

   # ä¸Šä¼ SARIFæŠ¥å‘Šåˆ°GitHub Securityæ ‡ç­¾
   - name: Upload Snyk results to GitHub Security
    uses: github/codeql-action/upload-sarif@v3
    with:
     sarif_file: snyk.sarif

 container-scan:
  name: Container Image Scanning
  runs-on: ubuntu-latest
  needs: [sast-scan, sca-scan] # ä¾èµ–å‰ç½®æ‰«æé€šè¿‡
  steps:
   - uses: actions/checkout@v4

   - name: Build Image
    run: |
     docker build -t ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }} .

   - name: Scan with Trivy
    uses: aquasecurity/trivy-action@master
    with:
     image-ref: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }}
     format: 'sarif'
     output: 'trivy-results.sarif'
     severity: 'CRITICAL,HIGH'
     exit-code: '1' # å‘ç°é«˜å±æ¼æ´åˆ™å¤±è´¥

   - name: Upload Trivy results
    uses: github/codeql-action/upload-sarif@v3
    with:
     sarif_file: 'trivy-results.sarif'

   # ä½¿ç”¨Cosignç­¾å(Keylessæ¨¡å¼,åŸºäºOIDC)
   - name: Sign Image with Cosign
    run: |
     cosign sign --key env://COSIGN_KEY \
      ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }}
    env:
     COSIGN_KEY: ${{ secrets.COSIGN_PRIVATE_KEY }}
     COSIGN_PASSWORD: ${{ secrets.COSIGN_PASSWORD }}

 security-gate:
  name: Security Quality Gate
  runs-on: ubuntu-latest
  needs: [secret-scan, sast-scan, sca-scan, container-scan]
  steps:
   - name: Check Security Gate
    run: |
     echo "âœ… All security scans passed!"
     echo "Ready for deployment"

   # PRè‡ªåŠ¨è¯„è®ºé€šçŸ¥æ‰«æç»“æœ
   - name: Post PR Comment
    if: github.event_name == 'pull_request'
    uses: actions/github-script@v7
    with:
     script: |
      github.rest.issues.createComment({
       issue_number: context.issue.number,
       owner: context.repo.owner,
       repo: context.repo.repo,
       body: 'âœ… Security scans passed! Safe to merge.'
      })
```

å…³é”®é…ç½®è¦ç‚¹:

- **æƒé™æœ€å°åŒ–**:é¡¶å±‚`permissions`ä»…æˆäºˆå¿…éœ€æƒé™ã€‚é»˜è®¤GitHub Actionsæ‹¥æœ‰`write`æƒé™,éœ€æ˜¾å¼é™çº§ä¸º`read`å¹¶æŒ‰éœ€å¼€æ”¾ã€‚
- **Secretç®¡ç†**:`SNYK_TOKEN`ã€`COSIGN_PRIVATE_KEY`å­˜å‚¨åœ¨GitHub Repository Secretsä¸­,è¿è¡Œæ—¶é€šè¿‡ç¯å¢ƒå˜é‡æ³¨å…¥,ç¦æ­¢åœ¨æ—¥å¿—ä¸­æ‰“å°ã€‚
- **SARIFæŠ¥å‘Šä¸Šä¼ **:CodeQLã€Snykã€Trivyæ‰«æç»“æœç»Ÿä¸€ä¸Šä¼ åˆ°GitHub Securityæ ‡ç­¾,é›†ä¸­å±•ç¤ºæ¼æ´å¹¶è¿½è¸ªä¿®å¤çŠ¶æ€ã€‚

---

## 5.7.2 IaCå®‰å…¨æ‰«æ

### Terraformæ‰«æå·¥å…·å¯¹æ¯”

Terraformç­‰IaCå·¥å…·å°†åŸºç¡€è®¾æ–½é…ç½®ä»£ç åŒ–,ä½†é…ç½®é”™è¯¯(å¦‚S3å…¬å¼€è®¿é—®ã€å®‰å…¨ç»„0.0.0.0/0å¼€æ”¾)ä¼šç›´æ¥å¼•å…¥å®‰å…¨é£é™©ã€‚ä¸‹è¡¨å¯¹æ¯”ä¸»æµæ‰«æå·¥å…·çš„æ ¸å¿ƒèƒ½åŠ›:

| å·¥å…· | Checkov | tfsec | Terrascan | Snyk IaC |
|------|---------|-------|-----------|----------|
| å¼€å‘è€… | Bridgecrew/Palo Alto | Aqua Security | Tenable | Snyk |
| å¼€æº | æ˜¯ | æ˜¯ | æ˜¯ | éƒ¨åˆ†å¼€æº |
| è§„åˆ™æ•° | 1000+ | 600+ | 500+ | 400+ |
| è¯­è¨€ | Python | Go | Go | å¤šè¯­è¨€ |
| IaCæ”¯æŒ | TF/CFN/K8s/Helm | Terraform | TF/CFN/K8s | TF/K8s/ARM |
| è‡ªå®šä¹‰è§„åˆ™ | Python | JSON/Rego | Rego | æœ‰é™ |
| CI/CDé›†æˆ | æ˜“ | æ˜“ | æ˜“ | æ˜“ |
| ä¿®å¤å»ºè®® | è¯¦ç»† | ä¸­ç­‰ | åŸºç¡€ | è¯¦ç»† |
| è¯¯æŠ¥ç‡ | ä¸­ | ä½ | ä¸­ | ä½ |
| æ€§èƒ½ | ä¸­ | å¿« | ä¸­ | å¿« |
| æœ€ä½³åœºæ™¯ | å…¨é¢æ£€æŸ¥ | Terraformä¸“ç²¾ | å¤šIaCæ”¯æŒ | CI/CDé›†æˆ |

é€‰å‹å†³ç­–ä¾æ®:

- **å¼€æºä¼˜å…ˆ**:é¢„ç®—æœ‰é™æˆ–éœ€è¦å®šåˆ¶è§„åˆ™,é€‰æ‹©Checkov(è§„åˆ™æœ€ä¸°å¯Œ)æˆ–tfsec(æ€§èƒ½æœ€å¿«)ã€‚
- **Terraformä¸“ç²¾**:çº¯Terraformç¯å¢ƒ,é€‰æ‹©tfsec(è¯¯æŠ¥ç‡ä½ã€æ‰«æé€Ÿåº¦å¿«)ã€‚
- **å¤šIaCæ ¼å¼**:åŒæ—¶ä½¿ç”¨Terraformã€Kubernetes YAMLã€Helm,é€‰æ‹©Checkovæˆ–Terrascanã€‚
- **å•†ä¸šæ”¯æŒ**:éœ€è¦ä¼ä¸šçº§æ”¯æŒä¸æŒç»­æ›´æ–°,é€‰æ‹©Snyk IaCæˆ–Bridgecrew(å·²è¢«Palo Altoæ”¶è´­)ã€‚

å¸¸è§è¯¯åŒº:ä»…ä¾èµ–å•ä¸€å·¥å…·å¯¼è‡´è§„åˆ™è¦†ç›–ä¸å…¨,å»ºè®®ç»„åˆä½¿ç”¨(å¦‚Checkov+tfsec,é€šè¿‡å¹¶é›†è¦†ç›–æ›´å¤šé£é™©ç‚¹)ã€‚

### Checkovå®æˆ˜

Checkovæ˜¯åŠŸèƒ½æœ€å…¨é¢çš„IaCæ‰«æå·¥å…·,æ”¯æŒ1000+è§„åˆ™ä¸è‡ªå®šä¹‰Pythonè§„åˆ™ã€‚åŸºæœ¬ä½¿ç”¨:

```bash
# å®‰è£…Checkov
pip3 install checkov

# æ‰«æTerraformä»£ç 
checkov -d /path/to/terraform \
 --framework terraform \
 --output cli \
 --output json \
 --output-file checkov-report.json

# åªæ£€æŸ¥ç‰¹å®šä¸¥é‡æ€§(å‡å°‘å™ªéŸ³)
checkov -d . --compact --quiet \
 --check CKV_AWS_20,CKV_AWS_21

# è·³è¿‡ç‰¹å®šæ£€æŸ¥(é€šè¿‡æŠ‘åˆ¶æ–‡ä»¶ç®¡ç†)
checkov -d . --skip-check CKV_AWS_8

# ä»…æ˜¾ç¤ºå¤±è´¥çš„æ£€æŸ¥(å¿«é€Ÿå®šä½é—®é¢˜)
checkov -d . --compact --quiet
```

CI/CDé›†æˆç¤ºä¾‹(GitLab CI):

```yaml
# .gitlab-ci.yml
checkov-scan:
 stage: security
 image: bridgecrew/checkov:latest
 script:
  - |
   checkov -d terraform/ \
    --framework terraform \
    --output cli \
    --output junitxml \
    --output-file checkov-report.xml \
    --soft-fail # ä¸é˜»æ–­æ„å»º,ä»…è­¦å‘Š
 artifacts:
  reports:
   junit: checkov-report.xml
  when: always
 only:
  - merge_requests
```

å…³é”®é…ç½®:

- **--soft-fail**:åˆæœŸæ¨å¹¿é˜¶æ®µå»ºè®®ä½¿ç”¨,ä»…ç”Ÿæˆè­¦å‘Šä¸é˜»æ–­æ„å»º,é¿å…å¼€å‘å›¢é˜ŸæŠµè§¦ã€‚æˆç†Ÿåæ”¹ä¸ºå¼ºåˆ¶é˜»æ–­æ¨¡å¼(ç§»é™¤è¯¥å‚æ•°)ã€‚
- **è¾“å‡ºæ ¼å¼**:åŒæ—¶è¾“å‡ºCLI(äººç±»å¯è¯»)ä¸JSON(æœºå™¨è§£æ),JSONç”¨äºåç»­æ•°æ®åˆ†æä¸å·¥å•åˆ›å»ºã€‚
- **æŠ‘åˆ¶æ–‡ä»¶**:å¯¹äºåˆç†çš„ä¾‹å¤–(å¦‚æµ‹è¯•ç¯å¢ƒå…è®¸S3å…¬å¼€è¯»),é€šè¿‡`--skip-check`æˆ–`.checkov.yml`é…ç½®æ–‡ä»¶é›†ä¸­ç®¡ç†,è€Œéåœ¨ä»£ç ä¸­æ·»åŠ å¤§é‡æ³¨é‡Šã€‚

è‡ªå®šä¹‰è§„åˆ™ç¤ºä¾‹(æ£€æŸ¥S3 Bucketå¿…éœ€æ ‡ç­¾):

```python
# custom_checks/S3BucketCustomCheck.py
from checkov.terraform.checks.resource.base_resource_check import BaseResourceCheck
from checkov.common.models.enums import CheckResult, CheckCategories

class S3BucketRequireTags(BaseResourceCheck):
 def __init__(self):
  name = "Ensure S3 bucket has required tags"
  id = "CKV_AWS_CUSTOM_001"
  supported_resources = ['aws_s3_bucket']
  categories = [CheckCategories.GENERAL_SECURITY]
  super().__init__(name=name, id=id, categories=categories,
          supported_resources=supported_resources)

 def scan_resource_conf(self, conf):
  """
  æ£€æŸ¥S3 bucketæ˜¯å¦åŒ…å«å¿…éœ€çš„æ ‡ç­¾
  é€‚ç”¨è¾¹ç•Œ:ä»…æ£€æŸ¥æ ‡ç­¾å­˜åœ¨æ€§,ä¸éªŒè¯æ ‡ç­¾å€¼åˆæ³•æ€§(éœ€é¢å¤–è§„åˆ™)
  """
  required_tags = ['Environment', 'Owner', 'CostCenter']

  if 'tags' in conf:
   tags = conf['tags'][0]
   missing_tags = [tag for tag in required_tags if tag not in tags]

   if missing_tags:
    self.evaluated_keys = ['tags']
    return CheckResult.FAILED

  return CheckResult.PASSED

check = S3BucketRequireTags()
```

è¿è¡Œè‡ªå®šä¹‰è§„åˆ™:

```bash
checkov -d terraform/ --external-checks-dir ./custom_checks/
```

éªŒè¯æ–¹æ³•:åˆ›å»ºä¸åŒ…å«å¿…éœ€æ ‡ç­¾çš„æµ‹è¯•Terraformæ–‡ä»¶,ç¡®è®¤Checkovæ£€æµ‹åˆ°è¿è§„;ä¿®å¤åé‡æ–°æ‰«æ,ç¡®è®¤é€šè¿‡ã€‚

### tfsecå®æˆ˜

tfsecä¸“æ³¨äºTerraform,æ‰«æé€Ÿåº¦å¿«ã€è¯¯æŠ¥ç‡ä½ã€‚åŸºæœ¬ä½¿ç”¨:

```bash
# å®‰è£…tfsec
brew install tfsec

# åŸºæœ¬æ‰«æ
tfsec .

# è¾“å‡ºJSONæ ¼å¼(ç”¨äºCI/CDé›†æˆ)
tfsec . --format json --out tfsec-report.json

# åªæ˜¾ç¤ºé«˜å±å’Œä¸¥é‡é—®é¢˜(å‡å°‘å™ªéŸ³)
tfsec . --minimum-severity HIGH

# è‡ªå®šä¹‰é…ç½®æ–‡ä»¶
tfsec . --config-file tfsec.yml

# å¿½ç•¥ç‰¹å®šæ£€æŸ¥(é€šè¿‡é…ç½®æ–‡ä»¶ç®¡ç†)
tfsec . --exclude aws-s3-enable-bucket-logging
```

é…ç½®æ–‡ä»¶ç¤ºä¾‹(tfsec.yml):

```yaml
minimum_severity: MEDIUM

exclude:
 - aws-s3-enable-bucket-logging # å¼€å‘ç¯å¢ƒå¯ä»¥è·³è¿‡æ—¥å¿—

severity_overrides:
 aws-ec2-no-public-ip: HIGH # æå‡ä¸¥é‡æ€§

custom_check_dir: ./custom-checks
```

éªŒè¯æ–¹æ³•:åˆ›å»ºåŒ…å«å…¬å¼€S3 Bucketçš„æµ‹è¯•Terraformæ–‡ä»¶,ç¡®è®¤tfsecæ£€æµ‹åˆ°`aws-s3-block-public-access`è¿è§„;æ·»åŠ `public_access_block`é…ç½®åé‡æ–°æ‰«æ,ç¡®è®¤é€šè¿‡ã€‚

### Terrascanå®æˆ˜

Terrascanæ”¯æŒå¤šç§IaCå·¥å…·,é€‚åˆæ··åˆç¯å¢ƒã€‚åŸºæœ¬ä½¿ç”¨:

```bash
# å®‰è£…Terrascan
brew install terrascan

# æ‰«æTerraform
terrascan scan -t terraform

# æ‰«æç‰¹å®šç­–ç•¥(å¦‚AWSä¸“ç”¨ç­–ç•¥)
terrascan scan -t terraform -p aws

# è¾“å‡ºSARIFæ ¼å¼(ç”¨äºGitHub Securityæ ‡ç­¾)
terrascan scan -o sarif > terrascan-report.sarif
```

Pre-commité›†æˆ(åœ¨æäº¤å‰è‡ªåŠ¨æ‰«æ):

```yaml
# .pre-commit-config.yaml
repos:
 - repo: https://github.com/tenable/terrascan
  rev: v1.18.0
  hooks:
   - id: terrascan
    args: ['-t', 'terraform']
```

å®‰è£…Pre-commit Hook:

```bash
pre-commit install
```

éªŒè¯æ–¹æ³•:ä¿®æ”¹Terraformæ–‡ä»¶å¼•å…¥å®‰å…¨é£é™©(å¦‚ç§»é™¤åŠ å¯†é…ç½®),æ‰§è¡Œ`git commit`,ç¡®è®¤Pre-commit Hooké˜»æ­¢æäº¤å¹¶æ˜¾ç¤ºTerrascanæŠ¥å‘Š;ä¿®å¤åé‡æ–°æäº¤,ç¡®è®¤é€šè¿‡ã€‚

### ç»¼åˆIaCæ‰«æè„šæœ¬

ç”Ÿäº§ç¯å¢ƒå»ºè®®ç»„åˆä½¿ç”¨å¤šä¸ªå·¥å…·,é€šè¿‡å¹¶é›†æé«˜è¦†ç›–ç‡ã€‚ä»¥ä¸‹Shellè„šæœ¬é›†æˆCheckovã€tfsecã€Terrascan,ç”Ÿæˆæ±‡æ€»æŠ¥å‘Š:

```bash
#!/bin/bash
# iac-security-scan.sh - ç»¼åˆIaCæ‰«æè„šæœ¬

set -e

echo "======================================="
echo " Infrastructure as Code Security Scan"
echo "======================================="
echo ""

# é¢œè‰²å®šä¹‰
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# åˆ›å»ºæŠ¥å‘Šç›®å½•
mkdir -p reports

# 1. Checkovæ‰«æ
echo -e "${YELLOW}[1/4] Running Checkov...${NC}"
checkov -d terraform/ \
 --framework terraform \
 --compact \
 --quiet \
 --output cli \
 --output json \
 --output-file reports/checkov-report.json

CHECKOV_EXIT=$?
if [ $CHECKOV_EXIT -eq 0 ]; then
 echo -e "${GREEN}âœ“ Checkov passed${NC}"
else
 echo -e "${RED}âœ— Checkov found issues${NC}"
fi

# 2. tfsecæ‰«æ
echo -e "${YELLOW}[2/4] Running tfsec...${NC}"
tfsec terraform/ \
 --format json \
 --out reports/tfsec-report.json \
 --minimum-severity MEDIUM

TFSEC_EXIT=$?
if [ $TFSEC_EXIT -eq 0 ]; then
 echo -e "${GREEN}âœ“ tfsec passed${NC}"
else
 echo -e "${RED}âœ— tfsec found issues${NC}"
fi

# 3. Terrascanæ‰«æ
echo -e "${YELLOW}[3/4] Running Terrascan...${NC}"
terrascan scan -t terraform \
 -d terraform/ \
 -o json > reports/terrascan-report.json

TERRASCAN_EXIT=$?
if [ $TERRASCAN_EXIT -eq 0 ]; then
 echo -e "${GREEN}âœ“ Terrascan passed${NC}"
else
 echo -e "${RED}âœ— Terrascan found issues${NC}"
fi

# 4. ç”Ÿæˆæ±‡æ€»æŠ¥å‘Š
echo -e "${YELLOW}[4/4] Generating summary...${NC}"
python3 <<EOF
import json
from collections import defaultdict

def load_json(file):
 try:
  with open(file) as f:
   return json.load(f)
 except:
  return {}

checkov = load_json('reports/checkov-report.json')
tfsec = load_json('reports/tfsec-report.json')
terrascan = load_json('reports/terrascan-report.json')

summary = defaultdict(int)

# Checkovç»Ÿè®¡
if 'summary' in checkov:
 summary['checkov_passed'] = checkov['summary'].get('passed', 0)
 summary['checkov_failed'] = checkov['summary'].get('failed', 0)

# tfsecç»Ÿè®¡
if 'results' in tfsec:
 summary['tfsec_issues'] = len(tfsec['results'])

# Terrascanç»Ÿè®¡
if 'results' in terrascan:
 summary['terrascan_violations'] = terrascan['results'].get('violation_store', {}).get('violations', [])
 summary['terrascan_issues'] = len(summary['terrascan_violations'])

print("\n" + "="*50)
print(" IaC Security Scan Summary")
print("="*50)
print(f"Checkov: {summary['checkov_passed']} passed, {summary['checkov_failed']} failed")
print(f"tfsec: {summary['tfsec_issues']} issues found")
print(f"Terrascan: {summary['terrascan_issues']} issues found")
print("="*50)

# æ€»ä½“åˆ¤å®š
total_issues = summary['checkov_failed'] + summary['tfsec_issues'] + summary['terrascan_issues']
if total_issues > 0:
 print(f"\nâš  Total {total_issues} security issues found")
 exit(1)
else:
 print("\nâœ… All IaC security scans passed!")
 exit(0)
EOF

SUMMARY_EXIT=$?

# ä¸Šä¼ æŠ¥å‘Šåˆ°S3(å¯é€‰)
if [ -n "$REPORTS_S3_BUCKET" ]; then
 aws s3 cp reports/ s3://$REPORTS_S3_BUCKET/iac-scans/$(date +%Y%m%d)/ --recursive
fi

exit $SUMMARY_EXIT
```

è¿è¡ŒæŒ‡æ ‡:è„šæœ¬æ‰§è¡Œæ—¶é—´åº”â‰¤5åˆ†é’Ÿ(ä¸­å‹Terraformé¡¹ç›®,çº¦100ä¸ªèµ„æº);è¯¯æŠ¥ç‡é€šè¿‡äººå·¥å¤æ ¸å‰50ä¸ªå‘Šè­¦ç¡®è®¤,ç›®æ ‡â‰¤20%ã€‚

---

## 5.7.3 CloudFormationå®‰å…¨

CloudFormationæ˜¯AWSåŸç”ŸIaCå·¥å…·,å®‰å…¨æ£€æŸ¥éœ€è¦ä¸“ç”¨å·¥å…·ã€‚ä¸»æµå·¥å…·åŒ…æ‹¬cfn-nag(Rubyç¼–å†™,è§„åˆ™ä¸°å¯Œ)ä¸CloudFormation Guard(AWSå®˜æ–¹,ç­–ç•¥å³ä»£ç )ã€‚

### cfn-nagå®æˆ˜

cfn-nagä¸“æ³¨äºCloudFormationæ¨¡æ¿æ‰«æ,æ£€æµ‹IAMè¿‡åº¦æƒé™ã€åŠ å¯†ç¼ºå¤±ç­‰é—®é¢˜ã€‚åŸºæœ¬ä½¿ç”¨:

```bash
# å®‰è£…cfn-nag
gem install cfn-nag

# æ‰«æå•ä¸ªæ¨¡æ¿
cfn_nag_scan --input-path template.yaml

# æ‰«æç›®å½•
cfn_nag_scan --input-path cloudformation/

# è¾“å‡ºJSON(ç”¨äºCI/CDé›†æˆ)
cfn_nag_scan --input-path template.yaml \
 --output-format json > cfn-nag-report.json

# åªæ˜¾ç¤ºå¤±è´¥(è­¦å‘Šä¸é˜»æ–­æ„å»º)
cfn_nag_scan --input-path template.yaml --fail-on-warnings

# å¿½ç•¥ç‰¹å®šè§„åˆ™(é€šè¿‡æŠ‘åˆ¶æ–‡ä»¶ç®¡ç†)
cfn_nag_scan --input-path template.yaml \
 --blacklist-path cfn-nag-suppressions.yml
```

æŠ‘åˆ¶æ–‡ä»¶ç¤ºä¾‹(cfn-nag-suppressions.yml):

```yaml
---
RulesToSuppress:
 - id: W28
  reason: "Resource names are explicitly set for organizational requirements"

 - id: F1000
  reason: "Missing egress rule accepted for security group in private subnet"
```

éªŒè¯æ–¹æ³•:åˆ›å»ºåŒ…å«å…¬å¼€S3 Bucketçš„CloudFormationæ¨¡æ¿,ç¡®è®¤cfn-nagæ£€æµ‹åˆ°`W35`(S3ç¼ºå°‘è®¿é—®æ—¥å¿—)ä¸`F14`(S3å…¬å¼€è¯»);ä¿®å¤åé‡æ–°æ‰«æ,ç¡®è®¤é€šè¿‡ã€‚

### CloudFormation Guardå®æˆ˜

CloudFormation Guardä½¿ç”¨è‡ªå®šä¹‰DSLå®šä¹‰ç­–ç•¥,é€‚åˆä¼ä¸šçº§åˆè§„æ£€æŸ¥ã€‚åŸºæœ¬ä½¿ç”¨:

```bash
# å®‰è£…cfn-guard
cargo install cfn-guard

# éªŒè¯è§„åˆ™
cfn-guard validate \
 --data template.yaml \
 --rules s3-security-rules.guard

# æ‰¹é‡éªŒè¯(ç›®å½•æ¨¡å¼)
cfn-guard validate \
 --data cloudformation/ \
 --rules rules/ \
 --show-summary all
```

è§„åˆ™æ–‡ä»¶ç¤ºä¾‹(s3-security-rules.guard):

```
# S3 Bucketå¿…é¡»å¯ç”¨åŠ å¯†
rule s3_bucket_encrypted {
 Resources.*[ Type == 'AWS::S3::Bucket' ] {
  Properties {
   BucketEncryption exists
   BucketEncryption {
    ServerSideEncryptionConfiguration exists
    ServerSideEncryptionConfiguration[*] {
     ServerSideEncryptionByDefault exists
     ServerSideEncryptionByDefault {
      SSEAlgorithm in ['aws:kms', 'AES256']
     }
    }
   }
  }
 }
}

# S3 Bucketå¿…é¡»é˜»æ­¢å…¬å…±è®¿é—®
rule s3_bucket_block_public_access {
 Resources.*[ Type == 'AWS::S3::Bucket' ] {
  Properties {
   PublicAccessBlockConfiguration exists
   PublicAccessBlockConfiguration {
    BlockPublicAcls == true
    BlockPublicPolicy == true
    IgnorePublicAcls == true
    RestrictPublicBuckets == true
   }
  }
 }
}

# S3 Bucketå¿…é¡»å¯ç”¨ç‰ˆæœ¬æ§åˆ¶
rule s3_bucket_versioning {
 Resources.*[ Type == 'AWS::S3::Bucket' ] {
  Properties {
   VersioningConfiguration exists
   VersioningConfiguration {
    Status == 'Enabled'
   }
  }
 }
}
```

éªŒè¯æ–¹æ³•:åˆ›å»ºä¸ç¬¦åˆè§„åˆ™çš„CloudFormationæ¨¡æ¿(å¦‚S3æœªå¯ç”¨åŠ å¯†),æ‰§è¡Œ`cfn-guard validate`,ç¡®è®¤è§„åˆ™æ£€æµ‹å¤±è´¥;ä¿®å¤åé‡æ–°éªŒè¯,ç¡®è®¤é€šè¿‡ã€‚

### CloudFormationå®‰å…¨æ¨¡æ¿ç¤ºä¾‹

ä»¥ä¸‹æ¨¡æ¿å±•ç¤ºS3 Bucketå®‰å…¨é…ç½®æœ€ä½³å®è·µ:

```yaml
# secure-s3-bucket.yaml
AWSTemplateFormatVersion: '2010-09-09'
Description: Secure S3 Bucket with best practices

Parameters:
 BucketName:
  Type: String
  Description: Name of the S3 bucket
 DataClassification:
  Type: String
  Default: L2
  AllowedValues: [L1, L2, L3, L4]
  Description: Data classification level

Conditions:
 IsHighSensitivity: !Or
  - !Equals [!Ref DataClassification, L1]
  - !Equals [!Ref DataClassification, L2]

Resources:
 # KMSå¯†é’¥(ç”¨äºL1/L2æ•°æ®)
 BucketEncryptionKey:
  Type: AWS::KMS::Key
  Condition: IsHighSensitivity
  Properties:
   Description: !Sub 'Encryption key for ${BucketName}'
   KeyPolicy:
    Version: '2012-10-17'
    Statement:
     - Sid: Enable IAM User Permissions
      Effect: Allow
      Principal:
       AWS: !Sub 'arn:aws:iam::${AWS::AccountId}:root'
      Action: 'kms:*'
      Resource: '*'
     - Sid: Allow S3 to use the key
      Effect: Allow
      Principal:
       Service: s3.amazonaws.com
      Action:
       - 'kms:Decrypt'
       - 'kms:GenerateDataKey'
      Resource: '*'

 BucketEncryptionKeyAlias:
  Type: AWS::KMS::Alias
  Condition: IsHighSensitivity
  Properties:
   AliasName: !Sub 'alias/${BucketName}-key'
   TargetKeyId: !Ref BucketEncryptionKey

 # å®‰å…¨çš„S3 Bucket
 SecureS3Bucket:
  Type: AWS::S3::Bucket
  Properties:
   BucketName: !Ref BucketName

   # é˜»æ­¢å…¬å…±è®¿é—®
   PublicAccessBlockConfiguration:
    BlockPublicAcls: true
    BlockPublicPolicy: true
    IgnorePublicAcls: true
    RestrictPublicBuckets: true

   # å¯ç”¨ç‰ˆæœ¬æ§åˆ¶
   VersioningConfiguration:
    Status: Enabled

   # åŠ å¯†é…ç½®
   BucketEncryption:
    ServerSideEncryptionConfiguration:
     - ServerSideEncryptionByDefault:
       SSEAlgorithm: !If [IsHighSensitivity, 'aws:kms', 'AES256']
       KMSMasterKeyID: !If [IsHighSensitivity, !GetAtt BucketEncryptionKey.Arn, !Ref AWS::NoValue]
      BucketKeyEnabled: true

   # è®¿é—®æ—¥å¿—
   LoggingConfiguration:
    DestinationBucketName: !Ref LoggingBucket
    LogFilePrefix: !Sub '${BucketName}/'

   # ç”Ÿå‘½å‘¨æœŸç­–ç•¥
   LifecycleConfiguration:
    Rules:
     - Id: TransitionToIA
      Status: Enabled
      Transitions:
       - TransitionInDays: 90
        StorageClass: STANDARD_IA
     - Id: DeleteOldVersions
      Status: Enabled
      NoncurrentVersionExpirationInDays: 30

   # æ ‡ç­¾
   Tags:
    - Key: Environment
     Value: Production
    - Key: DataClassification
     Value: !Ref DataClassification
    - Key: ManagedBy
     Value: CloudFormation

 # Bucketç­–ç•¥ - å¼ºåˆ¶HTTPSå’ŒåŠ å¯†
 SecureS3BucketPolicy:
  Type: AWS::S3::BucketPolicy
  Properties:
   Bucket: !Ref SecureS3Bucket
   PolicyDocument:
    Statement:
     - Sid: DenyInsecureTransport
      Effect: Deny
      Principal: '*'
      Action: 's3:*'
      Resource:
       - !GetAtt SecureS3Bucket.Arn
       - !Sub '${SecureS3Bucket.Arn}/*'
      Condition:
       Bool:
        'aws:SecureTransport': false

     - Sid: DenyUnencryptedObjectUploads
      Effect: Deny
      Principal: '*'
      Action: 's3:PutObject'
      Resource: !Sub '${SecureS3Bucket.Arn}/*'
      Condition:
       StringNotEquals:
        's3:x-amz-server-side-encryption': !If [IsHighSensitivity, 'aws:kms', 'AES256']

 # æ—¥å¿—Bucket
 LoggingBucket:
  Type: AWS::S3::Bucket
  Properties:
   BucketName: !Sub '${BucketName}-logs'
   PublicAccessBlockConfiguration:
    BlockPublicAcls: true
    BlockPublicPolicy: true
    IgnorePublicAcls: true
    RestrictPublicBuckets: true
   LifecycleConfiguration:
    Rules:
     - Id: DeleteOldLogs
      Status: Enabled
      ExpirationInDays: 90

Outputs:
 BucketName:
  Description: Name of the secure S3 bucket
  Value: !Ref SecureS3Bucket

 BucketArn:
  Description: ARN of the secure S3 bucket
  Value: !GetAtt SecureS3Bucket.Arn

 EncryptionKeyId:
  Condition: IsHighSensitivity
  Description: KMS Key ID for bucket encryption
  Value: !Ref BucketEncryptionKey
```

å…³é”®é…ç½®è¯´æ˜:

- **æ•°æ®åˆ†ç±»é©±åŠ¨åŠ å¯†**:L1/L2é«˜æ•æ„Ÿæ•°æ®ä½¿ç”¨KMSåŠ å¯†,L3/L4ä½¿ç”¨S3é»˜è®¤AES256åŠ å¯†ã€‚åˆ†ç±»æ ‡å‡†éœ€å‚è€ƒç»„ç»‡æ•°æ®åˆ†ç±»ç­–ç•¥ã€‚
- **å¼ºåˆ¶HTTPS**:BucketPolicyæ‹’ç»éHTTPSè¯·æ±‚,é˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚
- **å¼ºåˆ¶åŠ å¯†ä¸Šä¼ **:BucketPolicyæ‹’ç»æœªåŠ å¯†å¯¹è±¡,ç¡®ä¿æ‰€æœ‰æ•°æ®é™æ€åŠ å¯†ã€‚
- **ç‰ˆæœ¬æ§åˆ¶**:å¯ç”¨ç‰ˆæœ¬æ§åˆ¶é˜²æ­¢è¯¯åˆ é™¤,é…åˆç”Ÿå‘½å‘¨æœŸç­–ç•¥è‡ªåŠ¨æ¸…ç†æ—§ç‰ˆæœ¬(30å¤©)ã€‚
- **è®¿é—®æ—¥å¿—**:æ‰€æœ‰è®¿é—®è®°å½•åˆ°ç‹¬ç«‹æ—¥å¿—Bucket,æ—¥å¿—ä¿ç•™90å¤©(æ ¹æ®åˆè§„è¦æ±‚è°ƒæ•´)ã€‚

éªŒè¯æ–¹æ³•:éƒ¨ç½²æ¨¡æ¿å,å°è¯•é€šè¿‡HTTPè®¿é—®Bucket,ç¡®è®¤403æ‹’ç»;å°è¯•ä¸Šä¼ æœªåŠ å¯†å¯¹è±¡,ç¡®è®¤403æ‹’ç»;æ£€æŸ¥ç‰ˆæœ¬æ§åˆ¶ä¸æ—¥å¿—é…ç½®,ç¡®è®¤ç¬¦åˆé¢„æœŸã€‚

---

## 5.7.4 å®¹å™¨é•œåƒå®‰å…¨

### é•œåƒç­¾åæ–¹æ¡ˆå¯¹æ¯”

å®¹å™¨é•œåƒç­¾åç”¨äºéªŒè¯é•œåƒå®Œæ•´æ€§ä¸æ¥æºå¯ä¿¡æ€§,é˜²æ­¢ä¾›åº”é“¾æ”»å‡»ã€‚ä¸‹è¡¨å¯¹æ¯”ä¸»æµç­¾åæ–¹æ¡ˆ:

| æ–¹æ¡ˆ | Cosign | Notary (v1) | Notary v2 | Docker Content Trust |
|------|--------|-------------|-----------|---------------------|
| å¼€å‘è€… | Sigstore | CNCF | CNCF | Docker |
| æ ‡å‡† | è‡ªæœ‰ | TUF | OCIæ ‡å‡† | TUF |
| å¯†é’¥ç®¡ç† | çµæ´» | å¤æ‚ | ç®€åŒ– | Docker Hub |
| OCIæ”¯æŒ | æ˜¯ | å¦ | æ˜¯ | æœ‰é™ |
| Kubernetesé›†æˆ | æ˜“ | ä¸­ | æ˜“ | éš¾ |
| å­¦ä¹ æ›²çº¿ | ä½ | é«˜ | ä¸­ | ä¸­ |
| ç¤¾åŒºæ´»è·ƒåº¦ | é«˜ | ä½(å·²åºŸå¼ƒ) | ä¸­ | ä½ |
| æ¨èåº¦ | æ¨è | ä¸æ¨è | æ¨è | ä¸æ¨è |

é€‰å‹å»ºè®®:

- **æ–°é¡¹ç›®ä¼˜å…ˆCosign**:å­¦ä¹ æ›²çº¿ä½ã€ç¤¾åŒºæ´»è·ƒã€æ”¯æŒKeylessç­¾å(åŸºäºOIDC,æ— éœ€ç®¡ç†ç§é’¥)ã€‚
- **OCIç”Ÿæ€ä¼˜å…ˆNotary v2**:ç¬¦åˆOCIæ ‡å‡†,é•¿æœŸæ”¯æŒæœ‰ä¿éšœ,ä½†å½“å‰ç”Ÿæ€ä¸å¦‚Cosignæˆç†Ÿã€‚
- **é¿å…Notary v1ä¸Docker Content Trust**:å·²åºŸå¼ƒæˆ–ä»…é™Docker Hub,ä¸é€‚åˆæ–°é¡¹ç›®ã€‚

### Cosignå®æˆ˜

Cosignæ˜¯Sigstoreé¡¹ç›®çš„æ ¸å¿ƒå·¥å…·,æ”¯æŒå¯†é’¥å¯¹ç­¾åä¸Keylessç­¾åä¸¤ç§æ¨¡å¼ã€‚

**å®‰è£…ä¸å¯†é’¥ç”Ÿæˆ**:

```bash
# å®‰è£…Cosign
brew install cosign

# ç”Ÿæˆå¯†é’¥å¯¹(å¯†ç ä¿æŠ¤ç§é’¥)
cosign generate-key-pair

# å°†ç§é’¥å­˜å‚¨åˆ°Secret Manager(æ¨èç”Ÿäº§ç¯å¢ƒ)
aws secretsmanager create-secret \
 --name cosign-private-key \
 --secret-string file://cosign.key

# å°†å…¬é’¥åˆ†å‘ç»™éªŒè¯è€…(å¦‚Kubernetesé›†ç¾¤)
kubectl create secret generic cosign-pub-key \
 --from-file=cosign.pub=cosign.pub \
 -n kube-system
```

**é•œåƒç­¾å**:

```bash
# ç­¾åé•œåƒ(ä½¿ç”¨æœ¬åœ°ç§é’¥)
cosign sign --key cosign.key \
 myregistry.io/myapp:v1.0.0

# ä½¿ç”¨ç¯å¢ƒå˜é‡ç§é’¥(é€‚åˆCI/CD)
export COSIGN_PASSWORD=<password>
export COSIGN_KEY=$(cat cosign.key)
cosign sign --key env://COSIGN_KEY \
 myregistry.io/myapp:v1.0.0

# æ— å¯†é’¥ç­¾å(Keyless,ä½¿ç”¨OIDC,æ¨è)
cosign sign \
 --oidc-issuer=https://accounts.google.com \
 myregistry.io/myapp:v1.0.0

# éªŒè¯ç­¾å
cosign verify --key cosign.pub \
 myregistry.io/myapp:v1.0.0

# é™„åŠ attestation(å¦‚SBOMæˆ–SLSA Provenance)
cosign attest --key cosign.key \
 --predicate sbom.json \
 --type slsaprovenance \
 myregistry.io/myapp:v1.0.0
```

**CI/CDé›†æˆç¤ºä¾‹(GitHub Actions)**:

```yaml
# GitHub Actions
name: Build and Sign Image

jobs:
 build-sign:
  runs-on: ubuntu-latest
  permissions:
   contents: read
   packages: write
   id-token: write # OIDCç­¾åå¿…éœ€

  steps:
   - uses: actions/checkout@v4

   - name: Install Cosign
    uses: sigstore/cosign-installer@v3

   - name: Build Image
    run: |
     docker build -t ghcr.io/${{ github.repository }}:${{ github.sha }} .

   - name: Login to GHCR
    uses: docker/login-action@v3
    with:
     registry: ghcr.io
     username: ${{ github.actor }}
     password: ${{ secrets.GITHUB_TOKEN }}

   - name: Push Image
    run: |
     docker push ghcr.io/${{ github.repository }}:${{ github.sha }}

   # Keylessç­¾å(æ— éœ€ç®¡ç†ç§é’¥)
   - name: Sign Image
    run: |
     cosign sign --yes \
      ghcr.io/${{ github.repository }}:${{ github.sha }}

   # ç”ŸæˆSBOMå¹¶é™„åŠ åˆ°é•œåƒ
   - name: Generate SBOM
    uses: anchore/sbom-action@v0
    with:
     image: ghcr.io/${{ github.repository }}:${{ github.sha }}
     format: spdx-json
     output-file: sbom.spdx.json

   - name: Attest SBOM
    run: |
     cosign attest --yes \
      --predicate sbom.spdx.json \
      --type spdxjson \
      ghcr.io/${{ github.repository }}:${{ github.sha }}
```

å…³é”®é…ç½®:

- **Keylessç­¾å**:ä½¿ç”¨GitHub OIDC Tokenç­¾å,æ— éœ€ç®¡ç†ç§é’¥,é™ä½å¯†é’¥æ³„éœ²é£é™©ã€‚`--yes`å‚æ•°è·³è¿‡äº¤äº’ç¡®è®¤(é€‚åˆCI/CD)ã€‚
- **SBOMé™„åŠ **:å°†Syftç”Ÿæˆçš„SBOMä½œä¸ºAttestationé™„åŠ åˆ°é•œåƒ,ä¾›ä¸‹æ¸¸éªŒè¯ä¸å®¡è®¡ã€‚
- **æƒé™æœ€å°åŒ–**:`id-token: write`æƒé™ä»…ç”¨äºOIDC Tokenç”Ÿæˆ,`packages: write`ç”¨äºæ¨é€é•œåƒã€‚

### Kuberneteså‡†å…¥æ§åˆ¶ - éªŒè¯ç­¾å

ç­¾åéªŒè¯éœ€è¦åœ¨Kuberneteså‡†å…¥é˜¶æ®µæ‰§è¡Œ,é˜»æ­¢æœªç­¾åæˆ–ç­¾åæ— æ•ˆçš„é•œåƒéƒ¨ç½²ã€‚ä¸¤ç§å®ç°æ–¹å¼:

**æ–¹å¼ä¸€:ä½¿ç”¨Sigstore Policy Controller**:

```yaml
# Policy Controller (Sigstore) é…ç½®
apiVersion: policy.sigstore.dev/v1beta1
kind: ClusterImagePolicy
metadata:
 name: require-signed-images
spec:
 images:
  - glob: "myregistry.io/**"
 authorities:
  - key:
    data: |
     -----BEGIN PUBLIC KEY-----
     <cosign public key content>
     -----END PUBLIC KEY-----
```

éƒ¨ç½²Policy Controller:

```bash
kubectl apply -f https://github.com/sigstore/policy-controller/releases/latest/download/policy-controller.yaml
```

éªŒè¯æ–¹æ³•:å°è¯•éƒ¨ç½²æœªç­¾åé•œåƒ,ç¡®è®¤Podåˆ›å»ºå¤±è´¥å¹¶æç¤ºç­¾åéªŒè¯é”™è¯¯;éƒ¨ç½²å·²ç­¾åé•œåƒ,ç¡®è®¤PodæˆåŠŸåˆ›å»ºã€‚

**æ–¹å¼äºŒ:ä½¿ç”¨OPA Gatekeeper**(é€‚åˆå·²æœ‰Gatekeeperç¯å¢ƒ):

```yaml
apiVersion: templates.gatekeeper.sh/v1
kind: ConstraintTemplate
metadata:
 name: cosignimageverification
spec:
 crd:
  spec:
   names:
    kind: CosignImageVerification
 targets:
  - target: admission.k8s.gatekeeper.sh
   rego: |
    package cosignimageverification

    violation[{"msg": msg}] {
     container := input.review.object.spec.containers[_]
     not verified(container.image)
     msg := sprintf("Image %v is not signed", [container.image])
    }

    verified(image) {
     # è°ƒç”¨CosignéªŒè¯API (éœ€è¦sidecar)
     result := http.send({
      "method": "POST",
      "url": "http://cosign-verifier:8080/verify",
      "body": {"image": image}
     })
     result.status_code == 200
    }

---
apiVersion: constraints.gatekeeper.sh/v1beta1
kind: CosignImageVerification
metadata:
 name: require-cosign-signature
spec:
 match:
  kinds:
   - apiGroups: [""]
    kinds: ["Pod"]
  namespaces:
   - production
```

é€‚ç”¨è¾¹ç•Œ:Gatekeeperæ–¹å¼éœ€è¦é¢å¤–éƒ¨ç½²éªŒè¯Sidecar(è°ƒç”¨`cosign verify`),å¤æ‚åº¦é«˜äºSigstore Policy Controller,ä½†é€‚åˆå·²æœ‰Gatekeeperç¯å¢ƒé¿å…å·¥å…·ç¢ç‰‡åŒ–ã€‚

### é•œåƒæ‰«æé›†æˆ

é•œåƒç­¾åéªŒè¯æ¥æºå¯ä¿¡æ€§,é•œåƒæ‰«ææ£€æµ‹æ¼æ´ã€‚å®Œæ•´æµæ°´çº¿éœ€è¦ç»“åˆä¸¤è€…:

```yaml
# GitLab CI - å®Œæ•´é•œåƒå®‰å…¨æµæ°´çº¿
stages:
 - build
 - scan
 - sign
 - deploy

build-image:
 stage: build
 script:
  - docker build -t $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA .
  - docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA

# å¹¶è¡Œæ‰«æ(Trivy + Grype)æé«˜è¦†ç›–ç‡
trivy-scan:
 stage: scan
 image: aquasec/trivy:latest
 script:
  - trivy image --exit-code 1 --severity HIGH,CRITICAL \
    $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
 allow_failure: false

grype-scan:
 stage: scan
 image: anchore/grype:latest
 script:
  - grype $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA \
    --fail-on high
 allow_failure: false

# ç­¾å(ä»…ä¸»åˆ†æ”¯)
sign-image:
 stage: sign
 image: gcr.io/projectsigstore/cosign:latest
 script:
  - echo "$COSIGN_KEY" | cosign sign --key env://COSIGN_KEY \
    $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
 only:
  - main

deploy-production:
 stage: deploy
 script:
  - kubectl set image deployment/myapp \
    myapp=$CI_REGISTRY_IMAGE:$CI_COMMIT_SHA \
    -n production
 only:
  - main
 when: manual
```

å…³é”®å†³ç­–:

- **å¹¶è¡Œæ‰«æ**:Trivyä¸Grypeå¹¶è¡Œæ‰§è¡Œ,ç¼©çŸ­æ€»æ‰«ææ—¶é—´(ä»6åˆ†é’Ÿé™è‡³4åˆ†é’Ÿ)ã€‚
- **æ‰«æé˜»æ–­**:`--exit-code 1`ä¸`--fail-on high`ç¡®ä¿é«˜å±æ¼æ´é˜»æ–­æ„å»ºã€‚
- **ç­¾åæ¡ä»¶**:ä»…ä¸»åˆ†æ”¯ç­¾å,é¿å…æ¯ä¸ªPRéƒ½ç”Ÿæˆç­¾åå¢åŠ Registryå­˜å‚¨å‹åŠ›ã€‚

è¿è¡ŒæŒ‡æ ‡:æ‰«æ+ç­¾åæ€»æ—¶é•¿åº”â‰¤5åˆ†é’Ÿ(ä¸­å‹é•œåƒ,çº¦500MB);Criticalæ¼æ´æ£€å‡ºç‡â‰¥95%(é€šè¿‡äººå·¥å¤æ ¸ç¡®è®¤)ã€‚

---

## 5.7.5 å®‰å…¨å·¦ç§»å®è·µ

### IDEæ’ä»¶é›†æˆ

å®‰å…¨å·¦ç§»å°†å®‰å…¨æ£€æŸ¥å‰ç½®åˆ°å¼€å‘é˜¶æ®µ,å‡å°‘ä¿®å¤æˆæœ¬ã€‚IDEæ’ä»¶åœ¨ç¼–ç æ—¶å®æ—¶æç¤ºå®‰å…¨é—®é¢˜,æé«˜å¼€å‘è€…å®‰å…¨æ„è¯†ã€‚

**VS Codeå®‰å…¨æ’ä»¶æ¨è**:

```json
// .vscode/settings.json
{
 "extensions": {
  "recommendations": [
   "ms-azuretools.vscode-docker", // Dockeræ”¯æŒ
   "redhat.vscode-yaml", // YAMLéªŒè¯
   "hashicorp.terraform", // Terraformè¯­æ³•
   "ms-python.python", // Python Linting
   "ms-vscode.vscode-json", // JSONéªŒè¯
   "trufflesecurity.trufflehog", // ç§˜å¯†æ‰«æ
   "snyk-security.snyk-vulnerability-scanner", // Snykæ‰«æ
   "sonarsource.sonarlint-vscode" // SonarLint
  ]
 },

 // SonarLinté…ç½®
 "sonarlint.connectedMode.project": {
  "projectKey": "my-project"
 },

 // Snyké…ç½®
 "snyk.severity": "high",

 // TruffleHogé…ç½®
 "trufflehog.scanOnSave": true
}
```

å…³é”®é…ç½®:

- **SonarLintè¿æ¥æ¨¡å¼**:è¿æ¥SonarQubeæœåŠ¡å™¨,åŒæ­¥Quality Profileä¸è§„åˆ™,ç¡®ä¿IDEæ£€æŸ¥ä¸CI/CDä¸€è‡´ã€‚
- **TruffleHogä¿å­˜æ—¶æ‰«æ**:ä¿å­˜æ–‡ä»¶æ—¶è‡ªåŠ¨æ‰«æç§˜å¯†,å³æ—¶æç¤ºå¼€å‘è€…ã€‚

éªŒè¯æ–¹æ³•:åœ¨ä»£ç ä¸­ç¡¬ç¼–ç APIå¯†é’¥,ä¿å­˜æ–‡ä»¶,ç¡®è®¤TruffleHogæ’ä»¶é«˜äº®æ˜¾ç¤ºå¹¶æç¤ºç§»é™¤;ä¿®å¤åé‡æ–°ä¿å­˜,ç¡®è®¤æç¤ºæ¶ˆå¤±ã€‚

### Pre-commit Hooks

Pre-commit Hooksåœ¨æäº¤å‰è‡ªåŠ¨æ‰§è¡Œæ£€æŸ¥,é˜²æ­¢é—®é¢˜ä»£ç è¿›å…¥ä»“åº“ã€‚ä½¿ç”¨[pre-commit](https://pre-commit.com/)æ¡†æ¶ç»Ÿä¸€ç®¡ç†:

```yaml
# .pre-commit-config.yaml
repos:
 # ç§˜å¯†æ‰«æ
 - repo: https://github.com/trufflesecurity/trufflehog
  rev: v3.63.0
  hooks:
   - id: trufflehog
    args: ['filesystem', '--directory', '.', '--fail']

 # Terraformæ‰«æ
 - repo: https://github.com/antonbabenko/pre-commit-terraform
  rev: v1.86.0
  hooks:
   - id: terraform_fmt
   - id: terraform_validate
   - id: terraform_tfsec
    args:
     - --args=--minimum-severity=MEDIUM

 # Pythonä»£ç è´¨é‡
 - repo: https://github.com/psf/black
  rev: 23.12.1
  hooks:
   - id: black

 - repo: https://github.com/pycqa/bandit
  rev: 1.7.5
  hooks:
   - id: bandit
    args: ['-r', 'src/', '-ll']

 # YAML Lint
 - repo: https://github.com/adrienverge/yamllint
  rev: v1.33.0
  hooks:
   - id: yamllint

 # Dockerfile Linting
 - repo: https://github.com/hadolint/hadolint
  rev: v2.12.0
  hooks:
   - id: hadolint

 # æäº¤æ¶ˆæ¯éªŒè¯
 - repo: https://github.com/commitizen-tools/commitizen
  rev: v3.13.0
  hooks:
   - id: commitizen
    stages: [commit-msg]
```

å®‰è£…ä¸ä½¿ç”¨:

```bash
# å®‰è£…pre-commit
pip install pre-commit

# å®‰è£…Hooksåˆ°.git/hooks/
pre-commit install

# æ‰‹åŠ¨è¿è¡Œæ‰€æœ‰Hooks(æµ‹è¯•é…ç½®)
pre-commit run --all-files
```

éªŒè¯æ–¹æ³•:ä¿®æ”¹Terraformæ–‡ä»¶å¼•å…¥å®‰å…¨é£é™©,æ‰§è¡Œ`git commit`,ç¡®è®¤Pre-commit Hooké˜»æ­¢æäº¤å¹¶æ˜¾ç¤ºtfsecæŠ¥å‘Š;ä¿®å¤åé‡æ–°æäº¤,ç¡®è®¤é€šè¿‡ã€‚

å¸¸è§è¯¯åŒº:Pre-commit Hookæ‰§è¡Œæ—¶é—´è¿‡é•¿(>30ç§’)å¯¼è‡´å¼€å‘è€…è·³è¿‡æ£€æŸ¥(`git commit --no-verify`),éœ€ä¼˜åŒ–Hookæ€§èƒ½æˆ–ä»…æ‰§è¡Œå¿«é€Ÿæ£€æŸ¥,å®Œæ•´æ£€æŸ¥æ”¾åˆ°CI/CDã€‚

### å¼€å‘è€…å®‰å…¨åŸ¹è®­è®¡åˆ’

å·¥å…·ä»…æ˜¯æ‰‹æ®µ,å¼€å‘è€…å®‰å…¨æ„è¯†æ˜¯æ ¹æœ¬ã€‚å»ºç«‹åˆ†çº§åŸ¹è®­ä½“ç³»,é€æ­¥æå‡å›¢é˜Ÿèƒ½åŠ›:

**Level 1:åŸºç¡€å®‰å…¨æ„è¯†(å…¥èŒç¬¬1å‘¨)**

ç›®æ ‡:å»ºç«‹åŸºç¡€å®‰å…¨æ„è¯†,äº†è§£å¸¸è§å¨èƒã€‚

åŸ¹è®­å†…å®¹:
- OWASP Top 10(Webåº”ç”¨)
- äº‘å®‰å…¨åŸºç¡€(å…±äº«è´£ä»»æ¨¡å‹)
- ç§˜å¯†ç®¡ç†(ä¸æäº¤å¯†ç /å¯†é’¥)
- å®‰å…¨ç¼–ç åŸåˆ™
- å…¬å¸å®‰å…¨æ”¿ç­–

è€ƒæ ¸æ–¹å¼:åœ¨çº¿æµ‹è¯•(80åˆ†åŠæ ¼)ã€å®é™…æ¡ˆä¾‹åˆ†æã€‚

åŸ¹è®­æ—¶é•¿:4å°æ—¶(çº¿ä¸Šè§†é¢‘)ã€‚

**Level 2:å®‰å…¨å·¥å…·ä½¿ç”¨(å…¥èŒç¬¬2å‘¨)**

ç›®æ ‡:ç†Ÿç»ƒä½¿ç”¨å®‰å…¨å·¥å…·,é›†æˆåˆ°æ—¥å¸¸å¼€å‘ã€‚

åŸ¹è®­å†…å®¹:
- IDEå®‰å…¨æ’ä»¶å®‰è£…ä¸é…ç½®
- Pre-commit hooksè®¾ç½®
- SASTå·¥å…·ä½¿ç”¨(SonarLint)
- SCAå·¥å…·ä½¿ç”¨(Snyk)
- å®¹å™¨æ‰«æ(Trivy)
- IaCæ‰«æ(Checkov/tfsec)

å®æ“ç»ƒä¹ :
- ä¿®å¤5ä¸ªSASTå‘ç°çš„é—®é¢˜
- æ‰«æå¹¶ä¿®å¤ä¾èµ–æ¼æ´
- é€šè¿‡pre-commitæ£€æŸ¥

åŸ¹è®­æ—¶é•¿:4å°æ—¶(åŠ¨æ‰‹å®éªŒ)ã€‚

**Level 3:å®‰å…¨å¼€å‘å®è·µ(ç¬¬1ä¸ªæœˆ)**

ç›®æ ‡:æŒæ¡å®‰å…¨å¼€å‘ç”Ÿå‘½å‘¨æœŸ(SDL)ã€‚

åŸ¹è®­å†…å®¹:
- å¨èƒå»ºæ¨¡(STRIDE)
- å®‰å…¨è®¾è®¡æ¨¡å¼
- è¾“å…¥éªŒè¯ä¸è¾“å‡ºç¼–ç 
- è®¤è¯ä¸æˆæƒæœ€ä½³å®è·µ
- åŠ å¯†å­˜å‚¨ä¸ä¼ è¾“
- å®‰å…¨æ—¥å¿—è®°å½•

é¡¹ç›®å®æˆ˜:
- å®Œæˆ1ä¸ªå®Œæ•´åŠŸèƒ½çš„å¨èƒå»ºæ¨¡
- é€šè¿‡å®‰å…¨ä»£ç å®¡æŸ¥

åŸ¹è®­æ—¶é•¿:8å°æ—¶(åˆ†2å‘¨å®Œæˆ)ã€‚

**Level 4:äº‘å®‰å…¨ä¸“ç²¾(ç¬¬3ä¸ªæœˆ)**

ç›®æ ‡:æˆä¸ºäº‘å®‰å…¨ä¸“å®¶ã€‚

åŸ¹è®­å†…å®¹:
- IAMæœ€å°æƒé™è®¾è®¡
- ç½‘ç»œå®‰å…¨æ¶æ„
- æ•°æ®åŠ å¯†ä¸å¯†é’¥ç®¡ç†
- å®¹å™¨ä¸Kuberneteså®‰å…¨
- Serverlesså®‰å…¨
- CI/CDå®‰å…¨æµæ°´çº¿

è®¤è¯è€ƒè¯•:
- AWS Security Specialty / Azure Security Engineer
- CKS(Certified Kubernetes Security Specialist)

åŸ¹è®­æ—¶é•¿:40å°æ—¶(è‡ªå­¦+å®éªŒ)ã€‚

**æŒç»­å­¦ä¹ (æ¯å­£åº¦)**

å®‰å…¨æ¼”ç»ƒ:
- å‚åŠ å†…éƒ¨CTFæ¯”èµ›
- Purple Teamæ¼”ç»ƒ
- æ¼æ´èµé‡‘è®¡åˆ’

çŸ¥è¯†åˆ†äº«:
- å®‰å…¨æŠ€æœ¯åˆ†äº«ä¼š(æœˆåº¦)
- å®‰å…¨äº‹ä»¶æ¡ˆä¾‹å­¦ä¹ 
- è¡Œä¸šå®‰å…¨è¶‹åŠ¿

å·¥å…·æ›´æ–°:
- æ–°å·¥å…·è¯•ç”¨ä¸è¯„ä¼°
- å·¥å…·é…ç½®ä¼˜åŒ–
- è‡ªåŠ¨åŒ–è„šæœ¬å¼€å‘

éªŒè¯æ–¹æ³•:åŸ¹è®­å3ä¸ªæœˆç»Ÿè®¡å¼€å‘è€…å¼•å…¥çš„å®‰å…¨æ¼æ´æ•°é‡,ç›®æ ‡ä¸‹é™50%;å­£åº¦å®‰å…¨æ„è¯†æµ‹è¯•é€šè¿‡ç‡â‰¥90%ã€‚

---

## 5.7.6 å®‰å…¨é—¨ç¦è®¾è®¡

### Quality Gateç­–ç•¥

Quality Gateå®šä¹‰å‘å¸ƒå‰å¿…é¡»æ»¡è¶³çš„å®‰å…¨è´¨é‡æ ‡å‡†ã€‚ä¸‹è¡¨åˆ—å‡ºå…¸å‹æ£€æŸ¥é¡¹ä¸é˜»æ–­ç­–ç•¥:

| æ£€æŸ¥é¡¹ | é˜»æ–­ | è­¦å‘Š | é€šè¿‡æ¡ä»¶ | ä¿®å¤SLA |
|--------|------|------|---------|---------|
| Criticalæ¼æ´ | æ˜¯ | | 0ä¸ª | ç«‹å³ |
| Highæ¼æ´(SAST) | æ˜¯ | | â‰¤è®¾å®šé˜ˆå€¼ | 7å¤© |
| Highæ¼æ´(SCA) | | æ˜¯ | â‰¤è®¾å®šé˜ˆå€¼ | 30å¤© |
| ç§˜å¯†æ³„éœ² | æ˜¯ | | 0ä¸ª | ç«‹å³ |
| ä»£ç è¦†ç›–ç‡ | | æ˜¯ | â‰¥è®¾å®šåŸºçº¿ | - |
| ä»£ç é‡å¤ç‡ | | æ˜¯ | â‰¤è®¾å®šé˜ˆå€¼ | - |
| IaCåˆè§„ | æ˜¯ | | â‰¥è®¾å®šåŸºçº¿ | 14å¤© |
| å®¹å™¨é«˜å±æ¼æ´ | æ˜¯ | | 0ä¸ª | 7å¤© |
| Licenseåˆè§„ | | æ˜¯ | æ— GPL | - |

è¯´æ˜:

- **é€šè¿‡æ¡ä»¶**:è¡¨æ ¼ä¸­"â‰¤è®¾å®šé˜ˆå€¼""â‰¥è®¾å®šåŸºçº¿"ä¸ºæŠ½è±¡æè¿°,å®é™…å€¼éœ€æ ¹æ®ç»„ç»‡é£é™©å®¹å¿åº¦ä¸å†å²åŸºçº¿ç¡®å®šã€‚ä¾‹å¦‚High SASTæ¼æ´é˜ˆå€¼å¯èƒ½ä¸º5ä¸ª(å°å‹å›¢é˜Ÿ)æˆ–20ä¸ª(å¤§å‹é—ç•™ç³»ç»Ÿ),éœ€é€šè¿‡é¦–æ¬¡æ‰«æç»“æœç¡®å®šå¯æ¥å—åŸºçº¿ã€‚
- **ä¿®å¤SLA**:Criticalæ¼æ´è¦æ±‚ç«‹å³ä¿®å¤(24å°æ—¶å†…),Highæ¼æ´æ ¹æ®ç±»å‹åŒºåˆ†(SAST 7å¤©ã€SCA 30å¤©,å› SCAä¿®å¤éœ€ç­‰å¾…ä¸Šæ¸¸è¡¥ä¸)ã€‚
- **è­¦å‘Švsé˜»æ–­**:ä»£ç è¦†ç›–ç‡ã€é‡å¤ç‡ç­‰è´¨é‡æŒ‡æ ‡ä»…è­¦å‘Šä¸é˜»æ–­,é¿å…å½±å“ç´§æ€¥å‘å¸ƒ;å®‰å…¨æ¼æ´æ ¹æ®ä¸¥é‡æ€§åˆ†çº§å¤„ç†ã€‚

å¸¸è§è¯¯åŒº:ä¸€åˆ€åˆ‡è®¾ç½®æ‰€æœ‰Highæ¼æ´é˜»æ–­,å¯¼è‡´é—ç•™ç³»ç»Ÿæ— æ³•é€šè¿‡é—¨ç¦,éœ€è¦å¤§é‡ä¾‹å¤–ç”³è¯·;æœªå®šæœŸå®¡æŸ¥åŸºçº¿,å¯¼è‡´åŸºçº¿å¤±æ•ˆ(å¦‚ä»£ç è¦†ç›–ç‡ä»80%é€æ­¥ä¸‹æ»‘è‡³60%ä½†æ— äººå…³æ³¨)ã€‚

### SonarQube Quality Gateé…ç½®

SonarQubeæ˜¯ä¸»æµSASTå·¥å…·,é€šè¿‡Quality Gateå¼ºåˆ¶æ‰§è¡Œä»£ç è´¨é‡æ ‡å‡†ã€‚é…ç½®ç¤ºä¾‹:

```json
{
 "name": "Production Quality Gate",
 "conditions": [
  {
   "metric": "new_vulnerabilities",
   "operator": "GREATER_THAN",
   "error": "0"
  },
  {
   "metric": "new_security_hotspots",
   "operator": "GREATER_THAN",
   "error": "3"
  },
  {
   "metric": "new_bugs",
   "operator": "GREATER_THAN",
   "error": "10"
  },
  {
   "metric": "new_code_smells",
   "operator": "GREATER_THAN",
   "error": "50"
  },
  {
   "metric": "new_coverage",
   "operator": "LESS_THAN",
   "error": "80"
  },
  {
   "metric": "new_duplicated_lines_density",
   "operator": "GREATER_THAN",
   "error": "3"
  }
 ]
}
```

å…³é”®å†³ç­–:

- **å…³æ³¨æ–°å¢é—®é¢˜**:ä½¿ç”¨`new_*`æŒ‡æ ‡ä»…æ£€æŸ¥PRæ–°å¢é—®é¢˜,é¿å…å†å²å€ºåŠ¡é˜»æ–­å½“å‰äº¤ä»˜ã€‚
- **Security Hotspotsé˜ˆå€¼**:å…è®¸â‰¤3ä¸ªSecurity Hotspots(éœ€äººå·¥å®¡æŸ¥çš„æ½œåœ¨é£é™©ç‚¹),é¿å…è¿‡åº¦é˜»æ–­ã€‚
- **è¦†ç›–ç‡åŸºçº¿**:æ–°å¢ä»£ç è¦†ç›–ç‡â‰¥80%,å­˜é‡ä»£ç ä¸å—é™(é€šè¿‡`new_coverage`å®ç°)ã€‚

éªŒè¯æ–¹æ³•:æäº¤åŒ…å«SQLæ³¨å…¥æ¼æ´çš„PR,ç¡®è®¤SonarQubeæ£€æµ‹åˆ°`new_vulnerabilities`å¹¶é˜»æ–­;ä¿®å¤åé‡æ–°æäº¤,ç¡®è®¤Quality Gateé€šè¿‡ã€‚

### é—¨ç¦å†³ç­–æµç¨‹

é—¨ç¦å†³ç­–æµç¨‹å®šä¹‰å®‰å…¨æ£€æŸ¥çš„æ‰§è¡Œé¡ºåºä¸åˆ†æ”¯é€»è¾‘:

```
    Pipelineæ‰§è¡Œ
     |
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  |              |
 Security Scan     Quality Check
  |              |
 â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
 |      |      |        |
SAST/SCA  IaC Scan  Coverage   Code Quality
 |      |      |        |
 â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
    |              |
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           |
       Quality Gateè¯„ä¼°
           |
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    |              |
   æœ‰é˜»æ–­çº§é—®é¢˜?       æ— é—®é¢˜
    |              |
  â”Œâ”€â”€â”€â”´â”€â”€â”€â”          é€šè¿‡
  |    |          |
 Critical High        éƒ¨ç½²
  |    |
  é˜»æ–­  è­¦å‘Š+é€šçŸ¥
  |    |
  å¤±è´¥  è®°å½•æŠ€æœ¯å€º
```

æµç¨‹è¯´æ˜:

1. **å¹¶è¡Œæ‰«æé˜¶æ®µ**:SAST/SCA/IaCæ‰«æå¹¶è¡Œæ‰§è¡Œ,Coverageä¸Code Qualityæ£€æŸ¥å¹¶è¡Œæ‰§è¡Œ,ç¼©çŸ­æ€»æ—¶é•¿ã€‚
2. **Quality Gateè¯„ä¼°é˜¶æ®µ**:æ±‡æ€»æ‰€æœ‰æ‰«æç»“æœ,æ ¹æ®é˜»æ–­ç­–ç•¥è¡¨åˆ¤æ–­æ˜¯å¦é€šè¿‡ã€‚
3. **åˆ†æ”¯å†³ç­–**:Criticalé—®é¢˜å¼ºåˆ¶é˜»æ–­,æ„å»ºå¤±è´¥;Highé—®é¢˜ç”Ÿæˆè­¦å‘Šå¹¶é€šçŸ¥å›¢é˜Ÿ,æ„å»ºé€šè¿‡ä½†è®°å½•æŠ€æœ¯å€º;æ— é—®é¢˜ç›´æ¥é€šè¿‡ã€‚

éªŒè¯æ–¹æ³•:æ¨¡æ‹Ÿä¸åŒåœºæ™¯(ä»…Criticalæ¼æ´ã€ä»…Highæ¼æ´ã€æ— æ¼æ´),ç¡®è®¤æµç¨‹æŒ‰é¢„æœŸåˆ†æ”¯æ‰§è¡Œã€‚

---

## 5.7.7 SAST/DAST/SCAé›†æˆ

### å·¥å…·å¯¹æ¯”çŸ©é˜µ

SAST(é™æ€åº”ç”¨å®‰å…¨æµ‹è¯•)ã€DAST(åŠ¨æ€åº”ç”¨å®‰å…¨æµ‹è¯•)ã€SCA(è½¯ä»¶æˆåˆ†åˆ†æ)è¦†ç›–è½¯ä»¶ç”Ÿå‘½å‘¨æœŸä¸åŒé˜¶æ®µ,éœ€è¦ç»„åˆä½¿ç”¨ã€‚

**SASTå·¥å…·å¯¹æ¯”**:

| å·¥å…· | è¯­è¨€æ”¯æŒ | è¯¯æŠ¥ç‡ | é›†æˆéš¾åº¦ | æœ€ä½³åœºæ™¯ |
|------|---------|--------|---------|----------|
| SonarQube | 25+ | ä¸­ | æ˜“ | é€šç”¨ |
| Checkmarx | 30+ | ä½ | ä¸­ | ä¼ä¸šçº§ |
| Snyk Code | 10+ | ä½ | æ˜“ | å¼€å‘è€…å‹å¥½ |
| CodeQL | 10+ | ä½ | ä¸­ | æ·±åº¦åˆ†æ |
| Semgrep | 20+ | ä¸­ | æ˜“ | è‡ªå®šä¹‰è§„åˆ™ |

**SCAå·¥å…·å¯¹æ¯”**:

| å·¥å…· | è¯­è¨€/åŒ…ç®¡ç† | CVEè¦†ç›– | Licenseæ£€æŸ¥ | æœ€ä½³åœºæ™¯ |
|------|------------|---------|------------|----------|
| Snyk Open Source | 20+ | å¹¿ | æ˜¯ | å¼€å‘è€…é›†æˆ |
| WhiteSource | 200+ | æœ€å¹¿ | æ˜¯ | ä¼ä¸šçº§ |
| Black Duck | 25+ | å¹¿ | æ˜¯ | åˆè§„é‡ç‚¹ |
| Dependabot | 10+ | ä¸­ | å¦ | GitHubé›†æˆ |
| OWASP Dependency-Check | 10+ | ä¸­ | æ˜¯ | å¼€æºé¡¹ç›® |

**DASTå·¥å…·å¯¹æ¯”**:

| å·¥å…· | æ‰«æç±»å‹ | å‡†ç¡®ç‡ | CI/CDé›†æˆ | æœ€ä½³åœºæ™¯ |
|------|---------|--------|----------|----------|
| OWASP ZAP | ä¸»åŠ¨/è¢«åŠ¨ | ä¸­ | æ˜“ | å¼€æºé¡¹ç›® |
| Burp Suite | ä¸»åŠ¨ | é«˜ | éš¾ | æ‰‹å·¥æµ‹è¯• |
| Acunetix | ä¸»åŠ¨ | é«˜ | ä¸­ | ä¼ä¸šWebåº”ç”¨ |
| Netsparker | ä¸»åŠ¨ | é«˜ | æ˜“ | è‡ªåŠ¨åŒ–æ‰«æ |
| StackHawk | ä¸»åŠ¨ | ä¸­ | æ˜“ | DevSecOps |

é€‰å‹å»ºè®®:

- **é¢„ç®—æœ‰é™**:SASTé€‰SonarQube(å¼€æºç‰ˆ),SCAé€‰OWASP Dependency-Check,DASTé€‰OWASP ZAPã€‚
- **å¼€å‘è€…ä½“éªŒä¼˜å…ˆ**:SASTé€‰Snyk Code,SCAé€‰Snyk Open Source,DASTé€‰StackHawk(ä¸“ä¸ºCI/CDä¼˜åŒ–)ã€‚
- **ä¼ä¸šçº§æ”¯æŒ**:SASTé€‰Checkmarx,SCAé€‰WhiteSource/Black Duck,DASTé€‰Acunetix/Netsparkerã€‚

å¸¸è§è¯¯åŒº:ä»…ä¾èµ–å•ä¸€å·¥å…·ç±»å‹(å¦‚ä»…SAST),æ— æ³•è¦†ç›–è¿è¡Œæ—¶æ¼æ´(éœ€DAST)ä¸ä¾èµ–åº“æ¼æ´(éœ€SCA);å·¥å…·è¿‡å¤šå¯¼è‡´å‘Šè­¦ç–²åŠ³,éœ€é€šè¿‡èšåˆå¹³å°(å¦‚Defect Dojo)ç»Ÿä¸€ç®¡ç†ã€‚

### å®Œæ•´å®‰å…¨æ‰«ææµæ°´çº¿

ä»¥ä¸‹GitLab CIæµæ°´çº¿é›†æˆSASTã€SCAã€DASTä¸å®¹å™¨æ‰«æ,å±•ç¤ºå®Œæ•´DevSecOpså®è·µ:

```yaml
# .gitlab-ci.yml - å®Œæ•´å®‰å…¨æ‰«ææµæ°´çº¿
stages:
 - pre-commit
 - sast
 - build
 - sca
 - container-scan
 - deploy-staging
 - dast
 - report

variables:
 SECURE_LOG_LEVEL: info

# ==================== Pre-commitæ£€æŸ¥ ====================
secret-scan:
 stage: pre-commit
 image: trufflesecurity/trufflehog:latest
 script:
  - trufflehog filesystem . --json --fail
 allow_failure: false

# ==================== SASTæ‰«æ ====================
sonarqube-sast:
 stage: sast
 image: sonarsource/sonar-scanner-cli:latest
 script:
  - sonar-scanner
   -Dsonar.projectKey=$CI_PROJECT_NAME
   -Dsonar.sources=src
   -Dsonar.host.url=$SONAR_HOST_URL
   -Dsonar.login=$SONAR_TOKEN
   -Dsonar.qualitygate.wait=true
 allow_failure: false
 only:
  - merge_requests
  - main

semgrep-sast:
 stage: sast
 image: returntocorp/semgrep:latest
 script:
  - semgrep ci --config auto --sarif > semgrep-report.sarif
 artifacts:
  reports:
   sast: semgrep-report.sarif
 allow_failure: true

# ==================== æ„å»º ====================
build-app:
 stage: build
 script:
  - mvn clean package -DskipTests
 artifacts:
  paths:
   - target/*.jar

# ==================== SCAä¾èµ–æ‰«æ ====================
snyk-sca:
 stage: sca
 image: snyk/snyk:node
 script:
  - snyk test
   --severity-threshold=high
   --json > snyk-report.json
 artifacts:
  reports:
   dependency_scanning: snyk-report.json
 allow_failure: true

dependency-check:
 stage: sca
 image: owasp/dependency-check:latest
 script:
  - /usr/share/dependency-check/bin/dependency-check.sh
   --project $CI_PROJECT_NAME
   --scan .
   --format JSON
   --out dependency-check-report.json
   --failOnCVSS 7
 artifacts:
  paths:
   - dependency-check-report.json
 allow_failure: true

# ==================== å®¹å™¨é•œåƒæ‰«æ ====================
build-image:
 stage: container-scan
 image: docker:latest
 services:
  - docker:dind
 before_script:
  - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
 script:
  - docker build -t $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA .
  - docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA

trivy-scan:
 stage: container-scan
 image: aquasec/trivy:latest
 script:
  - trivy image
   --exit-code 1
   --severity HIGH,CRITICAL
   --format sarif
   --output trivy-report.sarif
   $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
 artifacts:
  reports:
   container_scanning: trivy-report.sarif
 allow_failure: false

grype-scan:
 stage: container-scan
 image: anchore/grype:latest
 script:
  - grype $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
   --fail-on high
   --output json
   --file grype-report.json
 artifacts:
  paths:
   - grype-report.json
 allow_failure: true

# ==================== éƒ¨ç½²åˆ°Staging ====================
deploy-staging:
 stage: deploy-staging
 script:
  - kubectl set image deployment/myapp
   myapp=$CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
   -n staging
  - kubectl rollout status deployment/myapp -n staging
 environment:
  name: staging
  url: https://staging.myapp.com
 only:
  - main

# ==================== DASTåŠ¨æ€æ‰«æ ====================
zap-dast:
 stage: dast
 image: owasp/zap2docker-stable:latest
 script:
  - mkdir -p /zap/wrk
  - zap-baseline.py
   -t https://staging.myapp.com
   -r zap-baseline-report.html
   -J zap-baseline-report.json
   -w zap-baseline-report.md
   || true # ä¸é˜»æ–­æ„å»º
 artifacts:
  paths:
   - zap-baseline-report.html
   - zap-baseline-report.json
 only:
  - main
 when: manual

# ==================== å®‰å…¨æŠ¥å‘Šæ±‡æ€» ====================
security-report:
 stage: report
 image: python:3.11
 script:
  - |
   python3 <<'EOF'
   import json
   from pathlib import Path

   reports = {
    'sast': 'semgrep-report.sarif',
    'sca': 'snyk-report.json',
    'container': 'trivy-report.sarif',
    'dast': 'zap-baseline-report.json'
   }

   summary = {
    'total_issues': 0,
    'critical': 0,
    'high': 0,
    'medium': 0,
    'low': 0
   }

   for scan_type, report_file in reports.items():
    if Path(report_file).exists():
     # è§£ææŠ¥å‘Šå¹¶ç»Ÿè®¡(éœ€å®ç°è§£æé€»è¾‘)
     with open(report_file) as f:
      data = json.load(f)
      # ç®€åŒ–ç¤ºä¾‹:å®é™…éœ€æ ¹æ®æŠ¥å‘Šæ ¼å¼è§£æ
      summary['total_issues'] += 1

   print("="*50)
   print("Security Scan Summary")
   print("="*50)
   print(f"Total Issues: {summary['total_issues']}")
   print(f"Critical: {summary['critical']}")
   print(f"High: {summary['high']}")
   print(f"Medium: {summary['medium']}")
   print(f"Low: {summary['low']}")
   print("="*50)
   EOF
 dependencies:
  - semgrep-sast
  - snyk-sca
  - trivy-scan
  - zap-dast
 when: always
```

å…³é”®é…ç½®:

- **å¹¶è¡ŒåŒ–**:SASTé˜¶æ®µçš„SonarQubeä¸Semgrepå¹¶è¡Œ,SCAé˜¶æ®µçš„Snykä¸Dependency-Checkå¹¶è¡Œ,ç¼©çŸ­æ€»æ—¶é•¿ã€‚
- **DASTæ‰‹åŠ¨è§¦å‘**:DASTæ‰«ææ—¶é—´é•¿(30åˆ†é’Ÿè‡³æ•°å°æ—¶),è®¾ç½®`when: manual`é¿å…æ¯æ¬¡æäº¤éƒ½è§¦å‘,ä»…åœ¨ä¸»åˆ†æ”¯åˆå¹¶åæ‰‹åŠ¨æ‰§è¡Œã€‚
- **æŠ¥å‘Šèšåˆ**:security-reporté˜¶æ®µè§£ææ‰€æœ‰æ‰«ææŠ¥å‘Š,ç”Ÿæˆç»Ÿä¸€æ‘˜è¦,ä¾¿äºç®¡ç†å±‚æŸ¥çœ‹æ•´ä½“å®‰å…¨æ€åŠ¿ã€‚

è¿è¡ŒæŒ‡æ ‡:å®Œæ•´æµæ°´çº¿(ä¸å«DAST)æ‰§è¡Œæ—¶é—´åº”â‰¤15åˆ†é’Ÿ(ä¸­å‹Javaé¡¹ç›®);Criticalæ¼æ´æ£€å‡ºç‡â‰¥90%(é€šè¿‡äººå·¥å¤æ ¸ç¡®è®¤)ã€‚

---

## 5.7.8 æ¼æ´ç®¡ç†æµç¨‹

### æ¼æ´ç”Ÿå‘½å‘¨æœŸ

æ¼æ´ç®¡ç†è¦†ç›–ä»å‘ç°åˆ°å…³é—­çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ:

```
å‘ç° â†’ åˆ†ç±» â†’ ä¼˜å…ˆçº§æ’åº â†’ åˆ†é… â†’ ä¿®å¤ â†’ éªŒè¯ â†’ å…³é—­
 |   |    |     |   |   |   |
 â†“   â†“    â†“     â†“   â†“   â†“   â†“
æ‰«æ ä¸¥é‡æ€§ é£é™©è¯„åˆ†  Owner Patch æµ‹è¯• å½’æ¡£
å·¥å…· CVSS  æš´éœ²åº¦   éƒ¨ç½² å¤æµ‹ æŠ¥å‘Š
```

å„é˜¶æ®µå…³é”®å†³ç­–:

**å‘ç°é˜¶æ®µ**:é€šè¿‡SAST/SCA/DAST/å®¹å™¨æ‰«æç­‰å·¥å…·è‡ªåŠ¨å‘ç°,æˆ–é€šè¿‡æ¸—é€æµ‹è¯•ã€æ¼æ´èµé‡‘æ‰‹åŠ¨å‘ç°ã€‚

**åˆ†ç±»é˜¶æ®µ**:æ ¹æ®CVSSè¯„åˆ†(Critical/High/Medium/Low)åˆæ­¥åˆ†ç±»ã€‚å…³é”®çº¦æŸ:CVSSä»…åæ˜ æ¼æ´æœ¬èº«ä¸¥é‡æ€§,ä¸è€ƒè™‘èµ„äº§æš´éœ²åº¦ä¸ä¸šåŠ¡å½±å“,éœ€è¿›ä¸€æ­¥è¯„ä¼°ã€‚

**ä¼˜å…ˆçº§æ’åºé˜¶æ®µ**:åŸºäºCVSSè¯„åˆ†ã€æš´éœ²åº¦(å…¬ç½‘/å†…ç½‘)ã€å¯åˆ©ç”¨æ€§(æ˜¯å¦æœ‰POC)ã€æ•°æ®æ•æ„Ÿåº¦åŠ¨æ€è°ƒæ•´SLAã€‚è§ä¸‹æ–‡åŠ¨æ€SLAè®¡ç®—é€»è¾‘ã€‚

**åˆ†é…é˜¶æ®µ**:æ ¹æ®ä»£ç ä»“åº“CODEOWNERSæˆ–æœåŠ¡æ³¨å†Œä¿¡æ¯è‡ªåŠ¨åˆ†é…ä¿®å¤è´£ä»»äºº,åˆ›å»ºJira/GitHub Issueå·¥å•ã€‚

**ä¿®å¤é˜¶æ®µ**:å¼€å‘å›¢é˜Ÿä¿®å¤æ¼æ´,æäº¤PR,é€šè¿‡SAST/SCAé‡æ–°æ‰«æéªŒè¯ã€‚

**éªŒè¯é˜¶æ®µ**:å®‰å…¨å›¢é˜Ÿå¤æµ‹ç¡®è®¤æ¼æ´å·²ä¿®å¤,æœªå¼•å…¥æ–°é—®é¢˜ã€‚

**å…³é—­é˜¶æ®µ**:å½’æ¡£æ¼æ´è¯¦æƒ…ã€ä¿®å¤è¡¥ä¸ã€éªŒè¯æŠ¥å‘Š,ç”¨äºå®¡è®¡ä¸è¶‹åŠ¿åˆ†æã€‚

### æ¼æ´SLAæ ‡å‡†

SLAå®šä¹‰æ¼æ´ä¿®å¤æ—¶é™,é©±åŠ¨åŠæ—¶ä¿®å¤ã€‚ä¸‹è¡¨åˆ—å‡ºå…¸å‹SLAæ ‡å‡†:

| ä¸¥é‡æ€§ | CVSSè¯„åˆ† | ä¿®å¤SLA | å‡çº§è·¯å¾„ | ä¾‹å¤–å®¡æ‰¹ |
|--------|---------|---------|---------|---------|
| Critical | 9.0-10.0 | 24å°æ—¶ | ç«‹å³é€šçŸ¥CISO | ä¸å…è®¸ |
| High | 7.0-8.9 | 7å¤© | æ¯æ—¥æ›´æ–° | CISOå®¡æ‰¹ |
| Medium | 4.0-6.9 | 30å¤© | æ¯å‘¨æ›´æ–° | å®‰å…¨è´Ÿè´£äºº |
| Low | 0.1-3.9 | 90å¤© | æœˆåº¦æŠ¥å‘Š | å›¢é˜ŸLeader |

è¯´æ˜:

- **SLAåŸºçº¿**:è¡¨æ ¼ä¸­SLAä¸ºåŸºç¡€å€¼,å®é™…SLAé€šè¿‡åŠ¨æ€è°ƒæ•´ç®—æ³•è®¡ç®—(è§ä¸‹æ–‡)ã€‚
- **å‡çº§è·¯å¾„**:Criticalæ¼æ´è¶…æœŸç«‹å³å‡çº§è‡³CISO,Highæ¼æ´è¶…æœŸæ¯æ—¥å‡çº§æé†’,é¿å…æ¼æ´è¢«é—å¿˜ã€‚
- **ä¾‹å¤–å®¡æ‰¹**:Criticalæ¼æ´ä¸å…è®¸ä¾‹å¤–,å¿…é¡»ä¿®å¤;Highæ¼æ´éœ€CISOå®¡æ‰¹ä¾‹å¤–(å¦‚ä¸šåŠ¡ç´§æ€¥å‘å¸ƒ,æ¼æ´æš‚æ—¶è±å…)ã€‚

éªŒè¯æ–¹æ³•:ç»Ÿè®¡å­£åº¦SLAåˆè§„ç‡(æŒ‰æ—¶ä¿®å¤æ¼æ´æ•°Ã·æ¼æ´æ€»æ•°),ç›®æ ‡â‰¥90%;ç»Ÿè®¡å¹³å‡ä¿®å¤æ—¶é—´(MTTR),ç›®æ ‡æŒç»­ä¸‹é™ã€‚

### æ¼æ´ç®¡ç†è‡ªåŠ¨åŒ–

æ‰‹å·¥è¿½è¸ªæ•°ç™¾ä¸ªæ¼æ´å·¥å•æ•ˆç‡ä½ä¸‹,éœ€è¦è‡ªåŠ¨åŒ–æµç¨‹ã€‚è‡ªåŠ¨åŒ–è¦†ç›–å››å¤§æ ¸å¿ƒç¯èŠ‚:

**ç¯èŠ‚ä¸€:å¤šæºæ¼æ´èšåˆ**ã€‚ä»Snykã€Trivyã€SonarQubeã€Dependabotç­‰å·¥å…·APIæŠ“å–æ¼æ´æ•°æ®,ç»Ÿä¸€æ±‡æ€»åˆ°å•ä¸€å¹³å°(å¦‚Defect Dojoæˆ–è‡ªå»ºç³»ç»Ÿ)ã€‚å…³é”®æŒ‘æˆ˜:ä¸åŒå·¥å…·æŠ¥å‘Šæ ¼å¼ä¸ä¸€è‡´,éœ€è¦æ ‡å‡†åŒ–è§£æé€»è¾‘;åŒä¸€CVEè¢«å¤šä¸ªå·¥å…·é‡å¤æ£€æµ‹,éœ€è¦åŸºäºCVE ID+ç»„ä»¶+ç‰ˆæœ¬ä¸‰å…ƒç»„å»é‡ã€‚

**ç¯èŠ‚äºŒ:åŸºäºä¸šåŠ¡å½±å“çš„æ™ºèƒ½åˆ†çº§**ã€‚ä¸èƒ½ä»…ä¾èµ–CVSSè¯„åˆ†,éœ€å åŠ èµ„äº§æš´éœ²åº¦ã€å·²çŸ¥åˆ©ç”¨æƒ…å†µã€æ•°æ®æ•æ„Ÿåº¦ç­‰ç»´åº¦åŠ¨æ€è°ƒæ•´SLAã€‚ä¾‹å¦‚,ä¸€ä¸ªCVSS 7.5çš„SQLæ³¨å…¥æ¼æ´,è‹¥å‘ç”Ÿåœ¨å…¬ç½‘æš´éœ²çš„æ”¯ä»˜æœåŠ¡(å¤„ç†PCIæ•°æ®),SLAä»åŸºç¡€7å¤©ç¼©çŸ­è‡³1.75å¤©;è‹¥å‘ç”Ÿåœ¨å†…ç½‘ç®¡ç†å·¥å…·(æ— æ•æ„Ÿæ•°æ®),SLAä¿æŒ7å¤©ã€‚åŠ¨æ€SLAè®¡ç®—é€»è¾‘è§ä¸‹æ–‡ä»£ç ç¤ºä¾‹ã€‚

**ç¯èŠ‚ä¸‰:è‡ªåŠ¨åŒ–å·¥å•åˆ›å»ºä¸è´£ä»»åˆ†é…**ã€‚å½“SASTå·¥å…·æ£€æµ‹åˆ°æŸå¾®æœåŠ¡çš„Log4jæ¼æ´æ—¶,è‡ªåŠ¨åŒ–è„šæœ¬é€šè¿‡æœåŠ¡åç§°æŸ¥è¯¢æœåŠ¡æ³¨å†Œä¸­å¿ƒ(Consul/Eureka)è·å–ä»£ç ä»“åº“URL,è§£æCODEOWNERSæ–‡ä»¶æ‰¾åˆ°è´Ÿè´£å›¢é˜Ÿ,ä»LDAP/ADè·å–å›¢é˜ŸLeaderçš„Jiraè´¦å·,è‡ªåŠ¨åˆ›å»ºå¸¦æœ‰æ˜ç¡®Assigneeå’ŒDue Dateçš„Jiraå·¥å•ã€‚å…³é”®çº¦æŸ:éœ€è¦ç»´æŠ¤æœåŠ¡åç§°ä¸ä»£ç ä»“åº“çš„æ˜ å°„å…³ç³»;CODEOWNERSæ–‡ä»¶éœ€è¦åŠæ—¶æ›´æ–°,å¦åˆ™åˆ†é…é”™è¯¯ã€‚

**ç¯èŠ‚å››:SLAåˆè§„æ€§ç›‘æ§ä¸å‡çº§**ã€‚æ¯æ—¥å®šæ—¶ä»»åŠ¡æŸ¥è¯¢æ‰€æœ‰æœªé—­ç¯çš„å®‰å…¨æ¼æ´å·¥å•,è®¡ç®—è·ç¦»Due Dateçš„å‰©ä½™æ—¶é—´:å‰©ä½™æ—¶é—´<0(å·²è¶…æœŸ)å‘é€Slackå‘Šè­¦è‡³å›¢é˜Ÿé¢‘é“å¹¶æŠ„é€CISO,æ ‡è®°å·¥å•ä¸ºçº¢è‰²;å‰©ä½™æ—¶é—´<2å¤©(ä¸´è¿‘æˆªæ­¢)å‘é€æ¯æ—¥æé†’é‚®ä»¶è‡³Assigneeä¸Manager;å‰©ä½™æ—¶é—´>7å¤©(å®‰å…¨æœŸ)ä»…åœ¨å‘¨æŠ¥ä¸­å±•ç¤ºã€‚Criticalæ¼æ´è¶…æœŸè‡ªåŠ¨åˆ›å»ºPagerDutyäº‹ä»¶,7Ã—24å€¼ç­å·¥ç¨‹å¸ˆå¿…é¡»å“åº”ã€‚

### åŠ¨æ€SLAè®¡ç®—é€»è¾‘

ä»¥ä¸‹Pythonä»£ç å±•ç¤ºåŸºäºå¤šç»´åº¦çš„åŠ¨æ€SLAè®¡ç®—é€»è¾‘:

```python
# æ¼æ´åˆ†çº§ä¸SLAè®¡ç®— - æ ¸å¿ƒé€»è¾‘
def calculate_dynamic_sla(vuln):
 """
 åŸºäºå¤šç»´åº¦è®¡ç®—åŠ¨æ€SLA

 å‚æ•°:
  vuln: æ¼æ´å¯¹è±¡,åŒ…å«ä»¥ä¸‹å­—æ®µ
   - severity: Critical/High/Medium/Low
   - publicly_accessible: bool,èµ„äº§æ˜¯å¦å…¬ç½‘å¯è®¿é—®
   - exploit_available: bool,æ˜¯å¦å­˜åœ¨å…¬å¼€POCæˆ–åœ¨é‡åˆ©ç”¨
   - data_sensitivity: bool,æ˜¯å¦å¤„ç†æ•æ„Ÿæ•°æ®(PII/PCI)

 è¿”å›:
  int: ä¿®å¤SLA(å°æ—¶)

 é€‚ç”¨è¾¹ç•Œ:
  - ä»…é€‚ç”¨äºæŠ€æœ¯å€ºæ¼æ´,ç´§æ€¥äº‹ä»¶(å¦‚0day)éœ€èµ°åº”æ€¥å“åº”æµç¨‹
  - æš´éœ²åº¦åˆ¤æ–­ä¾èµ–èµ„äº§ç®¡ç†ç³»ç»Ÿå‡†ç¡®æ€§
 """

 # åŸºç¡€SLA(å°æ—¶)
 base_sla = {
  'Critical': 24,  # CVSS 9.0+
  'High': 168,   # CVSS 7.0-8.9, 7å¤©
  'Medium': 720,  # CVSS 4.0-6.9, 30å¤©
  'Low': 2160   # CVSS <4.0, 90å¤©
 }[vuln['severity']]

 # æš´éœ²åº¦ç³»æ•°(å…¬ç½‘å¯è®¿é—®SLAå‡åŠ)
 exposure_factor = 0.5 if vuln['publicly_accessible'] else 1.0

 # å¯åˆ©ç”¨æ€§ç³»æ•°(å­˜åœ¨POC/åœ¨é‡åˆ©ç”¨SLAå‡åŠ)
 exploit_factor = 0.5 if vuln['exploit_available'] else 1.0

 # æ•°æ®æ•æ„Ÿåº¦ç³»æ•°(å¤„ç†æ•æ„Ÿæ•°æ®SLAå‡åŠ)
 data_factor = 0.5 if vuln['data_sensitivity'] else 1.0

 # æœ€ç»ˆSLA(å¤šä¸ªç³»æ•°ç´¯ä¹˜)
 final_sla = base_sla * exposure_factor * exploit_factor * data_factor

 return int(final_sla) # è¿”å›å°æ—¶æ•°
```

ç¤ºä¾‹åœºæ™¯:

- **åœºæ™¯1**:CVSS 7.5 SQLæ³¨å…¥,å…¬ç½‘æš´éœ²,æ— POC,å¤„ç†PCIæ•°æ®ã€‚
  - åŸºç¡€SLA=168å°æ—¶(7å¤©)
  - æš´éœ²åº¦ç³»æ•°=0.5
  - å¯åˆ©ç”¨æ€§ç³»æ•°=1.0
  - æ•°æ®æ•æ„Ÿåº¦ç³»æ•°=0.5
  - æœ€ç»ˆSLA=168Ã—0.5Ã—1.0Ã—0.5=42å°æ—¶(1.75å¤©)

- **åœºæ™¯2**:CVSS 9.0 RCE,å†…ç½‘å·¥å…·,æ— POC,æ— æ•æ„Ÿæ•°æ®ã€‚
  - åŸºç¡€SLA=24å°æ—¶
  - æš´éœ²åº¦ç³»æ•°=1.0
  - å¯åˆ©ç”¨æ€§ç³»æ•°=1.0
  - æ•°æ®æ•æ„Ÿåº¦ç³»æ•°=1.0
  - æœ€ç»ˆSLA=24Ã—1.0Ã—1.0Ã—1.0=24å°æ—¶

éªŒè¯æ–¹æ³•:æ¨¡æ‹Ÿä¸åŒåœºæ™¯,ç¡®è®¤SLAè®¡ç®—ç¬¦åˆé¢„æœŸ;ç»Ÿè®¡SLAåˆè§„ç‡,ç¡®è®¤åŠ¨æ€SLAæ›´è´´åˆä¸šåŠ¡é£é™©(ç›¸æ¯”å›ºå®šSLAæé«˜10%+åˆè§„ç‡)ã€‚

---

## 5.7.9 æœ¬èŠ‚å°ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **CI/CDå®‰å…¨**:é€‰æ‹©åˆé€‚çš„CI/CDå¹³å°(Jenkins/GitLab/GitHub Actions),å®æ–½ä¸ƒå±‚å®‰å…¨é—¨ç¦(Secretæ‰«æâ†’SASTâ†’SCAâ†’å®¹å™¨æ‰«æâ†’IaCæ‰«æâ†’DASTâ†’Quality Gate),å¹³è¡¡å®‰å…¨é£é™©ä¸äº¤ä»˜æ•ˆç‡ã€‚

2. **IaCæ‰«æ**:ç»„åˆä½¿ç”¨Checkovã€tfsecã€Terrascanæé«˜è§„åˆ™è¦†ç›–ç‡,é€šè¿‡Pre-commit Hookå‰ç½®æ£€æŸ¥,é¿å…é…ç½®é£é™©è¿›å…¥ä»£ç åº“ã€‚

3. **CloudFormationå®‰å…¨**:ä½¿ç”¨cfn-nagæ£€æµ‹å¸¸è§é—®é¢˜,ä½¿ç”¨CloudFormation Guardå®šä¹‰ä¼ä¸šç­–ç•¥,éµå¾ªå®‰å…¨æ¨¡æ¿æœ€ä½³å®è·µ(åŠ å¯†ã€ç‰ˆæœ¬æ§åˆ¶ã€è®¿é—®æ—¥å¿—ã€æœ€å°æƒé™)ã€‚

4. **å®¹å™¨é•œåƒå®‰å…¨**:ä½¿ç”¨Cosignç­¾åéªŒè¯é•œåƒæ¥æº,ä½¿ç”¨Trivy/Grypeæ‰«ææ¼æ´,é€šè¿‡Kuberneteså‡†å…¥æ§åˆ¶å¼ºåˆ¶æ‰§è¡Œç­¾åéªŒè¯,å»ºç«‹å®Œæ•´ä¾›åº”é“¾å®‰å…¨ã€‚

5. **å®‰å…¨å·¦ç§»**:é€šè¿‡IDEæ’ä»¶ã€Pre-commit Hookã€å¼€å‘è€…åŸ¹è®­ä¸‰ä½ä¸€ä½“å°†å®‰å…¨æ£€æŸ¥å‰ç½®åˆ°å¼€å‘é˜¶æ®µ,é™ä½ä¿®å¤æˆæœ¬,æé«˜å®‰å…¨æ„è¯†ã€‚

6. **å®‰å…¨é—¨ç¦**:åŸºäºé£é™©çš„åŠ¨æ€é˜»æ–­ç­–ç•¥(Criticalå¼ºåˆ¶é˜»æ–­,Highè­¦å‘Š,Medium/Lowä»…è®°å½•),é€šè¿‡SonarQube Quality Gateç­‰å·¥å…·å¼ºåˆ¶æ‰§è¡Œ,å®šæœŸå®¡æŸ¥åŸºçº¿é¿å…å¤±æ•ˆã€‚

7. **SAST/DAST/SCA**:ç»„åˆä½¿ç”¨ä¸åŒç±»å‹å·¥å…·(SASTè¦†ç›–ä»£ç å±‚ã€DASTè¦†ç›–è¿è¡Œæ—¶ã€SCAè¦†ç›–ä¾èµ–åº“),é€šè¿‡èšåˆå¹³å°ç»Ÿä¸€ç®¡ç†å‘Šè­¦,é¿å…å·¥å…·ç¢ç‰‡åŒ–ã€‚

8. **æ¼æ´ç®¡ç†**:å»ºç«‹ä»å‘ç°åˆ°å…³é—­çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†,åŸºäºCVSS+æš´éœ²åº¦+å¯åˆ©ç”¨æ€§+æ•°æ®æ•æ„Ÿåº¦åŠ¨æ€è®¡ç®—SLA,é€šè¿‡è‡ªåŠ¨åŒ–å·¥å•åˆ›å»ºä¸å‡çº§æœºåˆ¶é©±åŠ¨åŠæ—¶ä¿®å¤ã€‚

### å¸¸è§è¯¯åŒº

- **è¯¯åŒº1**:ä¸€åˆ€åˆ‡é˜»æ–­æ‰€æœ‰Highæ¼æ´,å¯¼è‡´é—ç•™ç³»ç»Ÿæ— æ³•é€šè¿‡é—¨ç¦,å¤§é‡ä¾‹å¤–ç”³è¯·é™ä½é—¨ç¦æƒå¨æ€§ã€‚**æ­£ç¡®åšæ³•**:åŸºäºå†å²åŸºçº¿è®¾å®šé˜ˆå€¼,é€æ­¥æ”¶ç´§ã€‚

- **è¯¯åŒº2**:ä»…ä¾èµ–å•ä¸€æ‰«æå·¥å…·(å¦‚ä»…SAST),æ— æ³•è¦†ç›–è¿è¡Œæ—¶æ¼æ´ä¸ä¾èµ–åº“æ¼æ´ã€‚**æ­£ç¡®åšæ³•**:ç»„åˆSAST+DAST+SCAã€‚

- **è¯¯åŒº3**:Pre-commit Hookæ‰§è¡Œæ—¶é—´è¿‡é•¿(>30ç§’),å¼€å‘è€…è·³è¿‡æ£€æŸ¥ã€‚**æ­£ç¡®åšæ³•**:ä»…æ‰§è¡Œå¿«é€Ÿæ£€æŸ¥(å¦‚Secretæ‰«æ),å®Œæ•´æ£€æŸ¥æ”¾åˆ°CI/CDã€‚

- **è¯¯åŒº4**:æœªå»ºç«‹SASTåŸºçº¿,é¦–æ¬¡å¯ç”¨æ—¶æŠ¥å‘Šæ•°åƒä¸ªå†å²é—®é¢˜,æ·¹æ²¡æ–°å¢é—®é¢˜ã€‚**æ­£ç¡®åšæ³•**:é¦–æ¬¡æ‰«ææ—¶æ‰¹é‡æ ‡è®°å·²çŸ¥é—®é¢˜ä¸º"å·²æ¥å—é£é™©",ä»…å…³æ³¨æ–°å¢é—®é¢˜ã€‚

- **è¯¯åŒº5**:æ¼æ´SLAä»…ä¾èµ–CVSSè¯„åˆ†,æœªè€ƒè™‘èµ„äº§æš´éœ²åº¦ä¸ä¸šåŠ¡å½±å“ã€‚**æ­£ç¡®åšæ³•**:åŸºäºå¤šç»´åº¦åŠ¨æ€è®¡ç®—SLAã€‚

### å»¶ä¼¸é˜…è¯»

- **OWASP DevSecOps Guideline**:https://owasp.org/www-project-DevSecOps-guideline/
- **NIST SP 800-218 Secure Software Development Framework (SSDF)**:https://csrc.nist.gov/publications/detail/sp/800-218/final
- **SLSA Supply-chain Levels for Software Artifacts**:https://slsa.dev/
- **Sigstore**:https://www.sigstore.dev/
- **CNCF Cloud Native Security Whitepaper**:https://www.cncf.io/reports/cloud-native-security-whitepaper/
- **GitLab DevSecOps Best Practices**:https://about.gitlab.com/topics/DevSecOps/

### å®æˆ˜æ£€æŸ¥æ¸…å•

**CI/CDå®‰å…¨(æ¯å­£åº¦æ£€æŸ¥)**:
- [ ] æ‰€æœ‰Pipelineä½¿ç”¨æœ€æ–°Runneré•œåƒ
- [ ] å‡­è¯100%å­˜å‚¨åœ¨Secret Manager
- [ ] Pipelineæ—¥å¿—ä¸åŒ…å«æ•æ„Ÿä¿¡æ¯
- [ ] æ„å»ºç¯å¢ƒå®¹å™¨åŒ–éš”ç¦»
- [ ] ç­¾åéªŒè¯å¼ºåˆ¶æ‰§è¡Œ
- [ ] å®¡è®¡æ—¥å¿—å¯ç”¨å¹¶å½’æ¡£
- [ ] RBACæƒé™æœ€å°åŒ–

**IaCå®‰å…¨(æ¯æœˆæ£€æŸ¥)**:
- [ ] Pre-commit hooks 100%è¦†ç›–
- [ ] IaCæ‰«æé›†æˆåˆ°CI/CD
- [ ] è‡ªå®šä¹‰è§„åˆ™æ›´æ–°
- [ ] è¯¯æŠ¥æŠ‘åˆ¶åˆç†
- [ ] ä¿®å¤ç‡>è®¾å®šç›®æ ‡
- [ ] æ–°æ¨¡æ¿å®‰å…¨å®¡æŸ¥
- [ ] Driftæ£€æµ‹å¯ç”¨

**å®¹å™¨å®‰å…¨(æ¯å‘¨æ£€æŸ¥)**:
- [ ] é•œåƒæ‰«æ100%è¦†ç›–
- [ ] Criticalæ¼æ´0å®¹å¿
- [ ] é•œåƒç­¾åå¼ºåˆ¶éªŒè¯
- [ ] åŸºç¡€é•œåƒåŠæ—¶æ›´æ–°
- [ ] SBOMè‡ªåŠ¨ç”Ÿæˆ
- [ ] é•œåƒä»“åº“è®¿é—®æ§åˆ¶
- [ ] è¿è¡Œæ—¶ç­–ç•¥æ‰§è¡Œ

**æ¼æ´ç®¡ç†(æ¯æ—¥æ£€æŸ¥)**:
- [ ] æ–°æ¼æ´è‡ªåŠ¨åˆ›å»ºå·¥å•
- [ ] Critical SLA <24å°æ—¶
- [ ] High SLA <7å¤©
- [ ] SLAè¿è§„ç‡ <5%
- [ ] MTTRè¶‹åŠ¿æ”¹å–„
- [ ] é‡å¤æ¼æ´ç‡ <10%
- [ ] ä¿®å¤éªŒè¯100%

---

## ğŸ“ å¯¼èˆª

**[â† ä¸Šä¸€èŠ‚:5.6 äº‘åŸç”Ÿå®‰å…¨å·¥å…·é“¾](./5.6_cloud_native_security_toolchain.md)** | **[è¿”å› Part 2](../)** | **[è¿”å›æ€»ç›®å½•](../../)** | **[â†’ ä¸‹ä¸€èŠ‚:5.8 äº‘å®‰å…¨è¿è¥](./5.8_cloud_security_operations.md)**

---

**Â© 2025 AI-ESA Project. Licensed under CC BY-NC-SA 4.0**
