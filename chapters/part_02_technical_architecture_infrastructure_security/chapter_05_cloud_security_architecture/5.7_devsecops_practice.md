# 5.7 DevSecOps å®è·µ

æœ¬èŠ‚å»ºç«‹ä» CI/CD æµæ°´çº¿å®‰å…¨é›†æˆåˆ°æ¼æ´å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„å®Œæ•´ DevSecOps å·¥ç¨‹ä½“ç³»ï¼Œè¦†ç›–åŸºç¡€è®¾æ–½å³ä»£ç æ‰«æã€å®¹å™¨é•œåƒä¾›åº”é“¾å®‰å…¨ã€å®‰å…¨å·¦ç§»å·¥ç¨‹å®è·µä¸è‡ªåŠ¨åŒ–è´¨é‡é—¨ç¦è®¾è®¡ï¼Œå°†å®‰å…¨æ§åˆ¶å‰ç½®åˆ°è®¾è®¡ä¸å¼€å‘é˜¶æ®µï¼Œé™ä½ä¿®å¤æˆæœ¬å¹¶æé«˜äº¤ä»˜æ•ˆç‡ã€‚

---

## 5.7.1 CI/CD å®‰å…¨é›†æˆ

### CI/CD å¹³å°å®‰å…¨å¯¹æ¯”

é€‰æ‹© CI/CD å¹³å°æ—¶éœ€è¦ç»¼åˆè€ƒè™‘éƒ¨ç½²æ¨¡å¼ã€å‡­è¯ç®¡ç†æœºåˆ¶ã€å®‰å…¨æ‰«æç”Ÿæ€ä¸å®¡è®¡èƒ½åŠ›ã€‚ä¸‹è¡¨å¯¹æ¯”ä¸»æµå¹³å°çš„æ ¸å¿ƒå®‰å…¨ç‰¹æ€§ï¼Œä¸ºæŠ€æœ¯é€‰å‹æä¾›å‚è€ƒä¾æ®ï¼š

| å¹³å° | Jenkins | GitLab CI | GitHub Actions | CircleCI |
|------|---------|-----------|----------------|----------|
| éƒ¨ç½²æ¨¡å¼ | Self-hosted/Cloud | Self-hosted/SaaS | Cloud | Cloud |
| å‡­è¯ç®¡ç† | Credentials Plugin | CI/CD Variables | Secrets | Contexts |
| Pipeline å®šä¹‰ | Jenkinsfile | .gitlab-ci.yml | Workflow YAML | config.yml |
| RBAC | æ’ä»¶æ”¯æŒ | å†…ç½® | å†…ç½® | å†…ç½® |
| å®¡è®¡æ—¥å¿— | æ’ä»¶æ”¯æŒ | å†…ç½® | å†…ç½® | æœ‰é™ |
| ç­¾åéªŒè¯ | æ’ä»¶ | å†…ç½® | æœ‰é™ | æœ‰é™ |
| å®‰å…¨æ‰«æé›†æˆ | ä¸°å¯Œæ’ä»¶ | å†…ç½®+æ’ä»¶ | Marketplace | Orbs |
| éš”ç¦»æ€§ | é…ç½®ä¾èµ– | å®¹å™¨éš”ç¦» | å®¹å™¨éš”ç¦» | å®¹å™¨éš”ç¦» |
| æœ€ä½³åœºæ™¯ | ä¼ä¸šè‡ªå»º | GitLab ç”Ÿæ€ | GitHub ç”Ÿæ€ | å¿«é€Ÿé…ç½® |

é€‰å‹å…³é”®å†³ç­–ç‚¹åŒ…æ‹¬ï¼šä¼ä¸šè‡ªå»ºç¯å¢ƒä¼˜å…ˆ Jenkinsï¼ˆå¯æ§æ€§é«˜ã€å®šåˆ¶èƒ½åŠ›å¼ºï¼‰ï¼ŒGitLab/GitHub ç”Ÿæ€ä¼˜å…ˆå¯¹åº”åŸç”Ÿ CIï¼ˆå‡å°‘å·¥å…·åˆ‡æ¢æˆæœ¬ï¼‰ï¼Œå¯¹å®¹å™¨éš”ç¦»æœ‰å¼ºéœ€æ±‚æ—¶é¿å…å•çº¯ä¾èµ– Jenkins é…ç½®éš”ç¦»ï¼ˆéœ€é¢å¤–åŠ å›ºï¼‰ã€‚

### å®‰å…¨é—¨ç¦çš„ä¸ƒå±‚é˜²æŠ¤ç­–ç•¥

å®‰å…¨é—¨ç¦çš„è®¾è®¡éœ€è¦å¹³è¡¡é£é™©æ§åˆ¶ä¸å¼€å‘æ•ˆç‡ã€‚ä¸ƒå±‚é˜²æŠ¤ç­–ç•¥æŒ‰è½¯ä»¶ç”Ÿå‘½å‘¨æœŸé¡ºåºè®¾ç½®æ£€æŸ¥ç‚¹ï¼š

**ç¬¬ä¸€å±‚ï¼šä»£ç æäº¤éªŒè¯**ã€‚é€šè¿‡ Git ç­¾åéªŒè¯ï¼ˆGPG ç­¾åï¼‰ç¡®ä¿ä»£ç æ¥æºå¯ä¿¡ï¼Œé˜²æ­¢ä¾›åº”é“¾æŠ•æ¯’ã€‚æ£€æŸ¥ç‚¹åœ¨ä»£ç è¿›å…¥ä»£ç åº“å‰è§¦å‘ï¼Œé˜»æ–­æœªç­¾åæäº¤ã€‚

**ç¬¬äºŒå±‚ï¼šç§˜å¯†æ‰«æ**ã€‚ä½¿ç”¨ TruffleHog æˆ– GitGuardian æ‰«æå…¨å†å²æäº¤ä¸å½“å‰ä»£ç ï¼Œæ£€æµ‹ç¡¬ç¼–ç  API å¯†é’¥ã€æ•°æ®åº“å‡­è¯ã€ç§é’¥ã€‚å‘ç°æ³„éœ²ç«‹å³é˜»æ–­æ„å»ºã€‚é€‚ç”¨è¾¹ç•Œï¼šä»…æ‰«æä»£ç ä»“åº“ï¼Œä¸è¦†ç›–è¿è¡Œæ—¶é…ç½®æ–‡ä»¶ï¼ˆéœ€é€šè¿‡å…¶ä»–å·¥å…·ç›‘æ§ï¼‰ã€‚

**ç¬¬ä¸‰å±‚ï¼šé™æ€ä»£ç å®‰å…¨åˆ†æï¼ˆSASTï¼‰**ã€‚ä½¿ç”¨ SonarQube æˆ– Checkmarx æ£€æµ‹ SQL æ³¨å…¥ã€XSSã€ä¸å®‰å…¨ååºåˆ—åŒ–ç­‰ä»£ç æ¼æ´ã€‚è®¾ç½® Quality Gate é˜ˆå€¼ï¼ˆå¦‚ Critical æ¼æ´=0ï¼Œä»£ç è¦†ç›–ç‡>è®¾å®šåŸºçº¿ï¼‰ã€‚å…³é”®çº¦æŸï¼šSAST è¯¯æŠ¥ç‡å¯èƒ½è¾¾åˆ°åˆæ¬¡æ‰«æç»“æœçš„ 80%ï¼Œéœ€å»ºç«‹åŸºçº¿ä¸ç™½åå•æœºåˆ¶ï¼ˆè§é—¨ç¦å†³ç­–æµç¨‹ï¼‰ã€‚

**ç¬¬å››å±‚ï¼šè½¯ä»¶æˆåˆ†åˆ†æï¼ˆSCAï¼‰**ã€‚ä½¿ç”¨ Snyk æˆ– Dependabot æ£€æµ‹ä¾èµ–åº“ CVE æ¼æ´ã€‚ä»… Critical çº§åˆ«è‡ªåŠ¨é˜»æ–­ï¼ŒHigh çº§åˆ«ç”Ÿæˆä¿®å¤å·¥å•ä½†å…è®¸é€šè¿‡ï¼Œé¿å…é˜»å¡ä¸šåŠ¡äº¤ä»˜ã€‚éªŒè¯æ–¹æ³•ï¼šæ¯æœˆæŠ½æŸ¥ä¿®å¤å·¥å•å®Œæˆç‡ï¼Œç¡®è®¤ SLA åˆè§„ã€‚

**ç¬¬äº”å±‚ï¼šå®¹å™¨é•œåƒæ‰«æ**ã€‚ä½¿ç”¨ Trivy æˆ– Grype æ£€æµ‹åŸºç¡€é•œåƒä¸åº”ç”¨å±‚æ¼æ´ï¼Œé€šè¿‡ Cosign éªŒè¯é•œåƒç­¾åã€‚æ‰«æè¦†ç›–æ“ä½œç³»ç»ŸåŒ…ä¸åº”ç”¨ä¾èµ–ï¼Œé˜»æ–­åŒ…å«é«˜å±æ¼æ´çš„é•œåƒæ¨é€åˆ°ç”Ÿäº§ Registryã€‚

**ç¬¬å…­å±‚ï¼šåŸºç¡€è®¾æ–½å³ä»£ç æ‰«æï¼ˆIaCï¼‰**ã€‚ä½¿ç”¨ Checkov æˆ– Terrascan æ£€æµ‹ Terraform/CloudFormation é…ç½®é£é™©ï¼ˆå¦‚ S3 å…¬å¼€è¯»å†™ã€å®‰å…¨ç»„è¿‡åº¦å¼€æ”¾ï¼‰ã€‚é€‚ç”¨è¾¹ç•Œï¼šä»…æ£€æµ‹åŸºç¡€è®¾æ–½é…ç½®ï¼Œä¸è¦†ç›–åº”ç”¨å±‚é…ç½®æ–‡ä»¶ï¼ˆå¦‚ Nginx é…ç½®éœ€é€šè¿‡ SAST æˆ–è‡ªå®šä¹‰è„šæœ¬æ£€æŸ¥ï¼‰ã€‚

**ç¬¬ä¸ƒå±‚ï¼šåŠ¨æ€åº”ç”¨å®‰å…¨æµ‹è¯•ï¼ˆDASTï¼‰**ã€‚åœ¨ Staging ç¯å¢ƒä½¿ç”¨ OWASP ZAP æˆ– Burp Suite æ‰§è¡Œè¢«åŠ¨æ‰«æä¸ä¸»åŠ¨æ”»å‡»æµ‹è¯•ã€‚è¿è¡Œæ—¶æœºï¼šéƒ¨ç½²åˆ° Staging åæ‰§è¡Œï¼Œç”Ÿæˆ HTML æŠ¥å‘Šä¾›å®‰å…¨å›¢é˜Ÿå®¡æŸ¥ã€‚å…³é”®çº¦æŸï¼šDAST æ‰«ææ—¶é—´è¾ƒé•¿ï¼ˆ30 åˆ†é’Ÿè‡³æ•°å°æ—¶ï¼‰ï¼Œä¸é€‚åˆæ¯æ¬¡ PR è§¦å‘ï¼Œå»ºè®®ä»…åœ¨ä¸»åˆ†æ”¯åˆå¹¶åæ‰§è¡Œã€‚

### é—¨ç¦é˜»æ–­ç­–ç•¥è®¾è®¡

é—¨ç¦é˜»æ–­ç­–ç•¥éœ€è¦æƒè¡¡å®‰å…¨é£é™©ä¸äº¤ä»˜æ•ˆç‡ï¼š

- **å¼ºåˆ¶é˜»æ–­åœºæ™¯**ï¼šç§˜å¯†æ³„éœ²ã€Critical çº§åˆ« SAST æ¼æ´ã€Critical çº§åˆ«å®¹å™¨æ¼æ´ã€IaC é…ç½®è¿ååˆè§„è¦æ±‚(å¦‚æ•°æ®åº“å…¬ç½‘æš´éœ²)ã€‚è¿™äº›é—®é¢˜ä¿®å¤æˆæœ¬ä½ã€é£é™©é«˜ï¼Œå¿…é¡»é›¶å®¹å¿ã€‚
- **è­¦å‘Šä½†å…è®¸é€šè¿‡åœºæ™¯**ï¼šHigh çº§åˆ« SAST æ¼æ´(æ•°é‡â‰¤è®¾å®šé˜ˆå€¼ï¼Œå¦‚ 5 ä¸ª)ã€Medium çº§åˆ«ä¾èµ–æ¼æ´ã€ä»£ç è¦†ç›–ç‡ä½äºç›®æ ‡ä½†é«˜äºæœ€ä½è¦æ±‚ã€‚è¿™äº›é—®é¢˜ç”Ÿæˆå·¥å•è·Ÿè¸ªï¼Œä½†ä¸ç«‹å³é˜»æ–­ï¼Œé¿å…å½±å“ç´§æ€¥å‘å¸ƒã€‚
- **ä»…è®°å½•ä¸é˜»æ–­åœºæ™¯**ï¼šLow çº§åˆ«ä»£ç è´¨é‡é—®é¢˜ã€Medium çº§åˆ«ä¾èµ–æ¼æ´ã€ä¿¡æ¯æ³„éœ²(å¦‚æ³¨é‡Šä¸­çš„å†…éƒ¨ URL)ã€‚è®°å½•åˆ°æŠ€æœ¯å€ºå°è´¦ï¼Œå®šæœŸæ¸…ç†ã€‚

å¸¸è§è¯¯åŒºåŒ…æ‹¬ï¼šä¸€åˆ€åˆ‡é˜»æ–­æ‰€æœ‰ High æ¼æ´å¯¼è‡´å¼€å‘å›¢é˜Ÿé¢‘ç¹ç”³è¯·ä¾‹å¤–ï¼Œé™ä½é—¨ç¦æƒå¨æ€§ï¼›æœªå»ºç«‹åŸºçº¿å¯¼è‡´é¦–æ¬¡å¯ç”¨ SAST æ—¶æŠ¥å‘Šæ•°åƒä¸ªå†å²é—®é¢˜ï¼Œæ·¹æ²¡æ–°å¢é—®é¢˜ï¼›è¯¯æŠ¥ç™½åå•ç¼ºä¹å®¡æŸ¥æœºåˆ¶ï¼Œæˆä¸ºè§„é¿æ£€æŸ¥çš„åé—¨ã€‚

### é—¨ç¦æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

é›†æˆå¤šå±‚æ‰«æåï¼Œæ„å»ºæ—¶é—´å¯èƒ½ä» 5 åˆ†é’Ÿå»¶é•¿è‡³ 25 åˆ†é’Ÿï¼Œå½±å“å¼€å‘ä½“éªŒã€‚ä¼˜åŒ–ç­–ç•¥åŒ…æ‹¬ï¼š

**å¹¶è¡ŒåŒ–æ‰«æ**ã€‚SASTã€SCAã€Secret æ‰«æäº’ä¸ä¾èµ–ï¼Œå¯å¹¶è¡Œæ‰§è¡Œã€‚ç¤ºä¾‹é…ç½®è§ä¸‹æ–¹ Jenkins æµæ°´çº¿ç‰‡æ®µçš„å¹¶è¡Œ stage å®šä¹‰ã€‚

**å¢é‡æ‰«æ**ã€‚ä»…æ‰«æå˜æ›´ä»£ç è€Œéå…¨é‡ä»£ç ã€‚SonarQube çš„ Pull Request åˆ†ææ¨¡å¼ä»…æŠ¥å‘Š PR æ–°å¢é—®é¢˜ï¼Œå¤§å¹…ç¼©çŸ­æ‰«ææ—¶é—´(ä» 15 åˆ†é’Ÿé™è‡³ 3 åˆ†é’Ÿ)ã€‚

**ç¼“å­˜æœºåˆ¶**ã€‚ä¾èµ–åº“æ‰«æç»“æœç¼“å­˜ 24 å°æ—¶ï¼Œé¿å…é‡å¤æ‰«æç›¸åŒçš„ package.json æˆ– pom.xmlã€‚å®ç°æ–¹æ³•ï¼šæ ¹æ®ä¾èµ–æ–‡ä»¶å“ˆå¸Œå€¼æŸ¥è¯¢ç¼“å­˜ï¼Œå‘½ä¸­åˆ™è·³è¿‡æ‰«æã€‚

**åˆ†å±‚é—¨ç¦**ã€‚PR é˜¶æ®µä»…æ‰§è¡Œå¿«é€Ÿæ‰«æï¼ˆSecret+SAST å¢é‡),åˆå¹¶åæ‰§è¡Œå®Œæ•´æ‰«æ(åŒ…æ‹¬ DAST ä¸å®¹å™¨æ‰«æ)ã€‚é€‚ç”¨è¾¹ç•Œï¼šä»…é€‚ç”¨äºä¸»åˆ†æ”¯ä¿æŠ¤ä¸¥æ ¼çš„å›¢é˜Ÿï¼Œå¦åˆ™å¯èƒ½é—æ¼é—®é¢˜ã€‚

æ€§èƒ½ä¼˜åŒ–çš„éªŒè¯æ–¹æ³•ï¼šç»Ÿè®¡ P95 æ„å»ºæ—¶é•¿ï¼Œç¡®ä¿â‰¤åŸåŸºçº¿çš„ 150%(å¦‚åŸ 5 åˆ†é’Ÿï¼Œä¼˜åŒ–åâ‰¤7.5 åˆ†é’Ÿ);å¼€å‘è€…æ»¡æ„åº¦è°ƒç ”ï¼Œç¡®è®¤é—¨ç¦ä¸å½±å“æ­£å¸¸è¿­ä»£èŠ‚å¥ã€‚

### Jenkins å®‰å…¨é—¨ç¦å®ç°ç¤ºä¾‹

ä»¥ä¸‹ Groovy ä»£ç ç‰‡æ®µå±•ç¤ºæ ¸å¿ƒé—¨ç¦é€»è¾‘ï¼Œå®Œæ•´ Jenkinsfile éœ€æ ¹æ®å®é™…æŠ€æœ¯æ ˆè°ƒæ•´ï¼š

```groovy
// CI/CDå®‰å…¨é—¨ç¦ - æ ¸å¿ƒé˜¶æ®µé…ç½®
pipeline {
 agent any

 stages {
  // å†³ç­–ç‚¹1: Secretæ‰«æå‰ç½®,æœ€æ—©å‘ç°å‡­è¯æ³„éœ²
  stage('Secret Scanning') {
   steps {
    sh 'trufflehog filesystem . --json > secrets.json'
    script {
     def secrets = readJSON file: 'secrets.json'
     if (secrets.size() > 0) {
      error "ğŸ”´ Secrets detected! Build aborted." // å¼ºåˆ¶é˜»æ–­
     }
    }
   }
  }

  // å†³ç­–ç‚¹2: SAST Quality Gateé˜»æ–­Criticalæ¼æ´
  stage('SAST') {
   steps {
    withSonarQubeEnv('SonarQube') {
     sh 'mvn sonar:sonar -Dsonar.qualitygate.wait=true'
    }
    timeout(time: 10, unit: 'MINUTES') {
     waitForQualityGate abortPipeline: true // Quality Gateå¤±è´¥åˆ™é˜»æ–­
    }
   }
  }

  // å†³ç­–ç‚¹3: SCAæ‰«æå…è®¸Highæ¼æ´ä½†è®°å½•
  stage('SCA') {
   steps {
    sh 'snyk test --severity-threshold=critical --json > snyk-report.json'
    script {
     // è§£ææŠ¥å‘Š,Highæ¼æ´ç”ŸæˆJiraå·¥å•ä½†ä¸é˜»æ–­
     sh 'python3 scripts/create-vuln-tickets.py snyk-report.json'
    }
   }
  }

  // å†³ç­–ç‚¹4: å®¹å™¨ç­¾åéªŒè¯ä¾›åº”é“¾å®‰å…¨
  stage('Container Build & Sign') {
   steps {
    sh 'docker build -t ${IMAGE_TAG} .'
    sh 'trivy image --exit-code 1 --severity CRITICAL ${IMAGE_TAG}' // é«˜å±æ¼æ´é˜»æ–­
    sh 'cosign sign --key cosign.key ${IMAGE_TAG}' // Sigstore Cosignç­¾å
   }
  }
 }

 post {
  always {
   // å½’æ¡£æ‰«ææŠ¥å‘Š,ä¿ç•™30å¤©ç”¨äºå®¡è®¡
   archiveArtifacts artifacts: '**/*-report.json', allowEmptyArchive: true
  }
 }
}
```

å…³é”®é…ç½®å†³ç­–ï¼š

- **å‡­è¯ç®¡ç†**ï¼šæ‰€æœ‰æ•æ„Ÿä¿¡æ¯ï¼ˆDocker Registry å¯†ç ã€SonarQube Tokenã€Cosign ç§é’¥)å¿…é¡»ä» Vault æˆ– AWS Secrets Manager åŠ¨æ€è·å–ï¼Œç¦æ­¢ç¡¬ç¼–ç åœ¨ Jenkinsfile ä¸­ã€‚éªŒè¯æ–¹æ³•ï¼šä»£ç å®¡æŸ¥æ£€æŸ¥æ— æ˜æ–‡å‡­è¯ï¼Œå®šæœŸæ‰«æ Jenkins é…ç½®æ–‡ä»¶ã€‚
- **æ„å»ºè¶…æ—¶**ï¼šè®¾ç½®å…¨å±€è¶…æ—¶(å¦‚ 1 å°æ—¶),é˜²æ­¢å¼‚å¸¸æ„å»ºå ç”¨èµ„æºã€‚è¶…æ—¶åè‡ªåŠ¨ç»ˆæ­¢å¹¶å‘Šè­¦åˆ° Slackã€‚
- **ç»“æœå­˜æ¡£**ï¼šæ‰€æœ‰æ‰«ææŠ¥å‘Šï¼ˆJSON æ ¼å¼)å­˜æ¡£ 30 å¤©ï¼Œç”¨äºåˆè§„å®¡è®¡ä¸è¶‹åŠ¿åˆ†æã€‚å­˜æ¡£è·¯å¾„éœ€é…ç½®å®šæœŸæ¸…ç†ï¼Œé¿å…ç£ç›˜å æ»¡ã€‚

### GitHub Actions å®‰å…¨å®è·µ

GitHub Actions çš„å®‰å…¨é…ç½®éœ€è¦ç‰¹åˆ«æ³¨æ„æƒé™æœ€å°åŒ–ä¸ Secret ç®¡ç†ã€‚ä»¥ä¸‹ YAML å±•ç¤ºå®Œæ•´å®‰å…¨æµæ°´çº¿ï¼š

```yaml
# .github/workflows/security-pipeline.yml
name: Security CI/CD Pipeline

on:
 push:
  branches: [main, develop]
 pull_request:
  branches: [main]

# å…³é”®:æƒé™æœ€å°åŒ–,ä»…æˆäºˆå¿…éœ€æƒé™
permissions:
 contents: read          # è¯»å–ä»£ç 
 security-events: write  # ä¸Šä¼ SARIFæŠ¥å‘Šåˆ°Securityæ ‡ç­¾
 pull-requests: write    # PRè¯„è®º

env:
 REGISTRY: ghcr.io
 IMAGE_NAME: ${{ github.repository }}

jobs:
 secret-scan:
  name: Secret Scanning
  runs-on: ubuntu-latest
  steps:
   - uses: actions/checkout@v4
    with:
     fetch-depth: 0 # å…¨å†å²æ‰«æ,æ£€æµ‹å†å²æäº¤ä¸­çš„æ³„éœ²

   - name: TruffleHog Secret Scan
    uses: trufflesecurity/trufflehog@main
    with:
     path: ./
     base: ${{ github.event.repository.default_branch }}
     head: HEAD

 sast-scan:
  name: SAST Scanning
  runs-on: ubuntu-latest
  steps:
   - uses: actions/checkout@v4

   # CodeQLåˆ†æ(GitHubåŸç”Ÿ)
   - name: Initialize CodeQL
    uses: github/codeql-action/init@v3
    with:
     languages: java, javascript

   - name: Build
    run: mvn clean package -DskipTests

   - name: Perform CodeQL Analysis
    uses: github/codeql-action/analyze@v3

   # SonarCloudåˆ†æ(ç¬¬ä¸‰æ–¹)
   - name: SonarCloud Scan
    uses: SonarSource/sonarcloud-github-action@master
    env:
     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
     SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}

 sca-scan:
  name: SCA Dependency Scanning
  runs-on: ubuntu-latest
  steps:
   - uses: actions/checkout@v4

   - name: Run Snyk
    uses: snyk/actions/maven@master
    env:
     SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
    with:
     args: --severity-threshold=high

   # ä¸Šä¼ SARIFæŠ¥å‘Šåˆ°GitHub Securityæ ‡ç­¾
   - name: Upload Snyk results to GitHub Security
    uses: github/codeql-action/upload-sarif@v3
    with:
     sarif_file: snyk.sarif

 container-scan:
  name: Container Image Scanning
  runs-on: ubuntu-latest
  needs: [sast-scan, sca-scan] # ä¾èµ–å‰ç½®æ‰«æé€šè¿‡
  steps:
   - uses: actions/checkout@v4

   - name: Build Image
    run: |
     docker build -t ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }} .

   - name: Scan with Trivy
    uses: aquasecurity/trivy-action@master
    with:
     image-ref: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }}
     format: 'sarif'
     output: 'trivy-results.sarif'
     severity: 'CRITICAL,HIGH'
     exit-code: '1' # å‘ç°é«˜å±æ¼æ´åˆ™å¤±è´¥

   - name: Upload Trivy results
    uses: github/codeql-action/upload-sarif@v3
    with:
     sarif_file: 'trivy-results.sarif'

   # ä½¿ç”¨Cosignç­¾å(Keylessæ¨¡å¼,åŸºäºOIDC)
   - name: Sign Image with Cosign
    run: |
     cosign sign --key env://COSIGN_KEY \
      ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }}
    env:
     COSIGN_KEY: ${{ secrets.COSIGN_PRIVATE_KEY }}
     COSIGN_PASSWORD: ${{ secrets.COSIGN_PASSWORD }}

 security-gate:
  name: Security Quality Gate
  runs-on: ubuntu-latest
  needs: [secret-scan, sast-scan, sca-scan, container-scan]
  steps:
   - name: Check Security Gate
    run: |
     echo "âœ… All security scans passed!"
     echo "Ready for deployment"

   # PRè‡ªåŠ¨è¯„è®ºé€šçŸ¥æ‰«æç»“æœ
   - name: Post PR Comment
    if: github.event_name == 'pull_request'
    uses: actions/github-script@v7
    with:
     script: |
      github.rest.issues.createComment({
       issue_number: context.issue.number,
       owner: context.repo.owner,
       repo: context.repo.repo,
       body: 'âœ… Security scans passed! Safe to merge.'
      })
```

å…³é”®é…ç½®è¦ç‚¹ï¼š

- **æƒé™æœ€å°åŒ–**:é¡¶å±‚`permissions`ä»…æˆäºˆå¿…éœ€æƒé™ã€‚é»˜è®¤ GitHub Actions æ‹¥æœ‰`write`æƒé™ï¼Œéœ€æ˜¾å¼é™çº§ä¸º`read`å¹¶æŒ‰éœ€å¼€æ”¾ã€‚
- **Secret ç®¡ç†**:`SNYK_TOKEN`ã€`COSIGN_PRIVATE_KEY`å­˜å‚¨åœ¨ GitHub Repository Secrets ä¸­ï¼Œè¿è¡Œæ—¶é€šè¿‡ç¯å¢ƒå˜é‡æ³¨å…¥ï¼Œç¦æ­¢åœ¨æ—¥å¿—ä¸­æ‰“å°ã€‚
- **SARIF æŠ¥å‘Šä¸Šä¼ **:CodeQLã€Snykã€Trivy æ‰«æç»“æœç»Ÿä¸€ä¸Šä¼ åˆ° GitHub Security æ ‡ç­¾ï¼Œé›†ä¸­å±•ç¤ºæ¼æ´å¹¶è¿½è¸ªä¿®å¤çŠ¶æ€ã€‚

---

## 5.7.2 IaC å®‰å…¨æ‰«æ

### Terraform æ‰«æå·¥å…·å¯¹æ¯”

Terraform ç­‰ IaC å·¥å…·å°†åŸºç¡€è®¾æ–½é…ç½®ä»£ç åŒ–ï¼Œä½†é…ç½®é”™è¯¯(å¦‚ S3 å…¬å¼€è®¿é—®ã€å®‰å…¨ç»„ 0.0.0.0/0 å¼€æ”¾)ä¼šç›´æ¥å¼•å…¥å®‰å…¨é£é™©ã€‚ä¸‹è¡¨å¯¹æ¯”ä¸»æµæ‰«æå·¥å…·çš„æ ¸å¿ƒèƒ½åŠ›ï¼š

| å·¥å…· | Checkov | tfsec | Terrascan | Snyk IaC |
|------|---------|-------|-----------|----------|
| å¼€å‘è€… | Bridgecrew/Palo Alto | Aqua Security | Tenable | Snyk |
| å¼€æº | æ˜¯ | æ˜¯ | æ˜¯ | éƒ¨åˆ†å¼€æº |
| è§„åˆ™æ•° | 1000+ | 600+ | 500+ | 400+ |
| è¯­è¨€ | Python | Go | Go | å¤šè¯­è¨€ |
| IaC æ”¯æŒ | TF/CFN/K8s/Helm | Terraform | TF/CFN/K8s | TF/K8s/ARM |
| è‡ªå®šä¹‰è§„åˆ™ | Python | JSON/Rego | Rego | æœ‰é™ |
| CI/CD é›†æˆ | æ˜“ | æ˜“ | æ˜“ | æ˜“ |
| ä¿®å¤å»ºè®® | è¯¦ç»† | ä¸­ç­‰ | åŸºç¡€ | è¯¦ç»† |
| è¯¯æŠ¥ç‡ | ä¸­ | ä½ | ä¸­ | ä½ |
| æ€§èƒ½ | ä¸­ | å¿« | ä¸­ | å¿« |
| æœ€ä½³åœºæ™¯ | å…¨é¢æ£€æŸ¥ | Terraform ä¸“ç²¾ | å¤š IaC æ”¯æŒ | CI/CD é›†æˆ |

é€‰å‹å†³ç­–ä¾æ®ï¼š

- **å¼€æºä¼˜å…ˆ**ï¼šé¢„ç®—æœ‰é™æˆ–éœ€è¦å®šåˆ¶è§„åˆ™ï¼Œé€‰æ‹© Checkov(è§„åˆ™æœ€ä¸°å¯Œ)æˆ– tfsec(æ€§èƒ½æœ€å¿«)ã€‚
- **Terraform ä¸“ç²¾**:çº¯ Terraform ç¯å¢ƒï¼Œé€‰æ‹© tfsec(è¯¯æŠ¥ç‡ä½ã€æ‰«æé€Ÿåº¦å¿«)ã€‚
- **å¤š IaC æ ¼å¼**:åŒæ—¶ä½¿ç”¨ Terraformã€Kubernetes YAMLã€Helm,é€‰æ‹© Checkov æˆ– Terrascanã€‚
- **å•†ä¸šæ”¯æŒ**ï¼šéœ€è¦ä¼ä¸šçº§æ”¯æŒä¸æŒç»­æ›´æ–°ï¼Œé€‰æ‹© Snyk IaC æˆ– Bridgecrew(å·²è¢« Palo Alto æ”¶è´­)ã€‚

å¸¸è§è¯¯åŒºï¼šä»…ä¾èµ–å•ä¸€å·¥å…·å¯¼è‡´è§„åˆ™è¦†ç›–ä¸å…¨ï¼Œå»ºè®®ç»„åˆä½¿ç”¨(å¦‚ Checkov+tfsec,é€šè¿‡å¹¶é›†è¦†ç›–æ›´å¤šé£é™©ç‚¹)ã€‚

### Checkov å®æˆ˜

Checkov æ˜¯åŠŸèƒ½æœ€å…¨é¢çš„ IaC æ‰«æå·¥å…·ï¼Œæ”¯æŒ 1000+è§„åˆ™ä¸è‡ªå®šä¹‰ Python è§„åˆ™ã€‚åŸºæœ¬ä½¿ç”¨ï¼š

```bash
# å®‰è£…Checkov
pip3 install checkov

# æ‰«æTerraformä»£ç 
checkov -d /path/to/terraform \
 --framework terraform \
 --output cli \
 --output json \
 --output-file checkov-report.json

# åªæ£€æŸ¥ç‰¹å®šä¸¥é‡æ€§(å‡å°‘å™ªéŸ³)
checkov -d . --compact --quiet \
 --check CKV_AWS_20,CKV_AWS_21

# è·³è¿‡ç‰¹å®šæ£€æŸ¥(é€šè¿‡æŠ‘åˆ¶æ–‡ä»¶ç®¡ç†)
checkov -d . --skip-check CKV_AWS_8

# ä»…æ˜¾ç¤ºå¤±è´¥çš„æ£€æŸ¥(å¿«é€Ÿå®šä½é—®é¢˜)
checkov -d . --compact --quiet
```

CI/CD é›†æˆç¤ºä¾‹ï¼ˆGitLab CI):

```yaml
# .gitlab-ci.yml
checkov-scan:
 stage: security
 image: bridgecrew/checkov:latest
 script:
  - |
   checkov -d terraform/ \
    --framework terraform \
    --output cli \
    --output junitxml \
    --output-file checkov-report.xml \
    --soft-fail # ä¸é˜»æ–­æ„å»º,ä»…è­¦å‘Š
 artifacts:
  reports:
   junit: checkov-report.xml
  when: always
 only:
  - merge_requests
```

å…³é”®é…ç½®ï¼š

- **--soft-fail**:åˆæœŸæ¨å¹¿é˜¶æ®µå»ºè®®ä½¿ç”¨ï¼Œä»…ç”Ÿæˆè­¦å‘Šä¸é˜»æ–­æ„å»ºï¼Œé¿å…å¼€å‘å›¢é˜ŸæŠµè§¦ã€‚æˆç†Ÿåæ”¹ä¸ºå¼ºåˆ¶é˜»æ–­æ¨¡å¼(ç§»é™¤è¯¥å‚æ•°)ã€‚
- **è¾“å‡ºæ ¼å¼**ï¼šåŒæ—¶è¾“å‡º CLI(äººç±»å¯è¯»)ä¸ JSON(æœºå™¨è§£æ),JSON ç”¨äºåç»­æ•°æ®åˆ†æä¸å·¥å•åˆ›å»ºã€‚
- **æŠ‘åˆ¶æ–‡ä»¶**:å¯¹äºåˆç†çš„ä¾‹å¤–(å¦‚æµ‹è¯•ç¯å¢ƒå…è®¸ S3 å…¬å¼€è¯»),é€šè¿‡`--skip-check`æˆ–`.checkov.yml`é…ç½®æ–‡ä»¶é›†ä¸­ç®¡ç†ï¼Œè€Œéåœ¨ä»£ç ä¸­æ·»åŠ å¤§é‡æ³¨é‡Šã€‚

è‡ªå®šä¹‰è§„åˆ™ç¤ºä¾‹(æ£€æŸ¥ S3 Bucket å¿…éœ€æ ‡ç­¾):

```python
# custom_checks/S3BucketCustomCheck.py
from checkov.terraform.checks.resource.base_resource_check import BaseResourceCheck
from checkov.common.models.enums import CheckResult, CheckCategories

class S3BucketRequireTags(BaseResourceCheck):
 def __init__(self):
  name = "Ensure S3 bucket has required tags"
  id = "CKV_AWS_CUSTOM_001"
  supported_resources = ['aws_s3_bucket']
  categories = [CheckCategories.GENERAL_SECURITY]
  super().__init__(name=name, id=id, categories=categories,
          supported_resources=supported_resources)

 def scan_resource_conf(self, conf):
  """
  æ£€æŸ¥S3 bucketæ˜¯å¦åŒ…å«å¿…éœ€çš„æ ‡ç­¾
  é€‚ç”¨è¾¹ç•Œ:ä»…æ£€æŸ¥æ ‡ç­¾å­˜åœ¨æ€§,ä¸éªŒè¯æ ‡ç­¾å€¼åˆæ³•æ€§(éœ€é¢å¤–è§„åˆ™)
  """
  required_tags = ['Environment', 'Owner', 'CostCenter']

  if 'tags' in conf:
   tags = conf['tags'][0]
   missing_tags = [tag for tag in required_tags if tag not in tags]

   if missing_tags:
    self.evaluated_keys = ['tags']
    return CheckResult.FAILED

  return CheckResult.PASSED

check = S3BucketRequireTags()
```

è¿è¡Œè‡ªå®šä¹‰è§„åˆ™ï¼š

```bash
checkov -d terraform/ --external-checks-dir ./custom_checks/
```

éªŒè¯æ–¹æ³•ï¼šåˆ›å»ºä¸åŒ…å«å¿…éœ€æ ‡ç­¾çš„æµ‹è¯• Terraform æ–‡ä»¶ï¼Œç¡®è®¤ Checkov æ£€æµ‹åˆ°è¿è§„ï¼›ä¿®å¤åé‡æ–°æ‰«æï¼Œç¡®è®¤é€šè¿‡ã€‚

### tfsec å®æˆ˜

tfsec ä¸“æ³¨äº Terraform,æ‰«æé€Ÿåº¦å¿«ã€è¯¯æŠ¥ç‡ä½ã€‚åŸºæœ¬ä½¿ç”¨ï¼š

```bash
# å®‰è£…tfsec
brew install tfsec

# åŸºæœ¬æ‰«æ
tfsec .

# è¾“å‡ºJSONæ ¼å¼(ç”¨äºCI/CDé›†æˆ)
tfsec . --format json --out tfsec-report.json

# åªæ˜¾ç¤ºé«˜å±å’Œä¸¥é‡é—®é¢˜(å‡å°‘å™ªéŸ³)
tfsec . --minimum-severity HIGH

# è‡ªå®šä¹‰é…ç½®æ–‡ä»¶
tfsec . --config-file tfsec.yml

# å¿½ç•¥ç‰¹å®šæ£€æŸ¥(é€šè¿‡é…ç½®æ–‡ä»¶ç®¡ç†)
tfsec . --exclude aws-s3-enable-bucket-logging
```

é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼ˆtfsec.yml):

```yaml
minimum_severity: MEDIUM

exclude:
 - aws-s3-enable-bucket-logging # å¼€å‘ç¯å¢ƒå¯ä»¥è·³è¿‡æ—¥å¿—

severity_overrides:
 aws-ec2-no-public-ip: HIGH # æå‡ä¸¥é‡æ€§

custom_check_dir: ./custom-checks
```

éªŒè¯æ–¹æ³•ï¼šåˆ›å»ºåŒ…å«å…¬å¼€ S3 Bucket çš„æµ‹è¯• Terraform æ–‡ä»¶ï¼Œç¡®è®¤ tfsec æ£€æµ‹åˆ°`aws-s3-block-public-access`è¿è§„;æ·»åŠ `public_access_block`é…ç½®åé‡æ–°æ‰«æï¼Œç¡®è®¤é€šè¿‡ã€‚

### Terrascan å®æˆ˜

Terrascan æ”¯æŒå¤šç§ IaC å·¥å…·ï¼Œé€‚åˆæ··åˆç¯å¢ƒã€‚åŸºæœ¬ä½¿ç”¨ï¼š

```bash
# å®‰è£…Terrascan
brew install terrascan

# æ‰«æTerraform
terrascan scan -t terraform

# æ‰«æç‰¹å®šç­–ç•¥(å¦‚AWSä¸“ç”¨ç­–ç•¥)
terrascan scan -t terraform -p aws

# è¾“å‡ºSARIFæ ¼å¼(ç”¨äºGitHub Securityæ ‡ç­¾)
terrascan scan -o sarif > terrascan-report.sarif
```

Pre-commit é›†æˆ(åœ¨æäº¤å‰è‡ªåŠ¨æ‰«æ):

```yaml
# .pre-commit-config.yaml
repos:
 - repo: https://github.com/tenable/terrascan
  rev: v1.18.0
  hooks:
   - id: terrascan
    args: ['-t', 'terraform']
```

å®‰è£… Pre-commit Hook:

```bash
pre-commit install
```

éªŒè¯æ–¹æ³•ï¼šä¿®æ”¹ Terraform æ–‡ä»¶å¼•å…¥å®‰å…¨é£é™©(å¦‚ç§»é™¤åŠ å¯†é…ç½®),æ‰§è¡Œ`git commit`,ç¡®è®¤ Pre-commit Hook é˜»æ­¢æäº¤å¹¶æ˜¾ç¤º Terrascan æŠ¥å‘Š;ä¿®å¤åé‡æ–°æäº¤ï¼Œç¡®è®¤é€šè¿‡ã€‚

### ç»¼åˆ IaC æ‰«æè„šæœ¬

ç”Ÿäº§ç¯å¢ƒå»ºè®®ç»„åˆä½¿ç”¨å¤šä¸ªå·¥å…·ï¼Œé€šè¿‡å¹¶é›†æé«˜è¦†ç›–ç‡ã€‚ä»¥ä¸‹ Shell è„šæœ¬é›†æˆ Checkovã€tfsecã€Terrascan,ç”Ÿæˆæ±‡æ€»æŠ¥å‘Šï¼š

```bash
#!/bin/bash
# iac-security-scan.sh - ç»¼åˆIaCæ‰«æè„šæœ¬

set -e

echo "======================================="
echo " Infrastructure as Code Security Scan"
echo "======================================="
echo ""

# é¢œè‰²å®šä¹‰
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# åˆ›å»ºæŠ¥å‘Šç›®å½•
mkdir -p reports

# 1. Checkovæ‰«æ
echo -e "${YELLOW}[1/4] Running Checkov...${NC}"
checkov -d terraform/ \
 --framework terraform \
 --compact \
 --quiet \
 --output cli \
 --output json \
 --output-file reports/checkov-report.json

CHECKOV_EXIT=$?
if [ $CHECKOV_EXIT -eq 0 ]; then
 echo -e "${GREEN}âœ“ Checkov passed${NC}"
else
 echo -e "${RED}âœ— Checkov found issues${NC}"
fi

# 2. tfsecæ‰«æ
echo -e "${YELLOW}[2/4] Running tfsec...${NC}"
tfsec terraform/ \
 --format json \
 --out reports/tfsec-report.json \
 --minimum-severity MEDIUM

TFSEC_EXIT=$?
if [ $TFSEC_EXIT -eq 0 ]; then
 echo -e "${GREEN}âœ“ tfsec passed${NC}"
else
 echo -e "${RED}âœ— tfsec found issues${NC}"
fi

# 3. Terrascanæ‰«æ
echo -e "${YELLOW}[3/4] Running Terrascan...${NC}"
terrascan scan -t terraform \
 -d terraform/ \
 -o json > reports/terrascan-report.json

TERRASCAN_EXIT=$?
if [ $TERRASCAN_EXIT -eq 0 ]; then
 echo -e "${GREEN}âœ“ Terrascan passed${NC}"
else
 echo -e "${RED}âœ— Terrascan found issues${NC}"
fi

# 4. ç”Ÿæˆæ±‡æ€»æŠ¥å‘Š
echo -e "${YELLOW}[4/4] Generating summary...${NC}"
python3 <<EOF
import json
from collections import defaultdict

def load_json(file):
 try:
  with open(file) as f:
   return json.load(f)
 except:
  return {}

checkov = load_json('reports/checkov-report.json')
tfsec = load_json('reports/tfsec-report.json')
terrascan = load_json('reports/terrascan-report.json')

summary = defaultdict(int)

# Checkovç»Ÿè®¡
if 'summary' in checkov:
 summary['checkov_passed'] = checkov['summary'].get('passed', 0)
 summary['checkov_failed'] = checkov['summary'].get('failed', 0)

# tfsecç»Ÿè®¡
if 'results' in tfsec:
 summary['tfsec_issues'] = len(tfsec['results'])

# Terrascanç»Ÿè®¡
if 'results' in terrascan:
 summary['terrascan_violations'] = terrascan['results'].get('violation_store', {}).get('violations', [])
 summary['terrascan_issues'] = len(summary['terrascan_violations'])

print("\n" + "="*50)
print(" IaC Security Scan Summary")
print("="*50)
print(f"Checkov: {summary['checkov_passed']} passed, {summary['checkov_failed']} failed")
print(f"tfsec: {summary['tfsec_issues']} issues found")
print(f"Terrascan: {summary['terrascan_issues']} issues found")
print("="*50)

# æ€»ä½“åˆ¤å®š
total_issues = summary['checkov_failed'] + summary['tfsec_issues'] + summary['terrascan_issues']
if total_issues > 0:
 print(f"\nâš  Total {total_issues} security issues found")
 exit(1)
else:
 print("\nâœ… All IaC security scans passed!")
 exit(0)
EOF

SUMMARY_EXIT=$?

# ä¸Šä¼ æŠ¥å‘Šåˆ°S3(å¯é€‰)
if [ -n "$REPORTS_S3_BUCKET" ]; then
 aws s3 cp reports/ s3://$REPORTS_S3_BUCKET/iac-scans/$(date +%Y%m%d)/ --recursive
fi

exit $SUMMARY_EXIT
```

è¿è¡ŒæŒ‡æ ‡ï¼šè„šæœ¬æ‰§è¡Œæ—¶é—´åº”â‰¤5 åˆ†é’Ÿ(ä¸­å‹ Terraform é¡¹ç›®ï¼Œçº¦ 100 ä¸ªèµ„æº);è¯¯æŠ¥ç‡é€šè¿‡äººå·¥å¤æ ¸å‰ 50 ä¸ªå‘Šè­¦ç¡®è®¤ï¼Œç›®æ ‡â‰¤20%ã€‚

---

## 5.7.3 CloudFormation å®‰å…¨

CloudFormation æ˜¯ AWS åŸç”Ÿ IaC å·¥å…·ï¼Œå®‰å…¨æ£€æŸ¥éœ€è¦ä¸“ç”¨å·¥å…·ã€‚ä¸»æµå·¥å…·åŒ…æ‹¬ cfn-nag(Ruby ç¼–å†™ï¼Œè§„åˆ™ä¸°å¯Œ)ä¸ CloudFormation Guard(AWS å®˜æ–¹ï¼Œç­–ç•¥å³ä»£ç )ã€‚

### cfn-nag å®æˆ˜

cfn-nag ä¸“æ³¨äº CloudFormation æ¨¡æ¿æ‰«æï¼Œæ£€æµ‹ IAM è¿‡åº¦æƒé™ã€åŠ å¯†ç¼ºå¤±ç­‰é—®é¢˜ã€‚åŸºæœ¬ä½¿ç”¨ï¼š

```bash
# å®‰è£…cfn-nag
gem install cfn-nag

# æ‰«æå•ä¸ªæ¨¡æ¿
cfn_nag_scan --input-path template.yaml

# æ‰«æç›®å½•
cfn_nag_scan --input-path cloudformation/

# è¾“å‡ºJSON(ç”¨äºCI/CDé›†æˆ)
cfn_nag_scan --input-path template.yaml \
 --output-format json > cfn-nag-report.json

# åªæ˜¾ç¤ºå¤±è´¥(è­¦å‘Šä¸é˜»æ–­æ„å»º)
cfn_nag_scan --input-path template.yaml --fail-on-warnings

# å¿½ç•¥ç‰¹å®šè§„åˆ™(é€šè¿‡æŠ‘åˆ¶æ–‡ä»¶ç®¡ç†)
cfn_nag_scan --input-path template.yaml \
 --blacklist-path cfn-nag-suppressions.yml
```

æŠ‘åˆ¶æ–‡ä»¶ç¤ºä¾‹ï¼ˆcfn-nag-suppressions.yml):

```yaml
---
RulesToSuppress:
 - id: W28
  reason: "Resource names are explicitly set for organizational requirements"

 - id: F1000
  reason: "Missing egress rule accepted for security group in private subnet"
```

éªŒè¯æ–¹æ³•ï¼šåˆ›å»ºåŒ…å«å…¬å¼€ S3 Bucket çš„ CloudFormation æ¨¡æ¿ï¼Œç¡®è®¤ cfn-nag æ£€æµ‹åˆ°`W35`(S3 ç¼ºå°‘è®¿é—®æ—¥å¿—)ä¸`F14`(S3 å…¬å¼€è¯»);ä¿®å¤åé‡æ–°æ‰«æï¼Œç¡®è®¤é€šè¿‡ã€‚

### CloudFormation Guard å®æˆ˜

CloudFormation Guard ä½¿ç”¨è‡ªå®šä¹‰ DSL å®šä¹‰ç­–ç•¥ï¼Œé€‚åˆä¼ä¸šçº§åˆè§„æ£€æŸ¥ã€‚åŸºæœ¬ä½¿ç”¨ï¼š

```bash
# å®‰è£…cfn-guard
cargo install cfn-guard

# éªŒè¯è§„åˆ™
cfn-guard validate \
 --data template.yaml \
 --rules s3-security-rules.guard

# æ‰¹é‡éªŒè¯(ç›®å½•æ¨¡å¼)
cfn-guard validate \
 --data cloudformation/ \
 --rules rules/ \
 --show-summary all
```

è§„åˆ™æ–‡ä»¶ç¤ºä¾‹ï¼ˆs3-security-rules.guard):

```
# S3 Bucketå¿…é¡»å¯ç”¨åŠ å¯†
rule s3_bucket_encrypted {
 Resources.*[ Type == 'AWS::S3::Bucket' ] {
  Properties {
   BucketEncryption exists
   BucketEncryption {
    ServerSideEncryptionConfiguration exists
    ServerSideEncryptionConfiguration[*] {
     ServerSideEncryptionByDefault exists
     ServerSideEncryptionByDefault {
      SSEAlgorithm in ['aws:kms', 'AES256']
     }
    }
   }
  }
 }
}

# S3 Bucketå¿…é¡»é˜»æ­¢å…¬å…±è®¿é—®
rule s3_bucket_block_public_access {
 Resources.*[ Type == 'AWS::S3::Bucket' ] {
  Properties {
   PublicAccessBlockConfiguration exists
   PublicAccessBlockConfiguration {
    BlockPublicAcls == true
    BlockPublicPolicy == true
    IgnorePublicAcls == true
    RestrictPublicBuckets == true
   }
  }
 }
}

# S3 Bucketå¿…é¡»å¯ç”¨ç‰ˆæœ¬æ§åˆ¶
rule s3_bucket_versioning {
 Resources.*[ Type == 'AWS::S3::Bucket' ] {
  Properties {
   VersioningConfiguration exists
   VersioningConfiguration {
    Status == 'Enabled'
   }
  }
 }
}
```

éªŒè¯æ–¹æ³•ï¼šåˆ›å»ºä¸ç¬¦åˆè§„åˆ™çš„ CloudFormation æ¨¡æ¿(å¦‚ S3 æœªå¯ç”¨åŠ å¯†),æ‰§è¡Œ`cfn-guard validate`,ç¡®è®¤è§„åˆ™æ£€æµ‹å¤±è´¥;ä¿®å¤åé‡æ–°éªŒè¯ï¼Œç¡®è®¤é€šè¿‡ã€‚

### CloudFormation å®‰å…¨æ¨¡æ¿ç¤ºä¾‹

ä»¥ä¸‹æ¨¡æ¿å±•ç¤º S3 Bucket å®‰å…¨é…ç½®æœ€ä½³å®è·µï¼š

```yaml
# secure-s3-bucket.yaml
AWSTemplateFormatVersion: '2010-09-09'
Description: Secure S3 Bucket with best practices

Parameters:
 BucketName:
  Type: String
  Description: Name of the S3 bucket
 DataClassification:
  Type: String
  Default: L2
  AllowedValues: [L1, L2, L3, L4]
  Description: Data classification level

Conditions:
 IsHighSensitivity: !Or
  - !Equals [!Ref DataClassification, L1]
  - !Equals [!Ref DataClassification, L2]

Resources:
 # KMSå¯†é’¥(ç”¨äºL1/L2æ•°æ®)
 BucketEncryptionKey:
  Type: AWS::KMS::Key
  Condition: IsHighSensitivity
  Properties:
   Description: !Sub 'Encryption key for ${BucketName}'
   KeyPolicy:
    Version: '2012-10-17'
    Statement:
     - Sid: Enable IAM User Permissions
      Effect: Allow
      Principal:
       AWS: !Sub 'arn:aws:iam::${AWS::AccountId}:root'
      Action: 'kms:*'
      Resource: '*'
     - Sid: Allow S3 to use the key
      Effect: Allow
      Principal:
       Service: s3.amazonaws.com
      Action:
       - 'kms:Decrypt'
       - 'kms:GenerateDataKey'
      Resource: '*'

 BucketEncryptionKeyAlias:
  Type: AWS::KMS::Alias
  Condition: IsHighSensitivity
  Properties:
   AliasName: !Sub 'alias/${BucketName}-key'
   TargetKeyId: !Ref BucketEncryptionKey

 # å®‰å…¨çš„S3 Bucket
 SecureS3Bucket:
  Type: AWS::S3::Bucket
  Properties:
   BucketName: !Ref BucketName

   # é˜»æ­¢å…¬å…±è®¿é—®
   PublicAccessBlockConfiguration:
    BlockPublicAcls: true
    BlockPublicPolicy: true
    IgnorePublicAcls: true
    RestrictPublicBuckets: true

   # å¯ç”¨ç‰ˆæœ¬æ§åˆ¶
   VersioningConfiguration:
    Status: Enabled

   # åŠ å¯†é…ç½®
   BucketEncryption:
    ServerSideEncryptionConfiguration:
     - ServerSideEncryptionByDefault:
       SSEAlgorithm: !If [IsHighSensitivity, 'aws:kms', 'AES256']
       KMSMasterKeyID: !If [IsHighSensitivity, !GetAtt BucketEncryptionKey.Arn, !Ref AWS::NoValue]
      BucketKeyEnabled: true

   # è®¿é—®æ—¥å¿—
   LoggingConfiguration:
    DestinationBucketName: !Ref LoggingBucket
    LogFilePrefix: !Sub '${BucketName}/'

   # ç”Ÿå‘½å‘¨æœŸç­–ç•¥
   LifecycleConfiguration:
    Rules:
     - Id: TransitionToIA
      Status: Enabled
      Transitions:
       - TransitionInDays: 90
        StorageClass: STANDARD_IA
     - Id: DeleteOldVersions
      Status: Enabled
      NoncurrentVersionExpirationInDays: 30

   # æ ‡ç­¾
   Tags:
    - Key: Environment
     Value: Production
    - Key: DataClassification
     Value: !Ref DataClassification
    - Key: ManagedBy
     Value: CloudFormation

 # Bucketç­–ç•¥ - å¼ºåˆ¶HTTPSå’ŒåŠ å¯†
 SecureS3BucketPolicy:
  Type: AWS::S3::BucketPolicy
  Properties:
   Bucket: !Ref SecureS3Bucket
   PolicyDocument:
    Statement:
     - Sid: DenyInsecureTransport
      Effect: Deny
      Principal: '*'
      Action: 's3:*'
      Resource:
       - !GetAtt SecureS3Bucket.Arn
       - !Sub '${SecureS3Bucket.Arn}/*'
      Condition:
       Bool:
        'aws:SecureTransport': false

     - Sid: DenyUnencryptedObjectUploads
      Effect: Deny
      Principal: '*'
      Action: 's3:PutObject'
      Resource: !Sub '${SecureS3Bucket.Arn}/*'
      Condition:
       StringNotEquals:
        's3:x-amz-server-side-encryption': !If [IsHighSensitivity, 'aws:kms', 'AES256']

 # æ—¥å¿—Bucket
 LoggingBucket:
  Type: AWS::S3::Bucket
  Properties:
   BucketName: !Sub '${BucketName}-logs'
   PublicAccessBlockConfiguration:
    BlockPublicAcls: true
    BlockPublicPolicy: true
    IgnorePublicAcls: true
    RestrictPublicBuckets: true
   LifecycleConfiguration:
    Rules:
     - Id: DeleteOldLogs
      Status: Enabled
      ExpirationInDays: 90

Outputs:
 BucketName:
  Description: Name of the secure S3 bucket
  Value: !Ref SecureS3Bucket

 BucketArn:
  Description: ARN of the secure S3 bucket
  Value: !GetAtt SecureS3Bucket.Arn

 EncryptionKeyId:
  Condition: IsHighSensitivity
  Description: KMS Key ID for bucket encryption
  Value: !Ref BucketEncryptionKey
```

å…³é”®é…ç½®è¯´æ˜ï¼š

- **æ•°æ®åˆ†ç±»é©±åŠ¨åŠ å¯†**ï¼šL1/L2 é«˜æ•æ„Ÿæ•°æ®ä½¿ç”¨ KMS åŠ å¯†,L3/L4 ä½¿ç”¨ S3 é»˜è®¤ AES256 åŠ å¯†ã€‚åˆ†ç±»æ ‡å‡†éœ€å‚è€ƒç»„ç»‡æ•°æ®åˆ†ç±»ç­–ç•¥ã€‚
- **å¼ºåˆ¶ HTTPS**:BucketPolicy æ‹’ç»é HTTPS è¯·æ±‚ï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚
- **å¼ºåˆ¶åŠ å¯†ä¸Šä¼ **ï¼šBucketPolicy æ‹’ç»æœªåŠ å¯†å¯¹è±¡ï¼Œç¡®ä¿æ‰€æœ‰æ•°æ®é™æ€åŠ å¯†ã€‚
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šå¯ç”¨ç‰ˆæœ¬æ§åˆ¶é˜²æ­¢è¯¯åˆ é™¤ï¼Œé…åˆç”Ÿå‘½å‘¨æœŸç­–ç•¥è‡ªåŠ¨æ¸…ç†æ—§ç‰ˆæœ¬(30 å¤©)ã€‚
- **è®¿é—®æ—¥å¿—**ï¼šæ‰€æœ‰è®¿é—®è®°å½•åˆ°ç‹¬ç«‹æ—¥å¿— Bucket,æ—¥å¿—ä¿ç•™ 90 å¤©(æ ¹æ®åˆè§„è¦æ±‚è°ƒæ•´)ã€‚

éªŒè¯æ–¹æ³•ï¼šéƒ¨ç½²æ¨¡æ¿åï¼Œå°è¯•é€šè¿‡ HTTP è®¿é—® Bucket,ç¡®è®¤ 403 æ‹’ç»ï¼›å°è¯•ä¸Šä¼ æœªåŠ å¯†å¯¹è±¡ï¼Œç¡®è®¤ 403 æ‹’ç»ï¼›æ£€æŸ¥ç‰ˆæœ¬æ§åˆ¶ä¸æ—¥å¿—é…ç½®ï¼Œç¡®è®¤ç¬¦åˆé¢„æœŸã€‚

---

## 5.7.4 å®¹å™¨é•œåƒå®‰å…¨

### é•œåƒç­¾åæ–¹æ¡ˆå¯¹æ¯”

å®¹å™¨é•œåƒç­¾åç”¨äºéªŒè¯é•œåƒå®Œæ•´æ€§ä¸æ¥æºå¯ä¿¡æ€§ï¼Œé˜²æ­¢ä¾›åº”é“¾æ”»å‡»ã€‚ä¸‹è¡¨å¯¹æ¯”ä¸»æµç­¾åæ–¹æ¡ˆï¼š

| æ–¹æ¡ˆ | Cosign | Notary (v1) | Notary v2 | Docker Content Trust |
|------|--------|-------------|-----------|---------------------|
| å¼€å‘è€… | Sigstore | CNCF | CNCF | Docker |
| æ ‡å‡† | è‡ªæœ‰ | TUF | OCI æ ‡å‡† | TUF |
| å¯†é’¥ç®¡ç† | çµæ´» | å¤æ‚ | ç®€åŒ– | Docker Hub |
| OCI æ”¯æŒ | æ˜¯ | å¦ | æ˜¯ | æœ‰é™ |
| Kubernetes é›†æˆ | æ˜“ | ä¸­ | æ˜“ | éš¾ |
| å­¦ä¹ æ›²çº¿ | ä½ | é«˜ | ä¸­ | ä¸­ |
| ç¤¾åŒºæ´»è·ƒåº¦ | é«˜ | ä½(å·²åºŸå¼ƒ) | ä¸­ | ä½ |
| æ¨èåº¦ | æ¨è | ä¸æ¨è | æ¨è | ä¸æ¨è |

é€‰å‹å»ºè®®ï¼š

- **æ–°é¡¹ç›®ä¼˜å…ˆ Cosign**:å­¦ä¹ æ›²çº¿ä½ã€ç¤¾åŒºæ´»è·ƒã€æ”¯æŒ Keyless ç­¾å(åŸºäº OIDC,æ— éœ€ç®¡ç†ç§é’¥)ã€‚
- **OCI ç”Ÿæ€ä¼˜å…ˆ Notary v2**:ç¬¦åˆ OCI æ ‡å‡†ï¼Œé•¿æœŸæ”¯æŒæœ‰ä¿éšœï¼Œä½†å½“å‰ç”Ÿæ€ä¸å¦‚ Cosign æˆç†Ÿã€‚
- **é¿å… Notary v1 ä¸ Docker Content Trust**:å·²åºŸå¼ƒæˆ–ä»…é™ Docker Hub,ä¸é€‚åˆæ–°é¡¹ç›®ã€‚

### Cosign å®æˆ˜

Cosign æ˜¯ Sigstore é¡¹ç›®çš„æ ¸å¿ƒå·¥å…·ï¼Œæ”¯æŒå¯†é’¥å¯¹ç­¾åä¸ Keyless ç­¾åä¸¤ç§æ¨¡å¼ã€‚

**å®‰è£…ä¸å¯†é’¥ç”Ÿæˆ**ï¼š

```bash
# å®‰è£…Cosign
brew install cosign

# ç”Ÿæˆå¯†é’¥å¯¹(å¯†ç ä¿æŠ¤ç§é’¥)
cosign generate-key-pair

# å°†ç§é’¥å­˜å‚¨åˆ°Secret Manager(æ¨èç”Ÿäº§ç¯å¢ƒ)
aws secretsmanager create-secret \
 --name cosign-private-key \
 --secret-string file://cosign.key

# å°†å…¬é’¥åˆ†å‘ç»™éªŒè¯è€…(å¦‚Kubernetesé›†ç¾¤)
kubectl create secret generic cosign-pub-key \
 --from-file=cosign.pub=cosign.pub \
 -n kube-system
```

**é•œåƒç­¾å**ï¼š

```bash
# ç­¾åé•œåƒ(ä½¿ç”¨æœ¬åœ°ç§é’¥)
cosign sign --key cosign.key \
 myregistry.io/myapp:v1.0.0

# ä½¿ç”¨ç¯å¢ƒå˜é‡ç§é’¥(é€‚åˆCI/CD)
export COSIGN_PASSWORD=<password>
export COSIGN_KEY=$(cat cosign.key)
cosign sign --key env://COSIGN_KEY \
 myregistry.io/myapp:v1.0.0

# æ— å¯†é’¥ç­¾å(Keyless,ä½¿ç”¨OIDC,æ¨è)
cosign sign \
 --oidc-issuer=https://accounts.google.com \
 myregistry.io/myapp:v1.0.0

# éªŒè¯ç­¾å
cosign verify --key cosign.pub \
 myregistry.io/myapp:v1.0.0

# é™„åŠ attestation(å¦‚SBOMæˆ–SLSA Provenance)
cosign attest --key cosign.key \
 --predicate sbom.json \
 --type slsaprovenance \
 myregistry.io/myapp:v1.0.0
```

**CI/CD é›†æˆç¤ºä¾‹ï¼ˆGitHub Actions)**:

```yaml
# GitHub Actions
name: Build and Sign Image

jobs:
 build-sign:
  runs-on: ubuntu-latest
  permissions:
   contents: read
   packages: write
   id-token: write # OIDCç­¾åå¿…éœ€

  steps:
   - uses: actions/checkout@v4

   - name: Install Cosign
    uses: sigstore/cosign-installer@v3

   - name: Build Image
    run: |
     docker build -t ghcr.io/${{ github.repository }}:${{ github.sha }} .

   - name: Login to GHCR
    uses: docker/login-action@v3
    with:
     registry: ghcr.io
     username: ${{ github.actor }}
     password: ${{ secrets.GITHUB_TOKEN }}

   - name: Push Image
    run: |
     docker push ghcr.io/${{ github.repository }}:${{ github.sha }}

   # Keylessç­¾å(æ— éœ€ç®¡ç†ç§é’¥)
   - name: Sign Image
    run: |
     cosign sign --yes \
      ghcr.io/${{ github.repository }}:${{ github.sha }}

   # ç”ŸæˆSBOMå¹¶é™„åŠ åˆ°é•œåƒ
   - name: Generate SBOM
    uses: anchore/sbom-action@v0
    with:
     image: ghcr.io/${{ github.repository }}:${{ github.sha }}
     format: spdx-json
     output-file: sbom.spdx.json

   - name: Attest SBOM
    run: |
     cosign attest --yes \
      --predicate sbom.spdx.json \
      --type spdxjson \
      ghcr.io/${{ github.repository }}:${{ github.sha }}
```

å…³é”®é…ç½®ï¼š

- **Keyless ç­¾å**:ä½¿ç”¨ GitHub OIDC Token ç­¾åï¼Œæ— éœ€ç®¡ç†ç§é’¥ï¼Œé™ä½å¯†é’¥æ³„éœ²é£é™©ã€‚`--yes`å‚æ•°è·³è¿‡äº¤äº’ç¡®è®¤(é€‚åˆ CI/CD)ã€‚
- **SBOM é™„åŠ **:å°† Syft ç”Ÿæˆçš„ SBOM ä½œä¸º Attestation é™„åŠ åˆ°é•œåƒï¼Œä¾›ä¸‹æ¸¸éªŒè¯ä¸å®¡è®¡ã€‚
- **æƒé™æœ€å°åŒ–**:`id-token: write`æƒé™ä»…ç”¨äº OIDC Token ç”Ÿæˆ,`packages: write`ç”¨äºæ¨é€é•œåƒã€‚

### Kubernetes å‡†å…¥æ§åˆ¶ - éªŒè¯ç­¾å

ç­¾åéªŒè¯éœ€è¦åœ¨ Kubernetes å‡†å…¥é˜¶æ®µæ‰§è¡Œï¼Œé˜»æ­¢æœªç­¾åæˆ–ç­¾åæ— æ•ˆçš„é•œåƒéƒ¨ç½²ã€‚ä¸¤ç§å®ç°æ–¹å¼ï¼š

**æ–¹å¼ä¸€ï¼šä½¿ç”¨ Sigstore Policy Controller**:

```yaml
# Policy Controller (Sigstore) é…ç½®
apiVersion: policy.sigstore.dev/v1beta1
kind: ClusterImagePolicy
metadata:
 name: require-signed-images
spec:
 images:
  - glob: "myregistry.io/**"
 authorities:
  - key:
    data: |
     -----BEGIN PUBLIC KEY-----
     <cosign public key content>
     -----END PUBLIC KEY-----
```

éƒ¨ç½² Policy Controller:

```bash
kubectl apply -f https://github.com/sigstore/policy-controller/releases/latest/download/policy-controller.yaml
```

éªŒè¯æ–¹æ³•ï¼šå°è¯•éƒ¨ç½²æœªç­¾åé•œåƒï¼Œç¡®è®¤ Pod åˆ›å»ºå¤±è´¥å¹¶æç¤ºç­¾åéªŒè¯é”™è¯¯ï¼›éƒ¨ç½²å·²ç­¾åé•œåƒï¼Œç¡®è®¤ Pod æˆåŠŸåˆ›å»ºã€‚

**æ–¹å¼äºŒï¼šä½¿ç”¨ OPA Gatekeeper**(é€‚åˆå·²æœ‰ Gatekeeper ç¯å¢ƒ):

```yaml
apiVersion: templates.gatekeeper.sh/v1
kind: ConstraintTemplate
metadata:
 name: cosignimageverification
spec:
 crd:
  spec:
   names:
    kind: CosignImageVerification
 targets:
  - target: admission.k8s.gatekeeper.sh
   rego: |
    package cosignimageverification

    violation[{"msg": msg}] {
     container := input.review.object.spec.containers[_]
     not verified(container.image)
     msg := sprintf("Image %v is not signed", [container.image])
    }

    verified(image) {
     # è°ƒç”¨CosignéªŒè¯API (éœ€è¦sidecar)
     result := http.send({
      "method": "POST",
      "url": "http://cosign-verifier:8080/verify",
      "body": {"image": image}
     })
     result.status_code == 200
    }

---
apiVersion: constraints.gatekeeper.sh/v1beta1
kind: CosignImageVerification
metadata:
 name: require-cosign-signature
spec:
 match:
  kinds:
   - apiGroups: [""]
    kinds: ["Pod"]
  namespaces:
   - production
```

é€‚ç”¨è¾¹ç•Œï¼šGatekeeper æ–¹å¼éœ€è¦é¢å¤–éƒ¨ç½²éªŒè¯ Sidecar(è°ƒç”¨`cosign verify`),å¤æ‚åº¦é«˜äº Sigstore Policy Controller,ä½†é€‚åˆå·²æœ‰ Gatekeeper ç¯å¢ƒé¿å…å·¥å…·ç¢ç‰‡åŒ–ã€‚

### é•œåƒæ‰«æé›†æˆ

é•œåƒç­¾åéªŒè¯æ¥æºå¯ä¿¡æ€§ï¼Œé•œåƒæ‰«ææ£€æµ‹æ¼æ´ã€‚å®Œæ•´æµæ°´çº¿éœ€è¦ç»“åˆä¸¤è€…ï¼š

```yaml
# GitLab CI - å®Œæ•´é•œåƒå®‰å…¨æµæ°´çº¿
stages:
 - build
 - scan
 - sign
 - deploy

build-image:
 stage: build
 script:
  - docker build -t $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA .
  - docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA

# å¹¶è¡Œæ‰«æ(Trivy + Grype)æé«˜è¦†ç›–ç‡
trivy-scan:
 stage: scan
 image: aquasec/trivy:latest
 script:
  - trivy image --exit-code 1 --severity HIGH,CRITICAL \
    $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
 allow_failure: false

grype-scan:
 stage: scan
 image: anchore/grype:latest
 script:
  - grype $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA \
    --fail-on high
 allow_failure: false

# ç­¾å(ä»…ä¸»åˆ†æ”¯)
sign-image:
 stage: sign
 image: gcr.io/projectsigstore/cosign:latest
 script:
  - echo "$COSIGN_KEY" | cosign sign --key env://COSIGN_KEY \
    $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
 only:
  - main

deploy-production:
 stage: deploy
 script:
  - kubectl set image deployment/myapp \
    myapp=$CI_REGISTRY_IMAGE:$CI_COMMIT_SHA \
    -n production
 only:
  - main
 when: manual
```

å…³é”®å†³ç­–ï¼š

- **å¹¶è¡Œæ‰«æ**ï¼šTrivy ä¸ Grype å¹¶è¡Œæ‰§è¡Œï¼Œç¼©çŸ­æ€»æ‰«ææ—¶é—´(ä» 6 åˆ†é’Ÿé™è‡³ 4 åˆ†é’Ÿ)ã€‚
- **æ‰«æé˜»æ–­**:`--exit-code 1`ä¸`--fail-on high`ç¡®ä¿é«˜å±æ¼æ´é˜»æ–­æ„å»ºã€‚
- **ç­¾åæ¡ä»¶**ï¼šä»…ä¸»åˆ†æ”¯ç­¾åï¼Œé¿å…æ¯ä¸ª PR éƒ½ç”Ÿæˆç­¾åå¢åŠ  Registry å­˜å‚¨å‹åŠ›ã€‚

è¿è¡ŒæŒ‡æ ‡ï¼šæ‰«æ+ç­¾åæ€»æ—¶é•¿åº”â‰¤5 åˆ†é’Ÿ(ä¸­å‹é•œåƒï¼Œçº¦ 500MB);Critical æ¼æ´æ£€å‡ºç‡â‰¥95%(é€šè¿‡äººå·¥å¤æ ¸ç¡®è®¤)ã€‚

---

## 5.7.5 å®‰å…¨å·¦ç§»å®è·µ

### IDE æ’ä»¶é›†æˆ

å®‰å…¨å·¦ç§»å°†å®‰å…¨æ£€æŸ¥å‰ç½®åˆ°å¼€å‘é˜¶æ®µï¼Œå‡å°‘ä¿®å¤æˆæœ¬ã€‚IDE æ’ä»¶åœ¨ç¼–ç æ—¶å®æ—¶æç¤ºå®‰å…¨é—®é¢˜ï¼Œæé«˜å¼€å‘è€…å®‰å…¨æ„è¯†ã€‚

**VS Code å®‰å…¨æ’ä»¶æ¨è**:

```json
// .vscode/settings.json
{
 "extensions": {
  "recommendations": [
   "ms-azuretools.vscode-docker", // Dockeræ”¯æŒ
   "redhat.vscode-yaml", // YAMLéªŒè¯
   "hashicorp.terraform", // Terraformè¯­æ³•
   "ms-python.python", // Python Linting
   "ms-vscode.vscode-json", // JSONéªŒè¯
   "trufflesecurity.trufflehog", // ç§˜å¯†æ‰«æ
   "snyk-security.snyk-vulnerability-scanner", // Snykæ‰«æ
   "sonarsource.sonarlint-vscode" // SonarLint
  ]
 },

 // SonarLinté…ç½®
 "sonarlint.connectedMode.project": {
  "projectKey": "my-project"
 },

 // Snyké…ç½®
 "snyk.severity": "high",

 // TruffleHogé…ç½®
 "trufflehog.scanOnSave": true
}
```

å…³é”®é…ç½®ï¼š

- **SonarLint è¿æ¥æ¨¡å¼**:è¿æ¥ SonarQube æœåŠ¡å™¨ï¼ŒåŒæ­¥ Quality Profile ä¸è§„åˆ™ï¼Œç¡®ä¿ IDE æ£€æŸ¥ä¸ CI/CD ä¸€è‡´ã€‚
- **TruffleHog ä¿å­˜æ—¶æ‰«æ**:ä¿å­˜æ–‡ä»¶æ—¶è‡ªåŠ¨æ‰«æç§˜å¯†ï¼Œå³æ—¶æç¤ºå¼€å‘è€…ã€‚

éªŒè¯æ–¹æ³•ï¼šåœ¨ä»£ç ä¸­ç¡¬ç¼–ç  API å¯†é’¥ï¼Œä¿å­˜æ–‡ä»¶ï¼Œç¡®è®¤ TruffleHog æ’ä»¶é«˜äº®æ˜¾ç¤ºå¹¶æç¤ºç§»é™¤ï¼›ä¿®å¤åé‡æ–°ä¿å­˜ï¼Œç¡®è®¤æç¤ºæ¶ˆå¤±ã€‚

### Pre-commit Hooks

Pre-commit Hooks åœ¨æäº¤å‰è‡ªåŠ¨æ‰§è¡Œæ£€æŸ¥ï¼Œé˜²æ­¢é—®é¢˜ä»£ç è¿›å…¥ä»“åº“ã€‚ä½¿ç”¨[pre-commit](https://pre-commit.com/)æ¡†æ¶ç»Ÿä¸€ç®¡ç†:

```yaml
# .pre-commit-config.yaml
repos:
 # ç§˜å¯†æ‰«æ
 - repo: https://github.com/trufflesecurity/trufflehog
  rev: v3.63.0
  hooks:
   - id: trufflehog
    args: ['filesystem', '--directory', '.', '--fail']

 # Terraformæ‰«æ
 - repo: https://github.com/antonbabenko/pre-commit-terraform
  rev: v1.86.0
  hooks:
   - id: terraform_fmt
   - id: terraform_validate
   - id: terraform_tfsec
    args:
     - --args=--minimum-severity=MEDIUM

 # Pythonä»£ç è´¨é‡
 - repo: https://github.com/psf/black
  rev: 23.12.1
  hooks:
   - id: black

 - repo: https://github.com/pycqa/bandit
  rev: 1.7.5
  hooks:
   - id: bandit
    args: ['-r', 'src/', '-ll']

 # YAML Lint
 - repo: https://github.com/adrienverge/yamllint
  rev: v1.33.0
  hooks:
   - id: yamllint

 # Dockerfile Linting
 - repo: https://github.com/hadolint/hadolint
  rev: v2.12.0
  hooks:
   - id: hadolint

 # æäº¤æ¶ˆæ¯éªŒè¯
 - repo: https://github.com/commitizen-tools/commitizen
  rev: v3.13.0
  hooks:
   - id: commitizen
    stages: [commit-msg]
```

å®‰è£…ä¸ä½¿ç”¨ï¼š

```bash
# å®‰è£…pre-commit
pip install pre-commit

# å®‰è£…Hooksåˆ°.git/hooks/
pre-commit install

# æ‰‹åŠ¨è¿è¡Œæ‰€æœ‰Hooks(æµ‹è¯•é…ç½®)
pre-commit run --all-files
```

éªŒè¯æ–¹æ³•ï¼šä¿®æ”¹ Terraform æ–‡ä»¶å¼•å…¥å®‰å…¨é£é™©ï¼Œæ‰§è¡Œ`git commit`,ç¡®è®¤ Pre-commit Hook é˜»æ­¢æäº¤å¹¶æ˜¾ç¤º tfsec æŠ¥å‘Š;ä¿®å¤åé‡æ–°æäº¤ï¼Œç¡®è®¤é€šè¿‡ã€‚

å¸¸è§è¯¯åŒºï¼šPre-commit Hook æ‰§è¡Œæ—¶é—´è¿‡é•¿(>30 ç§’)å¯¼è‡´å¼€å‘è€…è·³è¿‡æ£€æŸ¥(`git commit --no-verify`),éœ€ä¼˜åŒ– Hook æ€§èƒ½æˆ–ä»…æ‰§è¡Œå¿«é€Ÿæ£€æŸ¥ï¼Œå®Œæ•´æ£€æŸ¥æ”¾åˆ° CI/CDã€‚

### å¼€å‘è€…å®‰å…¨åŸ¹è®­è®¡åˆ’

å·¥å…·ä»…æ˜¯æ‰‹æ®µï¼Œå¼€å‘è€…å®‰å…¨æ„è¯†æ˜¯æ ¹æœ¬ã€‚å»ºç«‹åˆ†çº§åŸ¹è®­ä½“ç³»ï¼Œé€æ­¥æå‡å›¢é˜Ÿèƒ½åŠ›ï¼š

**Level 1:åŸºç¡€å®‰å…¨æ„è¯†(å…¥èŒç¬¬ 1 å‘¨)**

ç›®æ ‡ï¼šå»ºç«‹åŸºç¡€å®‰å…¨æ„è¯†ï¼Œäº†è§£å¸¸è§å¨èƒã€‚

åŸ¹è®­å†…å®¹ï¼š
- OWASP Top 10(Web åº”ç”¨)
- äº‘å®‰å…¨åŸºç¡€(å…±äº«è´£ä»»æ¨¡å‹)
- ç§˜å¯†ç®¡ç†(ä¸æäº¤å¯†ç /å¯†é’¥)
- å®‰å…¨ç¼–ç åŸåˆ™
- å…¬å¸å®‰å…¨æ”¿ç­–

è€ƒæ ¸æ–¹å¼ï¼šåœ¨çº¿æµ‹è¯•(80 åˆ†åŠæ ¼)ã€å®é™…æ¡ˆä¾‹åˆ†æã€‚

åŸ¹è®­æ—¶é•¿ï¼š4 å°æ—¶(çº¿ä¸Šè§†é¢‘)ã€‚

**Level 2:å®‰å…¨å·¥å…·ä½¿ç”¨(å…¥èŒç¬¬ 2 å‘¨)**

ç›®æ ‡ï¼šç†Ÿç»ƒä½¿ç”¨å®‰å…¨å·¥å…·ï¼Œé›†æˆåˆ°æ—¥å¸¸å¼€å‘ã€‚

åŸ¹è®­å†…å®¹ï¼š
- IDE å®‰å…¨æ’ä»¶å®‰è£…ä¸é…ç½®
- Pre-commit hooks è®¾ç½®
- SAST å·¥å…·ä½¿ç”¨ï¼ˆSonarLint)
- SCA å·¥å…·ä½¿ç”¨ï¼ˆSnyk)
- å®¹å™¨æ‰«æï¼ˆTrivy)
- IaC æ‰«æï¼ˆCheckov/tfsec)

å®æ“ç»ƒä¹ ï¼š
- ä¿®å¤ 5 ä¸ª SAST å‘ç°çš„é—®é¢˜
- æ‰«æå¹¶ä¿®å¤ä¾èµ–æ¼æ´
- é€šè¿‡ pre-commit æ£€æŸ¥

åŸ¹è®­æ—¶é•¿ï¼š4 å°æ—¶(åŠ¨æ‰‹å®éªŒ)ã€‚

**Level 3:å®‰å…¨å¼€å‘å®è·µ(ç¬¬ 1 ä¸ªæœˆ)**

ç›®æ ‡ï¼šæŒæ¡å®‰å…¨å¼€å‘ç”Ÿå‘½å‘¨æœŸï¼ˆSDL)ã€‚

åŸ¹è®­å†…å®¹ï¼š
- å¨èƒå»ºæ¨¡ï¼ˆSTRIDE)
- å®‰å…¨è®¾è®¡æ¨¡å¼
- è¾“å…¥éªŒè¯ä¸è¾“å‡ºç¼–ç 
- è®¤è¯ä¸æˆæƒæœ€ä½³å®è·µ
- åŠ å¯†å­˜å‚¨ä¸ä¼ è¾“
- å®‰å…¨æ—¥å¿—è®°å½•

é¡¹ç›®å®æˆ˜ï¼š
- å®Œæˆ 1 ä¸ªå®Œæ•´åŠŸèƒ½çš„å¨èƒå»ºæ¨¡
- é€šè¿‡å®‰å…¨ä»£ç å®¡æŸ¥

åŸ¹è®­æ—¶é•¿ï¼š8 å°æ—¶(åˆ† 2 å‘¨å®Œæˆ)ã€‚

**Level 4:äº‘å®‰å…¨ä¸“ç²¾(ç¬¬ 3 ä¸ªæœˆ)**

ç›®æ ‡ï¼šæˆä¸ºäº‘å®‰å…¨ä¸“å®¶ã€‚

åŸ¹è®­å†…å®¹ï¼š
- IAM æœ€å°æƒé™è®¾è®¡
- ç½‘ç»œå®‰å…¨æ¶æ„
- æ•°æ®åŠ å¯†ä¸å¯†é’¥ç®¡ç†
- å®¹å™¨ä¸ Kubernetes å®‰å…¨
- Serverless å®‰å…¨
- CI/CD å®‰å…¨æµæ°´çº¿

è®¤è¯è€ƒè¯•ï¼š
- AWS Security Specialty / Azure Security Engineer
- CKS(Certified Kubernetes Security Specialist)

åŸ¹è®­æ—¶é•¿ï¼š40 å°æ—¶(è‡ªå­¦+å®éªŒ)ã€‚

**æŒç»­å­¦ä¹ (æ¯å­£åº¦)**

å®‰å…¨æ¼”ç»ƒï¼š
- å‚åŠ å†…éƒ¨ CTF æ¯”èµ›
- Purple Team æ¼”ç»ƒ
- æ¼æ´èµé‡‘è®¡åˆ’

çŸ¥è¯†åˆ†äº«ï¼š
- å®‰å…¨æŠ€æœ¯åˆ†äº«ä¼š(æœˆåº¦)
- å®‰å…¨äº‹ä»¶æ¡ˆä¾‹å­¦ä¹ 
- è¡Œä¸šå®‰å…¨è¶‹åŠ¿

å·¥å…·æ›´æ–°ï¼š
- æ–°å·¥å…·è¯•ç”¨ä¸è¯„ä¼°
- å·¥å…·é…ç½®ä¼˜åŒ–
- è‡ªåŠ¨åŒ–è„šæœ¬å¼€å‘

éªŒè¯æ–¹æ³•ï¼šåŸ¹è®­å 3 ä¸ªæœˆç»Ÿè®¡å¼€å‘è€…å¼•å…¥çš„å®‰å…¨æ¼æ´æ•°é‡ï¼Œç›®æ ‡ä¸‹é™ 50%;å­£åº¦å®‰å…¨æ„è¯†æµ‹è¯•é€šè¿‡ç‡â‰¥90%ã€‚

---

## 5.7.6 å®‰å…¨é—¨ç¦è®¾è®¡

### Quality Gate ç­–ç•¥

Quality Gate å®šä¹‰å‘å¸ƒå‰å¿…é¡»æ»¡è¶³çš„å®‰å…¨è´¨é‡æ ‡å‡†ã€‚ä¸‹è¡¨åˆ—å‡ºå…¸å‹æ£€æŸ¥é¡¹ä¸é˜»æ–­ç­–ç•¥ï¼š

| æ£€æŸ¥é¡¹ | é˜»æ–­ | è­¦å‘Š | é€šè¿‡æ¡ä»¶ | ä¿®å¤ SLA |
|--------|------|------|---------|---------|
| Critical æ¼æ´ | æ˜¯ | | 0 ä¸ª | ç«‹å³ |
| High æ¼æ´ï¼ˆSAST) | æ˜¯ | | â‰¤è®¾å®šé˜ˆå€¼ | 7 å¤© |
| High æ¼æ´ï¼ˆSCA) | | æ˜¯ | â‰¤è®¾å®šé˜ˆå€¼ | 30 å¤© |
| ç§˜å¯†æ³„éœ² | æ˜¯ | | 0 ä¸ª | ç«‹å³ |
| ä»£ç è¦†ç›–ç‡ | | æ˜¯ | â‰¥è®¾å®šåŸºçº¿ | - |
| ä»£ç é‡å¤ç‡ | | æ˜¯ | â‰¤è®¾å®šé˜ˆå€¼ | - |
| IaC åˆè§„ | æ˜¯ | | â‰¥è®¾å®šåŸºçº¿ | 14 å¤© |
| å®¹å™¨é«˜å±æ¼æ´ | æ˜¯ | | 0 ä¸ª | 7 å¤© |
| License åˆè§„ | | æ˜¯ | æ—  GPL | - |

è¯´æ˜ï¼š

- **é€šè¿‡æ¡ä»¶**ï¼šè¡¨æ ¼ä¸­"â‰¤è®¾å®šé˜ˆå€¼""â‰¥è®¾å®šåŸºçº¿"ä¸ºæŠ½è±¡æè¿°ï¼Œå®é™…å€¼éœ€æ ¹æ®ç»„ç»‡é£é™©å®¹å¿åº¦ä¸å†å²åŸºçº¿ç¡®å®šã€‚ä¾‹å¦‚ High SAST æ¼æ´é˜ˆå€¼å¯èƒ½ä¸º 5 ä¸ª(å°å‹å›¢é˜Ÿ)æˆ– 20 ä¸ª(å¤§å‹é—ç•™ç³»ç»Ÿ),éœ€é€šè¿‡é¦–æ¬¡æ‰«æç»“æœç¡®å®šå¯æ¥å—åŸºçº¿ã€‚
- **ä¿®å¤ SLA**:Critical æ¼æ´è¦æ±‚ç«‹å³ä¿®å¤(24 å°æ—¶å†…),High æ¼æ´æ ¹æ®ç±»å‹åŒºåˆ†ï¼ˆSAST 7 å¤©ã€SCA 30 å¤©ï¼Œå›  SCA ä¿®å¤éœ€ç­‰å¾…ä¸Šæ¸¸è¡¥ä¸)ã€‚
- **è­¦å‘Š vs é˜»æ–­**:ä»£ç è¦†ç›–ç‡ã€é‡å¤ç‡ç­‰è´¨é‡æŒ‡æ ‡ä»…è­¦å‘Šä¸é˜»æ–­ï¼Œé¿å…å½±å“ç´§æ€¥å‘å¸ƒï¼›å®‰å…¨æ¼æ´æ ¹æ®ä¸¥é‡æ€§åˆ†çº§å¤„ç†ã€‚

å¸¸è§è¯¯åŒºï¼šä¸€åˆ€åˆ‡è®¾ç½®æ‰€æœ‰ High æ¼æ´é˜»æ–­ï¼Œå¯¼è‡´é—ç•™ç³»ç»Ÿæ— æ³•é€šè¿‡é—¨ç¦ï¼Œéœ€è¦å¤§é‡ä¾‹å¤–ç”³è¯·ï¼›æœªå®šæœŸå®¡æŸ¥åŸºçº¿ï¼Œå¯¼è‡´åŸºçº¿å¤±æ•ˆ(å¦‚ä»£ç è¦†ç›–ç‡ä» 80%é€æ­¥ä¸‹æ»‘è‡³ 60%ä½†æ— äººå…³æ³¨)ã€‚

### SonarQube Quality Gate é…ç½®

SonarQube æ˜¯ä¸»æµ SAST å·¥å…·ï¼Œé€šè¿‡ Quality Gate å¼ºåˆ¶æ‰§è¡Œä»£ç è´¨é‡æ ‡å‡†ã€‚é…ç½®ç¤ºä¾‹ï¼š

```json
{
 "name": "Production Quality Gate",
 "conditions": [
  {
   "metric": "new_vulnerabilities",
   "operator": "GREATER_THAN",
   "error": "0"
  },
  {
   "metric": "new_security_hotspots",
   "operator": "GREATER_THAN",
   "error": "3"
  },
  {
   "metric": "new_bugs",
   "operator": "GREATER_THAN",
   "error": "10"
  },
  {
   "metric": "new_code_smells",
   "operator": "GREATER_THAN",
   "error": "50"
  },
  {
   "metric": "new_coverage",
   "operator": "LESS_THAN",
   "error": "80"
  },
  {
   "metric": "new_duplicated_lines_density",
   "operator": "GREATER_THAN",
   "error": "3"
  }
 ]
}
```

å…³é”®å†³ç­–ï¼š

- **å…³æ³¨æ–°å¢é—®é¢˜**:ä½¿ç”¨`new_*`æŒ‡æ ‡ä»…æ£€æŸ¥ PR æ–°å¢é—®é¢˜ï¼Œé¿å…å†å²å€ºåŠ¡é˜»æ–­å½“å‰äº¤ä»˜ã€‚
- **Security Hotspots é˜ˆå€¼**:å…è®¸â‰¤3 ä¸ª Security Hotspots(éœ€äººå·¥å®¡æŸ¥çš„æ½œåœ¨é£é™©ç‚¹),é¿å…è¿‡åº¦é˜»æ–­ã€‚
- **è¦†ç›–ç‡åŸºçº¿**:æ–°å¢ä»£ç è¦†ç›–ç‡â‰¥80%,å­˜é‡ä»£ç ä¸å—é™(é€šè¿‡`new_coverage`å®ç°)ã€‚

éªŒè¯æ–¹æ³•ï¼šæäº¤åŒ…å« SQL æ³¨å…¥æ¼æ´çš„ PR,ç¡®è®¤ SonarQube æ£€æµ‹åˆ°`new_vulnerabilities`å¹¶é˜»æ–­;ä¿®å¤åé‡æ–°æäº¤ï¼Œç¡®è®¤ Quality Gate é€šè¿‡ã€‚

### é—¨ç¦å†³ç­–æµç¨‹

é—¨ç¦å†³ç­–æµç¨‹å®šä¹‰å®‰å…¨æ£€æŸ¥çš„æ‰§è¡Œé¡ºåºä¸åˆ†æ”¯é€»è¾‘ï¼š

```
    Pipelineæ‰§è¡Œ
     |
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  |              |
 Security Scan     Quality Check
  |              |
 â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
 |      |      |        |
SAST/SCA  IaC Scan  Coverage   Code Quality
 |      |      |        |
 â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
    |              |
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           |
       Quality Gateè¯„ä¼°
           |
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    |              |
   æœ‰é˜»æ–­çº§é—®é¢˜?       æ— é—®é¢˜
    |              |
  â”Œâ”€â”€â”€â”´â”€â”€â”€â”          é€šè¿‡
  |    |          |
 Critical High        éƒ¨ç½²
  |    |
  é˜»æ–­  è­¦å‘Š+é€šçŸ¥
  |    |
  å¤±è´¥  è®°å½•æŠ€æœ¯å€º
```

æµç¨‹è¯´æ˜ï¼š

1. **å¹¶è¡Œæ‰«æé˜¶æ®µ**:SAST/SCA/IaC æ‰«æå¹¶è¡Œæ‰§è¡Œ,Coverage ä¸ Code Quality æ£€æŸ¥å¹¶è¡Œæ‰§è¡Œï¼Œç¼©çŸ­æ€»æ—¶é•¿ã€‚
2. **Quality Gate è¯„ä¼°é˜¶æ®µ**:æ±‡æ€»æ‰€æœ‰æ‰«æç»“æœï¼Œæ ¹æ®é˜»æ–­ç­–ç•¥è¡¨åˆ¤æ–­æ˜¯å¦é€šè¿‡ã€‚
3. **åˆ†æ”¯å†³ç­–**:Critical é—®é¢˜å¼ºåˆ¶é˜»æ–­ï¼Œæ„å»ºå¤±è´¥;High é—®é¢˜ç”Ÿæˆè­¦å‘Šå¹¶é€šçŸ¥å›¢é˜Ÿï¼Œæ„å»ºé€šè¿‡ä½†è®°å½•æŠ€æœ¯å€ºï¼›æ— é—®é¢˜ç›´æ¥é€šè¿‡ã€‚

éªŒè¯æ–¹æ³•ï¼šæ¨¡æ‹Ÿä¸åŒåœºæ™¯(ä»… Critical æ¼æ´ã€ä»… High æ¼æ´ã€æ— æ¼æ´),ç¡®è®¤æµç¨‹æŒ‰é¢„æœŸåˆ†æ”¯æ‰§è¡Œã€‚

---

## 5.7.7 SAST/DAST/SCA é›†æˆ

### å·¥å…·å¯¹æ¯”çŸ©é˜µ

SAST(é™æ€åº”ç”¨å®‰å…¨æµ‹è¯•)ã€DAST(åŠ¨æ€åº”ç”¨å®‰å…¨æµ‹è¯•)ã€SCA(è½¯ä»¶æˆåˆ†åˆ†æ)è¦†ç›–è½¯ä»¶ç”Ÿå‘½å‘¨æœŸä¸åŒé˜¶æ®µï¼Œéœ€è¦ç»„åˆä½¿ç”¨ã€‚

**SAST å·¥å…·å¯¹æ¯”**:

| å·¥å…· | è¯­è¨€æ”¯æŒ | è¯¯æŠ¥ç‡ | é›†æˆéš¾åº¦ | æœ€ä½³åœºæ™¯ |
|------|---------|--------|---------|----------|
| SonarQube | 25+ | ä¸­ | æ˜“ | é€šç”¨ |
| Checkmarx | 30+ | ä½ | ä¸­ | ä¼ä¸šçº§ |
| Snyk Code | 10+ | ä½ | æ˜“ | å¼€å‘è€…å‹å¥½ |
| CodeQL | 10+ | ä½ | ä¸­ | æ·±åº¦åˆ†æ |
| Semgrep | 20+ | ä¸­ | æ˜“ | è‡ªå®šä¹‰è§„åˆ™ |

**SCA å·¥å…·å¯¹æ¯”**:

| å·¥å…· | è¯­è¨€/åŒ…ç®¡ç† | CVE è¦†ç›– | License æ£€æŸ¥ | æœ€ä½³åœºæ™¯ |
|------|------------|---------|------------|----------|
| Snyk Open Source | 20+ | å¹¿ | æ˜¯ | å¼€å‘è€…é›†æˆ |
| MurphySecurityï¼ˆå¢¨è²å®‰å…¨ï¼‰ | 15+ | å¹¿ | æ˜¯ | å›½å†…ä¼ä¸šã€ä¿¡åˆ›åœºæ™¯ |
| WhiteSource | 200+ | æœ€å¹¿ | æ˜¯ | ä¼ä¸šçº§ |
| Black Duck | 25+ | å¹¿ | æ˜¯ | åˆè§„é‡ç‚¹ |
| Dependabot | 10+ | ä¸­ | å¦ | GitHub é›†æˆ |
| OWASP Dependency-Check | 10+ | ä¸­ | æ˜¯ | å¼€æºé¡¹ç›® |

**DAST å·¥å…·å¯¹æ¯”**:

| å·¥å…· | æ‰«æç±»å‹ | å‡†ç¡®ç‡ | CI/CD é›†æˆ | æœ€ä½³åœºæ™¯ |
|------|---------|--------|----------|----------|
| OWASP ZAP | ä¸»åŠ¨/è¢«åŠ¨ | ä¸­ | æ˜“ | å¼€æºé¡¹ç›® |
| Burp Suite | ä¸»åŠ¨ | é«˜ | éš¾ | æ‰‹å·¥æµ‹è¯• |
| Acunetix | ä¸»åŠ¨ | é«˜ | ä¸­ | ä¼ä¸š Web åº”ç”¨ |
| Netsparker | ä¸»åŠ¨ | é«˜ | æ˜“ | è‡ªåŠ¨åŒ–æ‰«æ |
| StackHawk | ä¸»åŠ¨ | ä¸­ | æ˜“ | DevSecOps |

é€‰å‹å»ºè®®ï¼š

- **é¢„ç®—æœ‰é™**ï¼šSAST é€‰ SonarQube(å¼€æºç‰ˆ),SCA é€‰ OWASP Dependency-Check,DAST é€‰ OWASP ZAPã€‚
- **å¼€å‘è€…ä½“éªŒä¼˜å…ˆ**ï¼šSAST é€‰ Snyk Code,SCA é€‰ Snyk Open Source,DAST é€‰ StackHawk(ä¸“ä¸º CI/CD ä¼˜åŒ–)ã€‚
- **ä¼ä¸šçº§æ”¯æŒ**ï¼šSAST é€‰ Checkmarx,SCA é€‰ WhiteSource/Black Duck,DAST é€‰ Acunetix/Netsparkerã€‚

å¸¸è§è¯¯åŒºï¼šä»…ä¾èµ–å•ä¸€å·¥å…·ç±»å‹(å¦‚ä»… SAST),æ— æ³•è¦†ç›–è¿è¡Œæ—¶æ¼æ´(éœ€ DASTï¼‰ä¸ä¾èµ–åº“æ¼æ´(éœ€ SCA);å·¥å…·è¿‡å¤šå¯¼è‡´å‘Šè­¦ç–²åŠ³ï¼Œéœ€é€šè¿‡èšåˆå¹³å°(å¦‚ Defect Dojoï¼‰ç»Ÿä¸€ç®¡ç†ã€‚

### å®Œæ•´å®‰å…¨æ‰«ææµæ°´çº¿

ä»¥ä¸‹ GitLab CI æµæ°´çº¿é›†æˆ SASTã€SCAã€DAST ä¸å®¹å™¨æ‰«æï¼Œå±•ç¤ºå®Œæ•´ DevSecOps å®è·µï¼š

```yaml
# .gitlab-ci.yml - å®Œæ•´å®‰å…¨æ‰«ææµæ°´çº¿
stages:
 - pre-commit
 - sast
 - build
 - sca
 - container-scan
 - deploy-staging
 - dast
 - report

variables:
 SECURE_LOG_LEVEL: info

# ==================== Pre-commitæ£€æŸ¥ ====================
secret-scan:
 stage: pre-commit
 image: trufflesecurity/trufflehog:latest
 script:
  - trufflehog filesystem . --json --fail
 allow_failure: false

# ==================== SASTæ‰«æ ====================
sonarqube-sast:
 stage: sast
 image: sonarsource/sonar-scanner-cli:latest
 script:
  - sonar-scanner
   -Dsonar.projectKey=$CI_PROJECT_NAME
   -Dsonar.sources=src
   -Dsonar.host.url=$SONAR_HOST_URL
   -Dsonar.login=$SONAR_TOKEN
   -Dsonar.qualitygate.wait=true
 allow_failure: false
 only:
  - merge_requests
  - main

semgrep-sast:
 stage: sast
 image: returntocorp/semgrep:latest
 script:
  - semgrep ci --config auto --sarif > semgrep-report.sarif
 artifacts:
  reports:
   sast: semgrep-report.sarif
 allow_failure: true

# ==================== æ„å»º ====================
build-app:
 stage: build
 script:
  - mvn clean package -DskipTests
 artifacts:
  paths:
   - target/*.jar

# ==================== SCAä¾èµ–æ‰«æ ====================
snyk-sca:
 stage: sca
 image: snyk/snyk:node
 script:
  - snyk test
   --severity-threshold=high
   --json > snyk-report.json
 artifacts:
  reports:
   dependency_scanning: snyk-report.json
 allow_failure: true

dependency-check:
 stage: sca
 image: owasp/dependency-check:latest
 script:
  - /usr/share/dependency-check/bin/dependency-check.sh
   --project $CI_PROJECT_NAME
   --scan .
   --format JSON
   --out dependency-check-report.json
   --failOnCVSS 7
 artifacts:
  paths:
   - dependency-check-report.json
 allow_failure: true

# ==================== å®¹å™¨é•œåƒæ‰«æ ====================
build-image:
 stage: container-scan
 image: docker:latest
 services:
  - docker:dind
 before_script:
  - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
 script:
  - docker build -t $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA .
  - docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA

trivy-scan:
 stage: container-scan
 image: aquasec/trivy:latest
 script:
  - trivy image
   --exit-code 1
   --severity HIGH,CRITICAL
   --format sarif
   --output trivy-report.sarif
   $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
 artifacts:
  reports:
   container_scanning: trivy-report.sarif
 allow_failure: false

grype-scan:
 stage: container-scan
 image: anchore/grype:latest
 script:
  - grype $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
   --fail-on high
   --output json
   --file grype-report.json
 artifacts:
  paths:
   - grype-report.json
 allow_failure: true

# ==================== éƒ¨ç½²åˆ°Staging ====================
deploy-staging:
 stage: deploy-staging
 script:
  - kubectl set image deployment/myapp
   myapp=$CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
   -n staging
  - kubectl rollout status deployment/myapp -n staging
 environment:
  name: staging
  url: https://staging.myapp.com
 only:
  - main

# ==================== DASTåŠ¨æ€æ‰«æ ====================
zap-dast:
 stage: dast
 image: owasp/zap2docker-stable:latest
 script:
  - mkdir -p /zap/wrk
  - zap-baseline.py
   -t https://staging.myapp.com
   -r zap-baseline-report.html
   -J zap-baseline-report.json
   -w zap-baseline-report.md
   || true # ä¸é˜»æ–­æ„å»º
 artifacts:
  paths:
   - zap-baseline-report.html
   - zap-baseline-report.json
 only:
  - main
 when: manual

# ==================== å®‰å…¨æŠ¥å‘Šæ±‡æ€» ====================
security-report:
 stage: report
 image: python:3.11
 script:
  - |
   python3 <<'EOF'
   import json
   from pathlib import Path

   reports = {
    'sast': 'semgrep-report.sarif',
    'sca': 'snyk-report.json',
    'container': 'trivy-report.sarif',
    'dast': 'zap-baseline-report.json'
   }

   summary = {
    'total_issues': 0,
    'critical': 0,
    'high': 0,
    'medium': 0,
    'low': 0
   }

   for scan_type, report_file in reports.items():
    if Path(report_file).exists():
     # è§£ææŠ¥å‘Šå¹¶ç»Ÿè®¡(éœ€å®ç°è§£æé€»è¾‘)
     with open(report_file) as f:
      data = json.load(f)
      # ç®€åŒ–ç¤ºä¾‹:å®é™…éœ€æ ¹æ®æŠ¥å‘Šæ ¼å¼è§£æ
      summary['total_issues'] += 1

   print("="*50)
   print("Security Scan Summary")
   print("="*50)
   print(f"Total Issues: {summary['total_issues']}")
   print(f"Critical: {summary['critical']}")
   print(f"High: {summary['high']}")
   print(f"Medium: {summary['medium']}")
   print(f"Low: {summary['low']}")
   print("="*50)
   EOF
 dependencies:
  - semgrep-sast
  - snyk-sca
  - trivy-scan
  - zap-dast
 when: always
```

å…³é”®é…ç½®ï¼š

- **å¹¶è¡ŒåŒ–**ï¼šSAST é˜¶æ®µçš„ SonarQube ä¸ Semgrep å¹¶è¡Œ,SCA é˜¶æ®µçš„ Snyk ä¸ Dependency-Check å¹¶è¡Œï¼Œç¼©çŸ­æ€»æ—¶é•¿ã€‚
- **DAST æ‰‹åŠ¨è§¦å‘**:DAST æ‰«ææ—¶é—´é•¿(30 åˆ†é’Ÿè‡³æ•°å°æ—¶),è®¾ç½®`when: manual`é¿å…æ¯æ¬¡æäº¤éƒ½è§¦å‘ï¼Œä»…åœ¨ä¸»åˆ†æ”¯åˆå¹¶åæ‰‹åŠ¨æ‰§è¡Œã€‚
- **æŠ¥å‘Šèšåˆ**ï¼šsecurity-report é˜¶æ®µè§£ææ‰€æœ‰æ‰«ææŠ¥å‘Šï¼Œç”Ÿæˆç»Ÿä¸€æ‘˜è¦ï¼Œä¾¿äºç®¡ç†å±‚æŸ¥çœ‹æ•´ä½“å®‰å…¨æ€åŠ¿ã€‚

è¿è¡ŒæŒ‡æ ‡ï¼šå®Œæ•´æµæ°´çº¿(ä¸å« DASTï¼‰æ‰§è¡Œæ—¶é—´åº”â‰¤15 åˆ†é’Ÿ(ä¸­å‹ Java é¡¹ç›®);Critical æ¼æ´æ£€å‡ºç‡â‰¥90%(é€šè¿‡äººå·¥å¤æ ¸ç¡®è®¤)ã€‚

---

## 5.7.8 æ¼æ´ç®¡ç†æµç¨‹

### æ¼æ´ç”Ÿå‘½å‘¨æœŸ

æ¼æ´ç®¡ç†è¦†ç›–ä»å‘ç°åˆ°å…³é—­çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼š

```
å‘ç° â†’ åˆ†ç±» â†’ ä¼˜å…ˆçº§æ’åº â†’ åˆ†é… â†’ ä¿®å¤ â†’ éªŒè¯ â†’ å…³é—­
 |   |    |     |   |   |   |
 â†“   â†“    â†“     â†“   â†“   â†“   â†“
æ‰«æ ä¸¥é‡æ€§ é£é™©è¯„åˆ†  Owner Patch æµ‹è¯• å½’æ¡£
å·¥å…· CVSS  æš´éœ²åº¦   éƒ¨ç½² å¤æµ‹ æŠ¥å‘Š
```

å„é˜¶æ®µå…³é”®å†³ç­–ï¼š

**å‘ç°é˜¶æ®µ**ï¼šé€šè¿‡ SAST/SCA/DAST/å®¹å™¨æ‰«æç­‰å·¥å…·è‡ªåŠ¨å‘ç°ï¼Œæˆ–é€šè¿‡æ¸—é€æµ‹è¯•ã€æ¼æ´èµé‡‘æ‰‹åŠ¨å‘ç°ã€‚

**åˆ†ç±»é˜¶æ®µ**ï¼šæ ¹æ® CVSS è¯„åˆ†ï¼ˆCritical/High/Medium/Lowï¼‰åˆæ­¥åˆ†ç±»ã€‚å…³é”®çº¦æŸï¼šCVSS ä»…åæ˜ æ¼æ´æœ¬èº«ä¸¥é‡æ€§ï¼Œä¸è€ƒè™‘èµ„äº§æš´éœ²åº¦ä¸ä¸šåŠ¡å½±å“ï¼Œéœ€è¿›ä¸€æ­¥è¯„ä¼°ã€‚

**ä¼˜å…ˆçº§æ’åºé˜¶æ®µ**ï¼šåŸºäº CVSS è¯„åˆ†ã€æš´éœ²åº¦(å…¬ç½‘/å†…ç½‘)ã€å¯åˆ©ç”¨æ€§(æ˜¯å¦æœ‰ POC)ã€æ•°æ®æ•æ„Ÿåº¦åŠ¨æ€è°ƒæ•´ SLAã€‚è§ä¸‹æ–‡åŠ¨æ€ SLA è®¡ç®—é€»è¾‘ã€‚

**åˆ†é…é˜¶æ®µ**ï¼šæ ¹æ®ä»£ç ä»“åº“ CODEOWNERS æˆ–æœåŠ¡æ³¨å†Œä¿¡æ¯è‡ªåŠ¨åˆ†é…ä¿®å¤è´£ä»»äººï¼Œåˆ›å»º Jira/GitHub Issue å·¥å•ã€‚

**ä¿®å¤é˜¶æ®µ**ï¼šå¼€å‘å›¢é˜Ÿä¿®å¤æ¼æ´ï¼Œæäº¤ PR,é€šè¿‡ SAST/SCA é‡æ–°æ‰«æéªŒè¯ã€‚

**éªŒè¯é˜¶æ®µ**ï¼šå®‰å…¨å›¢é˜Ÿå¤æµ‹ç¡®è®¤æ¼æ´å·²ä¿®å¤ï¼Œæœªå¼•å…¥æ–°é—®é¢˜ã€‚

**å…³é—­é˜¶æ®µ**ï¼šå½’æ¡£æ¼æ´è¯¦æƒ…ã€ä¿®å¤è¡¥ä¸ã€éªŒè¯æŠ¥å‘Šï¼Œç”¨äºå®¡è®¡ä¸è¶‹åŠ¿åˆ†æã€‚

### æ¼æ´ SLA æ ‡å‡†

SLA å®šä¹‰æ¼æ´ä¿®å¤æ—¶é™ï¼Œé©±åŠ¨åŠæ—¶ä¿®å¤ã€‚ä¸‹è¡¨åˆ—å‡ºå…¸å‹ SLA æ ‡å‡†ï¼š

| ä¸¥é‡æ€§ | CVSS è¯„åˆ† | ä¿®å¤ SLA | å‡çº§è·¯å¾„ | ä¾‹å¤–å®¡æ‰¹ |
|--------|---------|---------|---------|---------|
| Critical | 9.0-10.0 | 24 å°æ—¶ | ç«‹å³é€šçŸ¥ CISO | ä¸å…è®¸ |
| High | 7.0-8.9 | 7 å¤© | æ¯æ—¥æ›´æ–° | CISO å®¡æ‰¹ |
| Medium | 4.0-6.9 | 30 å¤© | æ¯å‘¨æ›´æ–° | å®‰å…¨è´Ÿè´£äºº |
| Low | 0.1-3.9 | 90 å¤© | æœˆåº¦æŠ¥å‘Š | å›¢é˜Ÿ Leader |

è¯´æ˜ï¼š

- **SLA åŸºçº¿**:è¡¨æ ¼ä¸­ SLA ä¸ºåŸºç¡€å€¼ï¼Œå®é™… SLA é€šè¿‡åŠ¨æ€è°ƒæ•´ç®—æ³•è®¡ç®—(è§ä¸‹æ–‡)ã€‚
- **å‡çº§è·¯å¾„**ï¼šCritical æ¼æ´è¶…æœŸç«‹å³å‡çº§è‡³ CISO,High æ¼æ´è¶…æœŸæ¯æ—¥å‡çº§æé†’ï¼Œé¿å…æ¼æ´è¢«é—å¿˜ã€‚
- **ä¾‹å¤–å®¡æ‰¹**ï¼šCritical æ¼æ´ä¸å…è®¸ä¾‹å¤–ï¼Œå¿…é¡»ä¿®å¤;High æ¼æ´éœ€ CISO å®¡æ‰¹ä¾‹å¤–(å¦‚ä¸šåŠ¡ç´§æ€¥å‘å¸ƒï¼Œæ¼æ´æš‚æ—¶è±å…)ã€‚

éªŒè¯æ–¹æ³•ï¼šç»Ÿè®¡å­£åº¦ SLA åˆè§„ç‡(æŒ‰æ—¶ä¿®å¤æ¼æ´æ•°Ã·æ¼æ´æ€»æ•°),ç›®æ ‡â‰¥90%;ç»Ÿè®¡å¹³å‡ä¿®å¤æ—¶é—´ï¼ˆMTTR),ç›®æ ‡æŒç»­ä¸‹é™ã€‚

### æ¼æ´ç®¡ç†è‡ªåŠ¨åŒ–

æ‰‹å·¥è¿½è¸ªæ•°ç™¾ä¸ªæ¼æ´å·¥å•æ•ˆç‡ä½ä¸‹ï¼Œéœ€è¦è‡ªåŠ¨åŒ–æµç¨‹ã€‚è‡ªåŠ¨åŒ–è¦†ç›–å››å¤§æ ¸å¿ƒç¯èŠ‚ï¼š

**ç¯èŠ‚ä¸€ï¼šå¤šæºæ¼æ´èšåˆ**ã€‚ä» Snykã€Trivyã€SonarQubeã€Dependabot ç­‰å·¥å…· API æŠ“å–æ¼æ´æ•°æ®ï¼Œç»Ÿä¸€æ±‡æ€»åˆ°å•ä¸€å¹³å°(å¦‚ Defect Dojo æˆ–è‡ªå»ºç³»ç»Ÿ)ã€‚å…³é”®æŒ‘æˆ˜ï¼šä¸åŒå·¥å…·æŠ¥å‘Šæ ¼å¼ä¸ä¸€è‡´ï¼Œéœ€è¦æ ‡å‡†åŒ–è§£æé€»è¾‘ï¼›åŒä¸€ CVE è¢«å¤šä¸ªå·¥å…·é‡å¤æ£€æµ‹ï¼Œéœ€è¦åŸºäº CVE ID+ç»„ä»¶+ç‰ˆæœ¬ä¸‰å…ƒç»„å»é‡ã€‚

**ç¯èŠ‚äºŒï¼šåŸºäºä¸šåŠ¡å½±å“çš„æ™ºèƒ½åˆ†çº§**ã€‚ä¸èƒ½ä»…ä¾èµ– CVSS è¯„åˆ†ï¼Œéœ€å åŠ èµ„äº§æš´éœ²åº¦ã€å·²çŸ¥åˆ©ç”¨æƒ…å†µã€æ•°æ®æ•æ„Ÿåº¦ç­‰ç»´åº¦åŠ¨æ€è°ƒæ•´ SLAã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª CVSS 7.5 çš„ SQL æ³¨å…¥æ¼æ´ï¼Œè‹¥å‘ç”Ÿåœ¨å…¬ç½‘æš´éœ²çš„æ”¯ä»˜æœåŠ¡(å¤„ç† PCI æ•°æ®),SLA ä»åŸºç¡€ 7 å¤©ç¼©çŸ­è‡³ 1.75 å¤©ï¼›è‹¥å‘ç”Ÿåœ¨å†…ç½‘ç®¡ç†å·¥å…·(æ— æ•æ„Ÿæ•°æ®),SLA ä¿æŒ 7 å¤©ã€‚åŠ¨æ€ SLA è®¡ç®—é€»è¾‘è§ä¸‹æ–‡ä»£ç ç¤ºä¾‹ã€‚

**ç¯èŠ‚ä¸‰ï¼šè‡ªåŠ¨åŒ–å·¥å•åˆ›å»ºä¸è´£ä»»åˆ†é…**ã€‚å½“ SAST å·¥å…·æ£€æµ‹åˆ°æŸå¾®æœåŠ¡çš„ Log4j æ¼æ´æ—¶ï¼Œè‡ªåŠ¨åŒ–è„šæœ¬é€šè¿‡æœåŠ¡åç§°æŸ¥è¯¢æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼ˆConsul/Eurekaï¼‰è·å–ä»£ç ä»“åº“ URL,è§£æ CODEOWNERS æ–‡ä»¶æ‰¾åˆ°è´Ÿè´£å›¢é˜Ÿï¼Œä» LDAP/AD è·å–å›¢é˜Ÿ Leader çš„ Jira è´¦å·ï¼Œè‡ªåŠ¨åˆ›å»ºå¸¦æœ‰æ˜ç¡® Assignee å’Œ Due Date çš„ Jira å·¥å•ã€‚å…³é”®çº¦æŸï¼šéœ€è¦ç»´æŠ¤æœåŠ¡åç§°ä¸ä»£ç ä»“åº“çš„æ˜ å°„å…³ç³»;CODEOWNERS æ–‡ä»¶éœ€è¦åŠæ—¶æ›´æ–°ï¼Œå¦åˆ™åˆ†é…é”™è¯¯ã€‚

**ç¯èŠ‚å››ï¼šSLA åˆè§„æ€§ç›‘æ§ä¸å‡çº§**ã€‚æ¯æ—¥å®šæ—¶ä»»åŠ¡æŸ¥è¯¢æ‰€æœ‰æœªé—­ç¯çš„å®‰å…¨æ¼æ´å·¥å•ï¼Œè®¡ç®—è·ç¦» Due Date çš„å‰©ä½™æ—¶é—´ï¼šå‰©ä½™æ—¶é—´<0(å·²è¶…æœŸ)å‘é€ Slack å‘Šè­¦è‡³å›¢é˜Ÿé¢‘é“å¹¶æŠ„é€ CISO,æ ‡è®°å·¥å•ä¸ºçº¢è‰²ï¼›å‰©ä½™æ—¶é—´<2 å¤©(ä¸´è¿‘æˆªæ­¢)å‘é€æ¯æ—¥æé†’é‚®ä»¶è‡³ Assignee ä¸ Manager;å‰©ä½™æ—¶é—´>7 å¤©(å®‰å…¨æœŸ)ä»…åœ¨å‘¨æŠ¥ä¸­å±•ç¤ºã€‚Critical æ¼æ´è¶…æœŸè‡ªåŠ¨åˆ›å»º PagerDuty äº‹ä»¶,7Ã—24 å€¼ç­å·¥ç¨‹å¸ˆå¿…é¡»å“åº”ã€‚

### åŠ¨æ€ SLA è®¡ç®—é€»è¾‘

ä»¥ä¸‹ Python ä»£ç å±•ç¤ºåŸºäºå¤šç»´åº¦çš„åŠ¨æ€ SLA è®¡ç®—é€»è¾‘ï¼š

```python
# æ¼æ´åˆ†çº§ä¸SLAè®¡ç®— - æ ¸å¿ƒé€»è¾‘
def calculate_dynamic_sla(vuln):
 """
 åŸºäºå¤šç»´åº¦è®¡ç®—åŠ¨æ€SLA

 å‚æ•°:
  vuln: æ¼æ´å¯¹è±¡,åŒ…å«ä»¥ä¸‹å­—æ®µ
   - severity: Critical/High/Medium/Low
   - publicly_accessible: bool,èµ„äº§æ˜¯å¦å…¬ç½‘å¯è®¿é—®
   - exploit_available: bool,æ˜¯å¦å­˜åœ¨å…¬å¼€POCæˆ–åœ¨é‡åˆ©ç”¨
   - data_sensitivity: bool,æ˜¯å¦å¤„ç†æ•æ„Ÿæ•°æ®(PII/PCI)

 è¿”å›:
  int: ä¿®å¤SLA(å°æ—¶)

 é€‚ç”¨è¾¹ç•Œ:
  - ä»…é€‚ç”¨äºæŠ€æœ¯å€ºæ¼æ´,ç´§æ€¥äº‹ä»¶(å¦‚0day)éœ€èµ°åº”æ€¥å“åº”æµç¨‹
  - æš´éœ²åº¦åˆ¤æ–­ä¾èµ–èµ„äº§ç®¡ç†ç³»ç»Ÿå‡†ç¡®æ€§
 """

 # åŸºç¡€SLA(å°æ—¶)
 base_sla = {
  'Critical': 24,  # CVSS 9.0+
  'High': 168,   # CVSS 7.0-8.9, 7å¤©
  'Medium': 720,  # CVSS 4.0-6.9, 30å¤©
  'Low': 2160   # CVSS <4.0, 90å¤©
 }[vuln['severity']]

 # æš´éœ²åº¦ç³»æ•°(å…¬ç½‘å¯è®¿é—®SLAå‡åŠ)
 exposure_factor = 0.5 if vuln['publicly_accessible'] else 1.0

 # å¯åˆ©ç”¨æ€§ç³»æ•°(å­˜åœ¨POC/åœ¨é‡åˆ©ç”¨SLAå‡åŠ)
 exploit_factor = 0.5 if vuln['exploit_available'] else 1.0

 # æ•°æ®æ•æ„Ÿåº¦ç³»æ•°(å¤„ç†æ•æ„Ÿæ•°æ®SLAå‡åŠ)
 data_factor = 0.5 if vuln['data_sensitivity'] else 1.0

 # æœ€ç»ˆSLA(å¤šä¸ªç³»æ•°ç´¯ä¹˜)
 final_sla = base_sla * exposure_factor * exploit_factor * data_factor

 return int(final_sla) # è¿”å›å°æ—¶æ•°
```

ç¤ºä¾‹åœºæ™¯ï¼š

- **åœºæ™¯ 1**:CVSS 7.5 SQL æ³¨å…¥ï¼Œå…¬ç½‘æš´éœ²ï¼Œæ—  POC,å¤„ç† PCI æ•°æ®ã€‚
 - åŸºç¡€ SLA=168 å°æ—¶(7 å¤©)
 - æš´éœ²åº¦ç³»æ•°=0.5
 - å¯åˆ©ç”¨æ€§ç³»æ•°=1.0
 - æ•°æ®æ•æ„Ÿåº¦ç³»æ•°=0.5
 - æœ€ç»ˆ SLA=168Ã—0.5Ã—1.0Ã—0.5=42 å°æ—¶(1.75 å¤©)

- **åœºæ™¯ 2**:CVSS 9.0 RCE,å†…ç½‘å·¥å…·ï¼Œæ—  POC,æ— æ•æ„Ÿæ•°æ®ã€‚
 - åŸºç¡€ SLA=24 å°æ—¶
 - æš´éœ²åº¦ç³»æ•°=1.0
 - å¯åˆ©ç”¨æ€§ç³»æ•°=1.0
 - æ•°æ®æ•æ„Ÿåº¦ç³»æ•°=1.0
 - æœ€ç»ˆ SLA=24Ã—1.0Ã—1.0Ã—1.0=24 å°æ—¶

éªŒè¯æ–¹æ³•ï¼šæ¨¡æ‹Ÿä¸åŒåœºæ™¯ï¼Œç¡®è®¤ SLA è®¡ç®—ç¬¦åˆé¢„æœŸï¼›ç»Ÿè®¡ SLA åˆè§„ç‡ï¼Œç¡®è®¤åŠ¨æ€ SLA æ›´è´´åˆä¸šåŠ¡é£é™©(ç›¸æ¯”å›ºå®š SLA æé«˜ 10%+åˆè§„ç‡)ã€‚

---

## 5.7.9 æœ¬èŠ‚å°ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **CI/CD å®‰å…¨**:é€‰æ‹©åˆé€‚çš„ CI/CD å¹³å°ï¼ˆJenkins/GitLab/GitHub Actions),å®æ–½ä¸ƒå±‚å®‰å…¨é—¨ç¦ï¼ˆSecret æ‰«æâ†’SASTâ†’SCAâ†’å®¹å™¨æ‰«æâ†’IaC æ‰«æâ†’DASTâ†’Quality Gate),å¹³è¡¡å®‰å…¨é£é™©ä¸äº¤ä»˜æ•ˆç‡ã€‚

2. **IaC æ‰«æ**:ç»„åˆä½¿ç”¨ Checkovã€tfsecã€Terrascan æé«˜è§„åˆ™è¦†ç›–ç‡ï¼Œé€šè¿‡ Pre-commit Hook å‰ç½®æ£€æŸ¥ï¼Œé¿å…é…ç½®é£é™©è¿›å…¥ä»£ç åº“ã€‚

3. **CloudFormation å®‰å…¨**:ä½¿ç”¨ cfn-nag æ£€æµ‹å¸¸è§é—®é¢˜ï¼Œä½¿ç”¨ CloudFormation Guard å®šä¹‰ä¼ä¸šç­–ç•¥ï¼Œéµå¾ªå®‰å…¨æ¨¡æ¿æœ€ä½³å®è·µ(åŠ å¯†ã€ç‰ˆæœ¬æ§åˆ¶ã€è®¿é—®æ—¥å¿—ã€æœ€å°æƒé™)ã€‚

4. **å®¹å™¨é•œåƒå®‰å…¨**:ä½¿ç”¨ Cosign ç­¾åéªŒè¯é•œåƒæ¥æºï¼Œä½¿ç”¨ Trivy/Grype æ‰«ææ¼æ´ï¼Œé€šè¿‡ Kubernetes å‡†å…¥æ§åˆ¶å¼ºåˆ¶æ‰§è¡Œç­¾åéªŒè¯ï¼Œå»ºç«‹å®Œæ•´ä¾›åº”é“¾å®‰å…¨ã€‚

5. **å®‰å…¨å·¦ç§»**:é€šè¿‡ IDE æ’ä»¶ã€Pre-commit Hookã€å¼€å‘è€…åŸ¹è®­ä¸‰ä½ä¸€ä½“å°†å®‰å…¨æ£€æŸ¥å‰ç½®åˆ°å¼€å‘é˜¶æ®µï¼Œé™ä½ä¿®å¤æˆæœ¬ï¼Œæé«˜å®‰å…¨æ„è¯†ã€‚

6. **å®‰å…¨é—¨ç¦**:åŸºäºé£é™©çš„åŠ¨æ€é˜»æ–­ç­–ç•¥ï¼ˆCritical å¼ºåˆ¶é˜»æ–­,High è­¦å‘Š,Medium/Low ä»…è®°å½•),é€šè¿‡ SonarQube Quality Gate ç­‰å·¥å…·å¼ºåˆ¶æ‰§è¡Œï¼Œå®šæœŸå®¡æŸ¥åŸºçº¿é¿å…å¤±æ•ˆã€‚

7. **SAST/DAST/SCA**:ç»„åˆä½¿ç”¨ä¸åŒç±»å‹å·¥å…·ï¼ˆSAST è¦†ç›–ä»£ç å±‚ã€DAST è¦†ç›–è¿è¡Œæ—¶ã€SCA è¦†ç›–ä¾èµ–åº“),é€šè¿‡èšåˆå¹³å°ç»Ÿä¸€ç®¡ç†å‘Šè­¦ï¼Œé¿å…å·¥å…·ç¢ç‰‡åŒ–ã€‚

8. **æ¼æ´ç®¡ç†**:å»ºç«‹ä»å‘ç°åˆ°å…³é—­çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ŒåŸºäº CVSS+æš´éœ²åº¦+å¯åˆ©ç”¨æ€§+æ•°æ®æ•æ„Ÿåº¦åŠ¨æ€è®¡ç®— SLA,é€šè¿‡è‡ªåŠ¨åŒ–å·¥å•åˆ›å»ºä¸å‡çº§æœºåˆ¶é©±åŠ¨åŠæ—¶ä¿®å¤ã€‚

### å¸¸è§è¯¯åŒº

- **è¯¯åŒº 1**:ä¸€åˆ€åˆ‡é˜»æ–­æ‰€æœ‰ High æ¼æ´ï¼Œå¯¼è‡´é—ç•™ç³»ç»Ÿæ— æ³•é€šè¿‡é—¨ç¦ï¼Œå¤§é‡ä¾‹å¤–ç”³è¯·é™ä½é—¨ç¦æƒå¨æ€§ã€‚**æ­£ç¡®åšæ³•**ï¼šåŸºäºå†å²åŸºçº¿è®¾å®šé˜ˆå€¼ï¼Œé€æ­¥æ”¶ç´§ã€‚

- **è¯¯åŒº 2**:ä»…ä¾èµ–å•ä¸€æ‰«æå·¥å…·(å¦‚ä»… SAST),æ— æ³•è¦†ç›–è¿è¡Œæ—¶æ¼æ´ä¸ä¾èµ–åº“æ¼æ´ã€‚**æ­£ç¡®åšæ³•**ï¼šç»„åˆ SAST+DAST+SCAã€‚

- **è¯¯åŒº 3**:Pre-commit Hook æ‰§è¡Œæ—¶é—´è¿‡é•¿(>30 ç§’),å¼€å‘è€…è·³è¿‡æ£€æŸ¥ã€‚**æ­£ç¡®åšæ³•**ï¼šä»…æ‰§è¡Œå¿«é€Ÿæ£€æŸ¥(å¦‚ Secret æ‰«æ),å®Œæ•´æ£€æŸ¥æ”¾åˆ° CI/CDã€‚

- **è¯¯åŒº 4**:æœªå»ºç«‹ SAST åŸºçº¿ï¼Œé¦–æ¬¡å¯ç”¨æ—¶æŠ¥å‘Šæ•°åƒä¸ªå†å²é—®é¢˜ï¼Œæ·¹æ²¡æ–°å¢é—®é¢˜ã€‚**æ­£ç¡®åšæ³•**ï¼šé¦–æ¬¡æ‰«ææ—¶æ‰¹é‡æ ‡è®°å·²çŸ¥é—®é¢˜ä¸º"å·²æ¥å—é£é™©",ä»…å…³æ³¨æ–°å¢é—®é¢˜ã€‚

- **è¯¯åŒº 5**:æ¼æ´ SLA ä»…ä¾èµ– CVSS è¯„åˆ†ï¼Œæœªè€ƒè™‘èµ„äº§æš´éœ²åº¦ä¸ä¸šåŠ¡å½±å“ã€‚**æ­£ç¡®åšæ³•**ï¼šåŸºäºå¤šç»´åº¦åŠ¨æ€è®¡ç®— SLAã€‚

### å»¶ä¼¸é˜…è¯»

- **OWASP DevSecOps Guideline**:https://owasp.org/www-project-DevSecOps-guideline/
- **NIST SP 800-218 Secure Software Development Framework (SSDF)**:https://csrc.nist.gov/publications/detail/sp/800-218/final
- **SLSA Supply-chain Levels for Software Artifacts**:https://slsa.dev/
- **Sigstore**:https://www.sigstore.dev/
- **CNCF Cloud Native Security Whitepaper**:https://www.cncf.io/reports/cloud-native-security-whitepaper/
- **GitLab DevSecOps Best Practices**:https://about.gitlab.com/topics/DevSecOps/

### å®æˆ˜æ£€æŸ¥æ¸…å•

**CI/CD å®‰å…¨(æ¯å­£åº¦æ£€æŸ¥)**:
- [ ] æ‰€æœ‰ Pipeline ä½¿ç”¨æœ€æ–° Runner é•œåƒ
- [ ] å‡­è¯ 100%å­˜å‚¨åœ¨ Secret Manager
- [ ] Pipeline æ—¥å¿—ä¸åŒ…å«æ•æ„Ÿä¿¡æ¯
- [ ] æ„å»ºç¯å¢ƒå®¹å™¨åŒ–éš”ç¦»
- [ ] ç­¾åéªŒè¯å¼ºåˆ¶æ‰§è¡Œ
- [ ] å®¡è®¡æ—¥å¿—å¯ç”¨å¹¶å½’æ¡£
- [ ] RBAC æƒé™æœ€å°åŒ–

**IaC å®‰å…¨(æ¯æœˆæ£€æŸ¥)**:
- [ ] Pre-commit hooks 100%è¦†ç›–
- [ ] IaC æ‰«æé›†æˆåˆ° CI/CD
- [ ] è‡ªå®šä¹‰è§„åˆ™æ›´æ–°
- [ ] è¯¯æŠ¥æŠ‘åˆ¶åˆç†
- [ ] ä¿®å¤ç‡>è®¾å®šç›®æ ‡
- [ ] æ–°æ¨¡æ¿å®‰å…¨å®¡æŸ¥
- [ ] Drift æ£€æµ‹å¯ç”¨

**å®¹å™¨å®‰å…¨(æ¯å‘¨æ£€æŸ¥)**:
- [ ] é•œåƒæ‰«æ 100%è¦†ç›–
- [ ] Critical æ¼æ´ 0 å®¹å¿
- [ ] é•œåƒç­¾åå¼ºåˆ¶éªŒè¯
- [ ] åŸºç¡€é•œåƒåŠæ—¶æ›´æ–°
- [ ] SBOM è‡ªåŠ¨ç”Ÿæˆ
- [ ] é•œåƒä»“åº“è®¿é—®æ§åˆ¶
- [ ] è¿è¡Œæ—¶ç­–ç•¥æ‰§è¡Œ

**æ¼æ´ç®¡ç†(æ¯æ—¥æ£€æŸ¥)**:
- [ ] æ–°æ¼æ´è‡ªåŠ¨åˆ›å»ºå·¥å•
- [ ] Critical SLA <24 å°æ—¶
- [ ] High SLA <7 å¤©
- [ ] SLA è¿è§„ç‡ <5%
- [ ] MTTR è¶‹åŠ¿æ”¹å–„
- [ ] é‡å¤æ¼æ´ç‡ <10%
- [ ] ä¿®å¤éªŒè¯ 100%

---

## ğŸ“ å¯¼èˆª

**[â† ä¸Šä¸€èŠ‚ï¼š5.6 äº‘åŸç”Ÿå®‰å…¨å·¥å…·é“¾](./5.6_cloud_native_security_toolchain.md)** | **[è¿”å› Part 2](../)** | **[è¿”å›æ€»ç›®å½•](../../)** | **[â†’ ä¸‹ä¸€èŠ‚ï¼š5.8 äº‘å®‰å…¨è¿è¥](./5.8_cloud_security_operations.md)**

---

**Â© 2025 AI-ESA Project. Licensed under CC BY-NC-SA 4.0**

