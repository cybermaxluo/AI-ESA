# 5.5 äº‘æ•°æ®ä¿æŠ¤ (Cloud Data Protection)

æœ¬èŠ‚èšç„¦äº‘ç¯å¢ƒæ•°æ®ä¿æŠ¤çš„å·¥ç¨‹å®ç°:ä»å¯¹è±¡å­˜å‚¨è®¿é—®æ§åˆ¶ã€å¤šå±‚åŠ å¯†ç­–ç•¥è®¾è®¡,åˆ°å¯†é’¥ç®¡ç†æœåŠ¡é€‰å‹ã€BYOK/HYOKå®æ–½,å†åˆ°æ•°æ®åˆ†ç±»ã€DLPéƒ¨ç½²ä¸è·¨å¢ƒé©»ç•™åˆè§„ã€‚å†…å®¹è¦†ç›–AWS/Azure/GCPä¸‰å¤§äº‘å¹³å°çš„æŠ€æœ¯å¯¹æ¯”ä¸é…ç½®å®æˆ˜,é€šè¿‡å…·ä½“æ§åˆ¶ç‚¹è®¾è®¡ã€éªŒè¯æ–¹æ³•ä¸è¿è¡ŒæŒ‡æ ‡,æ”¯æ’‘ä¼ä¸šæ„å»ºå¯å®¡è®¡ã€å¯éªŒæ”¶çš„äº‘æ•°æ®ä¿æŠ¤ä½“ç³»ã€‚

---

## 5.5.1 äº‘å¯¹è±¡å­˜å‚¨å®‰å…¨é…ç½®

### ä¸‰å¤§äº‘å­˜å‚¨æœåŠ¡å¯¹æ¯”

AWS S3ã€Azure Blob Storageä¸GCP Cloud Storageå‡é‡‡ç”¨å¯¹è±¡å­˜å‚¨æ¶æ„,ä½†åœ¨è®¿é—®æ§åˆ¶ã€åŠ å¯†é€‰é¡¹ã€åˆè§„ç‰¹æ€§ä¸Šå­˜åœ¨å·®å¼‚ã€‚é€‰å‹æ—¶éœ€ç»¼åˆè€ƒè™‘ç°æœ‰äº‘å¹³å°ç”Ÿæ€ã€æ•°æ®åˆ†ç±»éœ€æ±‚ä¸åˆè§„çº¦æŸã€‚

| ç»´åº¦ | AWS S3 | Azure Blob Storage | GCP Cloud Storage |
|------|--------|-------------------|-------------------|
| è®¿é—®æ§åˆ¶ | IAM + Bucket Policy + ACL | RBAC + SAS Token | IAM + ACL |
| é»˜è®¤åŠ å¯† | SSE-S3 (AES-256) | SSE (AES-256) | é»˜è®¤åŠ å¯†(Googleç®¡ç†) |
| å®¢æˆ·å¯†é’¥é€‰é¡¹ | SSE-KMS/SSE-C | Customer Managed Key | Customer Managed Encryption Key |
| ç‰ˆæœ¬æ§åˆ¶ | æ”¯æŒ | æ”¯æŒ | æ”¯æŒ |
| å¯¹è±¡ä¸å¯å˜æ€§ | Object Lock (WORM) | Immutable Blob Storage | Retention Policy |
| è®¿é—®æ—¥å¿— | Server Access Logging | Storage Analytics | Cloud Audit Logs |
| å…¬å¼€è®¿é—®é˜»æ­¢ | Block Public Access | Public Access Levelæ§åˆ¶ | Uniform bucket-level access |

![æ•°æ®åŠ å¯†æ¶æ„](../../../assets/images/chapter_08/02_Data_Encryption_Architecture_v6.png)

**é€‰å‹çº¦æŸ**:

- **ä¸äº‘å¹³å°é›†æˆæ·±åº¦**:è‹¥å·²å¤§é‡ä½¿ç”¨AWS Lambda/ECS,S3ä¸æœåŠ¡é—´çš„IAMç­–ç•¥é›†æˆæˆæœ¬æœ€ä½;è‹¥æ ¸å¿ƒä¸šåŠ¡åœ¨Azure App Service,Blob Storageçš„RBACä¸Azure ADå¤©ç„¶å¯¹æ¥ã€‚
- **åˆè§„å®¡è®¡ç²’åº¦**:é‡‘èè¡Œä¸šéœ€è¯æ˜"å®¢æˆ·ç‹¬å å¯†é’¥æ§åˆ¶æƒ"æ—¶,AWS SSE-C(å®¢æˆ·æä¾›å¯†é’¥)æˆ–Azure BYOKå¯æ»¡è¶³å®¡è®¡è¦æ±‚,ä½†è¿ç»´å¤æ‚åº¦é«˜äºäº‘ç®¡ç†å¯†é’¥ã€‚
- **è·¨åŒºåŸŸå¤åˆ¶éœ€æ±‚**:GCP Multi-Region Bucketså¤©ç„¶æ”¯æŒè·¨åœ°åŸŸå¼ºä¸€è‡´æ€§,é€‚åˆå…¨çƒåŒæ­¥åœºæ™¯;AWS CRR(Cross-Region Replication)éœ€æ‰‹åŠ¨é…ç½®å¤åˆ¶è§„åˆ™ã€‚

### S3å®‰å…¨é…ç½®åŸºçº¿

AWS S3å› å¸‚åœºä»½é¢é«˜,é…ç½®é”™è¯¯å¯¼è‡´çš„æ³„éœ²äº‹ä»¶é¢‘å‘ã€‚ä»¥ä¸‹é…ç½®ä¸ºä¼ä¸šçº§S3å®‰å…¨åŸºçº¿(åŸºäºCIS AWS Foundations Benchmark v1.5),æ¯é¡¹æ§åˆ¶å‡å¯é€šè¿‡CSPMå·¥å…·(å¦‚AWS Security Hub/Prowler)è‡ªåŠ¨æ£€æµ‹ã€‚

#### Block Public Access (BPA) - é˜»æ­¢æ„å¤–å…¬å¼€

**æ§åˆ¶ç›®æ ‡**:æŠ€æœ¯ä¸Šæ¶ˆé™¤Bucketè¢«é…ç½®ä¸ºå…¬å¼€è®¿é—®çš„å¯èƒ½æ€§,å³ä½¿Bucket Policyæˆ–ACLé…ç½®é”™è¯¯ä¹Ÿæ— æ³•ç”Ÿæ•ˆã€‚

```bash
# åœ¨AWSè´¦æˆ·çº§åˆ«å¯ç”¨BPA(å½±å“è´¦æˆ·å†…æ‰€æœ‰Bucket)
aws s3control put-public-access-block \
  --account-id 123456789012 \
  --public-access-block-configuration \
    BlockPublicAcls=true,IgnorePublicAcls=true,\
    BlockPublicPolicy=true,RestrictPublicBuckets=true
```

**éªŒè¯æ–¹æ³•**:

- è‡ªåŠ¨åŒ–éªŒè¯:é€šè¿‡AWS Configè§„åˆ™`s3-account-level-public-access-blocks`æŒç»­ç›‘æ§,ä»»ä½•BPAè¢«ç¦ç”¨ç«‹å³å‘Šè­¦ã€‚
- æ‰‹åŠ¨éªŒè¯:å°è¯•å°†æµ‹è¯•Bucketçš„Policyè®¾ä¸º`"Principal": "*"`,éªŒè¯æ“ä½œè¢«æ‹’ç»ã€‚

**å¸¸è§è¯¯åŒº**:

- è¯¯ä»¥ä¸º"ä»…åœ¨ç”Ÿäº§Bucketå¯ç”¨BPAå³å¯":å¼€å‘/æµ‹è¯•ç¯å¢ƒçš„é…ç½®é”™è¯¯åŒæ ·å¯èƒ½æ³„éœ²æ•æ„Ÿæ•°æ®(å¦‚åŒ…å«çœŸå®å®¢æˆ·æ•°æ®çš„æµ‹è¯•é›†)ã€‚
- è¯¯ä»¥ä¸º"æœ‰Bucket Policyå°±ä¸éœ€è¦BPA":Policyå¯è¢«äººä¸ºä¿®æ”¹æˆ–è¯¯é…,BPAæä¾›æŠ€æœ¯å¼ºåˆ¶å±‚ã€‚

#### å¼ºåˆ¶åŠ å¯†ä¸HTTPSä¼ è¾“

**æ§åˆ¶ç›®æ ‡**:æ‹’ç»æœªåŠ å¯†çš„å¯¹è±¡ä¸Šä¼ ,æ‹’ç»HTTPæ˜æ–‡ä¼ è¾“ã€‚

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "DenyInsecureTransport",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:*",
      "Resource": [
        "arn:aws:s3:::my-secure-bucket",
        "arn:aws:s3:::my-secure-bucket/*"
      ],
      "Condition": {
        "Bool": {"aws:SecureTransport": "false"}
      }
    },
    {
      "Sid": "DenyUnencryptedObjectUploads",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:PutObject",
      "Resource": "arn:aws:s3:::my-secure-bucket/*",
      "Condition": {
        "StringNotEquals": {
          "s3:x-amz-server-side-encryption": "aws:kms"
        }
      }
    }
  ]
}
```

**éªŒè¯æ–¹æ³•**:

```bash
# æµ‹è¯•1:å°è¯•HTTPä¸Šä¼ (åº”å¤±è´¥)
curl -X PUT http://my-secure-bucket.s3.amazonaws.com/test.txt \
  -d "test data" --aws-sigv4 "aws:amz:us-east-1:s3"
# é¢„æœŸ:403 Forbidden

# æµ‹è¯•2:å°è¯•ä¸åŠ å¯†ä¸Šä¼ (åº”å¤±è´¥)
aws s3 cp test.txt s3://my-secure-bucket/test.txt \
  --no-server-side-encryption
# é¢„æœŸ:Access Denied

# æµ‹è¯•3:æ­£ç¡®ä¸Šä¼ (åº”æˆåŠŸ)
aws s3 cp test.txt s3://my-secure-bucket/test.txt \
  --server-side-encryption aws:kms
```

**è¿è¡ŒæŒ‡æ ‡**:

- æœªåŠ å¯†å¯¹è±¡æ•°é‡:ç›®æ ‡å€¼ = 0(é€šè¿‡S3 Inventoryæ—¥å¿—çš„`EncryptionStatus`å­—æ®µç›‘æ§)
- HTTPè®¿é—®å°è¯•æ¬¡æ•°:ç›®æ ‡å€¼ = 0(CloudTrailä¸­`eventName=GetObject`ä¸”`tlsDetails.tlsVersion=null`çš„è®°å½•æ•°)

#### ç‰ˆæœ¬æ§åˆ¶ä¸å¯¹è±¡é”å®š

**é€‚ç”¨åœºæ™¯**:éœ€é˜²æ­¢å‹’ç´¢è½¯ä»¶åˆ é™¤å¤‡ä»½ã€éœ€æ»¡è¶³SEC 17a-4åˆè§„(é‡‘èè¡Œä¸š7å¹´æ•°æ®ä¿ç•™)ã€‚

```python
import boto3
s3 = boto3.client('s3')

# å¯ç”¨ç‰ˆæœ¬æ§åˆ¶+MFA Delete(åˆ é™¤å¯¹è±¡éœ€MFAè®¾å¤‡éªŒè¯)
s3.put_bucket_versioning(
    Bucket='compliance-bucket',
    VersioningConfiguration={
        'Status': 'Enabled',
        'MFADelete': 'Enabled'
    },
    MFA='arn:aws:iam::123456789012:mfa/root-account-mfa-device 123456'
)

# å¯ç”¨å¯¹è±¡é”å®š(COMPLIANCEæ¨¡å¼:AWSå‘˜å·¥ä¹Ÿæ— æ³•åˆ é™¤)
s3.put_object_lock_configuration(
    Bucket='compliance-bucket',
    ObjectLockConfiguration={
        'ObjectLockEnabled': 'Enabled',
        'Rule': {
            'DefaultRetention': {
                'Mode': 'COMPLIANCE',  # æˆ–GOVERNANCE(å…è®¸ç‰¹æƒç”¨æˆ·è¦†ç›–)
                'Days': 2555  # 7å¹´
            }
        }
    }
)
```

**çº¦æŸæ¡ä»¶**:

- å¯¹è±¡é”å®šå¯ç”¨åæ— æ³•ç¦ç”¨,ä»…èƒ½å»¶é•¿ä¿ç•™æœŸã€‚
- COMPLIANCEæ¨¡å¼ä¸‹,å¯¹è±¡åœ¨ä¿ç•™æœŸå†…ä»»ä½•è´¦æˆ·(åŒ…æ‹¬root)å‡æ— æ³•åˆ é™¤,éœ€è°¨æ…è¯„ä¼°ä¸šåŠ¡éœ€æ±‚ã€‚

**éªŒè¯æ–¹æ³•**:

- ä¸Šä¼ æµ‹è¯•å¯¹è±¡åå°è¯•åˆ é™¤,éªŒè¯è¿”å›`AccessDenied`é”™è¯¯ã€‚
- æ¨¡æ‹Ÿå‹’ç´¢è½¯ä»¶æ”»å‡»:ä½¿ç”¨é«˜æƒé™è´¦æˆ·æ‰¹é‡åˆ é™¤å¯¹è±¡,éªŒè¯ç‰ˆæœ¬å†å²å®Œæ•´ã€‚

---

## 5.5.2 å¤šå±‚åŠ å¯†ç­–ç•¥è®¾è®¡

äº‘æ•°æ®åŠ å¯†éœ€è¦†ç›–ä¸‰ä¸ªé˜¶æ®µ:é™æ€å­˜å‚¨(at rest)ã€ç½‘ç»œä¼ è¾“(in transit)ã€å†…å­˜å¤„ç†(in use)ã€‚æ¯å±‚åŠ å¯†è§£å†³ä¸åŒå¨èƒ:é™æ€åŠ å¯†é˜²ç‰©ç†ä»‹è´¨å¤±çªƒ,ä¼ è¾“åŠ å¯†é˜²ä¸­é—´äººæ”»å‡»,ä½¿ç”¨ä¸­åŠ å¯†é˜²å†…å­˜dumpæ³„éœ²ã€‚

### é™æ€åŠ å¯† (Encryption at Rest)

**AWS SSEåŠ å¯†æ–¹å¼å¯¹æ¯”**:

| æ–¹å¼ | å¯†é’¥ç®¡ç†æ–¹ | CloudTrailå®¡è®¡ | KMS APIè´¹ç”¨ | æ¨èåœºæ™¯ |
|------|-----------|---------------|-------------|---------|
| SSE-S3 | AWS | æ— æ³•å®¡è®¡å¯†é’¥ä½¿ç”¨ | $0 | L3/L4éæ•æ„Ÿæ•°æ® |
| SSE-KMS | AWS KMS | å®Œæ•´å®¡è®¡ | $0.03/ä¸‡æ¬¡ | L1/L2æ•æ„Ÿæ•°æ®(æ¨è) |
| SSE-C | å®¢æˆ·è‡ªè¡Œç®¡ç† | æ— KMSè®°å½• | $0 | å®¢æˆ·éœ€å®Œå…¨æ§åˆ¶å¯†é’¥ |
| Client-Side | å®¢æˆ·ç«¯åŠ å¯†åº“ | å®¢æˆ·è´Ÿè´£ | $0 | æç«¯æ•æ„Ÿåœºæ™¯+è‡ªæœ‰HSM |

**å†³ç­–æ¡†æ¶**:

```
æ•°æ®åˆ†ç±»L1/L2? â”€â”€æ˜¯â”€â”€> éœ€å®¡è®¡å¯†é’¥è®¿é—®? â”€â”€æ˜¯â”€â”€> SSE-KMS
        â”‚                      â””â”€â”€å¦â”€â”€> SSE-C (BYOKåœºæ™¯)
        â””â”€â”€å¦(L3/L4)â”€â”€> SSE-S3 (æˆæœ¬ä¼˜åŒ–)
```

**SSE-KMSå®æ–½ç¤ºä¾‹**:

```python
import boto3
kms = boto3.client('kms')
s3 = boto3.client('s3')

# åˆ›å»ºå®¢æˆ·ç®¡ç†çš„KMSå¯†é’¥(CMK)
key_response = kms.create_key(
    Description='S3 L2 data encryption key',
    KeyUsage='ENCRYPT_DECRYPT',
    Origin='AWS_KMS',  # æˆ–AWS_CLOUDHSM(FIPS 140-2 Level 3)
    MultiRegion=False,
    Tags=[
        {'TagKey': 'DataClassification', 'TagValue': 'L2'},
        {'TagKey': 'CostCenter', 'TagValue': 'SEC-001'}
    ]
)
key_id = key_response['KeyMetadata']['KeyId']

# é…ç½®Bucketé»˜è®¤åŠ å¯†
s3.put_bucket_encryption(
    Bucket='sensitive-data-bucket',
    ServerSideEncryptionConfiguration={
        'Rules': [{
            'ApplyServerSideEncryptionByDefault': {
                'SSEAlgorithm': 'aws:kms',
                'KMSMasterKeyID': key_id
            },
            'BucketKeyEnabled': True  # å‡å°‘KMS APIè°ƒç”¨(é™ä½æˆæœ¬+å»¶è¿Ÿ)
        }]
    }
)
```

**æ€§èƒ½ä¼˜åŒ– - Bucket Key**:

- æœªå¯ç”¨Bucket Key:æ¯æ¬¡å¯¹è±¡åŠ å¯†/è§£å¯†è°ƒç”¨1æ¬¡KMS API(æˆæœ¬:100ä¸‡å¯¹è±¡/æœˆ Ã— $0.03/ä¸‡æ¬¡ = $3000)ã€‚
- å¯ç”¨Bucket Key:S3ç”ŸæˆBucketçº§æ•°æ®å¯†é’¥,æœ¬åœ°åŠ å¯†å¯¹è±¡,ä»…å®šæœŸè½®æ¢æ—¶è°ƒç”¨KMS(æˆæœ¬é™ä½99%)ã€‚

**éªŒè¯æ–¹æ³•**:

```bash
# æ£€æŸ¥å¯¹è±¡åŠ å¯†çŠ¶æ€
aws s3api head-object --bucket sensitive-data-bucket --key test.csv \
  --query 'ServerSideEncryption'
# é¢„æœŸè¾“å‡º:aws:kms

# æŸ¥è¯¢KMSå¯†é’¥ä½¿ç”¨æ—¥å¿—(CloudTrail)
aws cloudtrail lookup-events \
  --lookup-attributes AttributeKey=ResourceName,AttributeValue=<key-arn> \
  --max-results 10
```

### ä¼ è¾“åŠ å¯† (Encryption in Transit)

**æ§åˆ¶ç›®æ ‡**:å¼ºåˆ¶TLS 1.2+(ç¦ç”¨TLS 1.0/1.1),é˜²æ­¢é™çº§æ”»å‡»ã€‚

```json
{
  "Sid": "EnforceTLS12Plus",
  "Effect": "Deny",
  "Principal": "*",
  "Action": "s3:*",
  "Resource": [
    "arn:aws:s3:::secure-bucket",
    "arn:aws:s3:::secure-bucket/*"
  ],
  "Condition": {
    "NumericLessThan": {
      "s3:TlsVersion": "1.2"
    }
  }
}
```

**éªŒè¯æ–¹æ³•**:

```bash
# æµ‹è¯•TLS 1.1è¿æ¥(åº”è¢«æ‹’ç»)
openssl s_client -connect secure-bucket.s3.amazonaws.com:443 -tls1_1
# é¢„æœŸ:handshake failureæˆ–connection refused
```

**å¸¸è§è¯¯åŒº**:

- è¯¯ä»¥ä¸º"å¯ç”¨HTTPSå³å®‰å…¨":è‹¥æœªå¼ºåˆ¶TLS 1.2+,æ”»å‡»è€…å¯è¯±å¯¼å®¢æˆ·ç«¯é™çº§è‡³TLS 1.0(å­˜åœ¨POODLE/BEASTæ¼æ´)ã€‚
- å¿½è§†å†…éƒ¨VPCæµé‡åŠ å¯†:VPCå†…S3 Gateway Endpointæµé‡é»˜è®¤æœªåŠ å¯†,éœ€é…ç½®PrivateLink + TLSã€‚

### ä½¿ç”¨ä¸­åŠ å¯† (Encryption in Use)

**é€‚ç”¨åœºæ™¯**:éœ€åœ¨å†…å­˜ä¸­å¤„ç†L1æ•°æ®(å¦‚ä¿¡ç”¨å¡CVVè§£å¯†),ä¸”éœ€é˜²å¾¡ç‰¹æƒç”¨æˆ·(root/äº‘å‚å•†å‘˜å·¥)è®¿é—®å†…å­˜ã€‚

**æŠ€æœ¯å®ç° - AWS Nitro Enclaves**:

```python
# åœ¨Enclaveå†…æ‰§è¡ŒKMSè§£å¯†(æ¯å®ä¾‹æ— æ³•è®¿é—®æ˜æ–‡)
import socket
import json

def decrypt_in_enclave(ciphertext_blob):
    """é€šè¿‡Enclaveè§£å¯†æ•°æ®"""
    # è¿æ¥Enclaveçš„vsock(CID=3è¡¨ç¤ºçˆ¶EC2å®ä¾‹)
    sock = socket.socket(socket.AF_VSOCK, socket.SOCK_STREAM)
    sock.connect((3, 5000))

    request = {'action': 'decrypt', 'ciphertext': ciphertext_blob}
    sock.send(json.dumps(request).encode())
    response = json.loads(sock.recv(4096))

    return response['plaintext']  # æ˜æ–‡ä»…åœ¨Enclaveå†…å­˜ä¸­å­˜åœ¨
```

**çº¦æŸæ¡ä»¶**:

- Nitro Enclaveséœ€è¿è¡Œåœ¨ç‰¹å®šEC2å®ä¾‹ç±»å‹(å¦‚m5.xlarge),æˆæœ¬é«˜äºæ™®é€šå®ä¾‹çº¦20%ã€‚
- å¼€å‘å¤æ‚åº¦:éœ€å°†åº”ç”¨æ‹†åˆ†ä¸ºEnclaveå†…(è§£å¯†é€»è¾‘)ä¸Enclaveå¤–(ä¸šåŠ¡é€»è¾‘)ä¸¤éƒ¨åˆ†ã€‚

**è¿è¡ŒæŒ‡æ ‡**:

- Enclaveå¥åº·æ£€æŸ¥å¤±è´¥ç‡:ç›®æ ‡ < 0.1%(vsockè¿æ¥è¶…æ—¶/Enclaveå´©æºƒ)
- è§£å¯†æ“ä½œå»¶è¿Ÿ:ç›®æ ‡ < 50ms(vs æ™®é€šKMSè§£å¯† < 20ms,å¢åŠ çº¦30msç½‘ç»œå¾€è¿”)

---

## 5.5.3 å¯†é’¥ç®¡ç†æœåŠ¡ (KMS) é€‰å‹ä¸å®æ–½

### ä¸‰å¤§äº‘KMSå¯¹æ¯”

| ç»´åº¦ | AWS KMS | Azure Key Vault | GCP Cloud KMS |
|------|---------|-----------------|---------------|
| å¯†é’¥ç±»å‹ | å¯¹ç§°/éå¯¹ç§° | Keys/Secrets/Certificates | å¯¹ç§°/éå¯¹ç§° |
| HSMæ”¯æŒ | CloudHSM(FIPS 140-2 L3) | Managed HSM(FIPS 140-2 L3) | Cloud HSM(FIPS 140-2 L3) |
| è‡ªåŠ¨è½®æ¢ | 365å¤©(å¯¹ç§°å¯†é’¥) | æ‰‹åŠ¨æˆ–è‡ªåŠ¨(Premium SKU) | 90å¤©(å¯é…ç½®) |
| å¤šåŒºåŸŸå¯†é’¥ | Multi-Region Keys | Geo-Replication | Global Keys |
| APIé€Ÿç‡é™åˆ¶ | å…±äº«æ± 5500 req/s | ç‹¬å 10000 req/s | 60000 req/min |
| ä»·æ ¼(CMK) | $1/æœˆ + $0.03/ä¸‡æ¬¡API | $0.03/ä¸‡æ¬¡æ“ä½œ | $0.06/å¯†é’¥ç‰ˆæœ¬/æœˆ |

**é€‰å‹å†³ç­–ç‚¹**:

- **å¤šäº‘ç­–ç•¥**:è‹¥å·²æœ‰AWSä¸ºä¸»ã€Azureä¸ºè¾…çš„æ¶æ„,å»ºè®®L1æ•°æ®ç”¨AWS KMS(ä½å»¶è¿Ÿ),L2æ•°æ®ç”¨Azure Key Vault(æˆæœ¬ä¼˜åŒ–)ã€‚
- **å¯†é’¥è½®æ¢é¢‘ç‡**:é‡‘èè¡Œä¸šéœ€90å¤©è½®æ¢,GCP Cloud KMSé»˜è®¤é…ç½®åŒ¹é…;AWSéœ€æ‰‹åŠ¨å¯ç”¨è‡ªåŠ¨è½®æ¢æˆ–é€šè¿‡Lambdaå®šæ—¶è§¦å‘ã€‚
- **å®¡è®¡è¦æ±‚**:AWS CloudTrailè®°å½•æ‰€æœ‰KMS APIè°ƒç”¨(åŒ…æ‹¬Decryptè°ƒç”¨æ–¹IP/IAMè§’è‰²),Azure Monitoréœ€æ‰‹åŠ¨å¯ç”¨è¯Šæ–­è®¾ç½®ã€‚

### AWS KMSå®æˆ˜é…ç½®

```python
import boto3
import json

kms = boto3.client('kms')

# å®šä¹‰å¯†é’¥ç­–ç•¥(é™åˆ¶ä½¿ç”¨èŒƒå›´)
key_policy = {
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "Enable IAM User Permissions",
            "Effect": "Allow",
            "Principal": {"AWS": "arn:aws:iam::123456789012:root"},
            "Action": "kms:*",
            "Resource": "*"
        },
        {
            "Sid": "Allow S3 to use the key",
            "Effect": "Allow",
            "Principal": {"Service": "s3.amazonaws.com"},
            "Action": ["kms:Decrypt", "kms:GenerateDataKey"],
            "Resource": "*",
            "Condition": {
                "StringEquals": {
                    "kms:ViaService": "s3.us-east-1.amazonaws.com"
                }
            }
        }
    ]
}

# åˆ›å»ºCMK
response = kms.create_key(
    Description='Master key for S3 L2 data',
    KeyUsage='ENCRYPT_DECRYPT',
    Origin='AWS_KMS',
    MultiRegion=False,
    Policy=json.dumps(key_policy),
    Tags=[
        {'TagKey': 'Environment', 'TagValue': 'Production'},
        {'TagKey': 'DataClassification', 'TagValue': 'L2'}
    ]
)

key_id = response['KeyMetadata']['KeyId']

# å¯ç”¨è‡ªåŠ¨è½®æ¢(365å¤©)
kms.enable_key_rotation(KeyId=key_id)

# åˆ›å»ºåˆ«å(æ–¹ä¾¿å¼•ç”¨)
kms.create_alias(
    AliasName='alias/s3-l2-encryption-key',
    TargetKeyId=key_id
)
```

**éªŒè¯æ–¹æ³•**:

```python
# æµ‹è¯•åŠ å¯†/è§£å¯†
plaintext = b"Sensitive customer data"
encrypt_resp = kms.encrypt(
    KeyId='alias/s3-l2-encryption-key',
    Plaintext=plaintext,
    EncryptionContext={'Application': 'CRM', 'Environment': 'Prod'}
)
ciphertext = encrypt_resp['CiphertextBlob']

decrypt_resp = kms.decrypt(
    CiphertextBlob=ciphertext,
    EncryptionContext={'Application': 'CRM', 'Environment': 'Prod'}
)
assert decrypt_resp['Plaintext'] == plaintext

# æ£€æŸ¥å¯†é’¥è½®æ¢çŠ¶æ€
rotation_status = kms.get_key_rotation_status(KeyId=key_id)
assert rotation_status['KeyRotationEnabled'] == True
```

**è¿è¡ŒæŒ‡æ ‡**:

- KMS APIè°ƒç”¨å»¶è¿ŸP99:ç›®æ ‡ < 100ms(é€šè¿‡CloudWatchæŒ‡æ ‡`KMS.Latency`ç›‘æ§)
- å¯†é’¥è½®æ¢åˆè§„ç‡:ç›®æ ‡ = 100%(æ‰€æœ‰CMKå¯ç”¨è‡ªåŠ¨è½®æ¢æˆ–æ‰‹åŠ¨è½®æ¢å‘¨æœŸ â‰¤ 365å¤©)

---

## 5.5.4 BYOK/HYOKå®æ–½ä¸å†³ç­–

### BYOK vs HYOKå¯¹æ¯”

| ç‰¹æ€§ | BYOK (Bring Your Own Key) | HYOK (Hold Your Own Key) |
|------|---------------------------|---------------------------|
| å¯†é’¥å­˜å‚¨ä½ç½® | äº‘å‚å•†KMS(å®¢æˆ·å¯¼å…¥) | å®¢æˆ·æœ¬åœ°HSM |
| å¯†é’¥ç”Ÿæˆæ–¹ | å®¢æˆ· | å®¢æˆ· |
| åŠ å¯†æ“ä½œä½ç½® | äº‘å‚å•† | å®¢æˆ·æœ¬åœ° |
| æ€§èƒ½ | é«˜(äº‘åŸç”Ÿ) | ä½(ç½‘ç»œå»¶è¿Ÿ20-50ms) |
| å¯ç”¨æ€§ | äº‘å‚å•†SLA(99.99%) | å®¢æˆ·è´Ÿè´£HA |
| å®¡è®¡è¯æ˜ | å¯†é’¥æ¥æºå®¢æˆ·å¯æ§ | å¯†é’¥+æ“ä½œå‡å®¢æˆ·å¯æ§ |
| é€‚ç”¨åœºæ™¯ | æ»¡è¶³å¤§éƒ¨åˆ†åˆè§„è¦æ±‚ | é‡‘è/æ”¿åºœ/æç«¯ç›‘ç®¡ |
| æˆæœ¬ | $1-5/å¯†é’¥/æœˆ | $10K+ HSMè®¾å¤‡ + è¿ç»´ |

**å†³ç­–æ¡†æ¶**:

```
æ˜¯å¦é‡‘è/æ”¿åºœè¡Œä¸š? â”€â”€æ˜¯â”€â”€> å®¡è®¡è¦æ±‚"å®¢æˆ·ç‹¬å å¯†é’¥ç¡¬ä»¶"? â”€â”€æ˜¯â”€â”€> HYOK
        â”‚                                â””â”€â”€å¦â”€â”€> BYOK
        â””â”€â”€å¦â”€â”€> æ•°æ®åˆ†ç±»L1/L2? â”€â”€æ˜¯â”€â”€> BYOK
                      â””â”€â”€å¦(L3/L4)â”€â”€> äº‘ç®¡ç†å¯†é’¥
```

### BYOKå®æ–½æ¡ˆä¾‹:é‡‘èæ”¯ä»˜å¹³å°

æŸæ”¯ä»˜å¹³å°(å¹´å¤„ç†äº¤æ˜“$20äº¿)åœ¨PCI DSS 4.0å®¡è®¡ä¸­è¢«è¦æ±‚"è¯æ˜åŠ å¯†å¯†é’¥çš„ç»å¯¹æ§åˆ¶æƒ"ã€‚è¯„ä¼°åé‡‡ç”¨æ··åˆç­–ç•¥:

- **L1æ•°æ®(æ”¯ä»˜å¡CVV/PIN,å æ¯”0.5%)**:HYOK,æœ¬åœ°CloudHSMé›†ç¾¤(3èŠ‚ç‚¹HA),å¯†é’¥æ°¸ä¸å¯¼å‡ºã€‚
- **L2æ•°æ®(äº¤æ˜“è®°å½•,å æ¯”20%)**:BYOK,æœ¬åœ°HSMç”Ÿæˆå¯†é’¥,å¯¼å…¥AWS KMS,è®¾ç½®12ä¸ªæœˆè¿‡æœŸã€‚
- **L3/L4æ•°æ®(å æ¯”79.5%)**:AWSç®¡ç†CMK,æˆæœ¬ä¼˜åŒ–ã€‚

**BYOKå¯†é’¥å¯¼å…¥æµç¨‹**:

```python
import boto3
from cryptography.hazmat.primitives.asymmetric import rsa
from cryptography.hazmat.backends import default_backend

kms = boto3.client('kms')

# æ­¥éª¤1:ä»KMSè·å–å¯¼å…¥ä»¤ç‰Œ(åŒ…å«å…¬é’¥)
import_token_resp = kms.get_parameters_for_import(
    KeyId='arn:aws:kms:us-east-1:123456789012:key/imported-key-id',
    WrappingAlgorithm='RSAES_OAEP_SHA_256',
    WrappingKeySpec='RSA_2048'
)
public_key = import_token_resp['PublicKey']
import_token = import_token_resp['ImportToken']

# æ­¥éª¤2:åœ¨æœ¬åœ°HSMç”Ÿæˆ256-bit AESå¯†é’¥(æ­¤å¤„ç”¨è½¯ä»¶æ¨¡æ‹Ÿ)
from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes
import os
key_material = os.urandom(32)  # 256-bit

# æ­¥éª¤3:ç”¨KMSå…¬é’¥åŒ…è£…å¯†é’¥ææ–™
from cryptography.hazmat.primitives import serialization, hashes
from cryptography.hazmat.primitives.asymmetric import padding

kms_public_key = serialization.load_der_public_key(
    public_key, backend=default_backend()
)
wrapped_key = kms_public_key.encrypt(
    key_material,
    padding.OAEP(
        mgf=padding.MGF1(algorithm=hashes.SHA256()),
        algorithm=hashes.SHA256(),
        label=None
    )
)

# æ­¥éª¤4:å¯¼å…¥å¯†é’¥åˆ°KMS(è®¾ç½®12ä¸ªæœˆè¿‡æœŸ)
from datetime import datetime, timedelta
kms.import_key_material(
    KeyId='arn:aws:kms:us-east-1:123456789012:key/imported-key-id',
    ImportToken=import_token,
    EncryptedKeyMaterial=wrapped_key,
    ExpirationModel='KEY_MATERIAL_EXPIRES',
    ValidTo=datetime.now() + timedelta(days=365)
)
```

**éªŒè¯æ–¹æ³•**:

```python
# æ£€æŸ¥å¯†é’¥æ¥æºä¸è¿‡æœŸæ—¶é—´
key_metadata = kms.describe_key(
    KeyId='arn:aws:kms:us-east-1:123456789012:key/imported-key-id'
)
assert key_metadata['KeyMetadata']['Origin'] == 'EXTERNAL'
assert key_metadata['KeyMetadata']['ExpirationModel'] == 'KEY_MATERIAL_EXPIRES'
```

**å®¡è®¡è¯æ˜ææ–™**:

- æœ¬åœ°HSMå¯†é’¥ç”Ÿæˆæ—¥å¿—(æ—¶é—´æˆ³+æ“ä½œå‘˜èº«ä»½)
- KMS ImportKeyMaterial CloudTrailäº‹ä»¶(è¯æ˜å¯†é’¥ç”±å®¢æˆ·å¯¼å…¥)
- å¯†é’¥è¿‡æœŸè‡ªåŠ¨åˆ é™¤éªŒè¯(è¯æ˜å®¢æˆ·æ§åˆ¶å¯†é’¥ç”Ÿå‘½å‘¨æœŸ)

**æˆæœ¬åˆ†æ**:

- BYOKæˆæœ¬:KMS CMK $1/æœˆ Ã— 50ä¸ªåŒºåŸŸå¯†é’¥ + æœ¬åœ°HSM $1K/æœˆ = $1,050/æœˆ
- é¿å…çš„å®¡è®¡å¤±è´¥æŸå¤±:è‹¥æœªé€šè¿‡PCI DSSå®¡è®¡,ä¸§å¤±æ”¯ä»˜å¡å¤„ç†èµ„è´¨,ä¼°è®¡å¹´æ”¶å…¥æŸå¤± > $50M

---

## 5.5.5 æ•°æ®åˆ†ç±»ä¸DLPå®æ–½

### æ•°æ®åˆ†ç±»æ¡†æ¶

| çº§åˆ« | åˆ†ç±» | å®šä¹‰ | åŠ å¯†è¦æ±‚ | è®¿é—®æ§åˆ¶ |
|------|------|------|----------|----------|
| L1 | ä¸¥æ ¼ä¿æŠ¤ | æ³„éœ²å¯¼è‡´æ³•å¾‹/è´¢åŠ¡ä¸¥é‡æŸå¤± | AES-256 + BYOK/HYOK | MFA + å®¡æ‰¹å·¥ä½œæµ |
| L2 | é‡ç‚¹ä¿æŠ¤ | æ³„éœ²å¯¼è‡´åˆè§„é—®é¢˜/å£°èª‰æŸå¤± | AES-256 + KMS | æœ€å°æƒé™+å®šæœŸå®¡è®¡ |
| L3 | ä¸€èˆ¬ä¿æŠ¤ | æ³„éœ²å¯¼è‡´æœ‰é™å½±å“ | ä¼ è¾“åŠ å¯†(TLS 1.2+) | åŸºäºè§’è‰²è®¿é—® |
| L4 | å…¬å¼€ä¿¡æ¯ | å¯å…¬å¼€è®¿é—® | å¯é€‰ | å…¬å¼€æˆ–ç™»å½•åè®¿é—® |

**åˆ†ç±»ä¾æ®**:

- L1ç¤ºä¾‹:æ”¯ä»˜å¡å·(PCI DSS)ã€èº«ä»½è¯å·(GDPR Article 9ç‰¹æ®Šç±»åˆ«)ã€å¯†ç å“ˆå¸Œã€‚
- L2ç¤ºä¾‹:å§“å+åœ°å€(GDPRä¸ªäººæ•°æ®)ã€è®¢å•è¯¦æƒ…ã€è´¢åŠ¡æŠ¥è¡¨ã€‚
- L3ç¤ºä¾‹:ç”¨æˆ·æµè§ˆå†å²ã€äº§å“è¯„ä»·ã€ç³»ç»Ÿæ—¥å¿—ã€‚
- L4ç¤ºä¾‹:äº§å“ç›®å½•ã€å…¬å¼€åšå®¢æ–‡ç« ã€‚

![DLPæ¶æ„](../../../assets/images/chapter_08/03_DLP_Architecture_v6.png)

### è‡ªåŠ¨åŒ–æ•°æ®å‘ç° - AWS Macie

```python
import boto3
macie = boto3.client('macie2')

# å¯ç”¨Macie
macie.enable_macie(
    status='ENABLED',
    findingPublishingFrequency='FIFTEEN_MINUTES'
)

# åˆ›å»ºæ•æ„Ÿæ•°æ®å‘ç°ä»»åŠ¡
job_response = macie.create_classification_job(
    jobType='ONE_TIME',
    s3JobDefinition={
        'bucketDefinitions': [{
            'accountId': '123456789012',
            'buckets': ['customer-data-bucket']
        }]
    },
    managedDataIdentifierIds=[
        'AWS_CREDENTIALS',
        'CREDIT_CARD',
        'EMAIL_ADDRESS',
        'US_SOCIAL_SECURITY_NUMBER'
    ],
    customDataIdentifiers=[{
        'name': 'InternalEmployeeID',
        'regex': r'EMP-\d{6}'
    }],
    name='Sensitive-Data-Discovery-Q1'
)

# æŸ¥è¯¢é«˜é£é™©å‘ç°
findings = macie.list_findings(
    findingCriteria={
        'criterion': {
            'severity.description': {'eq': ['High']},
            'classificationDetails.result.sensitiveData': {'exists': True}
        }
    }
)
```

**éªŒè¯æ–¹æ³•**:

- åœ¨æµ‹è¯•Bucketä¸­æ”¾å…¥åŒ…å«ä¿¡ç”¨å¡å·çš„CSVæ–‡ä»¶,éªŒè¯Macieåœ¨15åˆ†é’Ÿå†…æ£€æµ‹å¹¶æ ‡è®°ä¸ºHigh severityã€‚
- æ£€æŸ¥è¯¯æŠ¥ç‡:æŠ½æ ·100ä¸ªHigh severityå‘Šè­¦,ç¡®è®¤çœŸå®æ•æ„Ÿæ•°æ®å æ¯” > 95%ã€‚

**è¿è¡ŒæŒ‡æ ‡**:

- æ•°æ®åˆ†ç±»è¦†ç›–ç‡:ç›®æ ‡ â‰¥ 90%(å·²åˆ†ç±»æ•°æ®é‡ / æ€»æ•°æ®é‡)
- æ•æ„Ÿæ•°æ®å‘ç°å»¶è¿Ÿ:ç›®æ ‡ < 24å°æ—¶(æ•°æ®ä¸Šä¼ è‡³S3å,Macieæ£€æµ‹å¹¶åˆ†ç±»çš„æ—¶é—´)

### DLPç­–ç•¥å®æ–½

**Google Cloud DLPç¤ºä¾‹**:

```python
from google.cloud import dlp_v2

dlp = dlp_v2.DlpServiceClient()
project = 'my-project'

# å®šä¹‰æ£€æµ‹é…ç½®
inspect_config = {
    'info_types': [
        {'name': 'EMAIL_ADDRESS'},
        {'name': 'CREDIT_CARD_NUMBER'},
        {'name': 'US_SOCIAL_SECURITY_NUMBER'}
    ],
    'min_likelihood': dlp_v2.Likelihood.LIKELY,
    'limits': {'max_findings_per_request': 100}
}

# å®šä¹‰è„±æ•é…ç½®(ä¿¡ç”¨å¡å·ä¿ç•™å4ä½)
deidentify_config = {
    'info_type_transformations': {
        'transformations': [{
            'primitive_transformation': {
                'character_mask_config': {
                    'masking_character': '*',
                    'number_to_mask': 12,
                    'reverse_order': True
                }
            },
            'info_types': [{'name': 'CREDIT_CARD_NUMBER'}]
        }]
    }
}

# æ‰«æå¹¶è„±æ•
content = "Customer card: 4532-1234-5678-9010"
response = dlp.deidentify_content(
    request={
        'parent': f'projects/{project}',
        'deidentify_config': deidentify_config,
        'inspect_config': inspect_config,
        'item': {'value': content}
    }
)

print(response.item.value)  # è¾“å‡º:Customer card: ************9010
```

**éªŒè¯æ–¹æ³•**:

- å‡†å¤‡åŒ…å«100ä¸ªçœŸå®ä¿¡ç”¨å¡å·çš„æµ‹è¯•æ•°æ®é›†,éªŒè¯DLPæ£€æµ‹ç‡ â‰¥ 99%ã€‚
- å‡†å¤‡åŒ…å«100ä¸ªç±»ä¼¼æ ¼å¼ä½†éä¿¡ç”¨å¡å·çš„æ•°æ®(å¦‚è®¢å•å·),éªŒè¯è¯¯æŠ¥ç‡ < 5%ã€‚

**å¸¸è§è¯¯åŒº**:

- è¿‡åº¦ä¾èµ–DLPå·¥å…·è‡ªåŠ¨é˜»æ–­:DLPåº”ä½œä¸ºæ£€æµ‹+å‘Šè­¦å±‚,é˜»æ–­å†³ç­–éœ€äººå·¥å®¡æ‰¹(é¿å…è¯¯ä¼¤æ­£å¸¸ä¸šåŠ¡)ã€‚
- æœªé…ç½®æ’é™¤è§„åˆ™:æµ‹è¯•ç¯å¢ƒçš„æ¨¡æ‹Ÿæ•°æ®è§¦å‘å¤§é‡DLPå‘Šè­¦,éœ€é…ç½®`exclusion_rule`æ’é™¤ç‰¹å®šè·¯å¾„ã€‚

---

## 5.5.6 æ•°æ®é©»ç•™ä¸è·¨å¢ƒåˆè§„

### ä¸»è¦æ³•è§„æ•°æ®é©»ç•™è¦æ±‚

| æ³•è§„/åœ°åŒº | æ•°æ®é©»ç•™å¼ºåˆ¶æ€§ | è·¨å¢ƒä¼ è¾“æ¡ä»¶ | æŠ€æœ¯å®æ–½ |
|----------|--------------|-------------|---------|
| GDPR (EU) | éå¼ºåˆ¶(ä½†éœ€åˆæ³•ä¾æ®) | SCC/BCR/å……åˆ†æ€§è®¤å®š | EUåŒºåŸŸéƒ¨ç½² |
| PIPL (ä¸­å›½) | å…³åŸº+é‡è¦æ•°æ®å¼ºåˆ¶æœ¬åœ°åŒ– | å®‰å…¨è¯„ä¼°+ä¸»ç®¡éƒ¨é—¨å®¡æ‰¹ | æœ¬åœ°äº‘+é€»è¾‘éš”ç¦» |
| ä¿„ç½—æ–¯è”é‚¦æ³•å¾‹ | å…¬æ°‘ä¸ªäººæ•°æ®å¼ºåˆ¶æœ¬åœ° | ä¸¥æ ¼é™åˆ¶ | æœ¬åœ°æ•°æ®ä¸­å¿ƒ |
| LGPD (å·´è¥¿) | éå¼ºåˆ¶ | å……åˆ†ä¿æŠ¤æªæ–½ | å¯é€‰æœ¬åœ°éƒ¨ç½² |

**å†³ç­–æ¡†æ¶**:

```
å­˜å‚¨EUå…¬æ°‘æ•°æ®? â”€â”€æ˜¯â”€â”€> éœ€è·¨å¢ƒä¼ è¾“è‡³ç¾å›½? â”€â”€æ˜¯â”€â”€> ç­¾ç½²SCC + DPIAè¯„ä¼°
        â”‚                      â””â”€â”€å¦â”€â”€> éƒ¨ç½²äºeu-central-1/eu-west-1
        â””â”€â”€å¦â”€â”€> å­˜å‚¨ä¸­å›½å…¬æ°‘æ•°æ®? â”€â”€æ˜¯â”€â”€> å…³é”®ä¿¡æ¯åŸºç¡€è®¾æ–½?
                                  â”œâ”€â”€æ˜¯â”€â”€> å¼ºåˆ¶æœ¬åœ°åŒ–(é˜¿é‡Œäº‘/è…¾è®¯äº‘)
                                  â””â”€â”€å¦â”€â”€> è¯„ä¼°æ˜¯å¦"é‡è¦æ•°æ®"
```

### è·¨å¢ƒä¼ è¾“å®¡æ‰¹å·¥ä½œæµ

```python
import boto3
from datetime import datetime

def request_cross_border_transfer(
    data_classification, source_region, dest_region,
    business_justification, data_volume_gb, requester_email
):
    """æäº¤è·¨å¢ƒæ•°æ®ä¼ è¾“å®¡æ‰¹è¯·æ±‚"""

    # æ ¹æ®æ•°æ®åˆ†ç±»åˆ¤æ–­æ˜¯å¦éœ€è¦å®¡æ‰¹
    approval_required = data_classification in ['L1', 'L2']
    approvers = ['dpo@company.com', 'ciso@company.com'] if approval_required else []

    request = {
        'request_id': f"CBT-{datetime.now().strftime('%Y%m%d-%H%M%S')}",
        'requester': requester_email,
        'timestamp': datetime.now().isoformat(),
        'data_classification': data_classification,
        'source_region': source_region,
        'destination_region': dest_region,
        'justification': business_justification,
        'data_volume_gb': data_volume_gb,
        'approval_required': approval_required,
        'approvers': approvers,
        'status': 'PENDING' if approval_required else 'AUTO_APPROVED'
    }

    # å­˜å‚¨å®¡æ‰¹è®°å½•åˆ°DynamoDB
    dynamodb = boto3.resource('dynamodb')
    table = dynamodb.Table('CrossBorderTransferRequests')
    table.put_item(Item=request)

    return request['request_id']
```

**éªŒè¯æ–¹æ³•**:

- æ¨¡æ‹ŸL1æ•°æ®è·¨å¢ƒä¼ è¾“è¯·æ±‚,éªŒè¯å·¥ä½œæµè‡ªåŠ¨å‘é€å®¡æ‰¹é‚®ä»¶è‡³DPO+CISOã€‚
- éªŒè¯L3æ•°æ®è‡ªåŠ¨æ‰¹å‡†,æ— éœ€äººå·¥å®¡æ‰¹ã€‚

**è¿è¡ŒæŒ‡æ ‡**:

- å®¡æ‰¹SLAè¾¾æˆç‡:ç›®æ ‡ â‰¥ 95%(L1/L2è·¨å¢ƒè¯·æ±‚åœ¨48å°æ—¶å†…å®Œæˆå®¡æ‰¹)
- æœªæˆæƒè·¨å¢ƒä¼ è¾“æ¬¡æ•°:ç›®æ ‡ = 0(é€šè¿‡VPC Flow Logsç›‘æ§è·¨åŒºåŸŸæµé‡,å¯¹æ¯”å®¡æ‰¹è®°å½•)

---

## 5.5.7 äº‘æ•°æ®åº“å®‰å…¨é…ç½®

### RDSåŠ å¯†ä¸IAMè®¤è¯

```python
import boto3
rds = boto3.client('rds')

# åˆ›å»ºåŠ å¯†RDSå®ä¾‹
response = rds.create_db_instance(
    DBInstanceIdentifier='secure-mysql-db',
    DBInstanceClass='db.t3.medium',
    Engine='mysql',
    EngineVersion='8.0.35',
    MasterUsername='admin',
    MasterUserPassword='SecureP@ssw0rd123!',
    AllocatedStorage=100,
    StorageEncrypted=True,
    KmsKeyId='arn:aws:kms:us-east-1:123456789012:key/<key-id>',

    # ç½‘ç»œéš”ç¦»
    DBSubnetGroupName='private-db-subnet-group',
    PubliclyAccessible=False,

    # å¯ç”¨IAMæ•°æ®åº“è®¤è¯
    EnableIAMDatabaseAuthentication=True,

    # å¤‡ä»½ä¸ç›‘æ§
    BackupRetentionPeriod=30,
    EnableCloudwatchLogsExports=['error', 'slowquery'],
    DeletionProtection=True,
    MultiAZ=True
)
```

**IAMè®¤è¯è¿æ¥ç¤ºä¾‹**:

```python
import pymysql
import boto3

def connect_with_iam():
    rds_client = boto3.client('rds', region_name='us-east-1')

    # ç”Ÿæˆ15åˆ†é’Ÿæœ‰æ•ˆçš„è®¤è¯ä»¤ç‰Œ
    auth_token = rds_client.generate_db_auth_token(
        DBHostname='secure-mysql-db.c123.us-east-1.rds.amazonaws.com',
        Port=3306,
        DBUsername='iam_db_user',
        Region='us-east-1'
    )

    # ä½¿ç”¨ä»¤ç‰Œè¿æ¥(å¼ºåˆ¶SSL)
    conn = pymysql.connect(
        host='secure-mysql-db.c123.us-east-1.rds.amazonaws.com',
        port=3306,
        user='iam_db_user',
        password=auth_token,
        database='production_db',
        ssl={'ssl': True}
    )
    return conn
```

**éªŒè¯æ–¹æ³•**:

- æ£€æŸ¥RDSå®ä¾‹åŠ å¯†çŠ¶æ€:`aws rds describe-db-instances --query 'DBInstances[*].[DBInstanceIdentifier,StorageEncrypted]'`
- éªŒè¯IAMè®¤è¯:å°è¯•ç”¨é”™è¯¯IAMè§’è‰²è¿æ¥,ç¡®è®¤è¿”å›Access Deniedã€‚

**è¿è¡ŒæŒ‡æ ‡**:

- æ•°æ®åº“è¿æ¥æœªåŠ å¯†æ¯”ä¾‹:ç›®æ ‡ = 0%(é€šè¿‡RDSæ€§èƒ½æ´å¯Ÿç›‘æ§SSLè¿æ¥å æ¯”)
- æ ¹è´¦æˆ·ä½¿ç”¨æ¬¡æ•°:ç›®æ ‡ = 0æ¬¡/æœˆ(CloudTrailäº‹ä»¶`eventName=ModifyDBInstance`ä¸”`userIdentity=root`)

---

## æœ¬èŠ‚å°ç»“

### æ ¸å¿ƒæ§åˆ¶ç‚¹

æœ¬èŠ‚å»ºç«‹çš„äº‘æ•°æ®ä¿æŠ¤æ§åˆ¶ç‚¹åŒ…æ‹¬:

1. **å¯¹è±¡å­˜å‚¨è®¿é—®æ§åˆ¶**:Block Public Access + å¼ºåˆ¶HTTPS + Bucket Policyæœ€å°æƒé™åŸåˆ™ã€‚
2. **å¤šå±‚åŠ å¯†ç­–ç•¥**:é™æ€åŠ å¯†(SSE-KMS) + ä¼ è¾“åŠ å¯†(TLS 1.2+) + ä½¿ç”¨ä¸­åŠ å¯†(Nitro Enclaves)ã€‚
3. **å¯†é’¥ç®¡ç†**:AWS KMS/Azure Key Vault/GCP Cloud KMSé€‰å‹,BYOK/HYOKå®æ–½å†³ç­–æ¡†æ¶ã€‚
4. **æ•°æ®åˆ†ç±»ä¸DLP**:L1-L4åˆ†çº§ä½“ç³»,AWS Macie/Google DLPè‡ªåŠ¨åŒ–å‘ç°ã€‚
5. **è·¨å¢ƒé©»ç•™åˆè§„**:åŸºäºGDPR/PIPLçš„å®¡æ‰¹å·¥ä½œæµ,VPCåŒºåŸŸé™åˆ¶ç­–ç•¥ã€‚
6. **æ•°æ®åº“å®‰å…¨**:RDSåŠ å¯†+IAMè®¤è¯+å®¡è®¡æ—¥å¿—ã€‚

### éªŒè¯ä¸è¿è¡Œ

**å…³é”®éªŒè¯æ–¹æ³•**:

- S3å®‰å…¨åŸºçº¿:CSPMå·¥å…·(AWS Security Hub/Prowler)æŒç»­æ‰«æBPA/åŠ å¯†/å…¬å¼€è®¿é—®é…ç½®ã€‚
- åŠ å¯†æœ‰æ•ˆæ€§:S3 InventoryæŠ¥å‘Š`EncryptionStatus`å­—æ®µ,ç›®æ ‡å€¼:æ‰€æœ‰å¯¹è±¡=KMSåŠ å¯†ã€‚
- DLPæ£€æµ‹èƒ½åŠ›:çº¢é˜Ÿæµ‹è¯•ä¸Šä¼ åŒ…å«æ•æ„Ÿæ•°æ®çš„æ–‡ä»¶,éªŒè¯15åˆ†é’Ÿå†…å‘Šè­¦ã€‚
- è·¨å¢ƒåˆè§„:VPC Flow Logsè·¨åŒºåŸŸæµé‡ä¸å®¡æ‰¹è®°å½•äº¤å‰éªŒè¯,å‘ç°æœªæˆæƒä¼ è¾“ã€‚

**è¿è¡ŒæŒ‡æ ‡**:

- æœªåŠ å¯†å¯¹è±¡æ•°é‡:ç›®æ ‡ = 0(æ¯æ—¥S3 Inventoryæ‰«æ)
- KMSå¯†é’¥è½®æ¢åˆè§„ç‡:ç›®æ ‡ = 100%(æ‰€æœ‰CMKå¯ç”¨è‡ªåŠ¨è½®æ¢æˆ–æ‰‹åŠ¨è½®æ¢ â‰¤ 365å¤©)
- æ•æ„Ÿæ•°æ®å‘ç°è¦†ç›–ç‡:ç›®æ ‡ â‰¥ 90%(Macieæ‰«æå­˜å‚¨æ¡¶æ•° / æ€»å­˜å‚¨æ¡¶æ•°)
- è·¨å¢ƒå®¡æ‰¹SLAè¾¾æˆç‡:ç›®æ ‡ â‰¥ 95%(48å°æ—¶å†…å®ŒæˆL1/L2æ•°æ®å®¡æ‰¹)

### å®æ–½çº¦æŸ

**æˆæœ¬çº¦æŸ**:

- KMS APIè°ƒç”¨æˆæœ¬å¯èƒ½è¶…å‡ºé¢„æœŸ:æ¯æœˆ100Mæ¬¡Decryptæ“ä½œ = $30K,éœ€è¯„ä¼°å¯ç”¨Bucket Key(é™ä½99%æˆæœ¬)ã€‚
- Macieæ‰«ææˆæœ¬:é¦–æ¬¡å…¨é‡æ‰«æ500TB = $500K,å¢é‡æ‰«æé™è‡³$5K/æœˆ,éœ€åˆ†é˜¶æ®µå®æ–½ã€‚

**æŠ€æœ¯çº¦æŸ**:

- HYOKæ€§èƒ½ç“¶é¢ˆ:CloudHSMé›†ç¾¤ç½‘ç»œå»¶è¿Ÿ20-50ms,éœ€é€šè¿‡ä¿¡å°åŠ å¯†(Envelope Encryption)ä¼˜åŒ–ã€‚
- å¤šäº‘å¯†é’¥ç®¡ç†å¤æ‚åº¦:AWS KMSä¸Azure Key Vaultæ— åŸç”Ÿäº’æ“ä½œ,éœ€æ„å»ºç»Ÿä¸€å¯†é’¥æ²»ç†å¹³å°ã€‚

**ç»„ç»‡çº¦æŸ**:

- æ•°æ®åˆ†ç±»éœ€ä¸šåŠ¡æ–¹é…åˆ:DLPå·¥å…·ä»…èƒ½è‡ªåŠ¨è¯†åˆ«ç»“æ„åŒ–æ•æ„Ÿæ•°æ®(å¦‚ä¿¡ç”¨å¡å·),éç»“æ„åŒ–æ•°æ®(å¦‚åˆåŒPDF)éœ€äººå·¥æ ‡æ³¨ã€‚
- è·¨å¢ƒå®¡æ‰¹æµç¨‹æ—¶æ•ˆ:L1æ•°æ®è·¨å¢ƒéœ€DPO+CISOåŒé‡å®¡æ‰¹,å¹³å‡è€—æ—¶48-72å°æ—¶,éœ€æå‰è§„åˆ’ã€‚

### å¸¸è§å¤±æ•ˆæ¨¡å¼

1. **é…ç½®æ¼‚ç§»**:å¼€å‘äººå‘˜æ‰‹åŠ¨ä¿®æ”¹Bucket Policyç»•è¿‡BPA â†’ è§£å†³:é€šè¿‡AWS Configè§„åˆ™è‡ªåŠ¨ä¿®å¤+å‘Šè­¦é€šçŸ¥å®‰å…¨å›¢é˜Ÿã€‚
2. **å¯†é’¥è½®æ¢å¤±æ•ˆ**:è‡ªåŠ¨è½®æ¢å¯ç”¨ä½†æœªéªŒè¯æ—§æ•°æ®é‡æ–°åŠ å¯† â†’ è§£å†³:å®šæœŸå®¡è®¡S3å¯¹è±¡çš„KMSå¯†é’¥ç‰ˆæœ¬,æ ‡è®°ä½¿ç”¨æ—§å¯†é’¥çš„å¯¹è±¡ã€‚
3. **DLPè§„åˆ™è¿‡æ—¶**:æ–°å¢æ•°æ®ç±»å‹(å¦‚ç”Ÿç‰©ç‰¹å¾)æœªè¢«DLPè¯†åˆ« â†’ è§£å†³:å­£åº¦è¯„å®¡DLPè§„åˆ™åº“,ç»“åˆçº¢é˜Ÿæµ‹è¯•éªŒè¯è¦†ç›–ç‡ã€‚

### å»¶ä¼¸é˜…è¯»

- AWS: [S3 Security Best Practices](https://docs.aws.amazon.com/AmazonS3/latest/userguide/security-best-practices.html)
- NIST SP 800-175B: Guidelines for Using Cryptographic Standards - Key Management
- CSA: Cloud Data Security Guidance
- GDPR: Data Protection Impact Assessment (DPIA) Template

---

## ğŸ“ å¯¼èˆª | Navigation

**[â† ä¸Šä¸€èŠ‚: 5.4 äº‘å·¥ä½œè´Ÿè½½ä¿æŠ¤](./5.4_cloud_workload_protection.md)** | **[è¿”å› Chapter 5 ç›®å½•](./README.md)** | **[â†’ ä¸‹ä¸€èŠ‚: 5.6 äº‘åŸç”Ÿå®‰å…¨å·¥å…·é“¾](./5.6_cloud_native_security_toolchain.md)**

---

**Â© 2025 AI-ESA Project. Licensed under CC BY-NC-SA 4.0**

