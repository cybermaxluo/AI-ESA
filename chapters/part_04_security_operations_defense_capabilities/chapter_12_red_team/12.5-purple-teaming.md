# 12.5 紫队协作（Purple Teaming）

## 概述

紫队是红队与蓝队协作的组织机制，其核心职能在于将攻击方的战术、技术与程序（TTP）转化为可执行的检测规则与响应流程。与传统红蓝对抗模式不同，紫队协作强调透明性与知识共享，目标是缩短"发现攻击手法"到"具备检测能力"的时间窗口。

本节阐述紫队的核心理念、三种主流协作模式、检测能力验证方法、知识转移机制，以及联合演练的执行框架。

---

## 12.5.1 紫队理念

### 核心定位

紫队并非红队与蓝队的简单叠加，而是独立的协作机制，承担以下职能：

知识转移：将红队掌握的攻击知识系统化转化为蓝队可用的检测规则、响应手册与狩猎假设。这一过程要求红队在演练后详细披露攻击路径、使用工具、关键 IOC（Indicator of Compromise），而非仅提交漏洞报告。

能力验证：通过周期性重放攻击手法，验证已部署检测规则在当前环境下的有效性。安全工具配置漂移、日志采集中断、规则阈值不当等问题均可能导致检测失效，紫队验证机制可及时暴露此类退化。

快速迭代：建立"执行攻击 → 观察检测 → 识别缺口 → 改进规则 → 再次验证"的闭环流程。单次紫队演练周期通常控制在数小时至一天，显著短于传统红队演练的数周周期。

协同文化：消解红蓝对立心态，将安全运营团队的绩效衡量从"是否漏检"转向"检测能力提升幅度"。这一文化转变需要管理层明确支持，避免蓝队因检测失败而受到负面考核。

### 紫队循环

紫队运作遵循以下迭代循环：

1. 红队执行 TTP：按预定场景执行特定攻击技术，可选择公开执行（蓝队可观察）或隐蔽执行（蓝队独立检测）。
2. 蓝队尝试检测：SOC 分析师基于现有规则与工具进行检测，记录告警触发情况与响应时间。
3. 识别检测缺口：对比预期检测点与实际告警情况，识别未覆盖的攻击阶段或检测延迟过长的环节。
4. 制定改进计划：针对缺口编写检测改进计划（DDP），明确数据源、规则逻辑、部署范围与验收标准。
5. 实施检测规则：在开发或预生产环境部署新规则，调整阈值以平衡检出率与误报率。
6. 验证规则有效性：红队重新执行相同 TTP，确认新规则可正常触发告警。

此循环的关键约束在于：每轮迭代必须产出可量化的检测能力变化记录，而非仅停留在定性描述。

---

## 12.5.2 协作模式

紫队协作存在三种主流模式，适用于不同的组织成熟度与演练目标。

### 模式一：实时协作紫队演练

执行流程：红队公开执行攻击技术，蓝队同步观察监控系统，双方即时讨论检测效果，现场调整规则阈值后重新验证。

适用边界：适用于检测工程优化阶段，尤其是新部署安全工具后的规则调优。对于需要验证蓝队独立响应能力的场景，此模式价值有限。

关键约束：

- 要求红蓝双方同处一个物理或虚拟空间，沟通成本较高
- 蓝队已知攻击正在进行，检测结果无法反映真实对抗能力
- 适合检测规则开发人员与红队成员协同工作，不适合 SOC 全员参与

常见误区：

- 将实时协作等同于紫队全部价值，忽视隐蔽演练对能力验证的必要性
- 过度依赖现场调参，未形成标准化规则文档，导致知识无法沉淀

### 模式二：先红后紫（Blind Red, Then Purple）

执行流程：红队在不通知蓝队的情况下执行隐蔽演练，蓝队独立进行检测与响应，演练结束后红队完整披露攻击 TTP，双方联合复盘并制定检测改进计划。

适用边界：适用于检测能力成熟度评估与 SOC 响应流程验证。此模式可真实反映蓝队在对抗场景下的表现，是紫队协作的主要形态。

关键约束：

- 演练前需明确红队活动时间窗口，避免与真实安全事件混淆
- 复盘阶段需红队完整披露攻击链，包括失败尝试与绕过方法
- 演练周期较长，通常需要数天至数周

验证方法：

- 将红队 TTP 映射至 MITRE ATT&CK 矩阵、统计各技术的检测覆盖率
- 记录每个攻击阶段的平均检测时间（MTTD）、与基线对比

### 模式三：自动化紫队

执行流程：使用 BAS（Breach and Attack Simulation）平台自动执行预定义 TTP，SIEM/SOAR 系统自动检测并生成告警，平台自动生成覆盖度报告，人工审查检测缺口后更新规则库。

适用边界：适用于检测规则持续验证与回归测试。可实现周级甚至日级的检测能力验证，但无法替代人工红队的创造性攻击。

关键约束：

- BAS 平台执行的是已知攻击模式，无法发现零日漏洞或新型攻击手法
- 自动化覆盖度报告需人工校验，避免因环境差异导致的误判
- 平台运维本身需要专人负责，存在额外人力成本

运行指标：

- 每周自动化验证覆盖的 ATT&CK 技术数量
- 检测规则退化告警数（原本可检测的技术本周未检出）
- 从发现缺口到规则修复的平均周期

---

## 12.5.3 检测能力验证

### 检测覆盖度矩阵

检测覆盖度矩阵是紫队核心产出物之一，用于系统化记录每项攻击技术的检测状态。以下示例展示矩阵结构（数值仅为格式示意，非实际数据）：

| ATT&CK 技术            | 红队执行 | 检测规则        | MTTD   | 误报率 | 状态             |
| ---------------------- | -------- | --------------- | ------ | ------ | ---------------- |
| T1566.001 钓鱼附件     | 已执行   | SIEM Rule #xxx  | 待填写 | 待评估 | 通过/需优化/缺失 |
| T1059.001 PowerShell   | 已执行   | EDR Policy #xxx | 待填写 | 待评估 | 通过/需优化/缺失 |
| T1003.001 LSASS 转储   | 已执行   | 待建设          | N/A    | N/A    | 缺失             |
| T1021.001 RDP 远程桌面 | 已执行   | SIEM Rule #xxx  | 待填写 | 待评估 | 通过/需优化/缺失 |

矩阵维度说明：

- MTTD（Mean Time To Detect），从攻击执行到首次告警的平均时间，需结合业务容忍度设定阈值
- 误报率，该规则触发告警中非真实攻击的比例，过高会导致分析师疲劳
- 状态判定标准，需在组织内预先定义，例如"MTTD 超过内部阈值即为需优化"

### 检测改进计划（DDP）

检测改进计划是紫队演练的关键交付物，用于将检测缺口转化为可执行的工程任务。DDP 应包含以下要素：

缺口描述：明确缺失的检测能力，包括对应的 ATT&CK 技术编号、攻击场景描述、当前风险等级。

当前状态：说明现有检测覆盖情况，包括已尝试但失效的规则、日志数据源缺失情况。

目标状态：定义检测能力目标，包括需覆盖的攻击变种、预期 MTTD、可接受误报率。

实施计划：分阶段规划实施步骤、每阶段应有明确的验收标准。典型阶段划分：

- 第一阶段：部署必要的日志采集（如 Sysmon 配置调整）并在隔离环境验证
- 第二阶段：在小范围生产环境灰度部署、观察误报情况
- 第三阶段：全量部署、红队重新验证检测有效性

成功标准：量化验收条件、例如"红队使用相同 TTP 重测时检测率达到预设目标""误报率控制在预设阈值内"。

责任人与时间节点：明确 DDP 负责人、协作方、里程碑日期。

常见误区：

- DDP 停留在文档阶段，未纳入安全运营团队的工作排期
- 成功标准过于模糊，如"提升检测能力"而非可量化指标
- 忽视误报调优，规则上线后因高误报被禁用

---

## 12.5.4 知识转移

### TTP 知识库

紫队协作产出的知识需要结构化存储，形成组织内部的攻防知识库。知识库通常采用以下目录结构：

```
purple_team_knowledge/
├── attack_techniques/
│   ├── T1566.001-phishing/
│   │   ├── red_team_playbook.md      # 红队执行手册
│   │   ├── blue_team_detection.md    # 蓝队检测指南
│   │   ├── siem_rules/               # 对应 SIEM 规则
│   │   ├── atomic_tests/             # 原子化测试脚本
│   │   └── investigation_guide.md    # 调查分析手册
│   └── ...
├── detection_rules/
│   ├── sigma/                        # Sigma 格式规则
│   ├── splunk/                       # Splunk SPL 规则
│   ├── elasticsearch/                # Elastic Query DSL
│   └── sentinel/                     # Microsoft Sentinel 规则
└── response_playbooks/
    ├── phishing_response.md
    ├── ransomware_response.md
    └── ...
```

关键约束：

- 知识库需定期维护，清理过时内容，更新工具版本与配置
- 敏感攻击细节需设置访问权限，避免内部泄露
- 规则代码需纳入版本控制，支持变更追溯

### 培训与能力建设

紫队协作机制需配套能力建设活动，确保参与人员具备必要技能。

定期紫队训练营：建议按季度或半年周期组织，参与者包括红队、蓝队与 SOC 分析师。内容涵盖最新 TTP 介绍、检测规则编写实操、响应流程桌面推演、工具使用培训。训练营的产出物应包括更新后的知识库条目与新增检测规则。

验证方法：

- 训练营结束后组织检测规则编写考核、评估学员能力
- 统计训练营产出规则的生产部署率与检出效果

---

## 12.5.5 联合演练

### 演练场景设计

联合演练是紫队协作的高级形态，需要完整规划攻击场景、预期检测点与复盘流程。以下以勒索软件模拟为例说明演练设计框架。

演练目标：验证勒索软件攻击链各阶段的检测与响应能力，识别检测缺口与响应流程瓶颈。

红队行动规划：

```
阶段一：初始访问
  技术：T1566.001（钓鱼邮件）
  预期检测点：邮件网关、用户上报

阶段二：执行
  技术：T1059.001（PowerShell）
  预期检测点：EDR 行为监控、脚本块日志

阶段三：持久化
  技术：T1547.001（注册表 Run Key）
  预期检测点：EDR、Sysmon Event ID 13

阶段四：影响（模拟）
  技术：T1486（数据加密勒索）
  预期检测点：EDR 勒索行为检测、文件活动监控
```

紫队验证流程：

1. 蓝队在不知具体攻击时间的情况下独立检测响应
2. 记录每个阶段的检测时间与响应动作
3. 演练结束后对比预期检测点与实际检测情况
4. 针对缺口制定 DDP

![事件响应生命周期](../../../assets/images/chapter_12/01_Incident_Response_Lifecycle_v6.png)

### 复盘报告结构

演练复盘报告应包含以下要素：

演练概况：日期、演练类型、参与团队与人数、攻击场景概述。

各阶段检测成效：逐阶段记录检测时间、触发的检测工具与规则、响应动作、效果评估。评估结论应基于预设标准，而非主观判断。

检测缺口清单：列出未检测或检测延迟超标的环节，按优先级排序。

改进计划：针对每项缺口制定 DDP，明确优先级、责任人、时间节点。优先级判定应考虑攻击阶段的关键性（如持久化缺失比横向移动缺失更危险）与修复难度。

下次演练规划：根据本次缺口确定下次演练重点、形成持续改进闭环。

常见误区：

- 复盘流于形式，未形成可执行的改进任务
- 改进计划缺乏跟踪机制，DDP 完成率低
- 仅关注检测缺口，忽视响应流程中的瓶颈（如隔离操作耗时过长）

验证方法：

- 下次演练时重新验证本次缺口的修复效果
- 统计 DDP 完成率与规则上线后的检出效果
- 对比连续多次演练的整体检测覆盖率变化

---

## 本节小结

紫队协作是将红队攻击能力转化为防御能力的关键机制。其核心价值不在于发现漏洞本身，而在于系统化提升检测与响应能力。

紫队协作的有效运作依赖以下条件：明确的协作文化与管理层支持、结构化的知识转移流程、可量化的检测改进计划、持续的验证与迭代机制。

检测改进计划（DDP）是紫队的核心交付物，其质量直接决定协作成效。DDP 需包含明确的目标状态、分阶段实施计划、可量化的验收标准与责任分工。

组织在实施紫队协作时，常见误区包括：将紫队等同于红蓝同席、DDP 停留在文档阶段无人跟进、知识库缺乏维护导致信息过时、演练频率过低无法形成持续改进闭环。

---

## 导航

**[← 上一节：12.4 演练设计](./12.4-exercise-design.md)** | **[返回章节目录](./README.md)** | **[下一节：12.6 攻击模拟与 BAS →](./12.6-bas-automation.md)**

---

**© 2025 AI-ESA Project. Licensed under CC BY-NC-SA 4.0**
