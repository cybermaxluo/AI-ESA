# 12.6 攻击模拟与 BAS (Breach and Attack Simulation)

## 概述

BAS 项目的失败模式往往不是技术问题，而是期望管理问题。常见的情形是：安全团队花费数月完成平台选型与部署，首次运行生成了一份覆盖度报告——显示大量检测缺口。报告被呈送给管理层，管理层追问"这些缺口什么时候能修复"，安全团队发现自己根本没有资源逐一修复，报告被束之高阁，平台逐渐沦为摆设。半年后复盘项目效果时，除了"知道自己有很多检测缺口"之外没有实质改进。

另一种失败模式是过度依赖。某些团队将 BAS 视为红队的"自动化替代品"，大幅削减人工红队投入，结果发现 BAS 能够验证的都是已知攻击模式，对于真实 APT 使用的新型手法毫无检测能力——因为这些手法尚未被纳入 BAS 场景库。当真实攻击发生时，团队才意识到检测体系存在系统性盲区。

BAS (Breach and Attack Simulation) 是一类自动化攻击模拟平台，通过程序化执行预定义的攻击技术（TTP），在受控环境中持续验证安全检测规则的有效性。与人工红队演练相比，BAS 的核心特征在于自动化程度高、可重复执行、覆盖广度大；其局限性在于无法模拟真实攻击者的创造性行为与业务逻辑攻击。正确理解 BAS 的定位——它是检测规则的"回归测试工具"而非"攻防能力的完整验证"——是项目成功的前提。

本节阐述 BAS 的技术原理、主流平台选型考量、与红队的互补关系、实施路径，以及持续验证框架的设计。

---

## 12.6.1 BAS 基础概念

### 技术定位

BAS 平台的核心功能是将攻击技术（通常映射至 MITRE ATT&CK 矩阵）转化为可自动执行的测试用例，在目标环境中触发攻击行为，随后检验安全监控系统是否产生预期告警。这一过程可概括为"执行攻击 → 检查检测 → 生成报告"的闭环。

BAS 与传统渗透测试、红队演练的本质区别在于：BAS 执行的是已知攻击模式的标准化重放，而非探索性攻击。其价值不在于发现新漏洞，而在于验证已部署检测规则在当前配置下是否仍然有效。

适用边界：

- 适用场景：检测规则回归测试、安全工具升级后的能力验证、合规审计的检测覆盖度证明、新入职 SOC 分析师培训
- 不适用场景：零日漏洞发现、业务逻辑漏洞挖掘、物理安全评估、社会工程学评估、需要创造性绕过的对抗性测试

关键约束：

- BAS 测试用例基于已知 TTP，对于攻击者使用的新型手法或变种存在盲区
- 自动化测试在生产环境执行时需严格控制范围，避免触发业务中断或安全工具的联动响应（如自动隔离主机）
- 平台维护需要专人负责场景库更新与环境适配，存在持续运营成本

### BAS 与红队的差异

理解 BAS 与红队的差异是正确选型的前提。两者在多个维度上存在本质区别：

自动化程度：BAS 依赖预定义脚本自动执行，红队以人工操作为主，辅以自动化工具。

隐蔽性：BAS 执行通常不追求隐蔽（防御方已知测试正在进行），红队演练则需模拟真实攻击者的规避行为。

覆盖特征：BAS 侧重广度，可同时验证数十甚至上百种 TTP；红队侧重深度，沿完整攻击链纵向推进。

业务场景覆盖：BAS 主要验证技术层面的检测能力，红队可覆盖业务逻辑攻击与人员安全意识。

执行频率：BAS 可实现持续运行（日级或周级），红队演练通常为周期性（季度或年度）。

成本结构：BAS 的主要成本为平台许可费与运维人力，红队的主要成本为高级安全人员薪资。

适用阶段：BAS 适合已具备基础检测能力、需要持续验证的组织（安全成熟度中等及以上）；红队适合检测能力较成熟、需要深度对抗验证的组织。

### 互补关系

BAS 与红队并非替代关系，而是互补关系。理解这一点需要认识到两者的本质差异：BAS 验证的是"已知攻击模式是否被检测"，红队验证的是"真实攻击者能否突破防御"。前者是确定性测试，后者是探索性对抗。一个检测覆盖率 90% 的环境，如果那 10% 的盲区恰好包含攻击者的关键路径，整体防御仍可能失效——这是 BAS 无法发现、只有红队才能暴露的问题。

在实际运营中，两者应形成协同循环：

BAS 持续执行标准化测试，发现检测规则的覆盖缺口或配置退化；识别出的高优先级缺口交由红队进行深度验证，确认该缺口在真实攻击场景下的可利用性；红队验证结果反馈至紫队，由紫队主导检测规则优化；优化后的规则纳入 BAS 持续验证范围，形成闭环。

此外，红队演练中发现的新攻击手法经过脱敏与标准化后，应更新至 BAS 场景库，扩展自动化验证覆盖范围。威胁情报驱动的新 TTP 同样应纳入 BAS 场景库。这一循环的健康运转标志是：BAS 场景库不断丰富（来自红队和威胁情报的输入），同时 BAS 发现的缺口数量逐步下降（来自紫队改进的成效）。

常见误区：

- 将 BAS 视为红队的替代品，认为部署 BAS 后可减少红队投入。实际上 BAS 无法替代红队的创造性攻击能力
- 仅依赖 BAS 覆盖度报告评估安全态势，忽视 BAS 对新型威胁的盲区
- 在未建立基础检测能力的情况下部署 BAS，导致大量失败测试但无能力跟进修复

---

## 12.6.2 BAS 平台选型

### 开源平台：MITRE CALDERA

CALDERA 是 MITRE 组织开发的开源对抗模拟平台，与 ATT&CK 框架深度集成。其核心组件包括：

架构组成：

- Caldera Server：中央控制服务器，负责任务调度与结果收集
- Agents：部署在目标主机的代理程序，执行攻击指令
- Abilities：单个攻击能力模块，对应 ATT&CK 的具体技术
- Adversaries：攻击剧本，由多个 Abilities 组合而成，模拟特定威胁行为者
- Operations：具体演练任务，关联 Adversary、目标 Agents、执行规则

支持平台：Windows、Linux、macOS，以及 Docker 容器环境。

适用边界：

- 适合预算有限、具备开源工具运维能力的组织
- 适合安全团队希望深度定制攻击场景的场景
- 适合与内部红队工具链集成，构建统一攻防平台

关键约束：

- 开源版本的企业级功能（如多租户、细粒度权限、SLA 支持）有限
- 场景库需自行维护更新，依赖社区或内部红队贡献
- 部署与运维需要具备一定 Python 与系统管理能力的人员

验证方法：

- 在隔离测试环境部署 CALDERA 并执行基础 Adversary 配置文件（如 APT29 模拟）
- 验证 Agent 与 Server 通信稳定性、日志采集完整性
- 将 CALDERA 执行的 TTP 与 SIEM 告警进行关联，评估检测覆盖率

### 商业平台：SafeBreach、Cymulate、AttackIQ

商业 BAS 平台通常提供更丰富的预置场景库、企业级管理功能与厂商技术支持。以下为三个主流平台的特征概述（具体功能与定价需以厂商最新资料为准）：

SafeBreach：企业级 SaaS 平台，提供大量预置攻击场景，支持与主流安全产品（SIEM、EDR、WAF、邮件网关）集成，可自动生成修复建议。覆盖范围包括网络安全、端点安全、邮件安全、Web 安全、云安全等领域。

Cymulate：全栈 BAS 平台，模块化设计支持按需采购。特点包括即时威胁情报集成（可快速模拟新发布的 CVE）、面向管理层的执行摘要视图、合规框架映射（MITRE ATT&CK、NIST 等）。主要模块涵盖最新威胁模拟、完整攻击链验证、邮件网关测试、Web 网关测试、WAF 绕过测试、端点安全测试、数据外带测试等。

AttackIQ：定位为对抗性安全验证平台，强调与 ATT&CK 的深度集成，提供紫队协作功能与自定义攻击场景能力。适合需要将 BAS 与紫队流程深度整合的组织。

选型考量维度：

组织在选型时应评估以下因素，而非单纯比较功能列表：

- 场景库与更新频率：预置场景数量、新威胁情报转化为测试用例的周期
- 集成能力：与现有 SIEM/SOAR/EDR 的集成深度、API 开放程度
- 部署模式：SaaS 部署与本地部署的支持情况、数据主权要求
- 报告与合规：报告格式是否满足审计要求、是否支持目标合规框架映射
- 运维复杂度：平台维护所需人力、厂商技术支持响应能力
- 总拥有成本：许可费用结构、规模扩展成本、隐性运维成本

常见误区：

- 仅关注场景数量而忽视场景质量与环境适配性
- 选型时未充分评估与现有安全工具的集成复杂度，导致部署后无法获得预期价值
- 低估平台运维投入，认为购买商业平台即可实现"开箱即用"

---

## 12.6.3 BAS 实施路径

### 分阶段实施框架

BAS 部署应遵循渐进式路径，避免一步到位导致的资源浪费与能力断层。许多 BAS 项目的失败根源在于"启动过大"——试图在第一阶段就覆盖全部 ATT&CK 技术、接入全部业务系统、实现全自动化验证。结果是：场景库过大导致每次运行耗时过长，接入系统过多导致协调成本激增，自动化程度过高导致分析师无法理解告警含义。更务实的策略是从小处起步，先在有限范围内跑通"执行 → 检测 → 报告 → 改进"的完整闭环，再逐步扩大覆盖范围。

第一阶段：试点验证

目标：在受控环境验证 BAS 平台可行性，建立基础运营流程。

主要任务：

- 选择 BAS 平台（建议从 CALDERA 等开源平台开始，降低试错成本）
- 在隔离测试环境部署平台与 Agent
- 选择高优先级 TTP（建议初期聚焦组织面临的主要威胁类型，控制场景数量以确保可管理）
- 执行测试并评估与 SIEM 的告警关联效果
- 评估平台运维复杂度与人员技能缺口

验收标准：

- 平台稳定运行，Agent 通信可靠
- 至少完成一轮完整的"执行 → 检测 → 报告"闭环
- 形成初版运营手册与告警关联规则

第二阶段：扩展部署

目标：扩展覆盖范围，建立与安全运营体系的集成。

主要任务：

- 扩展至非核心生产环境（需与业务方充分沟通，获取变更审批）
- 增加 TTP 覆盖范围（逐步扩展以覆盖主要攻击阶段）
- 实现与 SIEM/SOAR 的自动化集成（BAS 执行结果自动写入 SIEM，检测缺口自动生成工单）
- 建立定期报告机制，向安全运营团队与管理层汇报覆盖度变化
- 启动紫队循环，将 BAS 发现的缺口纳入检测改进计划

验收标准：

- 生产环境执行无业务影响
- 检测覆盖度报告可自动生成
- 至少完成一个完整的紫队改进循环

第三阶段：规模化运营

目标：实现持续验证，形成常态化运营机制。

主要任务：

- 全环境覆盖（包括云环境、远程办公端点等）
- 建立持续运行机制（每日或每周自动执行）
- 与威胁情报联动（新 TTP 情报自动转化为测试用例）
- 开发业务相关的自定义场景（如针对核心业务系统的攻击模拟）
- 评估是否需要引入商业平台以获得更丰富的功能

验收标准：

- 持续运行机制稳定，无人工干预可完成周期性验证
- 覆盖度趋势可追溯，检测能力变化可量化
- 检测缺口从发现到修复的平均周期持续缩短

关键约束：

- 各阶段时长需根据组织实际能力调整，不建议设定固定时间表
- 生产环境扩展前必须完成充分的测试环境验证与业务影响评估
- 每阶段结束应进行回顾，评估是否具备进入下一阶段的条件

### 技术集成架构

BAS 的价值实现依赖与安全监控体系的有效集成。典型集成架构如下：

与 SIEM 集成：
BAS 平台执行攻击模拟，产生的日志与事件被安全监控系统采集；SIEM 基于检测规则判定是否告警；BAS 平台通过 API 查询 SIEM 告警数据；对比执行的 TTP 与产生的告警，计算检测覆盖率；生成覆盖度报告与缺口清单。

此集成的关键在于时间戳对齐与事件关联。BAS 执行记录需包含精确时间戳，SIEM 查询需限定时间窗口，避免将非 BAS 触发的告警误判为检测成功。

与 SOAR 集成：
进阶集成模式可将 BAS 与 SOAR 联动：BAS 触发攻击 → SIEM 检测告警 → SOAR 自动执行响应剧本 → BAS 验证响应是否生效。此模式可同时验证检测能力与响应能力，但实施复杂度较高，建议在基础集成稳定后再考虑。

验证方法：

- 执行已知可检测的 TTP，确认 SIEM 告警正常产生且时间戳关联准确
- 故意执行一个无检测规则覆盖的 TTP，确认报告正确标记为"未检测"
- 模拟网络中断场景，验证 BAS 平台的异常处理与告警机制

### 场景库管理

场景库是 BAS 平台的核心资产，需建立结构化管理机制：

```
bas_scenarios/
├── mitre_attack/           # 按 ATT&CK 战术分类
│   ├── initial_access/
│   ├── execution/
│   ├── persistence/
│   ├── privilege_escalation/
│   ├── defense_evasion/
│   ├── credential_access/
│   ├── discovery/
│   ├── lateral_movement/
│   ├── collection/
│   ├── command_and_control/
│   ├── exfiltration/
│   └── impact/
├── threat_actors/          # 按威胁行为者分类
│   ├── apt29/
│   ├── apt41/
│   └── fin7/
├── industry_specific/      # 行业特定场景
│   ├── financial/
│   ├── healthcare/
│   └── manufacturing/
├── compliance/             # 合规验证场景
│   ├── pci_dss/
│   ├── hipaa/
│   └── iso27001/
└── custom/                 # 组织自定义场景
    ├── business_logic/
    └── crown_jewels/
```

运行指标：

- 场景库总数与可执行场景数（部分场景可能因环境不兼容无法执行）
- 场景更新频率（新增/修改/废弃）
- 各类别场景的检测覆盖率趋势

---

## 12.6.4 持续验证框架

### 验证节奏设计

持续验证需根据验证目的与资源约束设计合理节奏：

高频验证（日级）：

- 验证范围：关键 TTP（根据组织威胁画像确定的高优先级技术）、新部署的检测规则、高价值资产相关场景
- 目的：及时发现检测规则退化或配置漂移
- 约束：需控制执行规模，避免对监控系统造成过大压力

常规验证（周级）：

- 验证范围：完整 TTP 库、合规要求场景、上周新增威胁情报对应的场景
- 目的：维护完整的检测覆盖度视图
- 约束：执行窗口需避开业务高峰期

触发式验证（按需）：

- 触发条件：新 CVE 发布、安全工具升级、检测规则变更、基础设施配置变更
- 目的：验证变更未引入检测能力退化
- 约束：需建立与变更管理流程的联动机制

常见误区：

- 设定过于激进的验证频率，导致运维负担过重、告警疲劳
- 仅执行高频验证而忽视完整覆盖度验证，形成检测盲区
- 触发式验证依赖人工判断，未与变更管理流程自动化集成

### 报告框架

BAS 报告应服务于不同受众的决策需求。以下为报告结构框架（具体数值需根据实际执行结果填充）：

执行摘要（面向管理层）：

- 报告周期
- 执行测试总数
- 检测成功数与成功率
- 检测失败数与失败率
- 较上一周期的变化趋势
- 关键风险缺口数量与简述

检测缺口详情（面向安全运营团队）：

- 按优先级排序的缺口清单
- 每项缺口包含：ATT&CK 技术编号、缺口描述、当前状态（无检测/检测失效/高误报）、建议优先级、关联的业务风险

趋势分析（面向持续改进）：

- 周环比/月环比检测率变化
- 各攻击阶段的覆盖率分布
- 检测能力改进速度（从发现缺口到修复的平均周期）

修复建议（面向检测工程团队）：

- 针对每项缺口的具体修复建议
- 建议优先级依据（风险等级、修复难度、依赖条件）
- 参考检测规则或配置示例（如适用）

验证方法：

- 报告数据应可追溯至具体执行记录
- 覆盖率计算逻辑需文档化，确保口径一致
- 与紫队检测改进计划（DDP）建立关联，跟踪缺口修复进度

运行指标：

- 整体检测覆盖率（检测成功的 TTP 数 / 执行的 TTP 总数）
- 关键 TTP 检测率（高优先级 TTP 的检测成功率）
- 检测规则退化率（本周期未检测但上周期可检测的 TTP 数）
- 平均检测时间（MTTD，从攻击执行到告警产生的时间）
- 检测缺口修复周期（从缺口发现到规则上线的平均天数）

---

## 12.6.5 实施要点

### 成功要素

BAS 实施成功依赖以下条件的具备：

明确的验证目标：在启动 BAS 项目前，需明确核心目标是检测规则验证、合规审计支撑、还是能力建设。不同目标对应不同的场景选择、报告格式与成功标准。

渐进式扩展：遵循"测试环境 → 非核心生产 → 全环境"的扩展路径，每阶段设定明确的准入标准与回退计划。

紫队协同机制：BAS 发现的缺口需通过紫队机制转化为检测改进，否则仅产出报告而无实际改进。BAS 运营团队应与检测工程团队建立固定协作节奏。

持续更新机制：场景库需随威胁情报与红队演练成果持续更新。建议建立场景贡献与审核流程，确保新场景的质量与适用性。

运营资源保障：BAS 平台需要持续运维投入，包括平台维护、场景更新、报告分析、缺口跟进。在项目规划阶段需明确运营团队职责与人力配置。

### 常见误区

| 常见误区   | 表现                                     | 根因分析                       | 应对措施                                |
| ---------- | ---------------------------------------- | ------------------------------ | --------------------------------------- |
| 仅依赖 BAS | 认为 BAS 可替代红队，减少人工红队投入    | 对 BAS 定位理解偏差            | 明确 BAS 与红队的互补关系，维持红队能力 |
| 告警疲劳   | 大量缺口告警无人跟进，团队对报告失去信任 | 验证频率过高或缺口跟进机制缺失 | 控制初期验证规模，建立缺口跟进 SLA      |
| 无闭环改进 | 持续发现相同缺口，检测能力无实质提升     | 缺口未纳入检测工程排期         | 将 DDP 与检测工程路线图整合             |
| 场景陈旧   | 场景库长期不更新，验证价值下降           | 无场景更新机制或资源           | 建立场景更新流程，与威胁情报/红队联动   |
| 脱离业务   | 仅验证通用技术场景，忽视业务特定风险     | 场景设计未纳入业务视角         | 开发业务相关自定义场景，纳入 BISO 参与  |

验证方法：

- 定期回顾 BAS 项目健康度，评估是否存在上述常见误区的早期信号
- 统计检测缺口的修复率与平均修复周期
- 调研安全运营团队对 BAS 报告的使用情况与满意度

---

## 本节小结

BAS 是检测能力持续验证的自动化手段，其核心价值在于将检测规则有效性验证从周期性人工活动转化为持续自动化流程。BAS 与红队形成互补：BAS 负责广度覆盖与持续验证，红队负责深度对抗与创造性攻击。

BAS 实施应遵循渐进式路径，从试点验证起步，逐步扩展至规模化运营。关键成功要素包括：明确的验证目标、与紫队的协同机制、持续的场景更新、以及充足的运营资源。

BAS 的常见误区包括将其视为红队替代品、告警疲劳导致报告失去公信力、检测缺口无闭环改进等。组织应在项目启动时识别这些风险，并建立相应的预防机制。

选型时，开源平台（如 CALDERA）适合预算有限且具备运维能力的组织，商业平台适合需要快速获得完整功能与厂商支持的组织。无论选择何种平台，BAS 的价值实现最终取决于与安全运营体系的有效集成，以及检测缺口到规则改进的闭环效率。

---

## 导航

**[← 上一节：12.5 紫队协作](./12.5-purple-teaming.md)** | **[返回章节目录](./README.md)** | **[下一节：12.7 报告与价值 →](./12.7-reporting-value.md)**

---

**© 2025 AI-ESA Project. Licensed under CC BY-NC-SA 4.0**
