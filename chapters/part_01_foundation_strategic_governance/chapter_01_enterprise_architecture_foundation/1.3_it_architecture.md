# 1.3 IT架构——TOGAF BDAT与Cloud映射

## IT Architecture: TOGAF BDAT and Cloud Service Mapping

> **核心理念**：IT架构是连接业务战略与技术实施的桥梁，通过TOGAF BDAT四层模型（业务/数据/应用/技术）将抽象的业务需求转化为可落地的技术方案，并映射到现代云服务架构（Cloud/IaaS/PaaS/SaaS）。

---

## 1.3.1 IT架构原则

### 原则1：标准化与黄金路径（Golden Path）

**核心理念**：为开发者提供"默认安全"的最佳实践模板与脚手架。

**实践要点**：

- 提供预配置的安全模板（项目脚手架、CI/CD模板）
- 建立技术栈标准目录（推荐框架、库、工具）
- 降低开发者安全决策负担（安全默认启用）
- 持续优化黄金路径（基于反馈迭代）

**示例**：

```
# 黄金路径项目脚手架示例
project-template/
├── .gitlab-ci.yml          # 预配置安全扫描
├── Dockerfile              # 安全基础镜像
├── k8s/                    # K8s安全配置
│   ├── deployment.yaml     # 安全上下文配置
│   └── network-policy.yaml # 网络策略
├── src/
│   ├── auth/              # 认证授权模块
│   └── logging/           # 日志审计模块
└── docs/
    └── security-guide.md  # 安全开发指南
```

### 原则2：共享责任清晰

**核心理念**：云厂商与企业自建的责任边界清晰，每个控制点都有明确的责任方。

**共享责任模型**：

| 层级            | 云厂商责任                     | 企业责任                         |
| --------------- | ------------------------------ | -------------------------------- |
| **SaaS**  | 应用安全、数据加密、访问控制   | 用户权限管理、数据分类、合规配置 |
| **PaaS**  | 平台安全、运行时安全、中间件   | 应用代码安全、配置管理、密钥管理 |
| **IaaS**  | 物理安全、虚拟化、网络基础设施 | OS安全、网络配置、安全组、镜像   |
| **Cloud** | 数据中心、硬件、电力           | 账户安全、IAM、日志审计、合规    |

### 原则3：可组合与低耦合

**核心理念**：组件化、接口化设计，便于替换与升级。

**架构设计要点**：

- 服务化拆分（微服务架构）
- API优先设计（API-first）
- 标准化接口（RESTful/gRPC/GraphQL）
- 插件化扩展（可替换组件）
- 容器化部署（Docker/K8s）

---

## 1.3.2 TOGAF框架概述

### 什么是TOGAF？

**TOGAF（The Open Group Architecture Framework）** 是企业架构设计的通用方法论，核心价值是搭建"商业架构到IT架构"的完整落地路径。

**核心价值**：

- 提供标准化的架构开发方法（ADM - Architecture Development Method）
- 建立业务与IT的沟通语言
- 确保架构决策的可追溯性
- 支持架构治理与演进

**与其他框架的关系**：

- **ITIL**：聚焦IT基础架构的落地执行指导
- **ITSM**：提供IT服务管理的标准化框架
- **TOGAF**：从战略到实施的完整架构设计方法论

三者共同支撑架构从设计到运营的闭环。

### BDAT四层架构模型

TOGAF的核心架构模型为**BDAT四层架构**：

```
┌─────────────────────────────────────────┐
│  1. Business Architecture（业务架构）    │
│     衔接商业目标与业务流程，架构设计起点  │
└─────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────┐
│  2. Data Architecture（数据架构）        │
│     定义数据资产、流转逻辑与管理标准      │
└─────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────┐
│  3. Application Architecture（应用架构）  │
│     规划应用系统的功能、交互关系与集成    │
└─────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────┐
│  4. Technology Architecture（技术架构）   │
│     为上层架构提供技术支撑（基础设施）    │
└─────────────────────────────────────────┘
```

---

## 1.3.3 BDAT四层架构详解

### 1. Business（业务架构）

**核心定位**：衔接商业目标与业务流程，是架构设计的起点。

**关键产出**：

- **业务能力图**（Business Capability Map）：识别企业核心能力
- **价值流图**（Value Stream）：展示价值创造过程
- **服务蓝图**（Service Blueprint）：定义业务服务与触点

**安全控制映射**：

- 业务连续性管理（BCM/DR）
- 业务风控与反欺诈
- 业务流程审计
- 合规性要求映射

**示例：电商平台业务能力图**

| 业务域             | 核心能力             | 安全需求              |
| ------------------ | -------------------- | --------------------- |
| **用户管理** | 注册、登录、身份认证 | MFA、账户保护、反爬虫 |
| **商品管理** | 商品发布、库存管理   | 内容审核、数据完整性  |
| **交易管理** | 下单、支付、结算     | 支付安全、欺诈检测    |
| **物流管理** | 订单履约、配送跟踪   | 信息保护、隐私合规    |
| **客户服务** | 咨询、投诉、退换货   | 数据访问控制、审计    |

### 2. Data（数据架构）

**核心定位**：定义数据资产、流转逻辑与管理标准。

**关键产出**：

- **数据域划分**：按业务划分数据域（用户域/订单域/商品域）
- **主数据管理**（MDM）：定义核心数据实体与标准
- **数据血缘**（Data Lineage）：追踪数据流转路径
- **跨境策略**：数据驻留与跨境传输规则
- **生命周期管理**：数据创建、存储、归档、销毁

**安全控制映射**：

- **数据分级分类**：L0-L4五级分类体系
- **加密与脱敏**：静态加密、传输加密、动态脱敏
- **血缘与访问审计**：数据访问日志、审计追溯
- **备份与恢复**：定期备份、灾难恢复
- **驻留管理**：合规的数据存储位置

**示例：数据分级与控制矩阵**

| 数据级别              | 定义                      | 典型数据               | 安全控制                     |
| --------------------- | ------------------------- | ---------------------- | ---------------------------- |
| **L4 严格受限** | 泄露导致严重法律/声誉风险 | 支付卡信息、生物特征   | 加密存储、最小授权、审计100% |
| **L3 高度敏感** | 泄露导致重大业务影响      | 身份证、护照、健康数据 | 加密存储、脱敏展示、审计     |
| **L2 敏感**     | 泄露影响用户隐私          | 姓名、手机、邮箱、地址 | 访问控制、脱敏、日志         |
| **L1 内部**     | 内部业务数据              | 订单号、商品ID         | 访问控制、日志               |
| **L0 公开**     | 可公开数据                | 商品名称、描述         | 无特殊要求                   |

### 3. Application（应用架构）

**核心定位**：规划应用系统的功能、交互关系与集成方案。

**关键产出**：

- **应用组件图**：核心应用及依赖关系
- **微服务架构**：服务拆分与边界
- **集成架构**：服务间通信方式（同步/异步）
- **事件驱动架构**：事件流与事件总线
- **API管理**：API 网关、速率限制、版本管理
- **可观测性**：日志、指标、链路追踪

**安全控制映射**：

- **认证与鉴权**：OAuth 2.0/OIDC、RBAC/ABAC
- **输入校验**：防注入、防XSS、防CSRF
- **SDL流程**：SAST/DAST/SCA/IAST
- **WAF/RASP**：应用层防护
- **API安全**：认证、授权、速率限制、契约校验

**示例：微服务安全架构**

```
┌────────────────────────────────────────────────────┐
│                   API Gateway                       │
│  • 统一认证（OAuth2/JWT）                           │
│  • 速率限制与熔断                                   │
│  • 请求日志与审计                                   │
└────────────────────────────────────────────────────┘
                      ↓
        ┌─────────────┼─────────────┐
        ↓             ↓             ↓
┌──────────────┐ ┌──────────────┐ ┌──────────────┐
│ User Service │ │ Order Service│ │ Payment Svc  │
│ • 身份验证   │ │ • 授权检查   │ │ • 敏感操作   │
│ • 密码管理   │ │ • 数据校验   │ │ • 加密传输   │
└──────────────┘ └──────────────┘ └──────────────┘
        ↓             ↓             ↓
┌─────────────────────────────────────────────────┐
│              Service Mesh (Istio/Linkerd)        │
│  • mTLS（服务间加密）                            │
│  • 细粒度授权策略                                │
│  • 流量监控与异常检测                            │
└─────────────────────────────────────────────────┘
```

### 4. Technology（技术架构/基础设施）

**核心定位**：为上层架构提供技术支撑，可统一表述为"基础设施（Infrastructure）"。

**关键产出**：

- **云基础层**（Cloud）：多云/混合云战略
- **IaaS层**：计算、存储、网络资源
- **PaaS层**：容器编排（K8s）、数据库、中间件
- **SaaS层**：企业应用（CRM/ERP/协作工具）

**安全控制映射**：

- **CSPM/CIEM**：云安全态势管理、权限管理
- **网络分段**：VPC、子网、安全组、防火墙
- **密钥管理**：KMS/HSM、密钥轮换
- **日志集中化**：SIEM、日志聚合与分析

---

## 1.3.4 BDAT与云服务映射

### 从抽象到具象：IT架构的云服务映射

基于BDAT四层架构，可将"IT架构"（含数据、应用、基础设施三层）从**抽象逻辑**转化为**具象的云服务分层结构**：

```
抽象层（TOGAF BDAT）          具象层（Cloud Services）
┌──────────────────┐
│  Business Layer  │          ┌─────────────────────┐
│   (业务架构)      │ ────────→│  Business Services  │
└──────────────────┘          │  (业务能力平台)      │
                              └─────────────────────┘
┌──────────────────┐
│   Data Layer     │          ┌─────────────────────┐
│   (数据架构)      │ ────────→│  SaaS (软件即服务)   │
└──────────────────┘          │  • CRM/ERP/BI       │
                              │  • 协作工具         │
┌──────────────────┐          └─────────────────────┘
│ Application Layer│                    ↓
│   (应用架构)      │          ┌─────────────────────┐
└──────────────────┘ ────────→│  PaaS (平台即服务)   │
                              │  • 容器编排(K8s)     │
┌──────────────────┐          │  • 数据库/中间件     │
│ Technology Layer │          │  • API网关/服务网格  │
│  (技术架构)       │          └─────────────────────┘
└──────────────────┘                    ↓
                              ┌─────────────────────┐
                              │  IaaS (基础设施服务) │
                              │  • 计算(VM/容器)     │
                              │  • 存储(对象/块)     │
                              │  • 网络(VPC/LB)      │
                              └─────────────────────┘
                                        ↓
                              ┌─────────────────────┐
                              │  Cloud (云基础层)    │
                              │  • 数据中心          │
                              │  • 物理基础设施      │
                              └─────────────────────┘
```

**映射关系总结**：

| TOGAF层               | 实施层映射                           | 云服务形态                   |
| --------------------- | ------------------------------------ | ---------------------------- |
| **Business**    | 业务能力图/价值流/服务蓝图           | Business Capability Platform |
| **Data**        | 数据域/主数据/血缘/跨境策略/生命周期 | SaaS层数据管理               |
| **Application** | 应用/微服务/集成/事件与API/可观测    | PaaS层应用平台               |
| **Technology**  | Cloud/IaaS/PaaS/SaaS资源与平台       | IaaS+Cloud层基础设施         |

---

## 1.3.5 参考实施模型

### 应用层参考模型

**架构模式**：

- **微服务架构**：按业务能力拆分服务
- **事件驱动架构**（EDA）：异步解耦、最终一致性
- **BFF模式**（Backend For Frontend）：前端专用API聚合层
- **API管理平台**：统一网关、速率限制、版本管理

**技术选型**：

- 框架：Spring Boot / FastAPI / Node.js
- 容器化：Docker + K8s
- 服务网格：Istio / Linkerd
- API 网关：Kong / Apigee / AWS API 网关

### 数据层参考模型

**架构模式**：

- **数据网格**（Data Mesh）：域驱动的数据所有权
- **数据仓库**（Data Warehouse）：OLAP分析
- **数据湖**（Data Lake）：原始数据存储
- **实时流处理**：Kafka / Pulsar / Flink

**技术选型**：

- 关系型：PostgreSQL / MySQL
- NoSQL：MongoDB / Redis / Cassandra
- 数据仓库：Snowflake / BigQuery / Redshift
- 流处理：Kafka / Pulsar / Flink

### 集成层参考模型

**架构模式**：

- **API 网关**：统一入口、认证鉴权、流量控制
- **服务网格**（Service Mesh）：服务间通信治理
- **消息中间件**：异步通信、削峰填谷

**技术选型**：

- API 网关：Kong / Apigee / Tyk
- 服务网格：Istio / Linkerd / Consul
- 消息队列：Kafka / RabbitMQ / AWS SQS

### 基础设施层参考模型

**架构模式**：

- **多云/混合云**：避免厂商锁定
- **容器编排**：Kubernetes集群管理
- **基础镜像与运行时**：标准化镜像、安全加固

**技术选型**：

- 云平台：AWS / Azure / GCP / 阿里云
- 容器编排：Kubernetes / AWS ECS / Azure AKS
- 基础镜像：Alpine / Distroless / Chainguard

---

## 1.3.6 安全控制映射

### API平台安全控制

| 控制域                   | 控制措施        | 实现方式               |
| ------------------------ | --------------- | ---------------------- |
| **认证**           | 统一认证中心    | OAuth2/OIDC、JWT       |
| **授权**           | 细粒度权限控制  | RBAC/ABAC、API Scope   |
| **契约治理**       | API规范强制执行 | OpenAPI Spec、契约测试 |
| **配额与速率限制** | 防滥用与DDoS    | 令牌桶算法、滑动窗口   |
| **密钥管理**       | API Key轮换     | KMS托管、自动轮换      |
| **审计**           | 请求日志与追踪  | 访问日志、链路追踪     |

### 数据平台安全控制

| 控制域             | 控制措施         | 实现方式              |
| ------------------ | ---------------- | --------------------- |
| **数据分级** | 五级分类体系     | 数据标签、元数据管理  |
| **加密**     | 静态与传输加密   | AES-256、TLS 1.3      |
| **脱敏**     | 动态脱敏与代币化 | 脱敏规则引擎、Token化 |
| **血缘追踪** | 数据流转可追溯   | 血缘分析平台          |
| **访问审计** | 数据访问日志     | 审计日志、SIEM集成    |
| **备份恢复** | 定期备份与DR     | 增量备份、异地容灾    |
| **驻留管理** | 合规的数据位置   | 数据地图、驻留策略    |

### 云平台安全控制

| 控制域               | 控制措施       | 实现方式                      |
| -------------------- | -------------- | ----------------------------- |
| **态势管理**   | 云资源配置合规 | CSPM（Prisma/Wiz/Lacework）   |
| **权限管理**   | 最小权限原则   | CIEM、IAM策略即代码           |
| **网络分段**   | 微分段与隔离   | VPC、安全组、Network Policy   |
| **密钥管理**   | 集中式密钥管理 | AWS KMS / Azure Key Vault     |
| **日志集中化** | 统一日志收集   | CloudTrail/CloudWatch → SIEM |
| **合规性**     | 自动化合规检查 | AWS Config / Azure Policy     |

---

## 1.3.7 实践案例：金融科技公司IT架构安全设计

### 背景

某金融科技公司提供在线支付与理财服务，面临以下挑战：

- 高度监管环境（PCI DSS、金融合规）
- 业务快速增长（日交易量从10万笔增至100万笔）
- 多云架构（AWS主用、阿里云备用）
- 复杂的数据流转（跨境支付、数据驻留）

### 架构设计

**1. Business层（业务架构）**

| 业务能力 | 核心流程              | 安全要求              |
| -------- | --------------------- | --------------------- |
| 用户注册 | KYC实名认证           | 身份验证、反欺诈      |
| 充值提现 | 银行卡绑定、交易      | PCI DSS合规、加密传输 |
| 投资理财 | 产品购买、赎回        | 风控评估、交易审计    |
| 风险控制 | 反洗钱（AML）、反欺诈 | 异常检测、规则引擎    |

**2. Data层（数据架构）**

```
数据分级策略：
├── L4 严格受限：银行卡号、CVV、密码
│   └── 控制：加密存储(AES-256)、最小授权、审计100%
├── L3 高度敏感：身份证号、人脸照片、交易记录
│   └── 控制：加密存储、脱敏展示、访问审计
├── L2 敏感：姓名、手机号、账户余额
│   └── 控制：访问控制、日志记录
└── L1 内部：产品信息、系统配置
    └── 控制：基础访问控制
```

**数据驻留要求**：

- 中国用户数据：存储于阿里云（中国大陆）
- 海外用户数据：存储于AWS（新加坡/法兰克福）
- 跨境数据传输：通过VPN专线加密传输

**3. Application层（应用架构）**

微服务架构设计：

```
┌─────────────────────────────────────────┐
│          API Gateway (Kong)              │
│  • OAuth2认证                            │
│  • 速率限制（1000 req/min/user）         │
│  • WAF规则（OWASP Top 10）               │
└─────────────────────────────────────────┘
                  ↓
    ┌─────────────┼─────────────┐
    ↓             ↓             ↓
┌─────────┐ ┌──────────┐ ┌────────────┐
│ User Svc│ │Payment Svc│ │Investment │
│ • KYC   │ │• PCI DSS  │ │Svc        │
│ • Auth  │ │• 加密传输 │ │• 风控     │
└─────────┘ └──────────┘ └────────────┘
    ↓             ↓             ↓
┌─────────────────────────────────────────┐
│       Service Mesh (Istio)               │
│  • mTLS（服务间加密）                    │
│  • 授权策略（JWT验证）                   │
└─────────────────────────────────────────┘
```

**SDL流程集成**：

- 需求阶段：威胁建模（STRIDE方法）
- 开发阶段：SAST（SonarQube）、SCA（Snyk）、Secrets扫描（GitLeaks）
- 测试阶段：DAST（OWASP ZAP）、API安全测试
- 发布阶段：镜像签名（Cosign）、K8s策略门禁（OPA）

**4. Technology层（技术架构）**

**云资源布局**：

| 云平台                 | 用途           | 安全控制                             |
| ---------------------- | -------------- | ------------------------------------ |
| **AWS（主）**    | 核心业务系统   | CSPM（Prisma Cloud）、CloudTrail审计 |
| **阿里云（备）** | 中国市场、灾备 | 态势感知、操作审计                   |
| **混合云**       | 专线互联       | VPN加密、流量监控                    |

**网络架构**：

```
Internet
    ↓
[WAF/DDoS防护]
    ↓
┌─────────────────────────┐
│  Public Subnet (DMZ)    │
│  • ALB (负载均衡)        │
│  • NAT Gateway          │
└─────────────────────────┘
    ↓
┌─────────────────────────┐
│  Private Subnet (App)   │
│  • K8s Worker Nodes     │
│  • Application Services │
└─────────────────────────┘
    ↓
┌─────────────────────────┐
│  Private Subnet (Data)  │
│  • RDS (加密)           │
│  • ElastiCache (加密)   │
│  • 无公网访问           │
└─────────────────────────┘
```

**密钥管理**：

- 使用AWS KMS管理加密密钥
- 数据库密码存储于AWS Secrets Manager
- 自动密钥轮换（90天）

### 实施成果

**安全指标**：

- 数据加密覆盖率：100%（静态+传输）
- 高危漏洞修复时间：从14天降至3天
- 安全审计通过率：PCI DSS认证一次通过
- 安全事件响应时间：从4小时降至30分钟

**业务影响**：

- 系统可用性：99.95% → 99.99%
- 监管合规：通过PCI DSS、等保三级认证
- 客户信任：NPS提升12分
- 市场准入：成功进入香港、新加坡市场

---

## 小结

IT架构是连接业务战略与技术实施的关键桥梁：

1. **IT架构原则**：标准化（黄金路径）、共享责任清晰、可组合低耦合
2. **TOGAF BDAT模型**：业务/数据/应用/技术四层架构，从抽象到具象
3. **云服务映射**：BDAT → Cloud/IaaS/PaaS/SaaS的完整映射关系
4. **参考实施模型**：应用层、数据层、集成层、基础设施层的架构模式与技术选型
5. **安全控制映射**：API平台、数据平台、云平台的具体安全控制措施

---

**下一节**：[1.4 安全架构全景——从战略到落地](./1.4_security_architecture_landscape.md)

## 📍 导航 | Navigation

**[← 上一节](./1.2_business_architecture.md)** | **[返回 Part 1](../)** | **[返回总目录](../../)** | **[→ 下一节](./1.4_security_architecture_landscape.md)**

---

**© 2025 AI-ESA Project. Licensed under CC BY-NC-SA 4.0**
